import{r as a,l as ue,m as he,n as me,e as xe,d as M,k as pe,q as te,c as H,w as L,g as $,T as A,u as je,i as ve,j as e,p as ge}from"./index-Bkf74Iy9.js";/* empty css                         */const F=()=>{const c=new Date;let o=(6-c.getDay()+7)%7;if(o===0){const g=new Date(c);g.setHours(9,45,0,0),c>g&&(o=7)}const N=new Date(c);return N.setDate(c.getDate()+o),N},T=c=>`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,fe=c=>new Date(c+"T09:00:00").toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"});function Ne(){const[c,I]=a.useState(!0),[o,N]=a.useState(null),[g,U]=a.useState(null),[p,ie]=a.useState({attended:0,streak:0,strikes:0}),[E,V]=a.useState(null),D=a.useRef(null),[w,B]=a.useState(0),[R,ne]=a.useState(!1),O=a.useRef(0),y=a.useRef(!1),{currentUser:q,isClient:z,clientData:l,logout:ae,loading:_}=ue(),{isDark:G,toggleTheme:ce}=he(),f=me();a.useCallback((s,r="info")=>{V({message:s,type:r}),setTimeout(()=>V(null),4e3)},[]),a.useEffect(()=>{!_&&(!q||!z)&&f("/")},[q,z,_,f]),a.useEffect(()=>{const s=()=>window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,r=d=>{s()<=0&&(O.current=d.touches[0].clientY,y.current=!1)},u=d=>{const m=s(),v=d.touches[0].clientY-O.current;if(m>5||v<=0){y.current=!1,B(0);return}v>20&&m<=0&&(y.current=!0,B(Math.min((v-20)*.4,80)))},h=()=>{y.current&&w>60?(ne(!0),setTimeout(()=>{window.location.reload()},300)):B(0),y.current=!1};return document.addEventListener("touchstart",r,{passive:!0}),document.addEventListener("touchmove",u,{passive:!0}),document.addEventListener("touchend",h),()=>{document.removeEventListener("touchstart",r),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",h)}},[w]),a.useEffect(()=>{const s=()=>{const u=new Date,h=F();h.setHours(9,0,0,0);const d=h-u;if(d<=0){N({days:0,hours:0,minutes:0,seconds:0});return}N({days:Math.floor(d/864e5),hours:Math.floor(d%864e5/36e5),minutes:Math.floor(d%36e5/6e4),seconds:Math.floor(d%6e4/1e3)});const m=T(h);D.current&&D.current!==m&&l&&(D.current=m,Q())};s();const r=setInterval(s,1e3);return()=>clearInterval(r)},[l]),a.useEffect(()=>{l&&Q()},[l]);const Q=async()=>{try{const s=T(F());D.current=s;const r=xe(M,"circuitSessions",s),u=await pe(r);if(u.exists()){const t=u.data();try{const j=te(H(M,"clients"),L("clientType","==","circuit_vip"),L("status","==","active")),i=(await $(j)).docs.map(n=>({id:n.id,...n.data()})),X=t.slots.filter(n=>n.memberId).map(n=>n.memberId),C=t.vipOptOuts||[],Z=i.filter(n=>!X.includes(n.id)&&!C.includes(n.id));if(Z.length>0){const n=[...t.slots];let ee=!1;for(const se of Z){const Y=n.findIndex(de=>de.status==="available");if(Y===-1)break;n[Y]={slotNumber:n[Y].slotNumber,memberId:se.id,memberName:se.name,memberType:"circuit_vip",status:"confirmed",bookedAt:A.now()},ee=!0}ee&&(await je(r,{slots:n}),t.slots=n)}}catch(j){console.error("VIP auto-slot check failed (non-critical):",j)}const x=t.slots?.find(j=>j.memberId===l.id);U(x||null)}else{let t=[];try{const i=te(H(M,"clients"),L("clientType","==","circuit_vip"),L("status","==","active"));t=(await $(i)).docs.map(C=>({id:C.id,...C.data()}))}catch(i){console.error("VIP query failed, creating session with empty slots:",i)}const x=[];for(let i=0;i<8;i++)i<t.length?x.push({slotNumber:i+1,memberId:t[i].id,memberName:t[i].name,memberType:"circuit_vip",status:"confirmed",bookedAt:A.now()}):x.push({slotNumber:i+1,memberId:null,memberName:null,memberType:null,status:"available"});const j={date:s,time:"09:00",endTime:"09:45",maxCapacity:8,slots:x,waitlist:[],createdAt:A.now()};await ve(r,j);const k=x.find(i=>i.memberId===l.id);U(k||null)}const d=(await $(H(M,"circuitSessions"))).docs.map(t=>({id:t.id,...t.data()})),m=new Date;m.setHours(0,0,0,0);let P=0;const v=[];d.forEach(t=>{new Date(t.date+"T09:00:00")<m&&t.slots?.some(k=>k.memberId===l.id&&(k.status==="confirmed"||k.status==="attended"))&&(P++,v.push(t.date))}),v.sort((t,x)=>x.localeCompare(t));let K=0,b=new Date(m);const W=b.getDay(),le=W>=6?W-6:W+1;b.setDate(b.getDate()-le);for(const t of v)if(t===T(b))K++,b.setDate(b.getDate()-7);else break;ie({attended:P,streak:K,strikes:l.circuitStrikes||0,banUntil:l.circuitBanUntil||null})}catch(s){console.error("Error fetching circuit data:",s)}I(!1)};if(_||c)return e.jsx("div",{className:"circuit-page",children:e.jsx("div",{className:"circuit-loading",children:e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"circuit-loading-logo"})})});const re=T(F()),S=l?.clientType||"block",J=S==="circuit_vip"||S==="circuit_dropin",oe=S==="circuit_vip"?"VIP":S==="circuit_dropin"?"Drop-in":"Block";return e.jsxs("div",{className:`circuit-page ${G?"dark":""}`,children:[w>0&&e.jsxs("div",{className:"pull-indicator",style:{height:w},children:[e.jsx("div",{className:`pull-spinner ${R?"spinning":""}`,children:R?"↻":"↓"}),e.jsx("span",{children:R?"Refreshing...":w>60?"Release to refresh":"Pull to refresh"})]}),e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:ce,"aria-label":"Toggle theme",children:G?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})}),J&&e.jsx("button",{onClick:ae,"aria-label":"Log out",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"})})})]})]})}),e.jsxs("main",{className:"circuit-main",children:[e.jsxs("div",{className:"circuit-intro",children:[e.jsx("h2",{children:"Circuit Class"}),e.jsxs("p",{children:["Hey ",l?.name?.split(" ")[0],"! Your Saturday session awaits."]})]}),o&&e.jsxs("div",{className:"circuit-countdown",children:[e.jsxs("div",{className:"circuit-ring",children:[e.jsx("svg",{className:"circuit-ring-svg",viewBox:"0 0 200 200",children:ge.map((s,r)=>{const u=60-o.seconds,h=r<u;return e.jsx("line",{x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,className:`circuit-tick ${h?"elapsed":"remaining"}`,strokeWidth:s.thick?"3":"2"},r)})}),e.jsxs("div",{className:"circuit-ring-center",children:[e.jsx("div",{className:"circuit-ring-logo",children:e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness"})}),e.jsx("div",{className:"circuit-ring-label",children:"Next Class"}),e.jsxs("div",{className:"circuit-ring-countdown",children:[o.days>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"circuit-digit",children:String(o.days).padStart(2,"0")}),e.jsx("span",{className:"circuit-colon",children:":"})]}),e.jsx("span",{className:"circuit-digit",children:String(o.hours).padStart(2,"0")}),e.jsx("span",{className:"circuit-colon",children:":"}),e.jsx("span",{className:"circuit-digit",children:String(o.minutes).padStart(2,"0")}),e.jsx("span",{className:"circuit-colon",children:":"}),e.jsx("span",{className:"circuit-digit circuit-seconds",children:String(o.seconds).padStart(2,"0")})]}),e.jsx("div",{className:"circuit-ring-sub",children:"Saturday 9:00am"})]})]}),e.jsx("p",{className:"circuit-date-full",children:fe(re)})]}),e.jsx("div",{className:`circuit-status-card ${g?"booked":"not-booked"}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"circuit-status-check",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"circuit-status-info",children:[e.jsx("h3",{children:"You're Locked In"}),e.jsxs("p",{children:["Slot #",g.slotNumber," • ",oe]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"circuit-status-alert",children:"!"}),e.jsxs("div",{className:"circuit-status-info",children:[e.jsx("h3",{children:"Not Booked Yet"}),e.jsx("p",{children:"Tap below to view and book your slot"})]}),e.jsx("button",{className:"circuit-book-now-btn",onClick:()=>f("/client/circuit/booking"),children:"Book Now"})]})}),e.jsxs("div",{className:"circuit-stats-card",children:[e.jsx("h3",{children:"Your Stats"}),e.jsxs("div",{className:"circuit-stats-grid",children:[e.jsxs("div",{className:"circuit-stat",children:[e.jsx("span",{className:"circuit-stat-value",children:p.attended}),e.jsx("span",{className:"circuit-stat-label",children:"Classes"})]}),e.jsxs("div",{className:"circuit-stat",children:[e.jsx("span",{className:"circuit-stat-value",children:p.streak}),e.jsx("span",{className:"circuit-stat-label",children:"Week Streak"})]}),e.jsxs("div",{className:"circuit-stat",children:[e.jsxs("span",{className:`circuit-stat-value ${p.strikes>=2?"warning":""}`,children:[p.strikes,"/3"]}),e.jsx("span",{className:"circuit-stat-label",children:"Strikes"})]})]}),p.banUntil&&(()=>{const s=p.banUntil.toDate?p.banUntil.toDate():new Date(p.banUntil.seconds*1e3);return s>new Date?e.jsxs("div",{className:"circuit-ban-notice",children:["Booking suspended until ",s.toLocaleDateString("en-GB",{day:"numeric",month:"long"})]}):null})()]}),e.jsxs("div",{className:"circuit-rules",children:[e.jsx("h4",{children:"Class Rules"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Book your slot ",e.jsx("strong",{children:"anytime before class"})]}),e.jsxs("li",{children:["Cancel at least ",e.jsx("strong",{children:"24 hours"})," before class"]}),e.jsx("li",{children:"3 no-show strikes = 1 month booking ban"})]})]}),S!=="circuit_vip"&&e.jsxs("div",{className:"circuit-vip-promo",children:[e.jsx("div",{className:"vip-promo-badge",children:"VIP"}),e.jsx("h3",{children:"Become a VIP Member"}),e.jsxs("p",{className:"vip-promo-price",children:["Just ",e.jsx("strong",{children:"£25"}),"/month"]}),e.jsx("p",{className:"vip-promo-desc",children:"Full access with a priority spot every week — your slot is automatically locked in before anyone else can book."}),e.jsxs("ul",{className:"vip-promo-perks",children:[e.jsx("li",{children:"Guaranteed slot every Saturday"}),e.jsx("li",{children:"Auto-booked — no need to race for a spot"}),e.jsx("li",{children:"Cancel anytime for the week, reinstated the next"})]}),e.jsxs("a",{href:"https://wa.me/447449782055?text=Hi%20Ross%2C%20I%27d%20like%20to%20become%20a%20VIP%20circuit%20member!",target:"_blank",rel:"noopener noreferrer",className:"vip-promo-wa-btn",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),"Message on WhatsApp"]})]})]}),e.jsxs("nav",{className:"circuit-bottom-nav",children:[!J&&e.jsxs("button",{className:"circuit-nav-tab",onClick:()=>f("/client"),children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs("button",{className:"circuit-nav-tab active",onClick:()=>f("/client/circuit"),children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),e.jsx("span",{children:"Home"})]}),e.jsxs("button",{className:"circuit-nav-tab",onClick:()=>f("/client/circuit/booking"),children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsx("span",{children:"Class"})]})]}),E&&e.jsx("div",{className:`toast-notification ${E.type}`,children:e.jsx("span",{children:E.message})})]})}export{Ne as default};
