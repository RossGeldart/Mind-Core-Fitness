import{r as p,g as ue,q as Te,c as te,d as $,o as Ue,j as e,a as ke,T as me,w as Ee,b as we,e as ae,f as Ve,s as Pe,h as ze,u as je,i as Ye,k as Ge,l as Ke,m as Je,n as Qe}from"./index-DGP_OPbz.js";import{f as he,D as Xe,g as Ze,a as Re,b as $e,S as _e,t as De,c as Me}from"./scheduleUtils-BAUZ6756.js";function es(){const[m,T]=p.useState([]),[f,B]=p.useState([]),[W,z]=p.useState(!0),[u,L]=p.useState(null),[o,H]=p.useState({}),[E,A]=p.useState(null),[_,ee]=p.useState(""),[h,re]=p.useState("all"),[M,Y]=p.useState(null),[F,O]=p.useState({sessionNotes:"",whatWentWell:"",whatWentWrong:"",whatsNext:""}),[xe,J]=p.useState([]),[oe,d]=p.useState(!1),[Q,U]=p.useState(!1),[se,ne]=p.useState("list");p.useEffect(()=>{N()},[]);const N=async()=>{try{const[s,c]=await Promise.all([ue(Te(te($,"clients"),Ue("name","asc"))),ue(te($,"sessions"))]),g=s.docs.map(i=>({id:i.id,...i.data()})),C=c.docs.map(i=>({id:i.id,...i.data()}));T(g),B(C)}catch(s){console.error("Error fetching data:",s)}z(!1)},P=s=>{const c=new Date,g=c.getFullYear(),C=(c.getMonth()+1).toString().padStart(2,"0"),i=c.getDate().toString().padStart(2,"0"),k=`${g}-${C}-${i}`,Z=`${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}`;return f.filter(I=>I.clientId!==s?!1:I.date<k||I.date===k&&I.time<Z).length},q=s=>{const c=P(s.id);return(s.totalSessions||0)-c},fe=s=>{const c=new Date,g=c.getFullYear(),C=(c.getMonth()+1).toString().padStart(2,"0"),i=c.getDate().toString().padStart(2,"0"),k=`${g}-${C}-${i}`,Z=`${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}`;return f.filter(I=>I.clientId!==s?!1:I.date>k||I.date===k&&I.time>=Z).length},G=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"-",ie=async(s,c)=>{if(window.confirm(`Are you sure you want to delete ${c}? This will also delete all their booked sessions.`))try{const C=f.filter(i=>i.clientId===s).map(i=>we(ae($,"sessions",i.id)));await Promise.all(C),await we(ae($,"clients",s)),T(m.filter(i=>i.id!==s)),B(f.filter(i=>i.clientId!==s))}catch(g){console.error("Error deleting client:",g),alert("Failed to delete client")}},ce=s=>{if(!s)return"";const c=s.toDate?s.toDate():new Date(s),g=c.getFullYear(),C=(c.getMonth()+1).toString().padStart(2,"0"),i=c.getDate().toString().padStart(2,"0");return`${g}-${C}-${i}`},le=s=>{L(s.id),H({name:s.name,email:s.email,password:"",clientType:s.clientType||"block",weeksInBlock:s.weeksInBlock||"",totalSessions:s.totalSessions||"",sessionsRemaining:s.sessionsRemaining,sessionDuration:s.sessionDuration||45,startDate:ce(s.startDate),endDate:ce(s.endDate),status:s.status,hasPortalAccess:!!s.uid,circuitAccess:!!s.circuitAccess,coreBuddyAccess:!!s.coreBuddyAccess,buddyEnabled:!!s.buddyEnabled,coreBuddyPlan:s.coreBuddyPlan||"free",isJunior:!!s.isJunior})},X=s=>{const{name:c,value:g}=s.target;if(H(C=>({...C,[c]:g})),c==="startDate"||c==="weeksInBlock"){const C=c==="startDate"?g:o.startDate,i=parseInt(c==="weeksInBlock"?g:o.weeksInBlock);if(C&&i>0){const k=new Date(C),Z=new Date(k);Z.setDate(Z.getDate()+i*7);const I=Z.getFullYear(),de=(Z.getMonth()+1).toString().padStart(2,"0"),ge=Z.getDate().toString().padStart(2,"0");H(Ne=>({...Ne,[c]:g,endDate:`${I}-${de}-${ge}`}))}}},K=async s=>{try{const c=m.find(k=>k.id===s);let g=c?.uid;if(o.password&&o.password.length>=6&&!c?.uid)try{const k=await Ve(Pe,o.email.trim().toLowerCase(),o.password);await ze(Pe),g=k.user.uid}catch(k){if(console.error("Error creating auth account:",k),k.code==="auth/email-already-in-use")alert("This email already has a portal account. Password not changed.");else if(k.code==="auth/weak-password"){alert("Password must be at least 6 characters.");return}else{alert("Failed to create portal account: "+k.message);return}}const C=o.clientType==="block",i={name:o.name.trim(),email:o.email.trim().toLowerCase(),clientType:o.clientType,status:o.status,coreBuddyAccess:o.coreBuddyAccess,buddyEnabled:o.buddyEnabled,isJunior:o.isJunior};if(C)i.weeksInBlock=parseInt(o.weeksInBlock)||0,i.totalSessions=parseInt(o.totalSessions)||0,i.sessionDuration=parseInt(o.sessionDuration),i.circuitAccess=o.circuitAccess,o.startDate&&(i.startDate=me.fromDate(new Date(o.startDate))),o.endDate&&(i.endDate=me.fromDate(new Date(o.endDate)));else if(o.clientType==="core_buddy")i.coreBuddyPlan=o.coreBuddyPlan||"free",i.coreBuddyAccess=!0;else{const k=m.find(Z=>Z.id===s);k?.circuitStrikes===void 0&&(i.circuitStrikes=0),k?.circuitBanUntil===void 0&&(i.circuitBanUntil=null)}g&&!c?.uid&&(i.uid=g),await je(ae($,"clients",s),i),T(m.map(k=>k.id===s?{...k,...o,uid:g||k.uid,weeksInBlock:parseInt(o.weeksInBlock),totalSessions:parseInt(o.totalSessions),sessionDuration:parseInt(o.sessionDuration),startDate:me.fromDate(new Date(o.startDate)),endDate:me.fromDate(new Date(o.endDate))}:k)),L(null),g&&!c?.uid&&alert("Portal access created! Client can now log in.")}catch(c){console.error("Error updating client:",c),alert("Failed to update client")}},pe=async s=>{try{const c=m.find(g=>g.id===s)?.status==="archived"?"active":"archived";await je(ae($,"clients",s),{status:c}),T(m.map(g=>g.id===s?{...g,status:c}:g))}catch(c){console.error("Error archiving client:",c),alert("Failed to update client status")}},be=async s=>{Y({clientId:s.id,clientName:s.name}),ne("list"),O({sessionNotes:"",whatWentWell:"",whatWentWrong:"",whatsNext:""}),d(!0);try{const c=Te(te($,"sessionNotes"),Ee("clientId","==",s.id)),C=(await ue(c)).docs.map(i=>({id:i.id,...i.data()}));C.sort((i,k)=>{const Z=i.createdAt?.toMillis?.()||0;return(k.createdAt?.toMillis?.()||0)-Z}),J(C)}catch(c){console.error("Error fetching notes:",c),J([])}d(!1)},ve=()=>{Y(null),J([]),ne("list")},n=async()=>{if(!M)return;const{sessionNotes:s,whatWentWell:c,whatWentWrong:g,whatsNext:C}=F;if(!(!s.trim()&&!c.trim()&&!g.trim()&&!C.trim())){U(!0);try{const k=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});await ke(te($,"sessionNotes"),{clientId:M.clientId,date:k,sessionNotes:s.trim(),whatWentWell:c.trim(),whatWentWrong:g.trim(),whatsNext:C.trim(),createdAt:me.now()}),O({sessionNotes:"",whatWentWell:"",whatWentWrong:"",whatsNext:""});const Z=Te(te($,"sessionNotes"),Ee("clientId","==",M.clientId)),de=(await ue(Z)).docs.map(ge=>({id:ge.id,...ge.data()}));de.sort((ge,Ne)=>{const ye=ge.createdAt?.toMillis?.()||0;return(Ne.createdAt?.toMillis?.()||0)-ye}),J(de),ne("list")}catch(i){console.error("Error saving note:",i),alert("Failed to save note. Check Firestore rules for sessionNotes collection.")}U(!1)}},v=async s=>{if(window.confirm("Delete this session note?"))try{await we(ae($,"sessionNotes",s)),J(xe.filter(c=>c.id!==s))}catch(c){console.error("Error deleting note:",c)}};if(W)return e.jsx("div",{className:"client-list-loading",children:"Loading clients..."});if(m.length===0)return e.jsxs("div",{className:"client-list-empty",children:[e.jsx("p",{children:"No clients yet"}),e.jsx("span",{children:"Add your first client to get started"})]});const b=s=>s.clientType==="circuit_vip"?"VIP":s.clientType==="circuit_dropin"?"Drop-in":s.clientType==="core_buddy"?"Core Buddy":"Block",S=m.filter(s=>s.name?.toLowerCase().includes(_.toLowerCase())||s.email?.toLowerCase().includes(_.toLowerCase())).sort((s,c)=>(s.name||"").localeCompare(c.name||"")),V=s=>s.clientType==="circuit_vip"||s.clientType==="circuit_dropin",R=s=>s.clientType==="core_buddy",a=s=>s.status==="archived",j=S.filter(s=>!a(s)),D=j.filter(s=>!V(s)&&!R(s)),t=j.filter(s=>V(s)),l=j.filter(s=>R(s)),r=S.filter(s=>a(s)),y=h==="block"?D:h==="circuit"?t:h==="core_buddy"?l:h==="archived"?r:j,x=s=>{u||A(c=>c===s?null:s)},w=s=>{const c=E===s.id,g=u===s.id,C=!s.clientType||s.clientType==="block";return e.jsxs("div",{className:`client-card ${s.status==="archived"?"archived":""} ${c||g?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"client-name-row",onClick:()=>x(s.id),children:[e.jsxs("div",{className:"client-name-row-left",children:[e.jsx("span",{className:"client-name-initial",children:s.name?.charAt(0)?.toUpperCase()}),e.jsxs("div",{className:"client-name-text",children:[e.jsx("h3",{children:s.name}),e.jsx("span",{className:"client-name-sub",children:C?`${q(s)}/${s.totalSessions||0} sessions`:b(s)})]})]}),e.jsxs("div",{className:"client-name-row-right",children:[(s.clientType==="circuit_vip"||s.clientType==="circuit_dropin"||s.clientType==="core_buddy")&&e.jsx("span",{className:`client-type-badge ${s.clientType==="circuit_vip"?"vip":s.clientType==="core_buddy"?"core-buddy":"dropin"}`,children:b(s)}),e.jsx("span",{className:`status-dot ${s.status}`}),e.jsx("svg",{className:`client-chevron ${c||g?"open":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]})]}),(c||g)&&e.jsx("div",{className:"client-expand-panel",children:g?e.jsxs("div",{className:"edit-form",children:[e.jsx("div",{className:"edit-type-toggle",children:[{value:"block",label:"Block"},{value:"circuit_vip",label:"VIP"},{value:"circuit_dropin",label:"Drop-in"},{value:"core_buddy",label:"Core Buddy"}].map(i=>e.jsx("button",{type:"button",className:`edit-type-btn ${o.clientType===i.value?"active":""}`,onClick:()=>H(k=>({...k,clientType:i.value})),children:i.label},i.value))}),e.jsxs("div",{className:"edit-row",children:[e.jsx("input",{type:"text",name:"name",value:o.name,onChange:X,placeholder:"Name"}),e.jsx("input",{type:"email",name:"email",value:o.email,onChange:X,placeholder:"Email"})]}),o.clientType==="block"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"edit-row",children:[e.jsx("input",{type:"number",name:"weeksInBlock",value:o.weeksInBlock,onChange:X,placeholder:"Weeks",min:"1"}),e.jsx("input",{type:"number",name:"totalSessions",value:o.totalSessions,onChange:X,placeholder:"Total Sessions",min:"1"}),e.jsxs("select",{name:"sessionDuration",value:o.sessionDuration,onChange:X,children:[e.jsx("option",{value:"30",children:"30 min"}),e.jsx("option",{value:"45",children:"45 min"})]})]}),e.jsxs("div",{className:"edit-row",children:[e.jsx("input",{type:"date",name:"startDate",value:o.startDate,onChange:X}),e.jsx("input",{type:"date",name:"endDate",value:o.endDate,onChange:X})]})]}),o.clientType==="core_buddy"&&e.jsx("div",{className:"edit-row",children:e.jsxs("select",{name:"coreBuddyPlan",value:o.coreBuddyPlan,onChange:X,children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"premium",children:"Premium"})]})}),e.jsx("div",{className:"edit-row password-row",children:o.hasPortalAccess?e.jsx("div",{className:"portal-status has-access",children:"Has portal access"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",name:"password",value:o.password,onChange:X,placeholder:"Set portal password (min 6 chars)"}),e.jsx("span",{className:"password-hint",children:"Set password to enable client portal"})]})}),o.clientType==="block"&&e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:o.circuitAccess,onChange:i=>H(k=>({...k,circuitAccess:i.target.checked}))}),e.jsx("span",{children:"Circuit Class Access"})]})}),o.clientType!=="core_buddy"&&e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:o.coreBuddyAccess,onChange:i=>H(k=>({...k,coreBuddyAccess:i.target.checked}))}),e.jsx("span",{children:"Core Buddy Access"})]})}),e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:o.buddyEnabled,onChange:i=>H(k=>({...k,buddyEnabled:i.target.checked}))}),e.jsx("span",{children:"AI Buddy"})]})}),o.clientType==="block"&&e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:o.isJunior,onChange:i=>H(k=>({...k,isJunior:i.target.checked}))}),e.jsx("span",{children:"Junior Client (Kids)"})]})}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"save-edit-btn",onClick:()=>K(s.id),children:"Save"}),e.jsx("button",{className:"cancel-edit-btn",onClick:()=>{L(null)},children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-expand-info",children:[e.jsx("span",{className:"client-email",children:s.email}),e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})]}),C?e.jsxs("div",{className:"client-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Block"}),e.jsxs("span",{className:"detail-value",children:[s.weeksInBlock," weeks"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Sessions"}),e.jsxs("span",{className:"detail-value",children:[q(s)," / ",s.totalSessions," remaining"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Booked"}),e.jsxs("span",{className:"detail-value",children:[fe(s.id)," sessions"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Duration"}),e.jsxs("span",{className:"detail-value",children:[s.sessionDuration||45," min"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Start"}),e.jsx("span",{className:"detail-value",children:G(s.startDate)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"End"}),e.jsx("span",{className:"detail-value",children:G(s.endDate)})]})]}):s.clientType==="core_buddy"?e.jsxs("div",{className:"client-details circuit-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Plan"}),e.jsx("span",{className:"detail-value",children:s.coreBuddyPlan==="premium"?"Premium":"Free"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Joined"}),e.jsx("span",{className:"detail-value",children:G(s.createdAt)})]})]}):e.jsxs("div",{className:"client-details circuit-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Type"}),e.jsx("span",{className:"detail-value",children:s.clientType==="circuit_vip"?"Monthly VIP":"Drop-in"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Strikes"}),e.jsxs("span",{className:"detail-value",children:[s.circuitStrikes||0,"/3"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Joined"}),e.jsx("span",{className:"detail-value",children:G(s.createdAt)})]})]}),e.jsxs("div",{className:"client-actions",children:[C&&e.jsxs("button",{className:"action-btn notes",onClick:i=>{i.stopPropagation(),be(s)},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"14",height:"14",children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),"Notes"]}),e.jsx("button",{className:"action-btn edit",onClick:i=>{i.stopPropagation(),le(s)},children:"Edit"}),e.jsx("button",{className:"action-btn archive",onClick:i=>{i.stopPropagation(),pe(s.id)},children:s.status==="archived"?"Reactivate":"Archive"}),e.jsx("button",{className:"action-btn delete",onClick:i=>{i.stopPropagation(),ie(s.id,s.name)},children:"Delete"})]})]})})]},s.id)};return e.jsxs("div",{className:"client-list",children:[e.jsxs("div",{className:"client-search",children:[e.jsxs("svg",{className:"client-search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]}),e.jsx("input",{type:"text",placeholder:"Search clients...",value:_,onChange:s=>ee(s.target.value),className:"client-search-input"}),_&&e.jsx("button",{className:"client-search-clear",onClick:()=>ee(""),children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),e.jsx("div",{className:"client-type-filter",children:[{value:"all",label:"All",count:j.length},{value:"block",label:"Block",count:D.length},{value:"circuit",label:"Circuit",count:t.length},{value:"core_buddy",label:"Core Buddy",count:l.length},{value:"archived",label:"Archived",count:r.length}].map(s=>e.jsxs("button",{className:`client-filter-btn ${h===s.value?"active":""}`,onClick:()=>re(s.value),children:[s.label,e.jsx("span",{className:"client-filter-count",children:s.count})]},s.value))}),h==="all"?e.jsxs(e.Fragment,{children:[D.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Block Members ",e.jsx("span",{children:D.length})]}),D.map(w)]}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Circuit Members ",e.jsx("span",{children:t.length})]}),t.map(w)]}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Core Buddy Members ",e.jsx("span",{children:l.length})]}),l.map(w)]})]}):h==="archived"?e.jsx(e.Fragment,{children:r.length===0?e.jsx("div",{className:"client-section-empty",children:"No archived clients"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Archived Clients ",e.jsx("span",{children:r.length})]}),r.map(w)]})}):e.jsxs(e.Fragment,{children:[y.length===0&&e.jsxs("div",{className:"client-section-empty",children:["No ",h," clients found"]}),y.map(w)]}),M&&e.jsx("div",{className:"notes-modal-overlay",onClick:ve,children:e.jsxs("div",{className:"notes-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"notes-modal-header",children:[e.jsxs("h3",{children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),M.clientName]}),e.jsx("button",{className:"notes-modal-close",onClick:ve,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),se==="list"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notes-modal-body",children:oe?e.jsx("div",{className:"notes-loading",children:"Loading notes..."}):xe.length===0?e.jsxs("div",{className:"notes-empty",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",width:"40",height:"40",children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),e.jsx("p",{children:"No session notes yet"}),e.jsx("span",{children:"Add notes after each session"})]}):e.jsx("div",{className:"notes-list",children:xe.map(s=>e.jsxs("div",{className:"note-card",children:[e.jsxs("div",{className:"note-card-header",children:[e.jsx("span",{className:"note-date",children:s.date}),e.jsx("button",{className:"note-delete-btn",onClick:()=>v(s.id),children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"14",height:"14",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]})})]}),s.sessionNotes&&e.jsxs("div",{className:"note-section",children:[e.jsx("span",{className:"note-section-label",children:"Session Notes"}),e.jsx("p",{children:s.sessionNotes})]}),s.whatWentWell&&e.jsxs("div",{className:"note-section went-well",children:[e.jsx("span",{className:"note-section-label",children:"What Went Well"}),e.jsx("p",{children:s.whatWentWell})]}),s.whatWentWrong&&e.jsxs("div",{className:"note-section went-wrong",children:[e.jsx("span",{className:"note-section-label",children:"What Went Wrong"}),e.jsx("p",{children:s.whatWentWrong})]}),s.whatsNext&&e.jsxs("div",{className:"note-section whats-next",children:[e.jsx("span",{className:"note-section-label",children:"What's Next"}),e.jsx("p",{children:s.whatsNext})]})]},s.id))})}),e.jsx("div",{className:"notes-modal-footer",children:e.jsxs("button",{className:"notes-add-btn",onClick:()=>ne("add"),children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Session Notes"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notes-modal-body",children:e.jsxs("div",{className:"notes-form",children:[e.jsxs("div",{className:"notes-form-group",children:[e.jsx("label",{children:"Session Notes"}),e.jsx("textarea",{value:F.sessionNotes,onChange:s=>O(c=>({...c,sessionNotes:s.target.value})),placeholder:"Overview of the session...",rows:"3"})]}),e.jsxs("div",{className:"notes-form-group went-well",children:[e.jsxs("label",{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"What Went Well"]}),e.jsx("textarea",{value:F.whatWentWell,onChange:s=>O(c=>({...c,whatWentWell:s.target.value})),placeholder:"Positives from the session...",rows:"2"})]}),e.jsxs("div",{className:"notes-form-group went-wrong",children:[e.jsxs("label",{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),"What Went Wrong"]}),e.jsx("textarea",{value:F.whatWentWrong,onChange:s=>O(c=>({...c,whatWentWrong:s.target.value})),placeholder:"Areas to improve...",rows:"2"})]}),e.jsxs("div",{className:"notes-form-group whats-next",children:[e.jsxs("label",{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14",children:e.jsx("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})}),"What's Next"]}),e.jsx("textarea",{value:F.whatsNext,onChange:s=>O(c=>({...c,whatsNext:s.target.value})),placeholder:"Goals for next session...",rows:"2"})]})]})}),e.jsxs("div",{className:"notes-modal-footer",children:[e.jsx("button",{className:"notes-cancel-btn",onClick:()=>ne("list"),children:"Back"}),e.jsx("button",{className:"notes-save-btn",onClick:n,disabled:Q,children:Q?"Saving...":"Save Notes"})]})]})]})})]})}const ss=["Mon","Tue","Wed","Thu","Fri"],ts=m=>{const T=new Date(m),f=T.getDay(),B=T.getDate()-f+(f===0?-6:1);return T.setDate(B),$e.map((W,z)=>{const u=new Date(T);return u.setDate(T.getDate()+z),u})};function as(){const[m,T]=p.useState(new Date),[f,B]=p.useState([]),[W,z]=p.useState([]),[u,L]=p.useState([]),[o,H]=p.useState([]),[E,A]=p.useState([]),[_,ee]=p.useState([]),[h,re]=p.useState(null),[M,Y]=p.useState(null),[F,O]=p.useState(!1),[xe,J]=p.useState(!0),[oe,d]=p.useState("");p.useEffect(()=>{B(ts(m))},[m]),p.useEffect(()=>{G()},[]);const Q=t=>{re(t),O(!1),Y(null)},U=()=>{if(!h)return null;const t=h.startDate?.toDate?h.startDate.toDate():new Date(h.startDate),l=h.endDate?.toDate?h.endDate.toDate():new Date(h.endDate),r=f[0];if(!r)return null;const y=10080*60*1e3,x=Math.floor((r-t)/y)+1,w=h.weeksInBlock||Math.ceil((l-t)/y),s=r>=t&&r<=l;return{startDate:t,endDate:l,weekNumber:x,totalWeeks:w,isWithinBlock:s}},se=()=>{if(h?.startDate){const t=h.startDate.toDate?h.startDate.toDate():new Date(h.startDate);T(t),Y(null)}},ne=()=>{if(h?.endDate){const t=h.endDate.toDate?h.endDate.toDate():new Date(h.endDate);T(t),Y(null)}},N=t=>{const l=new Date,r=he(l),y=`${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`;return u.filter(x=>x.clientId!==t?!1:x.date<r||x.date===r&&x.time<y).length},P=t=>{const l=N(t.id);return(t.totalSessions||0)-l},q=t=>{const l=new Date,r=l.getFullYear(),y=(l.getMonth()+1).toString().padStart(2,"0"),x=l.getDate().toString().padStart(2,"0"),w=`${r}-${y}-${x}`,s=`${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`;return u.filter(c=>c.clientId!==t?!1:c.date>w||c.date===w&&c.time>=s).length},fe=t=>{const l=new Date,r=he(l),y=`${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`;return t.date<r||t.date===r&&t.time<y},G=async()=>{try{const l=(await ue(te($,"clients"))).docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.status==="active").sort((i,k)=>i.name.localeCompare(k.name));z(l);const y=(await ue(te($,"sessions"))).docs.map(i=>({id:i.id,...i.data()}));L(y);const w=(await ue(te($,"holidays"))).docs.map(i=>({id:i.id,...i.data()}));H(w);const c=(await ue(te($,"blockedTimes"))).docs.map(i=>({id:i.id,...i.data()}));A(c);const C=(await ue(te($,"openedSlots"))).docs.map(i=>({id:i.id,...i.data()}));ee(C)}catch(t){console.error("Error fetching data:",t)}J(!1)},ie=t=>{const l=new Date(m);l.setDate(l.getDate()+t*7),T(l),Y(null)},ce=()=>{T(new Date),Y(null)},le=t=>{const l=he(t);return o.some(r=>r.date===l)},X=(t,l)=>{const r=he(t);return E.some(y=>y.date===r&&y.time===l)},K=(t,l)=>{const r=he(t);return _.some(y=>y.date===r&&y.time===l)},pe=t=>{const l=$e[t.getDay()-1];return l&&_e[l]?.defaultBlocked},be=async(t,l)=>{const r=he(t);if(pe(t)){const x=_.find(w=>w.date===r&&w.time===l);try{if(x)await we(ae($,"openedSlots",x.id)),ee(_.filter(w=>w.id!==x.id));else{const w=await ke(te($,"openedSlots"),{date:r,time:l,createdAt:me.now()});ee([..._,{id:w.id,date:r,time:l}])}}catch(w){console.error("Error toggling opened slot:",w),alert("Failed to update time slot")}return}const y=E.find(x=>x.date===r&&x.time===l);try{if(y)await we(ae($,"blockedTimes",y.id)),A(E.filter(x=>x.id!==y.id));else{const x=await ke(te($,"blockedTimes"),{date:r,time:l,createdAt:me.now()});A([...E,{id:x.id,date:r,time:l}])}}catch(x){console.error("Error toggling blocked time:",x),alert("Failed to update time slot")}},ve=t=>{const l=he(t);return u.filter(r=>r.date===l)},n=(t,l)=>{const r=he(t);return u.find(y=>y.date===r&&y.time===l)},v=(t,l)=>{const r=he(t),y=De(l);return u.find(x=>{if(x.date!==r)return!1;const w=De(x.time),s=w+(x.duration||45);return y>=w&&y<s})},b=(t,l,r)=>{const y=$e[t.getDay()-1];if(!y||le(t))return!1;const x=_e[y],w=Math.ceil(r/15);if(x.defaultBlocked)for(let I=0;I<w;I++){const de=Me(l,I*15);if(!K(t,de))return!1}else for(let I=0;I<w;I++){const de=Me(l,I*15);if(X(t,de))return!1}const s=he(t);if(u.find(I=>I.date===s&&I.time===l))return!1;const g=Me(l,r),C=x.morning&&g<=x.morning.end,i=x.afternoon&&g<=x.afternoon.end,k=x.morning&&l>=x.morning.start&&l<x.morning.end,Z=x.afternoon&&l>=x.afternoon.start&&l<x.afternoon.end;if(k&&!C||Z&&!i)return!1;for(const I of u){if(I.date!==s)continue;const de=De(I.time),ge=de+(I.duration||45),Ne=De(l),ye=Ne+r;if(Ne<ge&&ye>de)return!1}return!0},S=async(t,l)=>{const r=v(t,l);if(r){if(fe(r))return;if(window.confirm(`Cancel ${r.clientName}'s session at ${Re(r.time)}?`))try{await we(ae($,"sessions",r.id)),L(u.filter(w=>w.id!==r.id))}catch(w){console.error("Error cancelling session:",w),alert("Failed to cancel session")}return}if(!h){alert("Please select a client first");return}if(!b(t,l,h.sessionDuration||45)){alert("This slot is not available for this client's session duration");return}const y=q(h.id);if(N(h.id)+y>=h.totalSessions){alert(`${h.name} has used all ${h.totalSessions} sessions in their package`);return}try{const w=he(t),s={clientId:h.id,clientName:h.name,date:w,time:l,duration:h.sessionDuration||45,createdAt:me.now()},c=await ke(te($,"sessions"),s);L([...u,{id:c.id,...s}])}catch(w){console.error("Error booking session:",w),alert("Failed to book session")}},V=async()=>{if(!h)return;const t=h.startDate?.toDate?h.startDate.toDate():new Date(h.startDate),l=h.endDate?.toDate?h.endDate.toDate():new Date(h.endDate),r=u.filter(g=>g.clientId!==h.id?!1:f.some(C=>he(C)===g.date));if(r.length===0){alert("No sessions in current week to repeat. Book some sessions first, then use this button.");return}const y=h.weeksInBlock||Math.ceil((l-t)/(10080*60*1e3)),x=r.map(g=>({dayOfWeek:new Date(g.date).getDay(),time:g.time}));let w=[];const s=q(h.id)+N(h.id);for(let g=0;g<y;g++){const C=new Date(t);C.setDate(C.getDate()+g*7);const i=new Date(C),k=i.getDay(),Z=i.getDate()-k+(k===0?-6:1);i.setDate(Z);for(const I of x){const de=new Date(i),ge=I.dayOfWeek===0?6:I.dayOfWeek-1;de.setDate(i.getDate()+ge);const Ne=he(de);u.some(ye=>ye.clientId===h.id&&ye.date===Ne&&ye.time===I.time)||de<t||de>l||o.some(ye=>ye.date===Ne)||w.push({dateKey:Ne,time:I.time,sessionDate:de})}}const c=s+w.length;if(c>h.totalSessions){alert(`This would create ${w.length} new sessions (${c} total), but client only has ${h.totalSessions} sessions in their package.

You can still book ${h.totalSessions-s} more sessions.`);return}if(w.length===0){alert("All weeks already have sessions booked for this pattern.");return}if(window.confirm(`This will create ${w.length} new sessions across the block.

(${s} existing + ${w.length} new = ${c} total)

Continue?`))try{const g=[];for(const C of w){const i={clientId:h.id,clientName:h.name,date:C.dateKey,time:C.time,duration:h.sessionDuration||45,createdAt:me.now()},k=await ke(te($,"sessions"),i);g.push({id:k.id,...i})}L([...u,...g]),alert(`Created ${g.length} new sessions!`)}catch(g){console.error("Error repeating weekly:",g),alert("Failed to repeat sessions")}},R=async t=>{const l=he(t),r=o.find(y=>y.date===l);try{if(r)await we(ae($,"holidays",r.id)),H(o.filter(y=>y.id!==r.id));else{const y=await ke(te($,"holidays"),{date:l,createdAt:me.now()});H([...o,{id:y.id,date:l}])}}catch(y){console.error("Error toggling day availability:",y),alert("Failed to update day availability")}};if(xe)return e.jsx("div",{className:"calendar-loading",children:"Loading calendar..."});const a=f[0],j=f[4],D=a&&j?`${a.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${j.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`:"";return e.jsxs("div",{className:"calendar",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsxs("div",{className:"calendar-nav",children:[e.jsx("button",{onClick:()=>ie(-1),children:"←"}),e.jsx("button",{onClick:ce,children:"Today"}),e.jsx("button",{onClick:()=>ie(1),children:"→"})]}),e.jsx("h3",{children:D})]}),e.jsxs("div",{className:"client-selector",children:[e.jsx("span",{className:"selector-label",children:"Booking for:"}),h?e.jsxs("div",{className:"selected-client",children:[e.jsxs("div",{className:"selected-info",children:[e.jsx("strong",{children:h.name}),e.jsxs("span",{children:[h.sessionDuration||45,"min • ",P(h),"/",h.totalSessions," remaining"]}),e.jsxs("span",{className:"booked-info",children:[q(h.id)," booked"]})]}),e.jsx("button",{onClick:()=>re(null),children:"Change"})]}):e.jsx("button",{className:"select-client-btn",onClick:()=>O(!0),children:"Select Client"})]}),h&&h.startDate&&h.endDate&&(()=>{const t=U();return t?e.jsxs("div",{className:"block-nav",children:[e.jsx("button",{onClick:se,children:"← Block Start"}),e.jsx("span",{className:"block-range",children:t.isWithinBlock?`Week ${t.weekNumber} of ${t.totalWeeks}`:f[0]<t.startDate?"Before block":"After block"}),e.jsx("button",{onClick:ne,children:"Block End →"})]}):null})(),h&&e.jsxs("div",{className:"repeat-weekly-section",children:[e.jsx("button",{className:"repeat-weekly-btn",onClick:V,children:"Repeat This Week's Schedule For All Weeks"}),e.jsx("span",{className:"repeat-hint",children:"Copies current week's sessions to all weeks in block"})]}),e.jsx("div",{className:"day-cards",children:f.map((t,l)=>{const r=ve(t),y=he(t)===he(new Date),x=le(t);return e.jsxs("div",{className:`day-card ${M===l?"selected":""} ${y?"today":""} ${x?"holiday":""}`,onClick:()=>Y(M===l?null:l),children:[e.jsxs("div",{className:"day-card-header",children:[e.jsx("span",{className:"day-name",children:ss[l]}),e.jsx("span",{className:"day-date",children:t.getDate()})]}),x?e.jsx("div",{className:"day-card-status holiday",children:"Unavailable"}):e.jsxs("div",{className:"day-card-status",children:[r.length," session",r.length!==1?"s":""]})]},l)})}),M!==null&&f[M]&&e.jsxs("div",{className:"time-panel",children:[e.jsxs("div",{className:"time-panel-header",children:[e.jsxs("h4",{children:[Xe[M]," ",f[M].getDate()]}),e.jsx("button",{className:"close-panel",onClick:()=>Y(null),children:"×"})]}),e.jsx("div",{className:"availability-toggle",children:e.jsx("button",{className:`toggle-availability-btn ${le(f[M])?"unavailable":"available"}`,onClick:()=>R(f[M]),children:le(f[M])?"Mark Day Available":"Mark Day Unavailable"})}),le(f[M])?e.jsxs("div",{className:"day-unavailable-message",children:[e.jsx("p",{children:"This day is marked as unavailable"}),e.jsx("span",{children:"Tap the button above to make it available again"})]}):e.jsxs("div",{className:"time-slots",children:[pe(f[M])&&e.jsx("div",{className:"default-blocked-notice",children:"Flex day — slots are closed by default. Tap the toggle to open slots."}),Ze($e[M]).map(({time:t,period:l},r,y)=>{const x=n(f[M],t),w=v(f[M],t),s=!!w,c=!x&&!!w,g=w?fe(w):!1,C=pe(f[M]),i=C?!K(f[M],t):X(f[M],t),k=C&&K(f[M],t),Z=h&&!s&&b(f[M],t,h.sessionDuration||45),I=r===0||y[r-1]?.period!==l;return e.jsxs("div",{children:[I&&e.jsx("div",{className:"period-label",children:l==="morning"?"Morning":"Afternoon"}),e.jsxs("div",{className:"time-slot-row",children:[e.jsxs("button",{className:`time-slot ${s&&g?"completed":""} ${s&&!g?"booked":""} ${c?"booked-continuation":""} ${i&&!s?"blocked":""} ${k&&!s?"opened":""} ${Z?"available":""} ${!s&&!i&&!Z&&h?"unavailable":""}`,onClick:()=>!g&&(!i||s)&&S(f[M],t),disabled:g||i&&!s,children:[e.jsx("span",{className:"slot-time",children:Re(t)}),x&&g?e.jsxs("span",{className:"slot-done",children:[x.clientName," ✓"]}):x?e.jsxs("span",{className:"slot-client",children:[x.clientName," (",x.duration,"m)"]}):c&&g?e.jsxs("span",{className:"slot-done",children:[w.clientName," ↑"]}):c?e.jsxs("span",{className:"slot-client",children:[w.clientName," ↑"]}):i?e.jsx("span",{className:"slot-blocked",children:C?"Closed":"Blocked"}):Z?e.jsx("span",{className:"slot-available",children:"Available"}):h?e.jsx("span",{className:"slot-unavailable",children:"Unavailable"}):k?e.jsx("span",{className:"slot-available",children:"Open"}):e.jsx("span",{className:"slot-empty",children:"Select client to book"})]}),e.jsx("button",{className:`block-toggle-btn ${C?k?"is-opened":"":i?"is-blocked":""}`,onClick:()=>be(f[M],t),disabled:g||!!s,title:C?k?"Close this slot":"Open this slot":i?"Unblock this time":"Block this time",children:C?k?"✓":"+":i?"✓":"✕"})]})]},t)})]})]}),F&&e.jsx("div",{className:"modal-overlay",onClick:()=>{O(!1),d("")},children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Select Client"}),e.jsx("button",{className:"close-btn",onClick:()=>{O(!1),d("")},children:"×"})]}),e.jsx("div",{className:"client-search-wrapper",children:e.jsx("input",{className:"client-search-input",type:"text",placeholder:"Search by name...",value:oe,onChange:t=>d(t.target.value),autoFocus:!0})}),e.jsx("div",{className:"client-list-picker",children:W.length===0?e.jsx("p",{className:"no-items",children:"No active clients"}):(()=>{const t={block:"Block",core_buddy:"Core Buddy",circuit_vip:"Circuit VIP",circuit_dropin:"Circuit Drop-in"},l=W.filter(r=>r.name.toLowerCase().includes(oe.toLowerCase()));return l.length===0?e.jsxs("p",{className:"no-items",children:['No clients match "',oe,'"']}):l.map(r=>{const y=r.startDate&&r.endDate,x=y?r.startDate?.toDate?r.startDate.toDate():new Date(r.startDate):null,w=y?r.endDate?.toDate?r.endDate.toDate():new Date(r.endDate):null,s=P(r),c=q(r.id);return e.jsxs("button",{className:"client-option",onClick:()=>{Q(r),d("")},children:[e.jsxs("div",{className:"client-option-header",children:[e.jsx("strong",{children:r.name}),r.clientType&&e.jsx("span",{className:"client-type-badge",children:t[r.clientType]||r.clientType})]}),e.jsxs("span",{children:[r.sessionDuration||45,"min • ",s,"/",r.totalSessions," remaining • ",c," booked"]}),x&&w&&e.jsxs("span",{className:"client-dates",children:[x.toLocaleDateString("en-GB",{day:"numeric",month:"short"})," – ",w.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]},r.id)})})()})]})})]})}const Fe=m=>{const[T,f]=m.split(":"),B=parseInt(T),W=B>=12?"pm":"am";return`${B>12?B-12:B===0?12:B}:${f}${W}`},Se=m=>{const T=m.getFullYear(),f=(m.getMonth()+1).toString().padStart(2,"0"),B=m.getDate().toString().padStart(2,"0");return`${T}-${f}-${B}`},Ie=m=>m===Se(new Date),ns=m=>{const T=new Date;return T.setDate(T.getDate()+1),m===Se(T)},Le=m=>Ie(m)?"Today":ns(m)?"Tomorrow":new Date(m).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"short"}),qe=m=>{const[T,f]=m.split(":").map(Number);return T*60+f},Ce=m=>{const T=new Date,f=Se(T),B=`${T.getHours().toString().padStart(2,"0")}:${T.getMinutes().toString().padStart(2,"0")}`;if(m.date<f)return!0;if(m.date===f){const W=qe(m.time)+(m.duration||45);return qe(B)>=W}return!1},is=m=>{if(m.length===0)return[];const T=new Date,f=new Date(T),B=f.getDay();f.setDate(f.getDate()-(B===0?6:B-1)),f.setHours(0,0,0,0);const W=new Date(f);W.setDate(W.getDate()+7);const z=new Date(W);z.setDate(z.getDate()+7);const u=new Map;return m.forEach(L=>{const[o,H,E]=L.split("-").map(Number),A=new Date(o,H-1,E);let _,ee,h;A<W?(_="this-week",ee="This Week",h=0):A<z?(_="next-week",ee="Next Week",h=1):(_=`${A.getFullYear()}-${A.getMonth()}`,ee=A.toLocaleDateString("en-GB",{month:"long",year:"numeric"}),h=100+A.getFullYear()*12+A.getMonth()),u.has(_)||u.set(_,{key:_,label:ee,order:h,dates:[]}),u.get(_).dates.push(L)}),Array.from(u.values()).sort((L,o)=>L.order-o.order)};function ls(){const[m,T]=p.useState([]),[f,B]=p.useState(!0),[W,z]=p.useState(new Date),[u,L]=p.useState(""),[o,H]=p.useState(""),[E,A]=p.useState(!1),[_,ee]=p.useState(new Set);p.useEffect(()=>{h();const N=setInterval(()=>z(new Date),6e4);return()=>clearInterval(N)},[]);const h=async()=>{try{const P=(await ue(te($,"sessions"))).docs.map(G=>({id:G.id,...G.data()})),q=Se(new Date),fe=P.filter(G=>G.date>=q).sort((G,ie)=>G.date!==ie.date?G.date.localeCompare(ie.date):G.time.localeCompare(ie.time));T(fe)}catch(N){console.error("Error fetching sessions:",N)}B(!1)},re=async N=>{if(window.confirm(`Cancel ${N.clientName}'s session at ${Fe(N.time)} on ${Le(N.date)}?`))try{await we(ae($,"sessions",N.id)),T(m.filter(P=>P.id!==N.id))}catch(P){console.error("Error cancelling session:",P),alert("Failed to cancel session")}},M=N=>{ee(P=>{const q=new Set(P);return q.has(N)?q.delete(N):q.add(N),q})};if(f)return e.jsx("div",{className:"schedule-loading",children:"Loading schedule..."});const Y=o?m.filter(N=>N.clientName.toLowerCase().includes(o.toLowerCase())):m,F=Y.reduce((N,P)=>(N[P.date]||(N[P.date]=[]),N[P.date].push(P),N),{}),O=Object.keys(F).sort(),xe=Se(new Date),J=F[xe]||[],oe=J.filter(N=>Ce(N)).length,d=J.length-oe,Q=Y.find(N=>!Ce(N)),se=(()=>{if(!Q||Q.date!==Se(new Date))return null;const[N,P]=Q.time.split(":").map(Number),q=N*60+P-(new Date().getHours()*60+new Date().getMinutes());return q<=0||q>180?null:q<60?`${q}m`:`${Math.floor(q/60)}h ${q%60}m`})(),ne=is(O);return e.jsxs("div",{className:"schedule",children:[e.jsxs("div",{className:"today-summary",children:[e.jsx("h3",{children:"Today's Sessions"}),e.jsx("div",{className:"today-count",children:J.length===0?e.jsx("span",{className:"no-sessions",children:"No sessions today"}):e.jsxs("div",{className:"today-stats",children:[e.jsxs("span",{className:"completed-count",children:[oe," completed"]}),e.jsxs("span",{className:"remaining-count",children:[d," remaining"]})]})}),oe>0&&e.jsx("button",{className:"hide-completed-btn",onClick:()=>A(N=>!N),children:E?"Show all":"Hide done"})]}),Q&&se&&e.jsxs("div",{className:"next-session-banner",children:[e.jsx("div",{className:"next-session-label",children:"Up next"}),e.jsxs("div",{className:"next-session-info",children:[e.jsx("span",{className:"next-session-name",children:Q.clientName}),e.jsx("span",{className:"next-session-time",children:Fe(Q.time)})]}),e.jsx("div",{className:"next-session-countdown",children:se})]}),O.length===0?e.jsx("div",{className:"no-upcoming",children:e.jsx("p",{children:o?`No sessions found for "${o}"`:"No upcoming sessions booked"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"schedule-controls",children:[e.jsx("input",{className:"client-filter-input",type:"text",placeholder:"Filter by client...",value:o,onChange:N=>H(N.target.value)}),e.jsxs("select",{className:"date-jump-select",value:u,onChange:N=>{const P=N.target.value;L(P),P&&(document.getElementById(`date-${P}`)?.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>L(""),600))},children:[e.jsx("option",{value:"",children:"Jump to date..."}),O.map(N=>e.jsxs("option",{value:N,children:[Le(N)," (",F[N].length,")"]},N))]})]}),e.jsx("div",{className:"sessions-list",children:ne.map(({key:N,label:P,dates:q})=>{const G=N!=="this-week"&&N!=="next-week"?!_.has(N):_.has(N),ie=q.reduce((ce,le)=>ce+F[le].length,0);return e.jsxs("div",{className:"week-group",children:[e.jsxs("button",{className:`week-group-header ${G?"collapsed":""}`,onClick:()=>M(N),children:[e.jsx("span",{className:"week-label",children:P}),e.jsxs("span",{className:"week-count",children:[ie," session",ie!==1?"s":""]}),e.jsx("span",{className:"week-chevron",children:G?"▸":"▾"})]}),!G&&e.jsx("div",{className:"week-group-body",children:q.map(ce=>{const le=F[ce],X=E&&Ie(ce)?le.filter(K=>!Ce(K)):le;return e.jsxs("div",{id:`date-${ce}`,className:`date-group ${Ie(ce)?"today":""}`,children:[e.jsxs("div",{className:"date-header",children:[e.jsx("span",{className:"date-label",children:Le(ce)}),e.jsxs("span",{className:"date-count",children:[le.length," session",le.length!==1?"s":""]})]}),e.jsx("div",{className:"date-sessions",children:X.length===0?e.jsx("div",{className:"all-done-msg",children:"All sessions completed ✓"}):X.map(K=>{const pe=Ce(K);return e.jsxs("div",{className:`session-card ${pe?"completed":""}`,children:[e.jsx("div",{className:"session-time",children:Fe(K.time)}),e.jsxs("div",{className:"session-details",children:[e.jsx("strong",{children:K.clientName}),e.jsxs("span",{children:[K.duration,"min session"]})]}),pe?e.jsx("div",{className:"completed-badge",children:"✓"}):e.jsx("button",{className:"cancel-session-btn",onClick:()=>re(K),children:"Cancel"})]},K.id)})})]},ce)})})]},N)})})]})]})}const rs={sedentary:"Sedentary (little to no exercise)",light:"Lightly Active (1-2 days/week)",moderate:"Moderately Active (3-4 days/week)",active:"Very Active (5+ days/week)",athlete:"Athlete/Highly Active"},os={"less-5":"Less than 5 hours","5-6":"5-6 hours","7-8":"7-8 hours","more-8":"More than 8 hours"},cs={low:"Low",moderate:"Moderate",high:"High","very-high":"Very High"},ds=[{key:"q1HeartCondition",text:"Has your doctor ever said that you have a heart condition and that you should only do physical activity recommended by a doctor?"},{key:"q2ChestPain",text:"Do you feel pain in your chest when you do physical activity?"},{key:"q3ChestPainLastMonth",text:"In the past month, have you had chest pain when you were not doing physical activity?"},{key:"q4Balance",text:"Do you lose your balance because of dizziness or do you ever lose consciousness?"},{key:"q5BoneJoint",text:"Do you have a bone or joint problem that could be made worse by a change in your physical activity?"},{key:"q6BloodPressure",text:"Is your doctor currently prescribing drugs for your blood pressure or heart condition?"},{key:"q7OtherReason",text:"Do you know of any other reason why you should not do physical activity?"}];function ms(){const[m,T]=p.useState([]),[f,B]=p.useState(!0),[W,z]=p.useState(null),[u,L]=p.useState(null),[o,H]=p.useState("all"),[E,A]=p.useState("");p.useEffect(()=>{_()},[]);const _=async()=>{try{const Q=(await ue(te($,"clients"))).docs.map(U=>({id:U.id,...U.data()}));Q.sort((U,se)=>(U.name||"").localeCompare(se.name||"")),T(Q)}catch(d){console.error("Error fetching clients:",d)}B(!1)},ee=d=>!!d.welcomeForm?.completedAt,h=d=>!!d.parqForm?.completedAt,re=d=>ee(d)||h(d),M=d=>ee(d)&&h(d),Y=d=>d?(d.toDate?d.toDate():new Date(d)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",F=m.filter(d=>!E||d.name?.toLowerCase().includes(E.toLowerCase())?o==="all"?!0:o==="completed"?M(d):o==="partial"?re(d)&&!M(d):o==="pending"?!re(d):!0:!1),O=m.filter(M).length,xe=m.filter(d=>re(d)&&!M(d)).length,J=m.filter(d=>!re(d)).length,oe=d=>{W===d?(z(null),L(null)):(z(d),L(null))};return f?e.jsx("div",{className:"forms-loading",children:"Loading form submissions..."}):e.jsxs("div",{className:"form-submissions",children:[e.jsxs("div",{className:"forms-stats",children:[e.jsxs("div",{className:"forms-stat",children:[e.jsx("span",{className:"stat-number",children:O}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"forms-stat partial",children:[e.jsx("span",{className:"stat-number",children:xe}),e.jsx("span",{className:"stat-label",children:"Partial"})]}),e.jsxs("div",{className:"forms-stat pending",children:[e.jsx("span",{className:"stat-number",children:J}),e.jsx("span",{className:"stat-label",children:"Pending"})]})]}),e.jsxs("div",{className:"forms-search",children:[e.jsxs("svg",{className:"forms-search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("input",{type:"text",className:"forms-search-input",placeholder:"Search clients...",value:E,onChange:d=>A(d.target.value)}),E&&e.jsx("button",{className:"forms-search-clear",onClick:()=>A(""),children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),e.jsxs("div",{className:"forms-filter",children:[e.jsxs("button",{className:`forms-filter-btn ${o==="all"?"active":""}`,onClick:()=>H("all"),children:["All ",e.jsx("span",{className:"forms-filter-count",children:m.length})]}),e.jsxs("button",{className:`forms-filter-btn ${o==="completed"?"active":""}`,onClick:()=>H("completed"),children:["Complete ",e.jsx("span",{className:"forms-filter-count",children:O})]}),e.jsxs("button",{className:`forms-filter-btn ${o==="partial"?"active":""}`,onClick:()=>H("partial"),children:["Partial ",e.jsx("span",{className:"forms-filter-count",children:xe})]}),e.jsxs("button",{className:`forms-filter-btn ${o==="pending"?"active":""}`,onClick:()=>H("pending"),children:["Pending ",e.jsx("span",{className:"forms-filter-count",children:J})]})]}),F.length===0?e.jsxs("div",{className:"forms-empty",children:[e.jsx("div",{className:"forms-empty-icon",children:e.jsxs("svg",{viewBox:"0 0 100 100",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"20",y:"15",width:"60",height:"70",rx:"4"}),e.jsx("path",{d:"M35 35h30M35 50h30M35 65h20"}),e.jsx("circle",{cx:"70",cy:"70",r:"18",fill:"var(--bg-card)",strokeWidth:"3"}),e.jsx("path",{d:"M63 70h14M70 63v14",strokeWidth:"3",strokeLinecap:"round"})]})}),e.jsx("p",{children:"No clients match this filter"}),e.jsx("span",{children:"Try adjusting your search or filter"})]}):e.jsx("div",{className:"forms-client-list",children:F.map(d=>{const Q=W===d.id,U=ee(d),se=h(d);return e.jsxs("div",{className:`forms-client-card ${Q?"expanded":""}`,children:[e.jsxs("div",{className:"forms-client-row",onClick:()=>oe(d.id),children:[e.jsxs("div",{className:"forms-client-left",children:[e.jsx("div",{className:"forms-client-initial",children:(d.name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"forms-client-info",children:[e.jsx("h3",{children:d.name||"Unknown"}),e.jsxs("div",{className:"forms-badges",children:[e.jsxs("span",{className:`form-badge ${U?"done":"not-done"}`,children:[U?"✓":"○"," Welcome"]}),e.jsxs("span",{className:`form-badge ${se?"done":"not-done"}`,children:[se?"✓":"○"," PAR-Q"]})]})]})]}),e.jsx("svg",{className:`forms-chevron ${Q?"open":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"m6 9 6 6 6-6"})})]}),Q&&e.jsx("div",{className:"forms-expand-panel",children:!U&&!se?e.jsxs("div",{className:"forms-no-data",children:[e.jsx("p",{children:"No forms submitted yet"}),e.jsx("span",{children:"This client hasn't completed any forms"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"forms-toggle",children:[U&&e.jsx("button",{className:`forms-toggle-btn ${u==="welcome"||!u&&U?"active":""}`,onClick:()=>L("welcome"),children:"Welcome Questionnaire"}),se&&e.jsx("button",{className:`forms-toggle-btn ${u==="parq"||!u&&!U&&se?"active":""}`,onClick:()=>L("parq"),children:"PAR-Q Health Screening"})]}),(u==="welcome"||!u&&U)&&U&&e.jsxs("div",{className:"form-data",children:[e.jsxs("div",{className:"form-data-header",children:[e.jsx("span",{className:"form-data-title",children:"Welcome Questionnaire"}),e.jsxs("span",{className:"form-data-date",children:["Submitted ",Y(d.welcomeForm.completedAt)]})]}),d.welcomeForm.fitnessGoals&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Fitness Goals"}),e.jsx("p",{children:d.welcomeForm.fitnessGoals})]}),d.welcomeForm.currentActivityLevel&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Activity Level"}),e.jsx("p",{children:rs[d.welcomeForm.currentActivityLevel]||d.welcomeForm.currentActivityLevel})]}),d.welcomeForm.exerciseHistory&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Exercise History"}),e.jsx("p",{children:d.welcomeForm.exerciseHistory})]}),d.welcomeForm.injuries&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Injuries"}),e.jsx("p",{children:d.welcomeForm.injuries})]}),d.welcomeForm.medicalConditions&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Medical Conditions"}),e.jsx("p",{children:d.welcomeForm.medicalConditions})]}),d.welcomeForm.sleepHours&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Sleep"}),e.jsx("p",{children:os[d.welcomeForm.sleepHours]||d.welcomeForm.sleepHours})]}),d.welcomeForm.stressLevel&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Stress Level"}),e.jsx("p",{children:cs[d.welcomeForm.stressLevel]||d.welcomeForm.stressLevel})]}),d.welcomeForm.dietaryInfo&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Diet / Nutrition"}),e.jsx("p",{children:d.welcomeForm.dietaryInfo})]}),d.welcomeForm.availability&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Availability"}),e.jsx("p",{children:d.welcomeForm.availability})]}),d.welcomeForm.additionalInfo&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Additional Info"}),e.jsx("p",{children:d.welcomeForm.additionalInfo})]})]}),u==="parq"&&se&&e.jsxs("div",{className:"form-data",children:[e.jsxs("div",{className:"form-data-header",children:[e.jsx("span",{className:"form-data-title",children:"PAR-Q Health Screening"}),e.jsxs("span",{className:"form-data-date",children:["Submitted ",Y(d.parqForm.completedAt)]})]}),e.jsx("div",{className:"parq-results",children:ds.map(ne=>{const N=d.parqForm[ne.key];return e.jsxs("div",{className:`parq-result-item ${N?"flagged":""}`,children:[e.jsx("span",{className:`parq-answer ${N?"yes":"no"}`,children:N?"YES":"NO"}),e.jsx("span",{className:"parq-question-text",children:ne.text})]},ne.key)})}),d.parqForm.additionalDetails&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Additional Details"}),e.jsx("p",{children:d.parqForm.additionalDetails})]}),e.jsx("div",{className:"parq-declaration-status",children:e.jsx("span",{className:d.parqForm.declaration?"declared":"not-declared",children:d.parqForm.declaration?"✓ Declaration signed":"✗ Declaration not signed"})})]})]})})]},d.id)})})]})}const We=m=>`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}-${String(m.getDate()).padStart(2,"0")}`,He=m=>new Date(m+"T09:00:00").toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),Oe=()=>{const m=new Date;let f=(6-m.getDay()+7)%7;if(f===0){const W=new Date(m);W.setHours(9,45,0,0),m>W&&(f=7)}const B=new Date(m);return B.setDate(m.getDate()+f),B},Be=m=>m==="circuit_vip"?"VIP":m==="circuit_dropin"?"Drop-in":"Block",Ae=m=>m==="circuit_vip"?"vip":m==="circuit_dropin"?"dropin":"block";function hs(){const[m,T]=p.useState(!0),[f,B]=p.useState([]),[W,z]=p.useState([]),[u,L]=p.useState(null),[o,H]=p.useState("upcoming"),[E,A]=p.useState(!1),[_,ee]=p.useState(null),[h,re]=p.useState(!1),[M,Y]=p.useState(!1),F=p.useCallback((n,v="info")=>{ee({message:n,type:v}),setTimeout(()=>ee(null),4e3)},[]);p.useEffect(()=>{O()},[]);const O=async()=>{try{const v=(await ue(te($,"circuitSessions"))).docs.map(a=>({id:a.id,...a.data()}));v.sort((a,j)=>j.date.localeCompare(a.date)),B(v);const S=(await ue(te($,"clients"))).docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.clientType==="circuit_vip"||a.clientType==="circuit_dropin"||a.circuitAccess===!0);z(S);const V=We(Oe());let R=v.find(a=>a.date===V);if(!R){const a=S.filter(t=>t.clientType==="circuit_vip"&&t.status==="active"),j=[];for(let t=0;t<8;t++)t<a.length?j.push({slotNumber:t+1,memberId:a[t].id,memberName:a[t].name,memberType:"circuit_vip",status:"confirmed",bookedAt:me.now()}):j.push({slotNumber:t+1,memberId:null,memberName:null,memberType:null,status:"available"});const D={date:V,time:"09:00",endTime:"09:45",maxCapacity:8,slots:j,waitlist:[],createdAt:me.now()};await Ye(ae($,"circuitSessions",V),D),R={id:V,...D},v.unshift(R),B([...v])}R?L(R):v.length>0&&L(v[0])}catch(n){console.error("Error loading circuit data:",n),F("Failed to load circuit data","error")}T(!1)},xe=async n=>{if(!(!u||E)&&window.confirm("Remove this member from the slot?")){A(!0);try{const v=[...u.slots],b=v.findIndex(D=>D.slotNumber===n);if(b===-1){A(!1);return}const S=v[b],V=S.memberType==="circuit_vip";let R=[...u.waitlist||[]];if(R.length>0){const D=R.shift();v[b]={slotNumber:n,memberId:D.memberId,memberName:D.memberName,memberType:D.memberType,status:"confirmed",bookedAt:me.now()},F(`Slot given to ${D.memberName} from waitlist`,"success")}else v[b]={slotNumber:n,memberId:null,memberName:null,memberType:null,status:"available"},F("Member removed from slot","success");const a={slots:v,waitlist:R};if(V&&S.memberId){const D=u.vipOptOuts||[];D.includes(S.memberId)||(a.vipOptOuts=[...D,S.memberId])}await je(ae($,"circuitSessions",u.id),a);const j={...u,...a};L(j),B(D=>D.map(t=>t.id===j.id?j:t))}catch(v){console.error("Error removing from slot:",v),F("Failed to remove member","error")}A(!1)}},J=async(n,v)=>{if(!(!u||E)){A(!0);try{const b=[...u.slots],S=b.findIndex(j=>j.slotNumber===n&&j.status==="available");if(S===-1){F("Slot is not available","error"),A(!1);return}if(b.some(j=>j.memberId===v.id)){F(`${v.name} already has a slot`,"error"),A(!1);return}b[S]={slotNumber:n,memberId:v.id,memberName:v.name,memberType:v.clientType||"block",status:"confirmed",bookedAt:me.now()};const V=(u.waitlist||[]).filter(j=>j.memberId!==v.id),R={slots:b,waitlist:V};if(v.clientType==="circuit_vip"){const j=u.vipOptOuts||[];j.includes(v.id)&&(R.vipOptOuts=j.filter(D=>D!==v.id))}await je(ae($,"circuitSessions",u.id),R);const a={...u,...R};L(a),B(j=>j.map(D=>D.id===a.id?a:D)),F(`${v.name} added to slot ${n}`,"success")}catch(b){console.error("Error adding to slot:",b),F("Failed to add member","error")}A(!1)}},oe=async n=>{if(!(!u||E)){A(!0);try{const v=(u.waitlist||[]).filter(S=>S.memberId!==n);await je(ae($,"circuitSessions",u.id),{waitlist:v});const b={...u,waitlist:v};L(b),B(S=>S.map(V=>V.id===b.id?b:V)),F("Removed from waitlist","success")}catch(v){console.error("Error removing from waitlist:",v),F("Failed to remove from waitlist","error")}A(!1)}},d=async(n,v)=>{if(!(!u||E)){A(!0);try{const b=[...u.slots],S=b.findIndex(R=>R.slotNumber===n);if(S===-1){A(!1);return}if(b[S]={...b[S],attended:v},await je(ae($,"circuitSessions",u.id),{slots:b}),v===!1){const R=b[S].memberId;if(R){const a=ae($,"clients",R),j=await Ge(a);if(j.exists()){const t=(j.data().circuitStrikes||0)+1,l={circuitStrikes:t};if(t>=3){const r=new Date;r.setMonth(r.getMonth()+1),l.circuitBanUntil=me.fromDate(r),l.circuitStrikes=0,F(`${b[S].memberName} banned for 1 month (3 strikes)`,"error")}else F(`No-show recorded - ${b[S].memberName} (${t}/3 strikes)`,"error");await je(a,l)}}}else F(`${b[S].memberName} marked as attended`,"success");const V={...u,slots:b};L(V),B(R=>R.map(a=>a.id===V.id?V:a))}catch(b){console.error("Error marking attendance:",b),F("Failed to update attendance","error")}A(!1)}},Q=async(n,v)=>{if(!E&&window.confirm(`Reset strikes for ${v}?`)){A(!0);try{await je(ae($,"clients",n),{circuitStrikes:0,circuitBanUntil:null}),z(b=>b.map(S=>S.id===n?{...S,circuitStrikes:0,circuitBanUntil:null}:S)),F(`Strikes reset for ${v}`,"success")}catch(b){console.error("Error resetting strikes:",b),F("Failed to reset strikes","error")}A(!1)}},U=async(n,v)=>{if(!E&&window.confirm(`Lift ban for ${v}?`)){A(!0);try{await je(ae($,"clients",n),{circuitBanUntil:null,circuitStrikes:0}),z(b=>b.map(S=>S.id===n?{...S,circuitBanUntil:null,circuitStrikes:0}:S)),F(`Ban lifted for ${v}`,"success")}catch(b){console.error("Error lifting ban:",b),F("Failed to lift ban","error")}A(!1)}};if(m)return e.jsxs("div",{className:"cm-loading",children:[e.jsx("div",{className:"cm-loading-spinner"}),e.jsx("span",{children:"Loading circuit data..."})]});const se=We(new Date),ne=We(Oe()),N=f.filter(n=>n.date>=se),P=f.filter(n=>n.date<se),q=o==="upcoming"?N:P,fe=u?u.slots.filter(n=>n.status!=="available").length:0,G=u?u.slots.filter(n=>n.status==="available").length:0,ie=u?u.date>=se:!1,ce=u?u.slots.filter(n=>n.memberId).map(n=>n.memberId):[],le=u?(u.waitlist||[]).map(n=>n.memberId):[],X=W.filter(n=>!ce.includes(n.id)&&!le.includes(n.id)),K=W.filter(n=>n.clientType==="circuit_vip").length,pe=W.filter(n=>n.clientType==="circuit_dropin").length,be=W.filter(n=>n.circuitAccess&&n.clientType!=="circuit_vip"&&n.clientType!=="circuit_dropin").length,ve=W.filter(n=>n.circuitBanUntil?(n.circuitBanUntil.toDate?n.circuitBanUntil.toDate():new Date(n.circuitBanUntil))>new Date:!1);return e.jsxs("div",{className:"cm-container",children:[e.jsxs("div",{className:"cm-stats-row",children:[e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:K}),e.jsx("span",{className:"cm-stat-label",children:"VIP"})]}),e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:pe}),e.jsx("span",{className:"cm-stat-label",children:"Drop-in"})]}),e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:be}),e.jsx("span",{className:"cm-stat-label",children:"Block"})]}),e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:f.length}),e.jsx("span",{className:"cm-stat-label",children:"Sessions"})]})]}),e.jsxs("div",{className:"cm-view-toggle",children:[e.jsx("button",{className:`cm-toggle-btn ${h?"":"active"}`,onClick:()=>re(!1),children:"Sessions"}),e.jsx("button",{className:`cm-toggle-btn ${h?"active":""}`,onClick:()=>re(!0),children:"Members"})]}),!h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cm-tabs",children:[e.jsxs("button",{className:`cm-tab ${o==="upcoming"?"active":""}`,onClick:()=>H("upcoming"),children:["Upcoming (",N.length,")"]}),e.jsxs("button",{className:`cm-tab ${o==="past"?"active":""}`,onClick:()=>H("past"),children:["Past (",P.length,")"]})]}),e.jsx("div",{className:"cm-sessions-list",children:q.length===0?e.jsx("div",{className:"cm-empty",children:e.jsxs("p",{children:["No ",o," sessions"]})}):q.map(n=>{const v=n.slots.filter(V=>V.status!=="available").length,b=u?.id===n.id,S=n.date===ne;return e.jsxs("button",{className:`cm-session-btn ${b?"selected":""} ${S?"next":""}`,onClick:()=>{L(n),Y(!1)},children:[e.jsxs("div",{className:"cm-session-btn-left",children:[e.jsx("span",{className:"cm-session-date",children:He(n.date)}),S&&e.jsx("span",{className:"cm-next-badge",children:"Next"})]}),e.jsxs("div",{className:"cm-session-btn-right",children:[e.jsxs("span",{className:"cm-session-fill",children:[v,"/8"]}),(n.waitlist?.length||0)>0&&e.jsxs("span",{className:"cm-waitlist-count",children:["+",n.waitlist.length," wl"]})]})]},n.id)})}),u&&e.jsxs("div",{className:"cm-detail",children:[e.jsxs("div",{className:"cm-detail-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:He(u.date)}),e.jsxs("p",{children:[u.time," - ",u.endTime," • ",fe,"/8 booked • ",G," available"]})]}),!ie&&e.jsx("button",{className:`cm-attendance-btn ${M?"active":""}`,onClick:()=>Y(!M),children:M?"Done":"Attendance"})]}),e.jsx("div",{className:"cm-slots",children:u.slots.map(n=>{const v=n.status==="available";return e.jsxs("div",{className:`cm-slot ${v?"empty":"filled"} ${n.attended===!0?"attended":""} ${n.attended===!1?"no-show":""}`,children:[e.jsx("span",{className:"cm-slot-num",children:n.slotNumber}),v?e.jsxs("div",{className:"cm-slot-empty",children:[e.jsx("span",{children:"Available"}),ie&&e.jsx(us,{members:X,onSelect:b=>J(n.slotNumber,b),disabled:E})]}):e.jsxs("div",{className:"cm-slot-filled",children:[e.jsxs("div",{className:"cm-slot-info",children:[e.jsx("span",{className:"cm-slot-name",children:n.memberName}),e.jsx("span",{className:`cm-type-badge ${Ae(n.memberType)}`,children:Be(n.memberType)})]}),e.jsxs("div",{className:"cm-slot-actions",children:[M&&n.attended===void 0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cm-attend-yes",onClick:()=>d(n.slotNumber,!0),disabled:E,title:"Attended",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{d:"M5 13l4 4L19 7"})})}),e.jsx("button",{className:"cm-attend-no",onClick:()=>d(n.slotNumber,!1),disabled:E,title:"No-show",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),n.attended===!0&&e.jsx("span",{className:"cm-attended-label",children:"Attended"}),n.attended===!1&&e.jsx("span",{className:"cm-noshow-label",children:"No-show"}),ie&&e.jsx("button",{className:"cm-remove-btn",onClick:()=>xe(n.slotNumber),disabled:E,title:"Remove from slot",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]})]},n.slotNumber)})}),(u.waitlist?.length||0)>0&&e.jsxs("div",{className:"cm-waitlist",children:[e.jsxs("h4",{children:["Waitlist (",u.waitlist.length,")"]}),u.waitlist.map((n,v)=>e.jsxs("div",{className:"cm-waitlist-row",children:[e.jsxs("span",{className:"cm-wl-pos",children:["#",v+1]}),e.jsx("span",{className:"cm-wl-name",children:n.memberName}),e.jsx("span",{className:`cm-type-badge ${Ae(n.memberType)}`,children:Be(n.memberType)}),ie&&e.jsx("button",{className:"cm-wl-remove",onClick:()=>oe(n.memberId),disabled:E,children:"Remove"})]},n.memberId))]})]})]}),h&&e.jsxs("div",{className:"cm-members",children:[ve.length>0&&e.jsxs("div",{className:"cm-ban-alert",children:[e.jsxs("h4",{children:["Currently Banned (",ve.length,")"]}),ve.map(n=>{const v=n.circuitBanUntil?.toDate?n.circuitBanUntil.toDate():new Date(n.circuitBanUntil);return e.jsxs("div",{className:"cm-ban-row",children:[e.jsxs("div",{className:"cm-ban-info",children:[e.jsx("span",{className:"cm-ban-name",children:n.name}),e.jsxs("span",{className:"cm-ban-until",children:["Until ",v.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]}),e.jsx("button",{className:"cm-lift-ban-btn",onClick:()=>U(n.id,n.name),disabled:E,children:"Lift Ban"})]},n.id)})]}),e.jsx("div",{className:"cm-members-list",children:W.length===0?e.jsxs("div",{className:"cm-empty",children:[e.jsx("p",{children:"No circuit members yet"}),e.jsx("span",{children:"Add members via the Clients page"})]}):W.map(n=>{const v=n.circuitStrikes||0,b=ve.some(S=>S.id===n.id);return e.jsxs("div",{className:`cm-member-card ${b?"banned":""}`,children:[e.jsxs("div",{className:"cm-member-top",children:[e.jsx("span",{className:"cm-member-name",children:n.name}),e.jsx("span",{className:`cm-type-badge ${Ae(n.clientType)}`,children:Be(n.clientType)})]}),e.jsxs("div",{className:"cm-member-bottom",children:[e.jsxs("div",{className:"cm-strikes",children:[[0,1,2].map(S=>e.jsx("span",{className:`cm-strike-dot ${S<v?"active":""}`},S)),e.jsxs("span",{className:"cm-strike-text",children:[v,"/3 strikes"]})]}),e.jsxs("div",{className:"cm-member-actions",children:[b&&e.jsx("button",{className:"cm-small-btn ban",onClick:()=>U(n.id,n.name),disabled:E,children:"Lift Ban"}),v>0&&!b&&e.jsx("button",{className:"cm-small-btn reset",onClick:()=>Q(n.id,n.name),disabled:E,children:"Reset"})]})]})]},n.id)})})]}),_&&e.jsx("div",{className:`cm-toast ${_.type}`,children:e.jsx("span",{children:_.message})})]})}function us({members:m,onSelect:T,disabled:f}){const[B,W]=p.useState(!1),[z,u]=p.useState(""),L=m.filter(o=>o.name.toLowerCase().includes(z.toLowerCase()));return m.length===0?null:e.jsxs("div",{className:"cm-add-dropdown",children:[e.jsx("button",{className:"cm-add-trigger",onClick:()=>W(!B),disabled:f,children:"+ Add"}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cm-dropdown-backdrop",onClick:()=>{W(!1),u("")}}),e.jsxs("div",{className:"cm-dropdown-menu",children:[m.length>4&&e.jsx("input",{type:"text",className:"cm-dropdown-search",placeholder:"Search...",value:z,onChange:o=>u(o.target.value),autoFocus:!0}),e.jsxs("div",{className:"cm-dropdown-list",children:[L.map(o=>e.jsxs("button",{className:"cm-dropdown-item",onClick:()=>{T(o),W(!1),u("")},children:[e.jsx("span",{children:o.name}),e.jsx("span",{className:`cm-type-badge sm ${Ae(o.clientType)}`,children:Be(o.clientType)})]},o.id)),L.length===0&&e.jsx("div",{className:"cm-dropdown-empty",children:"No members found"})]})]})]})]})}function fs(){const[m,T]=p.useState(()=>localStorage.getItem("adminActiveView")||"schedule"),f=a=>{T(a),localStorage.setItem("adminActiveView",a)},[B,W]=p.useState(0),[z,u]=p.useState(!1),[L,o]=p.useState([]),[H,E]=p.useState(null),[A,_]=p.useState(null),[ee,h]=p.useState([]),[re,M]=p.useState([]),[Y,F]=p.useState(null),{currentUser:O,logout:xe,isAdmin:J,loading:oe}=Ke(),{isDark:d,toggleTheme:Q}=Je(),U=Qe(),se=p.useRef(0),ne=p.useRef(!1);p.useRef(null);const N=p.useCallback((a,j="info")=>{_({message:a,type:j}),setTimeout(()=>_(null),4e3)},[]);p.useEffect(()=>{!oe&&(!O||!J)&&U("/")},[O,J,oe,U]),p.useEffect(()=>{O&&J&&P()},[O,J]);const P=async()=>{try{const a=Te(te($,"rescheduleRequests"),Ee("status","==","pending")),D=(await ue(a)).docs.map(t=>({id:t.id,...t.data()}));D.sort((t,l)=>{const r=t.createdAt?.toDate?t.createdAt.toDate():new Date(0);return(l.createdAt?.toDate?l.createdAt.toDate():new Date(0))-r}),o(D)}catch(a){console.error("Error fetching reschedule requests:",a)}};p.useEffect(()=>{(async()=>{if(!(!O||!J))try{const[j,D]=await Promise.all([ue(te($,"clients")),ue(te($,"sessions"))]),t=j.docs.map(x=>({id:x.id,...x.data()})),l=D.docs.map(x=>({id:x.id,...x.data()}));h(t);const r=new Set(t.map(x=>x.id)),y=D.docs.filter(x=>!r.has(x.data().clientId));if(y.length>0){const x=y.map(w=>we(ae($,"sessions",w.id)));await Promise.all(x)}M(l.filter(x=>r.has(x.clientId)))}catch(j){console.error("Error fetching dashboard data:",j)}})()},[O,J]),p.useEffect(()=>{const a=()=>window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,j=l=>{a()<=0&&(se.current=l.touches[0].clientY,ne.current=!1)},D=l=>{const r=a(),x=l.touches[0].clientY-se.current;if(r>5||x<=0){ne.current=!1,W(0);return}x>20&&r<=0&&(ne.current=!0,W(Math.min((x-20)*.4,80)))},t=()=>{ne.current&&B>60?(u(!0),setTimeout(()=>{window.location.reload()},300)):W(0),ne.current=!1};return document.addEventListener("touchstart",j,{passive:!0}),document.addEventListener("touchmove",D,{passive:!0}),document.addEventListener("touchend",t),()=>{document.removeEventListener("touchstart",j),document.removeEventListener("touchmove",D),document.removeEventListener("touchend",t)}},[B]);const q=async()=>{try{await xe(),U("/")}catch(a){console.error("Failed to log out:",a)}},fe=()=>{U("/add-client")},G=a=>new Date(a).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}),ie=a=>{const[j,D]=a.split(":"),t=parseInt(j),l=t>=12?"pm":"am";return`${t>12?t-12:t===0?12:t}:${D}${l}`},ce=async a=>{if(window.confirm(`Approve reschedule for ${a.clientName}?

From: ${G(a.originalDate)} at ${ie(a.originalTime)}
To: ${G(a.requestedDate)} at ${ie(a.requestedTime)}`)){E(a.id);try{await je(ae($,"sessions",a.sessionId),{date:a.requestedDate,time:a.requestedTime}),await je(ae($,"rescheduleRequests",a.id),{status:"approved",respondedAt:me.now()}),o(L.filter(j=>j.id!==a.id)),N(`Approved reschedule for ${a.clientName}`,"success")}catch(j){console.error("Error approving request:",j),N("Failed to approve request","error")}E(null)}},le=async a=>{if(window.confirm(`Reject reschedule request from ${a.clientName}?`)){E(a.id);try{await je(ae($,"rescheduleRequests",a.id),{status:"rejected",respondedAt:me.now()}),o(L.filter(j=>j.id!==a.id)),N(`Request from ${a.clientName} rejected`,"info")}catch(j){console.error("Error rejecting request:",j),N("Failed to reject request","error")}E(null)}};if(oe)return e.jsx("div",{className:"loading",children:"Loading..."});if(!O||!J)return null;const X=L.length,K=new Date,pe=`${K.getFullYear()}-${(K.getMonth()+1).toString().padStart(2,"0")}-${K.getDate().toString().padStart(2,"0")}`,be=`${K.getHours().toString().padStart(2,"0")}:${K.getMinutes().toString().padStart(2,"0")}`,n=re.filter(a=>a.date===pe).length,v=a=>re.filter(j=>j.clientId!==a?!1:j.date<pe||j.date===pe&&j.time<be).length,b=ee.filter(a=>a.status!=="archived"&&(!a.clientType||a.clientType==="block")),S=new Date(K);S.setDate(S.getDate()+7);const V=b.filter(a=>{if(!a.endDate)return!1;const j=a.endDate.toDate?a.endDate.toDate():new Date(a.endDate);return j>=K&&j<=S}),R=b.filter(a=>(a.totalSessions||0)-v(a.id)<=2);return e.jsxs("div",{className:"dashboard",children:[B>0&&e.jsxs("div",{className:"pull-indicator",style:{height:B},children:[e.jsx("div",{className:`pull-spinner ${z?"spinning":""}`,children:z?"↻":"↓"}),e.jsx("span",{children:z?"Refreshing...":B>60?"Release to refresh":"Pull to refresh"})]}),e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"admin-header-logo",width:"50",height:"50"}),e.jsx("span",{className:"admin-badge",children:"Admin"})]}),e.jsxs("nav",{className:"header-nav",children:[e.jsxs("button",{className:`nav-btn ${m==="requests"?"active":""} ${X>0?"has-badge":""}`,onClick:()=>f("requests"),children:["Requests",X>0&&e.jsx("span",{className:"nav-badge",children:X})]}),e.jsx("button",{className:`nav-btn ${m==="forms"?"active":""}`,onClick:()=>f("forms"),children:"Forms"}),e.jsx("button",{className:`nav-btn ${m==="circuits"?"active":""}`,onClick:()=>f("circuits"),children:"Circuits"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"theme-toggle-btn",onClick:Q,"aria-label":d?"Switch to light mode":"Switch to dark mode",children:d?e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"})}):e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"})})}),e.jsx("button",{className:"logout-btn",onClick:q,children:"Log Out"})]})]}),A&&e.jsx("div",{className:"toast-container",children:e.jsxs("div",{className:`toast ${A.type}`,children:[e.jsxs("span",{className:"toast-icon",children:[A.type==="success"&&e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),A.type==="error"&&e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),A.type==="info"&&e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})]}),e.jsx("span",{className:"toast-message",children:A.message})]})}),e.jsxs("main",{className:"dashboard-main",children:[m==="schedule"&&e.jsxs("div",{className:"schedule-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Schedule"})}),e.jsxs("div",{className:"summary-cards",children:[e.jsxs("div",{className:"summary-card",onClick:()=>{},children:[e.jsx("div",{className:"summary-icon sessions-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:n}),e.jsx("span",{className:"summary-label",children:"Today"})]})]}),e.jsxs("div",{className:"summary-card",onClick:()=>X>0&&f("requests"),children:[e.jsx("div",{className:`summary-icon requests-icon ${X>0?"has-items":""}`,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:X}),e.jsx("span",{className:"summary-label",children:"Requests"})]})]}),e.jsxs("div",{className:`summary-card ${Y==="expiring"?"active":""}`,onClick:()=>F(Y==="expiring"?null:"expiring"),children:[e.jsx("div",{className:`summary-icon expiring-icon ${V.length>0?"has-items":""}`,children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:V.length}),e.jsx("span",{className:"summary-label",children:"Expiring"})]})]}),e.jsxs("div",{className:`summary-card ${Y==="low"?"active":""}`,onClick:()=>F(Y==="low"?null:"low"),children:[e.jsx("div",{className:`summary-icon low-icon ${R.length>0?"has-items":""}`,children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:R.length}),e.jsx("span",{className:"summary-label",children:"Low Sessions"})]})]})]}),Y==="expiring"&&e.jsxs("div",{className:"card-detail-panel",children:[e.jsxs("div",{className:"card-detail-header",children:[e.jsx("span",{children:"Expiring Soon"}),e.jsx("button",{className:"card-detail-close",onClick:()=>F(null),children:"✕"})]}),V.length===0?e.jsx("p",{className:"card-detail-empty",children:"No clients expiring within 7 days"}):V.map(a=>{const j=a.endDate.toDate?a.endDate.toDate():new Date(a.endDate),D=Math.ceil((j-K)/(1e3*60*60*24)),t=(a.totalSessions||0)-v(a.id);return e.jsxs("div",{className:"card-detail-item",children:[e.jsx("span",{className:"card-detail-name",children:a.name}),e.jsxs("div",{className:"card-detail-tags",children:[e.jsx("span",{className:"card-detail-tag warning",children:D<=1?"Ends today":`Ends in ${D} days`}),e.jsx("span",{className:`card-detail-tag ${t<=0?"urgent":"info"}`,children:t<=0?"No sessions left":`${t} session${t!==1?"s":""} left`})]})]},a.id)})]}),Y==="low"&&e.jsxs("div",{className:"card-detail-panel",children:[e.jsxs("div",{className:"card-detail-header",children:[e.jsx("span",{children:"Low / No Sessions"}),e.jsx("button",{className:"card-detail-close",onClick:()=>F(null),children:"✕"})]}),R.length===0?e.jsx("p",{className:"card-detail-empty",children:"All clients have sessions available"}):[...R].sort((a,j)=>{const D=(a.totalSessions||0)-v(a.id),t=(j.totalSessions||0)-v(j.id);return D-t}).map(a=>{const j=(a.totalSessions||0)-v(a.id),D=a.endDate?a.endDate.toDate?a.endDate.toDate():new Date(a.endDate):null,t=D?Math.ceil((D-K)/(1e3*60*60*24)):null;return e.jsxs("div",{className:"card-detail-item",children:[e.jsx("span",{className:"card-detail-name",children:a.name}),e.jsxs("div",{className:"card-detail-tags",children:[e.jsx("span",{className:`card-detail-tag ${j<=0?"urgent":"low"}`,children:j<=0?"No sessions left":`${j} session${j!==1?"s":""} left`}),t!==null&&t<=14&&e.jsxs("span",{className:"card-detail-tag warning",children:["Block ends ",t<=1?"today":`in ${t}d`]})]})]},a.id)})]}),e.jsx(ls,{})]}),m==="clients"&&e.jsxs("div",{className:"clients-view",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("h2",{children:"Clients"}),e.jsx("button",{className:"add-btn",onClick:fe,children:"+ Add Client"})]}),e.jsx(es,{})]}),m==="calendar"&&e.jsxs("div",{className:"calendar-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Calendar"})}),e.jsx(as,{})]}),m==="requests"&&e.jsxs("div",{className:"requests-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Reschedule Requests"})}),L.length===0?e.jsxs("div",{className:"no-requests",children:[e.jsx("div",{className:"empty-icon",children:e.jsxs("svg",{viewBox:"0 0 100 100",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"20",y:"25",width:"60",height:"50",rx:"4"}),e.jsx("path",{d:"M20 35 L50 55 L80 35"}),e.jsx("circle",{cx:"50",cy:"70",r:"3",fill:"currentColor"})]})}),e.jsx("p",{children:"No pending requests"}),e.jsx("span",{children:"When clients request to reschedule, they will appear here"})]}):e.jsx("div",{className:"requests-list",children:L.map(a=>e.jsxs("div",{className:"request-card",children:[e.jsxs("div",{className:"request-header",children:[e.jsx("span",{className:"client-name",children:a.clientName}),e.jsx("span",{className:"request-time",children:a.createdAt?.toDate?a.createdAt.toDate().toLocaleDateString("en-GB",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("div",{className:"request-details",children:e.jsxs("div",{className:"request-change",children:[e.jsxs("div",{className:"from-session",children:[e.jsx("span",{className:"label",children:"From:"}),e.jsxs("span",{className:"value",children:[G(a.originalDate)," at ",ie(a.originalTime)]})]}),e.jsx("div",{className:"arrow",children:"→"}),e.jsxs("div",{className:"to-session",children:[e.jsx("span",{className:"label",children:"To:"}),e.jsxs("span",{className:"value",children:[G(a.requestedDate)," at ",ie(a.requestedTime)]})]})]})}),e.jsxs("div",{className:"request-actions",children:[e.jsx("button",{className:"approve-btn",onClick:()=>ce(a),disabled:H===a.id,children:H===a.id?"Processing...":"Approve"}),e.jsx("button",{className:"reject-btn",onClick:()=>le(a),disabled:H===a.id,children:"Reject"})]})]},a.id))})]}),m==="forms"&&e.jsxs("div",{className:"forms-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Client Forms"})}),e.jsx(ms,{})]}),m==="circuits"&&e.jsxs("div",{className:"circuits-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Circuit Management"})}),e.jsx(hs,{})]})]}),e.jsxs("nav",{className:"admin-bottom-nav",children:[e.jsxs("button",{className:`admin-nav-tab ${m==="schedule"?"active":""}`,onClick:()=>f("schedule"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsx("span",{children:"Today"})]}),e.jsxs("button",{className:`admin-nav-tab ${m==="clients"?"active":""}`,onClick:()=>f("clients"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Clients"})]}),e.jsxs("button",{className:`admin-nav-tab ${m==="calendar"?"active":""}`,onClick:()=>f("calendar"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"}),e.jsx("path",{d:"M8 14h.01"}),e.jsx("path",{d:"M12 14h.01"}),e.jsx("path",{d:"M16 14h.01"}),e.jsx("path",{d:"M8 18h.01"}),e.jsx("path",{d:"M12 18h.01"})]}),e.jsx("span",{children:"Calendar"})]})]})]})}export{fs as default};
