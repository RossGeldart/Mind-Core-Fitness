import{r as p,g as ue,q as $e,c as ae,d as A,o as Ue,j as e,a as ke,T as me,w as Ee,b as we,e as ne,f as Ve,s as Pe,h as ze,u as je,i as Ye,k as Ge,l as Ke,m as Je,n as Qe}from"./index-BpTTIOmk.js";import{f as he,D as Xe,g as Ze,a as Re,b as Te,S as _e,t as De,c as Me}from"./scheduleUtils-BAUZ6756.js";function es(){const[m,B]=p.useState([]),[g,M]=p.useState([]),[I,Y]=p.useState(!0),[u,E]=p.useState(null),[r,O]=p.useState({}),[P,L]=p.useState(null),[H,se]=p.useState(""),[h,oe]=p.useState("all"),[F,G]=p.useState(null),[W,U]=p.useState({sessionNotes:"",whatWentWell:"",whatWentWrong:"",whatsNext:""}),[xe,Q]=p.useState([]),[ce,d]=p.useState(!1),[X,V]=p.useState(!1),[te,ie]=p.useState("list");p.useEffect(()=>{N()},[]);const N=async()=>{try{const[s,o]=await Promise.all([ue($e(ae(A,"clients"),Ue("name","asc"))),ue(ae(A,"sessions"))]),v=s.docs.map(c=>({id:c.id,...c.data()})),S=o.docs.map(c=>({id:c.id,...c.data()}));B(v),M(S)}catch(s){console.error("Error fetching data:",s)}Y(!1)},R=s=>{const o=new Date,v=o.getFullYear(),S=(o.getMonth()+1).toString().padStart(2,"0"),c=o.getDate().toString().padStart(2,"0"),D=`${v}-${S}-${c}`,k=`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`;return g.filter(T=>T.clientId!==s?!1:T.date<D||T.date===D&&T.time<k).length},_=s=>{const o=R(s.id);return(s.totalSessions||0)-o},ge=s=>{const o=new Date,v=o.getFullYear(),S=(o.getMonth()+1).toString().padStart(2,"0"),c=o.getDate().toString().padStart(2,"0"),D=`${v}-${S}-${c}`,k=`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`;return g.filter(T=>T.clientId!==s?!1:T.date>D||T.date===D&&T.time>=k).length},K=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"-",le=async(s,o)=>{if(window.confirm(`Are you sure you want to delete ${o}? This will also delete all their booked sessions.`))try{const S=g.filter(c=>c.clientId===s).map(c=>we(ne(A,"sessions",c.id)));await Promise.all(S),await we(ne(A,"clients",s)),B(m.filter(c=>c.id!==s)),M(g.filter(c=>c.clientId!==s))}catch(v){console.error("Error deleting client:",v),alert("Failed to delete client")}},de=s=>{if(!s)return"";const o=s.toDate?s.toDate():new Date(s),v=o.getFullYear(),S=(o.getMonth()+1).toString().padStart(2,"0"),c=o.getDate().toString().padStart(2,"0");return`${v}-${S}-${c}`},re=s=>{E(s.id),O({name:s.name,email:s.email,password:"",clientType:s.clientType||"block",weeksInBlock:s.weeksInBlock||"",totalSessions:s.totalSessions||"",sessionsRemaining:s.sessionsRemaining,sessionDuration:s.sessionDuration||45,startDate:de(s.startDate),endDate:de(s.endDate),status:s.status,hasPortalAccess:!!s.uid,circuitAccess:!!s.circuitAccess,coreBuddyAccess:!!s.coreBuddyAccess,buddyEnabled:!!s.buddyEnabled,coreBuddyPlan:s.coreBuddyPlan||"free",isJunior:!!s.isJunior})},Z=s=>{const{name:o,value:v}=s.target;if(O(S=>({...S,[o]:v})),o==="startDate"||o==="weeksInBlock"){const S=o==="startDate"?v:r.startDate,c=parseInt(o==="weeksInBlock"?v:r.weeksInBlock);if(S&&c>0){const D=new Date(S),k=new Date(D);k.setDate(k.getDate()+c*7);const T=k.getFullYear(),ee=(k.getMonth()+1).toString().padStart(2,"0"),ve=k.getDate().toString().padStart(2,"0");O(Ne=>({...Ne,[o]:v,endDate:`${T}-${ee}-${ve}`}))}}},J=async s=>{try{const o=m.find(D=>D.id===s);let v=o?.uid;if(r.password&&r.password.length>=6&&!o?.uid)try{const D=await Ve(Pe,r.email.trim().toLowerCase(),r.password);await ze(Pe),v=D.user.uid}catch(D){if(console.error("Error creating auth account:",D),D.code==="auth/email-already-in-use")alert("This email already has a portal account. Password not changed.");else if(D.code==="auth/weak-password"){alert("Password must be at least 6 characters.");return}else{alert("Failed to create portal account: "+D.message);return}}const S=r.clientType==="block",c={name:r.name.trim(),email:r.email.trim().toLowerCase(),clientType:r.clientType,status:r.status,coreBuddyAccess:r.coreBuddyAccess,buddyEnabled:r.buddyEnabled,isJunior:r.isJunior};if(S)c.weeksInBlock=parseInt(r.weeksInBlock)||0,c.totalSessions=parseInt(r.totalSessions)||0,c.sessionDuration=parseInt(r.sessionDuration),c.circuitAccess=r.circuitAccess,r.startDate&&(c.startDate=me.fromDate(new Date(r.startDate))),r.endDate&&(c.endDate=me.fromDate(new Date(r.endDate)));else if(r.clientType==="core_buddy")c.coreBuddyPlan=r.coreBuddyPlan||"free",c.coreBuddyAccess=!0;else{const D=m.find(k=>k.id===s);D?.circuitStrikes===void 0&&(c.circuitStrikes=0),D?.circuitBanUntil===void 0&&(c.circuitBanUntil=null)}v&&!o?.uid&&(c.uid=v),await je(ne(A,"clients",s),c),B(m.map(D=>D.id===s?{...D,...r,uid:v||D.uid,weeksInBlock:parseInt(r.weeksInBlock),totalSessions:parseInt(r.totalSessions),sessionDuration:parseInt(r.sessionDuration),startDate:me.fromDate(new Date(r.startDate)),endDate:me.fromDate(new Date(r.endDate))}:D)),E(null),v&&!o?.uid&&alert("Portal access created! Client can now log in.")}catch(o){console.error("Error updating client:",o),alert("Failed to update client")}},pe=async s=>{try{const o=m.find(v=>v.id===s)?.status==="archived"?"active":"archived";await je(ne(A,"clients",s),{status:o}),B(m.map(v=>v.id===s?{...v,status:o}:v))}catch(o){console.error("Error archiving client:",o),alert("Failed to update client status")}},be=async s=>{G({clientId:s.id,clientName:s.name}),ie("list"),U({sessionNotes:"",whatWentWell:"",whatWentWrong:"",whatsNext:""}),d(!0);try{const o=$e(ae(A,"sessionNotes"),Ee("clientId","==",s.id)),S=(await ue(o)).docs.map(c=>({id:c.id,...c.data()}));S.sort((c,D)=>{const k=c.createdAt?.toMillis?.()||0;return(D.createdAt?.toMillis?.()||0)-k}),Q(S)}catch(o){console.error("Error fetching notes:",o),Q([])}d(!1)},fe=()=>{G(null),Q([]),ie("list")},n=async()=>{if(!F)return;const{sessionNotes:s,whatWentWell:o,whatWentWrong:v,whatsNext:S}=W;if(!(!s.trim()&&!o.trim()&&!v.trim()&&!S.trim())){V(!0);try{const D=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});await ke(ae(A,"sessionNotes"),{clientId:F.clientId,date:D,sessionNotes:s.trim(),whatWentWell:o.trim(),whatWentWrong:v.trim(),whatsNext:S.trim(),createdAt:me.now()}),U({sessionNotes:"",whatWentWell:"",whatWentWrong:"",whatsNext:""});const k=$e(ae(A,"sessionNotes"),Ee("clientId","==",F.clientId)),ee=(await ue(k)).docs.map(ve=>({id:ve.id,...ve.data()}));ee.sort((ve,Ne)=>{const ye=ve.createdAt?.toMillis?.()||0;return(Ne.createdAt?.toMillis?.()||0)-ye}),Q(ee),ie("list")}catch(c){console.error("Error saving note:",c),alert("Failed to save note. Check Firestore rules for sessionNotes collection.")}V(!1)}},f=async s=>{if(window.confirm("Delete this session note?"))try{await we(ne(A,"sessionNotes",s)),Q(xe.filter(o=>o.id!==s))}catch(o){console.error("Error deleting note:",o)}};if(I)return e.jsx("div",{className:"client-list-loading",children:"Loading clients..."});if(m.length===0)return e.jsxs("div",{className:"client-list-empty",children:[e.jsx("p",{children:"No clients yet"}),e.jsx("span",{children:"Add your first client to get started"})]});const b=s=>s.clientType==="circuit_vip"?"VIP":s.clientType==="circuit_dropin"?"Drop-in":s.clientType==="core_buddy"?"Core Buddy":"Block",C=m.filter(s=>s.name?.toLowerCase().includes(H.toLowerCase())||s.email?.toLowerCase().includes(H.toLowerCase())).sort((s,o)=>(s.name||"").localeCompare(o.name||"")),z=s=>s.clientType==="circuit_vip"||s.clientType==="circuit_dropin",q=s=>s.clientType==="core_buddy",a=s=>s.status==="archived",j=C.filter(s=>!a(s)),$=j.filter(s=>!z(s)&&!q(s)),t=j.filter(s=>z(s)),i=j.filter(s=>q(s)),l=C.filter(s=>a(s)),y=h==="block"?$:h==="circuit"?t:h==="core_buddy"?i:h==="archived"?l:j,x=s=>{u||L(o=>o===s?null:s)},w=s=>{const o=P===s.id,v=u===s.id,S=!s.clientType||s.clientType==="block";let c=null,D=null;if(S&&s.status!=="archived"){const k=_(s);if(k<=2&&(c={text:k<=0?"No sessions":`${k} left`,urgent:k<=0}),s.endDate){const T=s.endDate.toDate?s.endDate.toDate():new Date(s.endDate),ee=Math.ceil((T-new Date)/(1e3*60*60*24));ee<=7&&(D={text:ee<=0?"Expired":ee===1?"Ends today":`${ee}d left`,urgent:ee<=1})}}return e.jsxs("div",{className:`client-card ${s.status==="archived"?"archived":""} ${o||v?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"client-name-row",onClick:()=>x(s.id),children:[e.jsxs("div",{className:"client-name-row-left",children:[e.jsx("span",{className:"client-name-initial",children:s.name?.charAt(0)?.toUpperCase()}),e.jsxs("div",{className:"client-name-text",children:[e.jsx("h3",{children:s.name}),e.jsx("span",{className:"client-name-sub",children:S?`${_(s)}/${s.totalSessions||0} sessions`:b(s)})]})]}),e.jsxs("div",{className:"client-name-row-right",children:[c&&e.jsx("span",{className:`client-warn-badge ${c.urgent?"urgent":"warning"}`,children:c.text}),D&&e.jsx("span",{className:`client-warn-badge ${D.urgent?"urgent":"expiry"}`,children:D.text}),(s.clientType==="circuit_vip"||s.clientType==="circuit_dropin"||s.clientType==="core_buddy")&&e.jsx("span",{className:`client-type-badge ${s.clientType==="circuit_vip"?"vip":s.clientType==="core_buddy"?"core-buddy":"dropin"}`,children:b(s)}),e.jsx("span",{className:`status-dot ${s.status}`}),e.jsx("svg",{className:`client-chevron ${o||v?"open":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]})]}),(o||v)&&e.jsx("div",{className:"client-expand-panel",children:v?e.jsxs("div",{className:"edit-form",children:[e.jsx("div",{className:"edit-type-toggle",children:[{value:"block",label:"Block"},{value:"circuit_vip",label:"VIP"},{value:"circuit_dropin",label:"Drop-in"},{value:"core_buddy",label:"Core Buddy"}].map(k=>e.jsx("button",{type:"button",className:`edit-type-btn ${r.clientType===k.value?"active":""}`,onClick:()=>O(T=>({...T,clientType:k.value})),children:k.label},k.value))}),e.jsxs("div",{className:"edit-row",children:[e.jsx("input",{type:"text",name:"name",value:r.name,onChange:Z,placeholder:"Name"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:Z,placeholder:"Email"})]}),r.clientType==="block"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"edit-row",children:[e.jsx("input",{type:"number",name:"weeksInBlock",value:r.weeksInBlock,onChange:Z,placeholder:"Weeks",min:"1"}),e.jsx("input",{type:"number",name:"totalSessions",value:r.totalSessions,onChange:Z,placeholder:"Total Sessions",min:"1"}),e.jsxs("select",{name:"sessionDuration",value:r.sessionDuration,onChange:Z,children:[e.jsx("option",{value:"30",children:"30 min"}),e.jsx("option",{value:"45",children:"45 min"})]})]}),e.jsxs("div",{className:"edit-row",children:[e.jsx("input",{type:"date",name:"startDate",value:r.startDate,onChange:Z}),e.jsx("input",{type:"date",name:"endDate",value:r.endDate,onChange:Z})]})]}),r.clientType==="core_buddy"&&e.jsx("div",{className:"edit-row",children:e.jsxs("select",{name:"coreBuddyPlan",value:r.coreBuddyPlan,onChange:Z,children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"premium",children:"Premium"})]})}),e.jsx("div",{className:"edit-row password-row",children:r.hasPortalAccess?e.jsx("div",{className:"portal-status has-access",children:"Has portal access"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",name:"password",value:r.password,onChange:Z,placeholder:"Set portal password (min 6 chars)"}),e.jsx("span",{className:"password-hint",children:"Set password to enable client portal"})]})}),r.clientType==="block"&&e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:r.circuitAccess,onChange:k=>O(T=>({...T,circuitAccess:k.target.checked}))}),e.jsx("span",{children:"Circuit Class Access"})]})}),r.clientType!=="core_buddy"&&e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:r.coreBuddyAccess,onChange:k=>O(T=>({...T,coreBuddyAccess:k.target.checked}))}),e.jsx("span",{children:"Core Buddy Access"})]})}),e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:r.buddyEnabled,onChange:k=>O(T=>({...T,buddyEnabled:k.target.checked}))}),e.jsx("span",{children:"AI Buddy"})]})}),r.clientType==="block"&&e.jsx("div",{className:"edit-row circuit-row",children:e.jsxs("label",{className:"circuit-access-toggle",children:[e.jsx("input",{type:"checkbox",checked:r.isJunior,onChange:k=>O(T=>({...T,isJunior:k.target.checked}))}),e.jsx("span",{children:"Junior Client (Kids)"})]})}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"save-edit-btn",onClick:()=>J(s.id),children:"Save"}),e.jsx("button",{className:"cancel-edit-btn",onClick:()=>{E(null)},children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-expand-info",children:[e.jsx("span",{className:"client-email",children:s.email}),e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})]}),S?e.jsxs("div",{className:"client-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Block"}),e.jsxs("span",{className:"detail-value",children:[s.weeksInBlock," weeks"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Sessions"}),e.jsxs("span",{className:"detail-value",children:[_(s)," / ",s.totalSessions," remaining"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Booked"}),e.jsxs("span",{className:"detail-value",children:[ge(s.id)," sessions"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Duration"}),e.jsxs("span",{className:"detail-value",children:[s.sessionDuration||45," min"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Start"}),e.jsx("span",{className:"detail-value",children:K(s.startDate)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"End"}),e.jsx("span",{className:"detail-value",children:K(s.endDate)})]})]}):s.clientType==="core_buddy"?e.jsxs("div",{className:"client-details circuit-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Plan"}),e.jsx("span",{className:"detail-value",children:s.coreBuddyPlan==="premium"?"Premium":"Free"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Joined"}),e.jsx("span",{className:"detail-value",children:K(s.createdAt)})]})]}):e.jsxs("div",{className:"client-details circuit-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Type"}),e.jsx("span",{className:"detail-value",children:s.clientType==="circuit_vip"?"Monthly VIP":"Drop-in"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Strikes"}),e.jsxs("span",{className:"detail-value",children:[s.circuitStrikes||0,"/3"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Joined"}),e.jsx("span",{className:"detail-value",children:K(s.createdAt)})]})]}),e.jsxs("div",{className:"client-actions",children:[S&&e.jsxs("button",{className:"action-btn notes",onClick:k=>{k.stopPropagation(),be(s)},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"14",height:"14",children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),"Notes"]}),e.jsx("button",{className:"action-btn edit",onClick:k=>{k.stopPropagation(),re(s)},children:"Edit"}),e.jsx("button",{className:"action-btn archive",onClick:k=>{k.stopPropagation(),pe(s.id)},children:s.status==="archived"?"Reactivate":"Archive"}),e.jsx("button",{className:"action-btn delete",onClick:k=>{k.stopPropagation(),le(s.id,s.name)},children:"Delete"})]})]})})]},s.id)};return e.jsxs("div",{className:"client-list",children:[e.jsxs("div",{className:"client-search",children:[e.jsxs("svg",{className:"client-search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]}),e.jsx("input",{type:"text",placeholder:"Search clients...",value:H,onChange:s=>se(s.target.value),className:"client-search-input"}),H&&e.jsx("button",{className:"client-search-clear",onClick:()=>se(""),children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),e.jsxs("select",{className:"client-type-select",value:h,onChange:s=>oe(s.target.value),children:[e.jsxs("option",{value:"all",children:["All Clients (",j.length,")"]}),e.jsxs("option",{value:"block",children:["Block Members (",$.length,")"]}),e.jsxs("option",{value:"circuit",children:["Circuit Members (",t.length,")"]}),e.jsxs("option",{value:"core_buddy",children:["Core Buddy (",i.length,")"]}),e.jsxs("option",{value:"archived",children:["Archived (",l.length,")"]})]}),h==="all"?e.jsxs(e.Fragment,{children:[$.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Block Members ",e.jsx("span",{children:$.length})]}),$.map(w)]}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Circuit Members ",e.jsx("span",{children:t.length})]}),t.map(w)]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Core Buddy Members ",e.jsx("span",{children:i.length})]}),i.map(w)]})]}):h==="archived"?e.jsx(e.Fragment,{children:l.length===0?e.jsx("div",{className:"client-section-empty",children:"No archived clients"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"client-section-header",children:["Archived Clients ",e.jsx("span",{children:l.length})]}),l.map(w)]})}):e.jsxs(e.Fragment,{children:[y.length===0&&e.jsxs("div",{className:"client-section-empty",children:["No ",h," clients found"]}),y.map(w)]}),F&&e.jsx("div",{className:"notes-modal-overlay",onClick:fe,children:e.jsxs("div",{className:"notes-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"notes-modal-header",children:[e.jsxs("h3",{children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),F.clientName]}),e.jsx("button",{className:"notes-modal-close",onClick:fe,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),te==="list"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notes-modal-body",children:ce?e.jsx("div",{className:"notes-loading",children:"Loading notes..."}):xe.length===0?e.jsxs("div",{className:"notes-empty",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",width:"40",height:"40",children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),e.jsx("p",{children:"No session notes yet"}),e.jsx("span",{children:"Add notes after each session"})]}):e.jsx("div",{className:"notes-list",children:xe.map(s=>e.jsxs("div",{className:"note-card",children:[e.jsxs("div",{className:"note-card-header",children:[e.jsx("span",{className:"note-date",children:s.date}),e.jsx("button",{className:"note-delete-btn",onClick:()=>f(s.id),children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"14",height:"14",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]})})]}),s.sessionNotes&&e.jsxs("div",{className:"note-section",children:[e.jsx("span",{className:"note-section-label",children:"Session Notes"}),e.jsx("p",{children:s.sessionNotes})]}),s.whatWentWell&&e.jsxs("div",{className:"note-section went-well",children:[e.jsx("span",{className:"note-section-label",children:"What Went Well"}),e.jsx("p",{children:s.whatWentWell})]}),s.whatWentWrong&&e.jsxs("div",{className:"note-section went-wrong",children:[e.jsx("span",{className:"note-section-label",children:"What Went Wrong"}),e.jsx("p",{children:s.whatWentWrong})]}),s.whatsNext&&e.jsxs("div",{className:"note-section whats-next",children:[e.jsx("span",{className:"note-section-label",children:"What's Next"}),e.jsx("p",{children:s.whatsNext})]})]},s.id))})}),e.jsx("div",{className:"notes-modal-footer",children:e.jsxs("button",{className:"notes-add-btn",onClick:()=>ie("add"),children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Session Notes"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notes-modal-body",children:e.jsxs("div",{className:"notes-form",children:[e.jsxs("div",{className:"notes-form-group",children:[e.jsx("label",{children:"Session Notes"}),e.jsx("textarea",{value:W.sessionNotes,onChange:s=>U(o=>({...o,sessionNotes:s.target.value})),placeholder:"Overview of the session...",rows:"3"})]}),e.jsxs("div",{className:"notes-form-group went-well",children:[e.jsxs("label",{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"What Went Well"]}),e.jsx("textarea",{value:W.whatWentWell,onChange:s=>U(o=>({...o,whatWentWell:s.target.value})),placeholder:"Positives from the session...",rows:"2"})]}),e.jsxs("div",{className:"notes-form-group went-wrong",children:[e.jsxs("label",{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),"What Went Wrong"]}),e.jsx("textarea",{value:W.whatWentWrong,onChange:s=>U(o=>({...o,whatWentWrong:s.target.value})),placeholder:"Areas to improve...",rows:"2"})]}),e.jsxs("div",{className:"notes-form-group whats-next",children:[e.jsxs("label",{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14",children:e.jsx("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})}),"What's Next"]}),e.jsx("textarea",{value:W.whatsNext,onChange:s=>U(o=>({...o,whatsNext:s.target.value})),placeholder:"Goals for next session...",rows:"2"})]})]})}),e.jsxs("div",{className:"notes-modal-footer",children:[e.jsx("button",{className:"notes-cancel-btn",onClick:()=>ie("list"),children:"Back"}),e.jsx("button",{className:"notes-save-btn",onClick:n,disabled:X,children:X?"Saving...":"Save Notes"})]})]})]})})]})}const ss=["Mon","Tue","Wed","Thu","Fri"],ts=m=>{const B=new Date(m),g=B.getDay(),M=B.getDate()-g+(g===0?-6:1);return B.setDate(M),Te.map((I,Y)=>{const u=new Date(B);return u.setDate(B.getDate()+Y),u})};function as(){const[m,B]=p.useState(new Date),[g,M]=p.useState([]),[I,Y]=p.useState([]),[u,E]=p.useState([]),[r,O]=p.useState([]),[P,L]=p.useState([]),[H,se]=p.useState([]),[h,oe]=p.useState(null),[F,G]=p.useState(null),[W,U]=p.useState(!1),[xe,Q]=p.useState(!0),[ce,d]=p.useState("");p.useEffect(()=>{M(ts(m))},[m]),p.useEffect(()=>{K()},[]);const X=t=>{oe(t),U(!1),G(null)},V=()=>{if(!h)return null;const t=h.startDate?.toDate?h.startDate.toDate():new Date(h.startDate),i=h.endDate?.toDate?h.endDate.toDate():new Date(h.endDate),l=g[0];if(!l)return null;const y=10080*60*1e3,x=Math.floor((l-t)/y)+1,w=h.weeksInBlock||Math.ceil((i-t)/y),s=l>=t&&l<=i;return{startDate:t,endDate:i,weekNumber:x,totalWeeks:w,isWithinBlock:s}},te=()=>{if(h?.startDate){const t=h.startDate.toDate?h.startDate.toDate():new Date(h.startDate);B(t),G(null)}},ie=()=>{if(h?.endDate){const t=h.endDate.toDate?h.endDate.toDate():new Date(h.endDate);B(t),G(null)}},N=t=>{const i=new Date,l=he(i),y=`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`;return u.filter(x=>x.clientId!==t?!1:x.date<l||x.date===l&&x.time<y).length},R=t=>{const i=N(t.id);return(t.totalSessions||0)-i},_=t=>{const i=new Date,l=i.getFullYear(),y=(i.getMonth()+1).toString().padStart(2,"0"),x=i.getDate().toString().padStart(2,"0"),w=`${l}-${y}-${x}`,s=`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`;return u.filter(o=>o.clientId!==t?!1:o.date>w||o.date===w&&o.time>=s).length},ge=t=>{const i=new Date,l=he(i),y=`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`;return t.date<l||t.date===l&&t.time<y},K=async()=>{try{const i=(await ue(ae(A,"clients"))).docs.map(c=>({id:c.id,...c.data()})).filter(c=>c.status==="active").sort((c,D)=>c.name.localeCompare(D.name));Y(i);const y=(await ue(ae(A,"sessions"))).docs.map(c=>({id:c.id,...c.data()}));E(y);const w=(await ue(ae(A,"holidays"))).docs.map(c=>({id:c.id,...c.data()}));O(w);const o=(await ue(ae(A,"blockedTimes"))).docs.map(c=>({id:c.id,...c.data()}));L(o);const S=(await ue(ae(A,"openedSlots"))).docs.map(c=>({id:c.id,...c.data()}));se(S)}catch(t){console.error("Error fetching data:",t)}Q(!1)},le=t=>{const i=new Date(m);i.setDate(i.getDate()+t*7),B(i),G(null)},de=()=>{B(new Date),G(null)},re=t=>{const i=he(t);return r.some(l=>l.date===i)},Z=(t,i)=>{const l=he(t);return P.some(y=>y.date===l&&y.time===i)},J=(t,i)=>{const l=he(t);return H.some(y=>y.date===l&&y.time===i)},pe=t=>{const i=Te[t.getDay()-1];return i&&_e[i]?.defaultBlocked},be=async(t,i)=>{const l=he(t);if(pe(t)){const x=H.find(w=>w.date===l&&w.time===i);try{if(x)await we(ne(A,"openedSlots",x.id)),se(H.filter(w=>w.id!==x.id));else{const w=await ke(ae(A,"openedSlots"),{date:l,time:i,createdAt:me.now()});se([...H,{id:w.id,date:l,time:i}])}}catch(w){console.error("Error toggling opened slot:",w),alert("Failed to update time slot")}return}const y=P.find(x=>x.date===l&&x.time===i);try{if(y)await we(ne(A,"blockedTimes",y.id)),L(P.filter(x=>x.id!==y.id));else{const x=await ke(ae(A,"blockedTimes"),{date:l,time:i,createdAt:me.now()});L([...P,{id:x.id,date:l,time:i}])}}catch(x){console.error("Error toggling blocked time:",x),alert("Failed to update time slot")}},fe=t=>{const i=he(t);return u.filter(l=>l.date===i)},n=(t,i)=>{const l=he(t);return u.find(y=>y.date===l&&y.time===i)},f=(t,i)=>{const l=he(t),y=De(i);return u.find(x=>{if(x.date!==l)return!1;const w=De(x.time),s=w+(x.duration||45);return y>=w&&y<s})},b=(t,i,l)=>{const y=Te[t.getDay()-1];if(!y||re(t))return!1;const x=_e[y],w=Math.ceil(l/15);if(x.defaultBlocked)for(let T=0;T<w;T++){const ee=Me(i,T*15);if(!J(t,ee))return!1}else for(let T=0;T<w;T++){const ee=Me(i,T*15);if(Z(t,ee))return!1}const s=he(t);if(u.find(T=>T.date===s&&T.time===i))return!1;const v=Me(i,l),S=x.morning&&v<=x.morning.end,c=x.afternoon&&v<=x.afternoon.end,D=x.morning&&i>=x.morning.start&&i<x.morning.end,k=x.afternoon&&i>=x.afternoon.start&&i<x.afternoon.end;if(D&&!S||k&&!c)return!1;for(const T of u){if(T.date!==s)continue;const ee=De(T.time),ve=ee+(T.duration||45),Ne=De(i),ye=Ne+l;if(Ne<ve&&ye>ee)return!1}return!0},C=async(t,i)=>{const l=f(t,i);if(l){if(ge(l))return;if(window.confirm(`Cancel ${l.clientName}'s session at ${Re(l.time)}?`))try{await we(ne(A,"sessions",l.id)),E(u.filter(w=>w.id!==l.id))}catch(w){console.error("Error cancelling session:",w),alert("Failed to cancel session")}return}if(!h){alert("Please select a client first");return}if(!b(t,i,h.sessionDuration||45)){alert("This slot is not available for this client's session duration");return}const y=_(h.id);if(N(h.id)+y>=h.totalSessions){alert(`${h.name} has used all ${h.totalSessions} sessions in their package`);return}try{const w=he(t),s={clientId:h.id,clientName:h.name,date:w,time:i,duration:h.sessionDuration||45,createdAt:me.now()},o=await ke(ae(A,"sessions"),s);E([...u,{id:o.id,...s}])}catch(w){console.error("Error booking session:",w),alert("Failed to book session")}},z=async()=>{if(!h)return;const t=h.startDate?.toDate?h.startDate.toDate():new Date(h.startDate),i=h.endDate?.toDate?h.endDate.toDate():new Date(h.endDate),l=u.filter(v=>v.clientId!==h.id?!1:g.some(S=>he(S)===v.date));if(l.length===0){alert("No sessions in current week to repeat. Book some sessions first, then use this button.");return}const y=h.weeksInBlock||Math.ceil((i-t)/(10080*60*1e3)),x=l.map(v=>({dayOfWeek:new Date(v.date).getDay(),time:v.time}));let w=[];const s=_(h.id)+N(h.id);for(let v=0;v<y;v++){const S=new Date(t);S.setDate(S.getDate()+v*7);const c=new Date(S),D=c.getDay(),k=c.getDate()-D+(D===0?-6:1);c.setDate(k);for(const T of x){const ee=new Date(c),ve=T.dayOfWeek===0?6:T.dayOfWeek-1;ee.setDate(c.getDate()+ve);const Ne=he(ee);u.some(ye=>ye.clientId===h.id&&ye.date===Ne&&ye.time===T.time)||ee<t||ee>i||r.some(ye=>ye.date===Ne)||w.push({dateKey:Ne,time:T.time,sessionDate:ee})}}const o=s+w.length;if(o>h.totalSessions){alert(`This would create ${w.length} new sessions (${o} total), but client only has ${h.totalSessions} sessions in their package.

You can still book ${h.totalSessions-s} more sessions.`);return}if(w.length===0){alert("All weeks already have sessions booked for this pattern.");return}if(window.confirm(`This will create ${w.length} new sessions across the block.

(${s} existing + ${w.length} new = ${o} total)

Continue?`))try{const v=[];for(const S of w){const c={clientId:h.id,clientName:h.name,date:S.dateKey,time:S.time,duration:h.sessionDuration||45,createdAt:me.now()},D=await ke(ae(A,"sessions"),c);v.push({id:D.id,...c})}E([...u,...v]),alert(`Created ${v.length} new sessions!`)}catch(v){console.error("Error repeating weekly:",v),alert("Failed to repeat sessions")}},q=async t=>{const i=he(t),l=r.find(y=>y.date===i);try{if(l)await we(ne(A,"holidays",l.id)),O(r.filter(y=>y.id!==l.id));else{const y=await ke(ae(A,"holidays"),{date:i,createdAt:me.now()});O([...r,{id:y.id,date:i}])}}catch(y){console.error("Error toggling day availability:",y),alert("Failed to update day availability")}};if(xe)return e.jsx("div",{className:"calendar-loading",children:"Loading calendar..."});const a=g[0],j=g[4],$=a&&j?`${a.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${j.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`:"";return e.jsxs("div",{className:"calendar",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsxs("div",{className:"calendar-nav",children:[e.jsx("button",{onClick:()=>le(-1),children:"←"}),e.jsx("button",{onClick:de,children:"Today"}),e.jsx("button",{onClick:()=>le(1),children:"→"})]}),e.jsx("h3",{children:$})]}),e.jsxs("div",{className:"client-selector",children:[e.jsx("span",{className:"selector-label",children:"Booking for:"}),h?e.jsxs("div",{className:"selected-client",children:[e.jsxs("div",{className:"selected-info",children:[e.jsx("strong",{children:h.name}),e.jsxs("span",{children:[h.sessionDuration||45,"min • ",R(h),"/",h.totalSessions," remaining"]}),e.jsxs("span",{className:"booked-info",children:[_(h.id)," booked"]})]}),e.jsx("button",{onClick:()=>oe(null),children:"Change"})]}):e.jsx("button",{className:"select-client-btn",onClick:()=>U(!0),children:"Select Client"})]}),h&&h.startDate&&h.endDate&&(()=>{const t=V();return t?e.jsxs("div",{className:"block-nav",children:[e.jsx("button",{onClick:te,children:"← Block Start"}),e.jsx("span",{className:"block-range",children:t.isWithinBlock?`Week ${t.weekNumber} of ${t.totalWeeks}`:g[0]<t.startDate?"Before block":"After block"}),e.jsx("button",{onClick:ie,children:"Block End →"})]}):null})(),h&&e.jsxs("div",{className:"repeat-weekly-section",children:[e.jsx("button",{className:"repeat-weekly-btn",onClick:z,children:"Repeat This Week's Schedule For All Weeks"}),e.jsx("span",{className:"repeat-hint",children:"Copies current week's sessions to all weeks in block"})]}),e.jsx("div",{className:"day-cards",children:g.map((t,i)=>{const l=fe(t),y=he(t)===he(new Date),x=re(t);return e.jsxs("div",{className:`day-card ${F===i?"selected":""} ${y?"today":""} ${x?"holiday":""}`,onClick:()=>G(F===i?null:i),children:[e.jsxs("div",{className:"day-card-header",children:[e.jsx("span",{className:"day-name",children:ss[i]}),e.jsx("span",{className:"day-date",children:t.getDate()})]}),x?e.jsx("div",{className:"day-card-status holiday",children:"Unavailable"}):e.jsxs("div",{className:"day-card-status",children:[l.length," session",l.length!==1?"s":""]})]},i)})}),F!==null&&g[F]&&e.jsxs("div",{className:"time-panel",children:[e.jsxs("div",{className:"time-panel-header",children:[e.jsxs("h4",{children:[Xe[F]," ",g[F].getDate()]}),e.jsx("button",{className:"close-panel",onClick:()=>G(null),children:"×"})]}),e.jsx("div",{className:"availability-toggle",children:e.jsx("button",{className:`toggle-availability-btn ${re(g[F])?"unavailable":"available"}`,onClick:()=>q(g[F]),children:re(g[F])?"Mark Day Available":"Mark Day Unavailable"})}),re(g[F])?e.jsxs("div",{className:"day-unavailable-message",children:[e.jsx("p",{children:"This day is marked as unavailable"}),e.jsx("span",{children:"Tap the button above to make it available again"})]}):e.jsxs("div",{className:"time-slots",children:[pe(g[F])&&e.jsx("div",{className:"default-blocked-notice",children:"Flex day — slots are closed by default. Tap the toggle to open slots."}),Ze(Te[F]).map(({time:t,period:i},l,y)=>{const x=n(g[F],t),w=f(g[F],t),s=!!w,o=!x&&!!w,v=w?ge(w):!1,S=pe(g[F]),c=S?!J(g[F],t):Z(g[F],t),D=S&&J(g[F],t),k=h&&!s&&b(g[F],t,h.sessionDuration||45),T=l===0||y[l-1]?.period!==i;return e.jsxs("div",{children:[T&&e.jsx("div",{className:"period-label",children:i==="morning"?"Morning":"Afternoon"}),e.jsxs("div",{className:"time-slot-row",children:[e.jsxs("button",{className:`time-slot ${s&&v?"completed":""} ${s&&!v?"booked":""} ${o?"booked-continuation":""} ${c&&!s?"blocked":""} ${D&&!s?"opened":""} ${k?"available":""} ${!s&&!c&&!k&&h?"unavailable":""}`,onClick:()=>!v&&(!c||s)&&C(g[F],t),disabled:v||c&&!s,children:[e.jsx("span",{className:"slot-time",children:Re(t)}),x&&v?e.jsxs("span",{className:"slot-done",children:[x.clientName," ✓"]}):x?e.jsxs("span",{className:"slot-client",children:[x.clientName," (",x.duration,"m)"]}):o&&v?e.jsxs("span",{className:"slot-done",children:[w.clientName," ↑"]}):o?e.jsxs("span",{className:"slot-client",children:[w.clientName," ↑"]}):c?e.jsx("span",{className:"slot-blocked",children:S?"Closed":"Blocked"}):k?e.jsx("span",{className:"slot-available",children:"Available"}):h?e.jsx("span",{className:"slot-unavailable",children:"Unavailable"}):D?e.jsx("span",{className:"slot-available",children:"Open"}):e.jsx("span",{className:"slot-empty",children:"Select client to book"})]}),e.jsx("button",{className:`block-toggle-btn ${S?D?"is-opened":"":c?"is-blocked":""}`,onClick:()=>be(g[F],t),disabled:v||!!s,title:S?D?"Close this slot":"Open this slot":c?"Unblock this time":"Block this time",children:S?D?"✓":"+":c?"✓":"✕"})]})]},t)})]})]}),W&&e.jsx("div",{className:"modal-overlay",onClick:()=>{U(!1),d("")},children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Select Client"}),e.jsx("button",{className:"close-btn",onClick:()=>{U(!1),d("")},children:"×"})]}),e.jsx("div",{className:"client-search-wrapper",children:e.jsx("input",{className:"client-search-input",type:"text",placeholder:"Search by name...",value:ce,onChange:t=>d(t.target.value),autoFocus:!0})}),e.jsx("div",{className:"client-list-picker",children:I.length===0?e.jsx("p",{className:"no-items",children:"No active clients"}):(()=>{const t={block:"Block",core_buddy:"Core Buddy",circuit_vip:"Circuit VIP",circuit_dropin:"Circuit Drop-in"},i=I.filter(l=>l.name.toLowerCase().includes(ce.toLowerCase()));return i.length===0?e.jsxs("p",{className:"no-items",children:['No clients match "',ce,'"']}):i.map(l=>{const y=l.startDate&&l.endDate,x=y?l.startDate?.toDate?l.startDate.toDate():new Date(l.startDate):null,w=y?l.endDate?.toDate?l.endDate.toDate():new Date(l.endDate):null,s=R(l),o=_(l.id);return e.jsxs("button",{className:"client-option",onClick:()=>{X(l),d("")},children:[e.jsxs("div",{className:"client-option-header",children:[e.jsx("strong",{children:l.name}),l.clientType&&e.jsx("span",{className:"client-type-badge",children:t[l.clientType]||l.clientType})]}),e.jsxs("span",{children:[l.sessionDuration||45,"min • ",s,"/",l.totalSessions," remaining • ",o," booked"]}),x&&w&&e.jsxs("span",{className:"client-dates",children:[x.toLocaleDateString("en-GB",{day:"numeric",month:"short"})," – ",w.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]},l.id)})})()})]})})]})}const Le=m=>{const[B,g]=m.split(":"),M=parseInt(B),I=M>=12?"pm":"am";return`${M>12?M-12:M===0?12:M}:${g}${I}`},Se=m=>{const B=m.getFullYear(),g=(m.getMonth()+1).toString().padStart(2,"0"),M=m.getDate().toString().padStart(2,"0");return`${B}-${g}-${M}`},Ie=m=>m===Se(new Date),ns=m=>{const B=new Date;return B.setDate(B.getDate()+1),m===Se(B)},Fe=m=>Ie(m)?"Today":ns(m)?"Tomorrow":new Date(m).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"short"}),qe=m=>{const[B,g]=m.split(":").map(Number);return B*60+g},Ce=m=>{const B=new Date,g=Se(B),M=`${B.getHours().toString().padStart(2,"0")}:${B.getMinutes().toString().padStart(2,"0")}`;if(m.date<g)return!0;if(m.date===g){const I=qe(m.time)+(m.duration||45);return qe(M)>=I}return!1},is=m=>{if(m.length===0)return[];const B=new Date,g=new Date(B),M=g.getDay();g.setDate(g.getDate()-(M===0?6:M-1)),g.setHours(0,0,0,0);const I=new Date(g);I.setDate(I.getDate()+7);const Y=new Date(I);Y.setDate(Y.getDate()+7);const u=new Map;return m.forEach(E=>{const[r,O,P]=E.split("-").map(Number),L=new Date(r,O-1,P);let H,se,h;L<I?(H="this-week",se="This Week",h=0):L<Y?(H="next-week",se="Next Week",h=1):(H=`${L.getFullYear()}-${L.getMonth()}`,se=L.toLocaleDateString("en-GB",{month:"long",year:"numeric"}),h=100+L.getFullYear()*12+L.getMonth()),u.has(H)||u.set(H,{key:H,label:se,order:h,dates:[]}),u.get(H).dates.push(E)}),Array.from(u.values()).sort((E,r)=>E.order-r.order)};function ls(){const[m,B]=p.useState([]),[g,M]=p.useState(!0),[I,Y]=p.useState(new Date),[u,E]=p.useState(""),[r,O]=p.useState(""),[P,L]=p.useState(!1),[H,se]=p.useState(new Set);p.useEffect(()=>{h();const N=setInterval(()=>Y(new Date),6e4);return()=>clearInterval(N)},[]);const h=async()=>{try{const R=(await ue(ae(A,"sessions"))).docs.map(K=>({id:K.id,...K.data()})),_=Se(new Date),ge=R.filter(K=>K.date>=_).sort((K,le)=>K.date!==le.date?K.date.localeCompare(le.date):K.time.localeCompare(le.time));B(ge)}catch(N){console.error("Error fetching sessions:",N)}M(!1)},oe=async N=>{if(window.confirm(`Cancel ${N.clientName}'s session at ${Le(N.time)} on ${Fe(N.date)}?`))try{await we(ne(A,"sessions",N.id)),B(m.filter(R=>R.id!==N.id))}catch(R){console.error("Error cancelling session:",R),alert("Failed to cancel session")}},F=N=>{se(R=>{const _=new Set(R);return _.has(N)?_.delete(N):_.add(N),_})};if(g)return e.jsx("div",{className:"schedule-loading",children:"Loading schedule..."});const G=r?m.filter(N=>N.clientName.toLowerCase().includes(r.toLowerCase())):m,W=G.reduce((N,R)=>(N[R.date]||(N[R.date]=[]),N[R.date].push(R),N),{}),U=Object.keys(W).sort(),xe=Se(new Date),Q=W[xe]||[],ce=Q.filter(N=>Ce(N)).length,d=Q.length-ce,X=G.find(N=>!Ce(N)),te=(()=>{if(!X||X.date!==Se(new Date))return null;const[N,R]=X.time.split(":").map(Number),_=N*60+R-(new Date().getHours()*60+new Date().getMinutes());return _<=0||_>180?null:_<60?`${_}m`:`${Math.floor(_/60)}h ${_%60}m`})(),ie=is(U);return e.jsxs("div",{className:"schedule",children:[e.jsxs("div",{className:"today-summary",children:[e.jsx("h3",{children:"Today's Sessions"}),e.jsx("div",{className:"today-count",children:Q.length===0?e.jsx("span",{className:"no-sessions",children:"No sessions today"}):e.jsxs("div",{className:"today-stats",children:[e.jsxs("span",{className:"completed-count",children:[ce," completed"]}),e.jsxs("span",{className:"remaining-count",children:[d," remaining"]})]})}),ce>0&&e.jsx("button",{className:"hide-completed-btn",onClick:()=>L(N=>!N),children:P?"Show all":"Hide done"})]}),X&&te&&e.jsxs("div",{className:"next-session-banner",children:[e.jsx("div",{className:"next-session-label",children:"Up next"}),e.jsxs("div",{className:"next-session-info",children:[e.jsx("span",{className:"next-session-name",children:X.clientName}),e.jsx("span",{className:"next-session-time",children:Le(X.time)})]}),e.jsx("div",{className:"next-session-countdown",children:te})]}),U.length===0?e.jsx("div",{className:"no-upcoming",children:e.jsx("p",{children:r?`No sessions found for "${r}"`:"No upcoming sessions booked"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"schedule-controls",children:[e.jsx("input",{className:"client-filter-input",type:"text",placeholder:"Filter by client...",value:r,onChange:N=>O(N.target.value)}),e.jsxs("select",{className:"date-jump-select",value:u,onChange:N=>{const R=N.target.value;E(R),R&&(document.getElementById(`date-${R}`)?.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>E(""),600))},children:[e.jsx("option",{value:"",children:"Jump to date..."}),U.map(N=>e.jsxs("option",{value:N,children:[Fe(N)," (",W[N].length,")"]},N))]})]}),e.jsx("div",{className:"sessions-list",children:ie.map(({key:N,label:R,dates:_})=>{const K=N!=="this-week"&&N!=="next-week"?!H.has(N):H.has(N),le=_.reduce((de,re)=>de+W[re].length,0);return e.jsxs("div",{className:"week-group",children:[e.jsxs("button",{className:`week-group-header ${K?"collapsed":""}`,onClick:()=>F(N),children:[e.jsx("span",{className:"week-label",children:R}),e.jsxs("span",{className:"week-count",children:[le," session",le!==1?"s":""]}),e.jsx("span",{className:"week-chevron",children:K?"▸":"▾"})]}),!K&&e.jsx("div",{className:"week-group-body",children:_.map(de=>{const re=W[de],Z=P&&Ie(de)?re.filter(J=>!Ce(J)):re;return e.jsxs("div",{id:`date-${de}`,className:`date-group ${Ie(de)?"today":""}`,children:[e.jsxs("div",{className:"date-header",children:[e.jsx("span",{className:"date-label",children:Fe(de)}),e.jsxs("span",{className:"date-count",children:[re.length," session",re.length!==1?"s":""]})]}),e.jsx("div",{className:"date-sessions",children:Z.length===0?e.jsx("div",{className:"all-done-msg",children:"All sessions completed ✓"}):Z.map(J=>{const pe=Ce(J);return e.jsxs("div",{className:`session-card ${pe?"completed":""}`,children:[e.jsx("div",{className:"session-time",children:Le(J.time)}),e.jsxs("div",{className:"session-details",children:[e.jsx("strong",{children:J.clientName}),e.jsxs("span",{children:[J.duration,"min session"]})]}),pe?e.jsx("div",{className:"completed-badge",children:"✓"}):e.jsx("button",{className:"cancel-session-btn",onClick:()=>oe(J),children:"Cancel"})]},J.id)})})]},de)})})]},N)})})]})]})}const rs={sedentary:"Sedentary (little to no exercise)",light:"Lightly Active (1-2 days/week)",moderate:"Moderately Active (3-4 days/week)",active:"Very Active (5+ days/week)",athlete:"Athlete/Highly Active"},os={"less-5":"Less than 5 hours","5-6":"5-6 hours","7-8":"7-8 hours","more-8":"More than 8 hours"},cs={low:"Low",moderate:"Moderate",high:"High","very-high":"Very High"},ds=[{key:"q1HeartCondition",text:"Has your doctor ever said that you have a heart condition and that you should only do physical activity recommended by a doctor?"},{key:"q2ChestPain",text:"Do you feel pain in your chest when you do physical activity?"},{key:"q3ChestPainLastMonth",text:"In the past month, have you had chest pain when you were not doing physical activity?"},{key:"q4Balance",text:"Do you lose your balance because of dizziness or do you ever lose consciousness?"},{key:"q5BoneJoint",text:"Do you have a bone or joint problem that could be made worse by a change in your physical activity?"},{key:"q6BloodPressure",text:"Is your doctor currently prescribing drugs for your blood pressure or heart condition?"},{key:"q7OtherReason",text:"Do you know of any other reason why you should not do physical activity?"}];function ms(){const[m,B]=p.useState([]),[g,M]=p.useState(!0),[I,Y]=p.useState(null),[u,E]=p.useState(null),[r,O]=p.useState("all"),[P,L]=p.useState("");p.useEffect(()=>{H()},[]);const H=async()=>{try{const X=(await ue(ae(A,"clients"))).docs.map(V=>({id:V.id,...V.data()}));X.sort((V,te)=>(V.name||"").localeCompare(te.name||"")),B(X)}catch(d){console.error("Error fetching clients:",d)}M(!1)},se=d=>!!d.welcomeForm?.completedAt,h=d=>!!d.parqForm?.completedAt,oe=d=>se(d)||h(d),F=d=>se(d)&&h(d),G=d=>d?(d.toDate?d.toDate():new Date(d)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",W=m.filter(d=>!P||d.name?.toLowerCase().includes(P.toLowerCase())?r==="all"?!0:r==="completed"?F(d):r==="partial"?oe(d)&&!F(d):r==="pending"?!oe(d):!0:!1),U=m.filter(F).length,xe=m.filter(d=>oe(d)&&!F(d)).length,Q=m.filter(d=>!oe(d)).length,ce=d=>{I===d?(Y(null),E(null)):(Y(d),E(null))};return g?e.jsx("div",{className:"forms-loading",children:"Loading form submissions..."}):e.jsxs("div",{className:"form-submissions",children:[e.jsxs("div",{className:"forms-stats",children:[e.jsxs("div",{className:"forms-stat",children:[e.jsx("span",{className:"stat-number",children:U}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"forms-stat partial",children:[e.jsx("span",{className:"stat-number",children:xe}),e.jsx("span",{className:"stat-label",children:"Partial"})]}),e.jsxs("div",{className:"forms-stat pending",children:[e.jsx("span",{className:"stat-number",children:Q}),e.jsx("span",{className:"stat-label",children:"Pending"})]})]}),e.jsxs("div",{className:"forms-search",children:[e.jsxs("svg",{className:"forms-search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("input",{type:"text",className:"forms-search-input",placeholder:"Search clients...",value:P,onChange:d=>L(d.target.value)}),P&&e.jsx("button",{className:"forms-search-clear",onClick:()=>L(""),children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),e.jsxs("div",{className:"forms-filter",children:[e.jsxs("button",{className:`forms-filter-btn ${r==="all"?"active":""}`,onClick:()=>O("all"),children:["All ",e.jsx("span",{className:"forms-filter-count",children:m.length})]}),e.jsxs("button",{className:`forms-filter-btn ${r==="completed"?"active":""}`,onClick:()=>O("completed"),children:["Complete ",e.jsx("span",{className:"forms-filter-count",children:U})]}),e.jsxs("button",{className:`forms-filter-btn ${r==="partial"?"active":""}`,onClick:()=>O("partial"),children:["Partial ",e.jsx("span",{className:"forms-filter-count",children:xe})]}),e.jsxs("button",{className:`forms-filter-btn ${r==="pending"?"active":""}`,onClick:()=>O("pending"),children:["Pending ",e.jsx("span",{className:"forms-filter-count",children:Q})]})]}),W.length===0?e.jsxs("div",{className:"forms-empty",children:[e.jsx("div",{className:"forms-empty-icon",children:e.jsxs("svg",{viewBox:"0 0 100 100",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"20",y:"15",width:"60",height:"70",rx:"4"}),e.jsx("path",{d:"M35 35h30M35 50h30M35 65h20"}),e.jsx("circle",{cx:"70",cy:"70",r:"18",fill:"var(--bg-card)",strokeWidth:"3"}),e.jsx("path",{d:"M63 70h14M70 63v14",strokeWidth:"3",strokeLinecap:"round"})]})}),e.jsx("p",{children:"No clients match this filter"}),e.jsx("span",{children:"Try adjusting your search or filter"})]}):e.jsx("div",{className:"forms-client-list",children:W.map(d=>{const X=I===d.id,V=se(d),te=h(d);return e.jsxs("div",{className:`forms-client-card ${X?"expanded":""}`,children:[e.jsxs("div",{className:"forms-client-row",onClick:()=>ce(d.id),children:[e.jsxs("div",{className:"forms-client-left",children:[e.jsx("div",{className:"forms-client-initial",children:(d.name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"forms-client-info",children:[e.jsx("h3",{children:d.name||"Unknown"}),e.jsxs("div",{className:"forms-badges",children:[e.jsxs("span",{className:`form-badge ${V?"done":"not-done"}`,children:[V?"✓":"○"," Welcome"]}),e.jsxs("span",{className:`form-badge ${te?"done":"not-done"}`,children:[te?"✓":"○"," PAR-Q"]})]})]})]}),e.jsx("svg",{className:`forms-chevron ${X?"open":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"m6 9 6 6 6-6"})})]}),X&&e.jsx("div",{className:"forms-expand-panel",children:!V&&!te?e.jsxs("div",{className:"forms-no-data",children:[e.jsx("p",{children:"No forms submitted yet"}),e.jsx("span",{children:"This client hasn't completed any forms"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"forms-toggle",children:[V&&e.jsx("button",{className:`forms-toggle-btn ${u==="welcome"||!u&&V?"active":""}`,onClick:()=>E("welcome"),children:"Welcome Questionnaire"}),te&&e.jsx("button",{className:`forms-toggle-btn ${u==="parq"||!u&&!V&&te?"active":""}`,onClick:()=>E("parq"),children:"PAR-Q Health Screening"})]}),(u==="welcome"||!u&&V)&&V&&e.jsxs("div",{className:"form-data",children:[e.jsxs("div",{className:"form-data-header",children:[e.jsx("span",{className:"form-data-title",children:"Welcome Questionnaire"}),e.jsxs("span",{className:"form-data-date",children:["Submitted ",G(d.welcomeForm.completedAt)]})]}),d.welcomeForm.fitnessGoals&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Fitness Goals"}),e.jsx("p",{children:d.welcomeForm.fitnessGoals})]}),d.welcomeForm.currentActivityLevel&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Activity Level"}),e.jsx("p",{children:rs[d.welcomeForm.currentActivityLevel]||d.welcomeForm.currentActivityLevel})]}),d.welcomeForm.exerciseHistory&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Exercise History"}),e.jsx("p",{children:d.welcomeForm.exerciseHistory})]}),d.welcomeForm.injuries&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Injuries"}),e.jsx("p",{children:d.welcomeForm.injuries})]}),d.welcomeForm.medicalConditions&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Medical Conditions"}),e.jsx("p",{children:d.welcomeForm.medicalConditions})]}),d.welcomeForm.sleepHours&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Sleep"}),e.jsx("p",{children:os[d.welcomeForm.sleepHours]||d.welcomeForm.sleepHours})]}),d.welcomeForm.stressLevel&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Stress Level"}),e.jsx("p",{children:cs[d.welcomeForm.stressLevel]||d.welcomeForm.stressLevel})]}),d.welcomeForm.dietaryInfo&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Diet / Nutrition"}),e.jsx("p",{children:d.welcomeForm.dietaryInfo})]}),d.welcomeForm.availability&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Availability"}),e.jsx("p",{children:d.welcomeForm.availability})]}),d.welcomeForm.additionalInfo&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Additional Info"}),e.jsx("p",{children:d.welcomeForm.additionalInfo})]})]}),u==="parq"&&te&&e.jsxs("div",{className:"form-data",children:[e.jsxs("div",{className:"form-data-header",children:[e.jsx("span",{className:"form-data-title",children:"PAR-Q Health Screening"}),e.jsxs("span",{className:"form-data-date",children:["Submitted ",G(d.parqForm.completedAt)]})]}),e.jsx("div",{className:"parq-results",children:ds.map(ie=>{const N=d.parqForm[ie.key];return e.jsxs("div",{className:`parq-result-item ${N?"flagged":""}`,children:[e.jsx("span",{className:`parq-answer ${N?"yes":"no"}`,children:N?"YES":"NO"}),e.jsx("span",{className:"parq-question-text",children:ie.text})]},ie.key)})}),d.parqForm.additionalDetails&&e.jsxs("div",{className:"form-data-field",children:[e.jsx("label",{children:"Additional Details"}),e.jsx("p",{children:d.parqForm.additionalDetails})]}),e.jsx("div",{className:"parq-declaration-status",children:e.jsx("span",{className:d.parqForm.declaration?"declared":"not-declared",children:d.parqForm.declaration?"✓ Declaration signed":"✗ Declaration not signed"})})]})]})})]},d.id)})})]})}const We=m=>`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}-${String(m.getDate()).padStart(2,"0")}`,He=m=>new Date(m+"T09:00:00").toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),Oe=()=>{const m=new Date;let g=(6-m.getDay()+7)%7;if(g===0){const I=new Date(m);I.setHours(9,45,0,0),m>I&&(g=7)}const M=new Date(m);return M.setDate(m.getDate()+g),M},Be=m=>m==="circuit_vip"?"VIP":m==="circuit_dropin"?"Drop-in":"Block",Ae=m=>m==="circuit_vip"?"vip":m==="circuit_dropin"?"dropin":"block";function hs(){const[m,B]=p.useState(!0),[g,M]=p.useState([]),[I,Y]=p.useState([]),[u,E]=p.useState(null),[r,O]=p.useState("upcoming"),[P,L]=p.useState(!1),[H,se]=p.useState(null),[h,oe]=p.useState(!1),[F,G]=p.useState(!1),W=p.useCallback((n,f="info")=>{se({message:n,type:f}),setTimeout(()=>se(null),4e3)},[]);p.useEffect(()=>{U()},[]);const U=async()=>{try{const f=(await ue(ae(A,"circuitSessions"))).docs.map(a=>({id:a.id,...a.data()}));f.sort((a,j)=>j.date.localeCompare(a.date)),M(f);const C=(await ue(ae(A,"clients"))).docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.clientType==="circuit_vip"||a.clientType==="circuit_dropin"||a.circuitAccess===!0);Y(C);const z=We(Oe());let q=f.find(a=>a.date===z);if(!q){const a=C.filter(t=>t.clientType==="circuit_vip"&&t.status==="active"),j=[];for(let t=0;t<8;t++)t<a.length?j.push({slotNumber:t+1,memberId:a[t].id,memberName:a[t].name,memberType:"circuit_vip",status:"confirmed",bookedAt:me.now()}):j.push({slotNumber:t+1,memberId:null,memberName:null,memberType:null,status:"available"});const $={date:z,time:"09:00",endTime:"09:45",maxCapacity:8,slots:j,waitlist:[],createdAt:me.now()};await Ye(ne(A,"circuitSessions",z),$),q={id:z,...$},f.unshift(q),M([...f])}q?E(q):f.length>0&&E(f[0])}catch(n){console.error("Error loading circuit data:",n),W("Failed to load circuit data","error")}B(!1)},xe=async n=>{if(!(!u||P)&&window.confirm("Remove this member from the slot?")){L(!0);try{const f=[...u.slots],b=f.findIndex($=>$.slotNumber===n);if(b===-1){L(!1);return}const C=f[b],z=C.memberType==="circuit_vip";let q=[...u.waitlist||[]];if(q.length>0){const $=q.shift();f[b]={slotNumber:n,memberId:$.memberId,memberName:$.memberName,memberType:$.memberType,status:"confirmed",bookedAt:me.now()},W(`Slot given to ${$.memberName} from waitlist`,"success")}else f[b]={slotNumber:n,memberId:null,memberName:null,memberType:null,status:"available"},W("Member removed from slot","success");const a={slots:f,waitlist:q};if(z&&C.memberId){const $=u.vipOptOuts||[];$.includes(C.memberId)||(a.vipOptOuts=[...$,C.memberId])}await je(ne(A,"circuitSessions",u.id),a);const j={...u,...a};E(j),M($=>$.map(t=>t.id===j.id?j:t))}catch(f){console.error("Error removing from slot:",f),W("Failed to remove member","error")}L(!1)}},Q=async(n,f)=>{if(!(!u||P)){L(!0);try{const b=[...u.slots],C=b.findIndex(j=>j.slotNumber===n&&j.status==="available");if(C===-1){W("Slot is not available","error"),L(!1);return}if(b.some(j=>j.memberId===f.id)){W(`${f.name} already has a slot`,"error"),L(!1);return}b[C]={slotNumber:n,memberId:f.id,memberName:f.name,memberType:f.clientType||"block",status:"confirmed",bookedAt:me.now()};const z=(u.waitlist||[]).filter(j=>j.memberId!==f.id),q={slots:b,waitlist:z};if(f.clientType==="circuit_vip"){const j=u.vipOptOuts||[];j.includes(f.id)&&(q.vipOptOuts=j.filter($=>$!==f.id))}await je(ne(A,"circuitSessions",u.id),q);const a={...u,...q};E(a),M(j=>j.map($=>$.id===a.id?a:$)),W(`${f.name} added to slot ${n}`,"success")}catch(b){console.error("Error adding to slot:",b),W("Failed to add member","error")}L(!1)}},ce=async n=>{if(!(!u||P)){L(!0);try{const f=(u.waitlist||[]).filter(C=>C.memberId!==n);await je(ne(A,"circuitSessions",u.id),{waitlist:f});const b={...u,waitlist:f};E(b),M(C=>C.map(z=>z.id===b.id?b:z)),W("Removed from waitlist","success")}catch(f){console.error("Error removing from waitlist:",f),W("Failed to remove from waitlist","error")}L(!1)}},d=async(n,f)=>{if(!(!u||P)){L(!0);try{const b=[...u.slots],C=b.findIndex(q=>q.slotNumber===n);if(C===-1){L(!1);return}if(b[C]={...b[C],attended:f},await je(ne(A,"circuitSessions",u.id),{slots:b}),f===!1){const q=b[C].memberId;if(q){const a=ne(A,"clients",q),j=await Ge(a);if(j.exists()){const t=(j.data().circuitStrikes||0)+1,i={circuitStrikes:t};if(t>=3){const l=new Date;l.setMonth(l.getMonth()+1),i.circuitBanUntil=me.fromDate(l),i.circuitStrikes=0,W(`${b[C].memberName} banned for 1 month (3 strikes)`,"error")}else W(`No-show recorded - ${b[C].memberName} (${t}/3 strikes)`,"error");await je(a,i)}}}else W(`${b[C].memberName} marked as attended`,"success");const z={...u,slots:b};E(z),M(q=>q.map(a=>a.id===z.id?z:a))}catch(b){console.error("Error marking attendance:",b),W("Failed to update attendance","error")}L(!1)}},X=async(n,f)=>{if(!P&&window.confirm(`Reset strikes for ${f}?`)){L(!0);try{await je(ne(A,"clients",n),{circuitStrikes:0,circuitBanUntil:null}),Y(b=>b.map(C=>C.id===n?{...C,circuitStrikes:0,circuitBanUntil:null}:C)),W(`Strikes reset for ${f}`,"success")}catch(b){console.error("Error resetting strikes:",b),W("Failed to reset strikes","error")}L(!1)}},V=async(n,f)=>{if(!P&&window.confirm(`Lift ban for ${f}?`)){L(!0);try{await je(ne(A,"clients",n),{circuitBanUntil:null,circuitStrikes:0}),Y(b=>b.map(C=>C.id===n?{...C,circuitBanUntil:null,circuitStrikes:0}:C)),W(`Ban lifted for ${f}`,"success")}catch(b){console.error("Error lifting ban:",b),W("Failed to lift ban","error")}L(!1)}};if(m)return e.jsxs("div",{className:"cm-loading",children:[e.jsx("div",{className:"cm-loading-spinner"}),e.jsx("span",{children:"Loading circuit data..."})]});const te=We(new Date),ie=We(Oe()),N=g.filter(n=>n.date>=te),R=g.filter(n=>n.date<te),_=r==="upcoming"?N:R,ge=u?u.slots.filter(n=>n.status!=="available").length:0,K=u?u.slots.filter(n=>n.status==="available").length:0,le=u?u.date>=te:!1,de=u?u.slots.filter(n=>n.memberId).map(n=>n.memberId):[],re=u?(u.waitlist||[]).map(n=>n.memberId):[],Z=I.filter(n=>!de.includes(n.id)&&!re.includes(n.id)),J=I.filter(n=>n.clientType==="circuit_vip").length,pe=I.filter(n=>n.clientType==="circuit_dropin").length,be=I.filter(n=>n.circuitAccess&&n.clientType!=="circuit_vip"&&n.clientType!=="circuit_dropin").length,fe=I.filter(n=>n.circuitBanUntil?(n.circuitBanUntil.toDate?n.circuitBanUntil.toDate():new Date(n.circuitBanUntil))>new Date:!1);return e.jsxs("div",{className:"cm-container",children:[e.jsxs("div",{className:"cm-stats-row",children:[e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:J}),e.jsx("span",{className:"cm-stat-label",children:"VIP"})]}),e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:pe}),e.jsx("span",{className:"cm-stat-label",children:"Drop-in"})]}),e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:be}),e.jsx("span",{className:"cm-stat-label",children:"Block"})]}),e.jsxs("div",{className:"cm-stat-pill",children:[e.jsx("span",{className:"cm-stat-num",children:g.length}),e.jsx("span",{className:"cm-stat-label",children:"Sessions"})]})]}),e.jsxs("div",{className:"cm-view-toggle",children:[e.jsx("button",{className:`cm-toggle-btn ${h?"":"active"}`,onClick:()=>oe(!1),children:"Sessions"}),e.jsx("button",{className:`cm-toggle-btn ${h?"active":""}`,onClick:()=>oe(!0),children:"Members"})]}),!h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cm-tabs",children:[e.jsxs("button",{className:`cm-tab ${r==="upcoming"?"active":""}`,onClick:()=>O("upcoming"),children:["Upcoming (",N.length,")"]}),e.jsxs("button",{className:`cm-tab ${r==="past"?"active":""}`,onClick:()=>O("past"),children:["Past (",R.length,")"]})]}),e.jsx("div",{className:"cm-sessions-list",children:_.length===0?e.jsx("div",{className:"cm-empty",children:e.jsxs("p",{children:["No ",r," sessions"]})}):_.map(n=>{const f=n.slots.filter(z=>z.status!=="available").length,b=u?.id===n.id,C=n.date===ie;return e.jsxs("button",{className:`cm-session-btn ${b?"selected":""} ${C?"next":""}`,onClick:()=>{E(n),G(!1)},children:[e.jsxs("div",{className:"cm-session-btn-left",children:[e.jsx("span",{className:"cm-session-date",children:He(n.date)}),C&&e.jsx("span",{className:"cm-next-badge",children:"Next"})]}),e.jsxs("div",{className:"cm-session-btn-right",children:[e.jsxs("span",{className:"cm-session-fill",children:[f,"/8"]}),(n.waitlist?.length||0)>0&&e.jsxs("span",{className:"cm-waitlist-count",children:["+",n.waitlist.length," wl"]})]})]},n.id)})}),u&&e.jsxs("div",{className:"cm-detail",children:[e.jsxs("div",{className:"cm-detail-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:He(u.date)}),e.jsxs("p",{children:[u.time," - ",u.endTime," • ",ge,"/8 booked • ",K," available"]})]}),!le&&e.jsx("button",{className:`cm-attendance-btn ${F?"active":""}`,onClick:()=>G(!F),children:F?"Done":"Attendance"})]}),e.jsx("div",{className:"cm-slots",children:u.slots.map(n=>{const f=n.status==="available";return e.jsxs("div",{className:`cm-slot ${f?"empty":"filled"} ${n.attended===!0?"attended":""} ${n.attended===!1?"no-show":""}`,children:[e.jsx("span",{className:"cm-slot-num",children:n.slotNumber}),f?e.jsxs("div",{className:"cm-slot-empty",children:[e.jsx("span",{children:"Available"}),le&&e.jsx(us,{members:Z,onSelect:b=>Q(n.slotNumber,b),disabled:P})]}):e.jsxs("div",{className:"cm-slot-filled",children:[e.jsxs("div",{className:"cm-slot-info",children:[e.jsx("span",{className:"cm-slot-name",children:n.memberName}),e.jsx("span",{className:`cm-type-badge ${Ae(n.memberType)}`,children:Be(n.memberType)})]}),e.jsxs("div",{className:"cm-slot-actions",children:[F&&n.attended===void 0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cm-attend-yes",onClick:()=>d(n.slotNumber,!0),disabled:P,title:"Attended",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{d:"M5 13l4 4L19 7"})})}),e.jsx("button",{className:"cm-attend-no",onClick:()=>d(n.slotNumber,!1),disabled:P,title:"No-show",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),n.attended===!0&&e.jsx("span",{className:"cm-attended-label",children:"Attended"}),n.attended===!1&&e.jsx("span",{className:"cm-noshow-label",children:"No-show"}),le&&e.jsx("button",{className:"cm-remove-btn",onClick:()=>xe(n.slotNumber),disabled:P,title:"Remove from slot",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]})]},n.slotNumber)})}),(u.waitlist?.length||0)>0&&e.jsxs("div",{className:"cm-waitlist",children:[e.jsxs("h4",{children:["Waitlist (",u.waitlist.length,")"]}),u.waitlist.map((n,f)=>e.jsxs("div",{className:"cm-waitlist-row",children:[e.jsxs("span",{className:"cm-wl-pos",children:["#",f+1]}),e.jsx("span",{className:"cm-wl-name",children:n.memberName}),e.jsx("span",{className:`cm-type-badge ${Ae(n.memberType)}`,children:Be(n.memberType)}),le&&e.jsx("button",{className:"cm-wl-remove",onClick:()=>ce(n.memberId),disabled:P,children:"Remove"})]},n.memberId))]})]})]}),h&&e.jsxs("div",{className:"cm-members",children:[fe.length>0&&e.jsxs("div",{className:"cm-ban-alert",children:[e.jsxs("h4",{children:["Currently Banned (",fe.length,")"]}),fe.map(n=>{const f=n.circuitBanUntil?.toDate?n.circuitBanUntil.toDate():new Date(n.circuitBanUntil);return e.jsxs("div",{className:"cm-ban-row",children:[e.jsxs("div",{className:"cm-ban-info",children:[e.jsx("span",{className:"cm-ban-name",children:n.name}),e.jsxs("span",{className:"cm-ban-until",children:["Until ",f.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]}),e.jsx("button",{className:"cm-lift-ban-btn",onClick:()=>V(n.id,n.name),disabled:P,children:"Lift Ban"})]},n.id)})]}),e.jsx("div",{className:"cm-members-list",children:I.length===0?e.jsxs("div",{className:"cm-empty",children:[e.jsx("p",{children:"No circuit members yet"}),e.jsx("span",{children:"Add members via the Clients page"})]}):I.map(n=>{const f=n.circuitStrikes||0,b=fe.some(C=>C.id===n.id);return e.jsxs("div",{className:`cm-member-card ${b?"banned":""}`,children:[e.jsxs("div",{className:"cm-member-top",children:[e.jsx("span",{className:"cm-member-name",children:n.name}),e.jsx("span",{className:`cm-type-badge ${Ae(n.clientType)}`,children:Be(n.clientType)})]}),e.jsxs("div",{className:"cm-member-bottom",children:[e.jsxs("div",{className:"cm-strikes",children:[[0,1,2].map(C=>e.jsx("span",{className:`cm-strike-dot ${C<f?"active":""}`},C)),e.jsxs("span",{className:"cm-strike-text",children:[f,"/3 strikes"]})]}),e.jsxs("div",{className:"cm-member-actions",children:[b&&e.jsx("button",{className:"cm-small-btn ban",onClick:()=>V(n.id,n.name),disabled:P,children:"Lift Ban"}),f>0&&!b&&e.jsx("button",{className:"cm-small-btn reset",onClick:()=>X(n.id,n.name),disabled:P,children:"Reset"})]})]})]},n.id)})})]}),H&&e.jsx("div",{className:`cm-toast ${H.type}`,children:e.jsx("span",{children:H.message})})]})}function us({members:m,onSelect:B,disabled:g}){const[M,I]=p.useState(!1),[Y,u]=p.useState(""),E=m.filter(r=>r.name.toLowerCase().includes(Y.toLowerCase()));return m.length===0?null:e.jsxs("div",{className:"cm-add-dropdown",children:[e.jsx("button",{className:"cm-add-trigger",onClick:()=>I(!M),disabled:g,children:"+ Add"}),M&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cm-dropdown-backdrop",onClick:()=>{I(!1),u("")}}),e.jsxs("div",{className:"cm-dropdown-menu",children:[m.length>4&&e.jsx("input",{type:"text",className:"cm-dropdown-search",placeholder:"Search...",value:Y,onChange:r=>u(r.target.value),autoFocus:!0}),e.jsxs("div",{className:"cm-dropdown-list",children:[E.map(r=>e.jsxs("button",{className:"cm-dropdown-item",onClick:()=>{B(r),I(!1),u("")},children:[e.jsx("span",{children:r.name}),e.jsx("span",{className:`cm-type-badge sm ${Ae(r.clientType)}`,children:Be(r.clientType)})]},r.id)),E.length===0&&e.jsx("div",{className:"cm-dropdown-empty",children:"No members found"})]})]})]})]})}function gs(){const[m,B]=p.useState(()=>localStorage.getItem("adminActiveView")||"schedule"),g=a=>{B(a),localStorage.setItem("adminActiveView",a)},[M,I]=p.useState(0),[Y,u]=p.useState(!1),[E,r]=p.useState([]),[O,P]=p.useState(null),[L,H]=p.useState(null),[se,h]=p.useState([]),[oe,F]=p.useState([]),[G,W]=p.useState(null),{currentUser:U,logout:xe,isAdmin:Q,loading:ce}=Ke(),{isDark:d,toggleTheme:X}=Je(),V=Qe(),te=p.useRef(0),ie=p.useRef(!1);p.useRef(null);const N=p.useCallback((a,j="info")=>{H({message:a,type:j}),setTimeout(()=>H(null),4e3)},[]);p.useEffect(()=>{!ce&&(!U||!Q)&&V("/")},[U,Q,ce,V]),p.useEffect(()=>{U&&Q&&R()},[U,Q]);const R=async()=>{try{const a=$e(ae(A,"rescheduleRequests"),Ee("status","==","pending")),$=(await ue(a)).docs.map(t=>({id:t.id,...t.data()}));$.sort((t,i)=>{const l=t.createdAt?.toDate?t.createdAt.toDate():new Date(0);return(i.createdAt?.toDate?i.createdAt.toDate():new Date(0))-l}),r($)}catch(a){console.error("Error fetching reschedule requests:",a)}};p.useEffect(()=>{(async()=>{if(!(!U||!Q))try{const[j,$]=await Promise.all([ue(ae(A,"clients")),ue(ae(A,"sessions"))]),t=j.docs.map(x=>({id:x.id,...x.data()})),i=$.docs.map(x=>({id:x.id,...x.data()}));h(t);const l=new Set(t.map(x=>x.id)),y=$.docs.filter(x=>!l.has(x.data().clientId));if(y.length>0){const x=y.map(w=>we(ne(A,"sessions",w.id)));await Promise.all(x)}F(i.filter(x=>l.has(x.clientId)))}catch(j){console.error("Error fetching dashboard data:",j)}})()},[U,Q]),p.useEffect(()=>{const a=()=>window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,j=i=>{a()<=0&&(te.current=i.touches[0].clientY,ie.current=!1)},$=i=>{const l=a(),x=i.touches[0].clientY-te.current;if(l>5||x<=0){ie.current=!1,I(0);return}x>20&&l<=0&&(ie.current=!0,I(Math.min((x-20)*.4,80)))},t=()=>{ie.current&&M>60?(u(!0),setTimeout(()=>{window.location.reload()},300)):I(0),ie.current=!1};return document.addEventListener("touchstart",j,{passive:!0}),document.addEventListener("touchmove",$,{passive:!0}),document.addEventListener("touchend",t),()=>{document.removeEventListener("touchstart",j),document.removeEventListener("touchmove",$),document.removeEventListener("touchend",t)}},[M]);const _=async()=>{try{await xe(),V("/")}catch(a){console.error("Failed to log out:",a)}},ge=()=>{V("/add-client")},K=a=>new Date(a).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}),le=a=>{const[j,$]=a.split(":"),t=parseInt(j),i=t>=12?"pm":"am";return`${t>12?t-12:t===0?12:t}:${$}${i}`},de=async a=>{if(window.confirm(`Approve reschedule for ${a.clientName}?

From: ${K(a.originalDate)} at ${le(a.originalTime)}
To: ${K(a.requestedDate)} at ${le(a.requestedTime)}`)){P(a.id);try{await je(ne(A,"sessions",a.sessionId),{date:a.requestedDate,time:a.requestedTime}),await je(ne(A,"rescheduleRequests",a.id),{status:"approved",respondedAt:me.now()}),r(E.filter(j=>j.id!==a.id)),N(`Approved reschedule for ${a.clientName}`,"success")}catch(j){console.error("Error approving request:",j),N("Failed to approve request","error")}P(null)}},re=async a=>{if(window.confirm(`Reject reschedule request from ${a.clientName}?`)){P(a.id);try{await je(ne(A,"rescheduleRequests",a.id),{status:"rejected",respondedAt:me.now()}),r(E.filter(j=>j.id!==a.id)),N(`Request from ${a.clientName} rejected`,"info")}catch(j){console.error("Error rejecting request:",j),N("Failed to reject request","error")}P(null)}};if(ce)return e.jsx("div",{className:"loading",children:"Loading..."});if(!U||!Q)return null;const Z=E.length,J=new Date,pe=`${J.getFullYear()}-${(J.getMonth()+1).toString().padStart(2,"0")}-${J.getDate().toString().padStart(2,"0")}`,be=`${J.getHours().toString().padStart(2,"0")}:${J.getMinutes().toString().padStart(2,"0")}`,n=oe.filter(a=>a.date===pe).length,f=a=>oe.filter(j=>j.clientId!==a?!1:j.date<pe||j.date===pe&&j.time<be).length,b=se.filter(a=>a.status!=="archived"&&(!a.clientType||a.clientType==="block")),C=new Date(J);C.setDate(C.getDate()+7);const z=b.filter(a=>{if(!a.endDate)return!1;const j=a.endDate.toDate?a.endDate.toDate():new Date(a.endDate);return j>=J&&j<=C}),q=b.filter(a=>(a.totalSessions||0)-f(a.id)<=2);return e.jsxs("div",{className:"dashboard",children:[M>0&&e.jsxs("div",{className:"pull-indicator",style:{height:M},children:[e.jsx("div",{className:`pull-spinner ${Y?"spinning":""}`,children:Y?"↻":"↓"}),e.jsx("span",{children:Y?"Refreshing...":M>60?"Release to refresh":"Pull to refresh"})]}),e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"admin-header-logo",width:"50",height:"50"}),e.jsx("span",{className:"admin-badge",children:"Admin"})]}),e.jsxs("nav",{className:"header-nav",children:[e.jsxs("button",{className:`nav-btn ${m==="requests"?"active":""} ${Z>0?"has-badge":""}`,onClick:()=>g("requests"),children:["Requests",Z>0&&e.jsx("span",{className:"nav-badge",children:Z})]}),e.jsx("button",{className:`nav-btn ${m==="forms"?"active":""}`,onClick:()=>g("forms"),children:"Forms"}),e.jsx("button",{className:`nav-btn ${m==="circuits"?"active":""}`,onClick:()=>g("circuits"),children:"Circuits"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"theme-toggle-btn",onClick:X,"aria-label":d?"Switch to light mode":"Switch to dark mode",children:d?e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"})}):e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"})})}),e.jsx("button",{className:"logout-btn",onClick:_,children:"Log Out"})]})]}),L&&e.jsx("div",{className:"toast-container",children:e.jsxs("div",{className:`toast ${L.type}`,children:[e.jsxs("span",{className:"toast-icon",children:[L.type==="success"&&e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),L.type==="error"&&e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),L.type==="info"&&e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})]}),e.jsx("span",{className:"toast-message",children:L.message})]})}),e.jsxs("main",{className:"dashboard-main",children:[m==="schedule"&&e.jsxs("div",{className:"schedule-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Schedule"})}),e.jsxs("div",{className:"summary-cards",children:[e.jsxs("div",{className:"summary-card",onClick:()=>{},children:[e.jsx("div",{className:"summary-icon sessions-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:n}),e.jsx("span",{className:"summary-label",children:"Today"})]})]}),e.jsxs("div",{className:"summary-card",onClick:()=>g("requests"),children:[e.jsx("div",{className:`summary-icon requests-icon ${Z>0?"has-items":""}`,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:Z}),e.jsx("span",{className:"summary-label",children:"Requests"})]})]}),e.jsxs("div",{className:`summary-card ${G==="expiring"?"active":""}`,onClick:()=>W(G==="expiring"?null:"expiring"),children:[e.jsx("div",{className:`summary-icon expiring-icon ${z.length>0?"has-items":""}`,children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:z.length}),e.jsx("span",{className:"summary-label",children:"Expiring"})]})]}),e.jsxs("div",{className:`summary-card ${G==="low"?"active":""}`,onClick:()=>W(G==="low"?null:"low"),children:[e.jsx("div",{className:`summary-icon low-icon ${q.length>0?"has-items":""}`,children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),e.jsxs("div",{className:"summary-info",children:[e.jsx("span",{className:"summary-number",children:q.length}),e.jsx("span",{className:"summary-label",children:"Low Sessions"})]})]})]}),G==="expiring"&&e.jsxs("div",{className:"card-detail-panel",children:[e.jsxs("div",{className:"card-detail-header",children:[e.jsx("span",{children:"Expiring Soon"}),e.jsx("button",{className:"card-detail-close",onClick:()=>W(null),children:"✕"})]}),z.length===0?e.jsx("p",{className:"card-detail-empty",children:"No clients expiring within 7 days"}):z.map(a=>{const j=a.endDate.toDate?a.endDate.toDate():new Date(a.endDate),$=Math.ceil((j-J)/(1e3*60*60*24)),t=(a.totalSessions||0)-f(a.id);return e.jsxs("div",{className:"card-detail-item",children:[e.jsx("span",{className:"card-detail-name",children:a.name}),e.jsxs("div",{className:"card-detail-tags",children:[e.jsx("span",{className:"card-detail-tag warning",children:$<=1?"Ends today":`Ends in ${$} days`}),e.jsx("span",{className:`card-detail-tag ${t<=0?"urgent":"info"}`,children:t<=0?"No sessions left":`${t} session${t!==1?"s":""} left`})]})]},a.id)})]}),G==="low"&&e.jsxs("div",{className:"card-detail-panel",children:[e.jsxs("div",{className:"card-detail-header",children:[e.jsx("span",{children:"Low / No Sessions"}),e.jsx("button",{className:"card-detail-close",onClick:()=>W(null),children:"✕"})]}),q.length===0?e.jsx("p",{className:"card-detail-empty",children:"All clients have sessions available"}):[...q].sort((a,j)=>{const $=(a.totalSessions||0)-f(a.id),t=(j.totalSessions||0)-f(j.id);return $-t}).map(a=>{const j=(a.totalSessions||0)-f(a.id),$=a.endDate?a.endDate.toDate?a.endDate.toDate():new Date(a.endDate):null,t=$?Math.ceil(($-J)/(1e3*60*60*24)):null;return e.jsxs("div",{className:"card-detail-item",children:[e.jsx("span",{className:"card-detail-name",children:a.name}),e.jsxs("div",{className:"card-detail-tags",children:[e.jsx("span",{className:`card-detail-tag ${j<=0?"urgent":"low"}`,children:j<=0?"No sessions left":`${j} session${j!==1?"s":""} left`}),t!==null&&t<=14&&e.jsxs("span",{className:"card-detail-tag warning",children:["Block ends ",t<=1?"today":`in ${t}d`]})]})]},a.id)})]}),e.jsx(ls,{})]}),m==="clients"&&e.jsxs("div",{className:"clients-view",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("h2",{children:"Clients"}),e.jsx("button",{className:"add-btn",onClick:ge,children:"+ Add Client"})]}),e.jsx(es,{})]}),m==="calendar"&&e.jsxs("div",{className:"calendar-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Calendar"})}),e.jsx(as,{})]}),m==="requests"&&e.jsxs("div",{className:"requests-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Reschedule Requests"})}),E.length===0?e.jsxs("div",{className:"no-requests",children:[e.jsx("div",{className:"empty-icon",children:e.jsxs("svg",{viewBox:"0 0 100 100",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"20",y:"25",width:"60",height:"50",rx:"4"}),e.jsx("path",{d:"M20 35 L50 55 L80 35"}),e.jsx("circle",{cx:"50",cy:"70",r:"3",fill:"currentColor"})]})}),e.jsx("p",{children:"No pending requests"}),e.jsx("span",{children:"When clients request to reschedule, they will appear here"})]}):e.jsx("div",{className:"requests-list",children:E.map(a=>e.jsxs("div",{className:"request-card",children:[e.jsxs("div",{className:"request-header",children:[e.jsx("span",{className:"client-name",children:a.clientName}),e.jsx("span",{className:"request-time",children:a.createdAt?.toDate?a.createdAt.toDate().toLocaleDateString("en-GB",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("div",{className:"request-details",children:e.jsxs("div",{className:"request-change",children:[e.jsxs("div",{className:"from-session",children:[e.jsx("span",{className:"label",children:"From:"}),e.jsxs("span",{className:"value",children:[K(a.originalDate)," at ",le(a.originalTime)]})]}),e.jsx("div",{className:"arrow",children:"→"}),e.jsxs("div",{className:"to-session",children:[e.jsx("span",{className:"label",children:"To:"}),e.jsxs("span",{className:"value",children:[K(a.requestedDate)," at ",le(a.requestedTime)]})]})]})}),e.jsxs("div",{className:"request-actions",children:[e.jsx("button",{className:"approve-btn",onClick:()=>de(a),disabled:O===a.id,children:O===a.id?"Processing...":"Approve"}),e.jsx("button",{className:"reject-btn",onClick:()=>re(a),disabled:O===a.id,children:"Reject"})]})]},a.id))})]}),m==="forms"&&e.jsxs("div",{className:"forms-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Client Forms"})}),e.jsx(ms,{})]}),m==="circuits"&&e.jsxs("div",{className:"circuits-view",children:[e.jsx("div",{className:"view-header",children:e.jsx("h2",{children:"Circuit Management"})}),e.jsx(hs,{})]})]}),e.jsxs("nav",{className:"admin-bottom-nav",children:[e.jsxs("button",{className:`admin-nav-tab ${m==="schedule"?"active":""}`,onClick:()=>g("schedule"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsx("span",{children:"Today"})]}),e.jsxs("button",{className:`admin-nav-tab ${m==="clients"?"active":""}`,onClick:()=>g("clients"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Clients"})]}),e.jsxs("button",{className:`admin-nav-tab ${m==="calendar"?"active":""}`,onClick:()=>g("calendar"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"}),e.jsx("path",{d:"M8 14h.01"}),e.jsx("path",{d:"M12 14h.01"}),e.jsx("path",{d:"M16 14h.01"}),e.jsx("path",{d:"M8 18h.01"}),e.jsx("path",{d:"M12 18h.01"})]}),e.jsx("span",{children:"Calendar"})]})]})]})}export{gs as default};
