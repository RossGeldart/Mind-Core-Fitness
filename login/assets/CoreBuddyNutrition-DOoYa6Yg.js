import{k as fs,l as ks,m as Ns,r as d,j as e,i as Ye,e as oe,d as de,T as Ge,n as Qe,_ as ws}from"./index-B7pQgPf9.js";import{C as ys}from"./CoreBuddyNav-HTaMOPjh.js";const Ce=60,Me=new Map;function B(){return new Date().toISOString().split("T")[0]}const Cs=[{key:"breakfast",label:"Breakfast"},{key:"lunch",label:"Lunch"},{key:"dinner",label:"Dinner"},{key:"snacks",label:"Snacks"}],Ms={breakfast:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8h1a4 4 0 0 1 0 8h-1"}),e.jsx("path",{d:"M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"}),e.jsx("line",{x1:"6",y1:"1",x2:"6",y2:"4"}),e.jsx("line",{x1:"10",y1:"1",x2:"10",y2:"4"}),e.jsx("line",{x1:"14",y1:"1",x2:"14",y2:"4"})]}),lunch:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}),dinner:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),snacks:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})};function Ss(){const z=new Date().getHours();return z<11?"breakfast":z<14?"lunch":z<17?"snacks":"dinner"}function Ds(){const{currentUser:z,isClient:Se,clientData:L,loading:ue}=fs(),{isDark:V,toggleTheme:Le,accent:he}=ks(),H=Ns(),[Fe,Y]=d.useState("loading"),[k,_e]=d.useState(null),[l,g]=d.useState({gender:"male",age:"",weight:"",weightUnit:"kg",height:"",heightUnit:"cm",heightFeet:"",heightInches:"",dailyActivity:"sedentary",trainingFrequency:"moderate",goal:"maintain",deficitLevel:"moderate"}),[p,m]=d.useState(null),[M,Z]=d.useState(B()),[j,E]=d.useState({entries:[],water:0}),[ee,Ke]=d.useState({protein:0,carbs:0,fats:0,calories:0}),[De,Te]=d.useState(!1),[Je,me]=d.useState(!1),[F,ge]=d.useState(()=>{const s=new Date;return{year:s.getFullYear(),month:s.getMonth()}}),[Xe,Ze]=d.useState(Ss),[Ae,I]=d.useState(null),[C,T]=d.useState(null),[pe,G]=d.useState(!1),[P,se]=d.useState(null),[q,$e]=d.useState(""),[We,Be]=d.useState(!1),[U,Ee]=d.useState(""),[Pe,xe]=d.useState([]),[je,Ue]=d.useState(!1),[w,A]=d.useState({name:"",protein:"",carbs:"",fats:"",calories:"",serving:""}),[r,_]=d.useState(null),[D,v]=d.useState("100"),[h,b]=d.useState(0),[N,y]=d.useState("weight"),[Ls,es]=d.useState(0),[O,ze]=d.useState(null);d.useRef(null);const Q=d.useRef(!1),ve=d.useRef(null),K=d.useRef(null),Ie=d.useRef(null),S=d.useCallback((s,t="info")=>{ze({message:s,type:t}),setTimeout(()=>ze(null),3e3)},[]);d.useEffect(()=>{!ue&&(!z||!Se)&&H("/")},[z,Se,ue,H]),d.useEffect(()=>{if(!L?.id)return;(async()=>{try{const t=await Ye(oe(de,"nutritionTargets",L.id));t.exists()?(_e(t.data()),Y("dashboard")):Y("setup")}catch(t){console.error("Error loading nutrition data:",t),Y("setup")}})()},[L?.id]),d.useEffect(()=>{if(!L?.id)return;(async()=>{try{const t=await Ye(oe(de,"nutritionLogs",`${L.id}_${M}`));if(t.exists()){const a=t.data();E({entries:a.entries||[],water:a.water||0})}else E({entries:[],water:0})}catch(t){console.error("Error loading log:",t),E({entries:[],water:0})}})()},[L?.id,M]),d.useEffect(()=>{const s=j.entries.reduce((t,a)=>({protein:t.protein+(a.protein||0),carbs:t.carbs+(a.carbs||0),fats:t.fats+(a.fats||0),calories:t.calories+(a.calories||0)}),{protein:0,carbs:0,fats:0,calories:0});Ke(s)},[j.entries]);const te=async s=>{try{await Qe(oe(de,"nutritionLogs",`${L.id}_${M}`),{clientId:L.id,date:M,entries:s.entries,water:s.water,updatedAt:Ge.now()})}catch(t){console.error("Error saving nutrition log:",t)}},ae=M===B(),ss=(s,t)=>new Date(s,t+1,0).getDate(),ts=(s,t)=>new Date(s,t,1).getDay(),qe=["January","February","March","April","May","June","July","August","September","October","November","December"],as=["Su","Mo","Tu","We","Th","Fr","Sa"],ns=()=>{let s=parseFloat(l.weight);l.weightUnit==="lbs"&&(s*=.453592);let t;l.heightUnit==="cm"?t=parseFloat(l.height):t=(parseFloat(l.heightFeet)||0)*30.48+(parseFloat(l.heightInches)||0)*2.54;const a=parseInt(l.age);let n=l.gender==="male"?10*s+6.25*t-5*a+5:10*s+6.25*t-5*a-161;const c=n*{sedentary:1.2,light:1.3,moderate:1.4,active:1.5}[l.dailyActivity],i={low:100,moderate:200,high:300,daily:400},x=Math.round(c+i[l.trainingFrequency]);let u=x,f,W;switch(l.goal){case"lose":u=x*(1-{light:.15,moderate:.2,harsh:.25}[l.deficitLevel]),f=2.2,W=.3;break;case"build":u=x*1.1,f=2,W=.22;break;default:f=1.8,W=.25}u=Math.max(u,l.gender==="male"?1400:1100);const le=Math.round(s*f),ce=Math.round(u*W/9),ye=Math.max(0,Math.round((u-le*4-ce*9)/4));m({calories:Math.round(u),protein:le,carbs:ye,fats:ce,bmr:Math.round(n),neat:Math.round(c),exerciseAdd:i[l.trainingFrequency],tdee:Math.round(x)})},rs=async()=>{if(p)try{const s={clientId:L.id,calories:p.calories,protein:p.protein,carbs:p.carbs,fats:p.fats,waterGoal:8,goal:l.goal,updatedAt:Ge.now()};await Qe(oe(de,"nutritionTargets",L.id),s),_e(s),Y("dashboard"),S("Macro targets saved!","success")}catch(s){console.error("Error saving targets:",s),S("Failed to save targets. Please try again.","error")}},is=()=>{const s=l.weight&&parseFloat(l.weight)>0,t=l.age&&parseInt(l.age)>0,a=l.heightUnit==="cm"?l.height&&parseFloat(l.height)>0:l.heightFeet&&parseFloat(l.heightFeet)>0||l.heightInches&&parseFloat(l.heightInches)>0;return s&&t&&a},Oe="nut_favourite_foods",be=()=>{try{return JSON.parse(localStorage.getItem(Oe)||"[]")}catch{return[]}},R=s=>be().some(t=>t.name.toLowerCase()===(s||"").toLowerCase()),ne=s=>{const t=be(),a=t.findIndex(n=>n.name.toLowerCase()===s.name.toLowerCase());a>=0?t.splice(a,1):t.unshift({name:s.name,protein:s.protein,carbs:s.carbs,fats:s.fats,calories:s.calories,serving:s.serving,per100g:s.per100g||null,servingUnit:s.servingUnit||"g",portion:s.portion||null}),localStorage.setItem(Oe,JSON.stringify(t)),es(n=>n+1)},J=s=>{const t=[...j.entries,{...s,meal:Xe,id:Date.now(),addedAt:new Date().toISOString()}],a={...j,entries:t};E(a),te(a),T(null),_(null),v("100"),b(0),y("weight"),A({name:"",protein:"",carbs:"",fats:"",calories:"",serving:""}),S("Food added!","success")},ls=s=>{const t=j.entries.filter(n=>n.id!==s),a={...j,entries:t};E(a),te(a)},X=d.useRef(null),cs=async()=>{G(!0);const s=document.querySelector("#barcode-reader");if(!s){G(!1),S("Scanner container not found.","error");return}if(!X.current)try{const a=await ws(()=>import("./quagga.min-BbicSfvA.js").then(n=>n.q),[]);X.current=a.default}catch(a){console.error("Failed to load barcode scanner:",a),G(!1),S("Could not load scanner.","error");return}const t=X.current;t.init({inputStream:{type:"LiveStream",target:s,constraints:{facingMode:"environment",width:{min:640,ideal:1280,max:1920},height:{min:480,ideal:720,max:1080}}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:navigator.hardwareConcurrency||2,decoder:{readers:["ean_reader","ean_8_reader","upc_reader","upc_e_reader","code_128_reader","code_39_reader"]},locate:!0},a=>{if(a){console.error("Quagga init error:",a),G(!1),S("Could not access camera. Check permissions.","error");return}t.start(),Q.current=!0}),t.onDetected(a=>{const n=a.codeResult.decodedCodes?.filter(c=>c.error!==void 0)?.map(c=>c.error)||[];if((n.length>0?n.reduce((c,i)=>c+i,0)/n.length:1)<.15){const c=a.codeResult.code;t.offDetected(),se(c)}})},fe=()=>{const s=X.current;Q.current&&s&&(s.stop(),s.offDetected(),Q.current=!1),G(!1)},os=/\b(milk|semi.skimmed|skimmed|whole milk|oat milk|almond milk|soy milk|juice|smoothie|water|squash|cordial|cola|pepsi|fanta|lemonade|soda|beer|wine|cider|lager|spirit|whisky|vodka|rum|gin|brandy|cream|yoghurt drink|milkshake|coffee|tea|broth|stock|soup|sauce|ketchup|vinegar|oil|syrup|honey|custard|coconut water|kombucha|energy drink|protein shake)\b/i,ke=s=>/ml|cl|\dl(?!b)|litre|liter|fl\s?oz/i.test((s||"").replace(/\s/g,"")),ds=s=>{if(!s)return{value:100,unit:"g"};const t=s.toLowerCase().replace(/\s/g,""),a=t.match(/([\d.]+)/),n=a?parseFloat(a[1]):100;return ke(s)?/cl/.test(t)?{value:n*10,unit:"ml"}:/(?:^|\d)l(?!i)/.test(t)&&!/ml/.test(t)?{value:n*1e3,unit:"ml"}:{value:n,unit:"ml"}:{value:n,unit:"g"}},us=s=>{if(ke(s.serving_size)||ke(s.quantity))return"ml";const t=s.product_name||s.product_name_en||"";return os.test(t)?"ml":"g"},hs=[{pattern:/\b(toast|bread|loaf|brioche|bagel|pitta|wrap|tortilla|crumpet|muffin|waffle|pancake)\b/i,label:"slice",weight:36},{pattern:/\begg\b/i,label:"egg",weight:60},{pattern:/\b(biscuit|cookie|digestive|hobnob|rich tea|oreo)\b/i,label:"biscuit",weight:13},{pattern:/\b(sausage|banger)\b/i,label:"sausage",weight:57},{pattern:/\b(rasher|bacon)\b/i,label:"rasher",weight:25},{pattern:/\b(rice cake)\b/i,label:"cake",weight:9},{pattern:/\b(cracker|ryvita)\b/i,label:"cracker",weight:10}],ms=(s,t)=>{const a=s||"",n=a.match(/\((\d+\.?\d*)\s*g\)/i),o=a.match(/(?:^|per\s+)(\d*\s*[a-z][a-z\s]*?)(?:\s*\(|\s*-\s*|\s*$)/i);if(n&&o){const x=parseFloat(n[1]);let u=o[1].replace(/^\d+\s*/,"").trim();if(u&&x>0)return{label:u,weight:x}}const c=a.match(/(\d+\.?\d*)\s*g\s*[\/=]\s*(\d*\s*[a-z][a-z\s]*)/i);if(c){const x=parseFloat(c[1]);let u=c[2].replace(/^\d+\s*/,"").trim();if(u&&x>0)return{label:u,weight:x}}const i=t||"";for(const{pattern:x,label:u,weight:f}of hs)if(x.test(i))return{label:u,weight:f};return null},Re=s=>{const t=s.nutriments||{},a=us(s),n=ds(s.serving_size),o=a==="ml"?n.unit==="ml"?n.value:100:n.value,c=s.product_name||s.product_name_en||"Unknown Product",i=ms(s.serving_size,c);return{name:c,brand:s.brands||"",image:s.image_small_url||s.image_url||null,servingSize:s.serving_size||"100g",servingValue:o,servingUnit:a,portion:i,protein:Math.round(t.proteins_100g||t.proteins||0),carbs:Math.round(t.carbohydrates_100g||t.carbohydrates||0),fats:Math.round(t.fat_100g||t.fat||0),calories:Math.round(t["energy-kcal_100g"]||t["energy-kcal"]||(t.energy_100g?t.energy_100g/4.184:0)),per100g:!0}},Ne=async s=>{Be(!0);try{const t=`https://world.openfoodfacts.org/api/v2/product/${s}?fields=product_name,product_name_en,brands,image_small_url,image_url,serving_size,quantity,nutriments`,a=await fetch(t);if(!a.ok)throw new Error(`HTTP ${a.status}`);const n=await a.json();if(n.status==="success"||n.status===1||n.product){const o=Re(n.product);o.calories===0&&o.protein===0&&o.carbs===0?S("Product found but no nutrition data available.","error"):(_(o),o.portion?(b(1),v(String(o.portion.weight)),y("portion")):(b(0),v(String(o.servingValue||100)),y("weight")),$e(""))}else S("Product not found. Try search or manual entry.","error")}catch(t){console.error("Barcode lookup error:",t),S("Failed to look up product. Check your connection.","error")}Be(!1)},Ve=(s,t,a)=>{const n=s.toLowerCase().trim(),o=t.toLowerCase().trim(),c=a.toLowerCase().trim();let i=0;return(n===c||n===c+"s"||n+"s"===c)&&(i+=100),(n.endsWith(" "+c)||n.endsWith(" "+c+"s"))&&(i+=40),(n.startsWith(c+" ")||n.startsWith(c+"s "))&&(i+=15),c.split(/\s+/).some(u=>o===u||o.startsWith(u))&&(i+=30),i+=Math.max(0,30-n.length),i},we=async()=>{if(!U.trim())return;ve.current&&ve.current.abort();const s=new AbortController;ve.current=s;const t=U.trim().toLowerCase(),a=t.split(/\s+/).filter(Boolean);if(Me.has(t)){xe(Me.get(t));return}Ue(!0);try{const o=`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${encodeURIComponent(U.trim())}&search_simple=1&action=process&json=1&page_size=10&lc=en&sort_by=unique_scans_n&fields=product_name,product_name_en,brands,image_small_url,image_url,serving_size,quantity,nutriments`,c=await fetch(o,{signal:s.signal});if(!c.ok)throw new Error(`HTTP ${c.status}`);const x=((await c.json()).products||[]).map(u=>Re(u)).filter(u=>u.name!=="Unknown Product"&&(u.calories>0||u.protein>0)).filter(u=>{const f=(u.name+" "+u.brand).toLowerCase();return a.every(W=>f.includes(W))}).sort((u,f)=>Ve(f.name,f.brand,t)-Ve(u.name,u.brand,t)).slice(0,10);Me.set(t,x),xe(x),x.length===0&&S("No results found. Try a different search.","info")}catch(n){if(n.name==="AbortError")return;console.error("Search error:",n),S("Search failed. Check your connection.","error")}Ue(!1)};d.useEffect(()=>{if(K.current&&clearTimeout(K.current),!(!U.trim()||C!=="search"||r))return K.current=setTimeout(()=>{we()},700),()=>clearTimeout(K.current)},[U]);const gs=()=>{const s={...j,water:j.water+1};E(s),te(s)},ps=()=>{if(j.water<=0)return;const s={...j,water:j.water-1};E(s),te(s)},xs=(s,t)=>!t||t<=0?0:Math.min(Ce,Math.round(s/t*Ce)),$=(s,t,a,n,o)=>{const c=xs(a,n),i=n>0?Math.min(100,Math.round(a/n*100)):0;return e.jsxs("div",{className:`nut-ring-wrap ${o}`,children:[e.jsx("svg",{className:"nut-ring-svg",viewBox:"0 0 200 200",children:[...Array(Ce)].map((x,u)=>{const f=(u*6-90)*(Math.PI/180),W=100+78*Math.cos(f),le=100+78*Math.sin(f),ce=100+96*Math.cos(f),ye=100+96*Math.sin(f);return e.jsx("line",{x1:W,y1:le,x2:ce,y2:ye,className:u<c?"nut-tick-filled":"nut-tick-empty",strokeWidth:u%5===0?"4.5":"3",strokeLinecap:"round",style:u<c?{animationDelay:`${u*50}ms`}:void 0},u)})}),e.jsxs("div",{className:"nut-ring-center",children:[e.jsx("span",{className:"nut-ring-value",children:Math.round(a)}),e.jsxs("span",{className:"nut-ring-target",children:["/ ",n,s==="Calories"?"":"g"]}),e.jsx("span",{className:"nut-ring-label",children:t})]}),e.jsxs("span",{className:"nut-ring-pct",children:[i,"%"]})]})};if(d.useEffect(()=>{if(!P)return;const s=setTimeout(()=>{const t=P;fe(),se(null),Ne(t)},1500);return()=>clearTimeout(s)},[P]),d.useEffect(()=>()=>{const s=X.current;if(Q.current&&s){try{s.stop(),s.offDetected()}catch{}Q.current=!1}},[]),ue||Fe==="loading")return e.jsxs("div",{className:"nut-page","data-theme":V?"dark":"light","data-accent":he,children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>H("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"})]})}),e.jsx("div",{className:"nut-loading-inline",children:e.jsx("div",{className:"cb-loading-spinner"})})]});if(Fe==="setup")return e.jsxs("div",{className:"nut-page","data-theme":V?"dark":"light","data-accent":he,children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>H("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:Le,"aria-label":"Toggle theme",children:V?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),e.jsxs("main",{className:"nut-main",children:[e.jsxs("div",{className:"nut-setup-intro",children:[e.jsx("h2",{children:"Set Your Daily Targets"}),e.jsx("p",{children:"Calculate your personalised macros based on your body and goals."})]}),e.jsxs("div",{className:"nut-calc-form",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Gender"}),e.jsxs("div",{className:"nut-toggle-group",children:[e.jsx("button",{className:l.gender==="male"?"active":"",onClick:()=>{g(s=>({...s,gender:"male"})),m(null)},children:"Male"}),e.jsx("button",{className:l.gender==="female"?"active":"",onClick:()=>{g(s=>({...s,gender:"female"})),m(null)},children:"Female"})]})]}),e.jsxs("div",{className:"nut-form-row",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Age"}),e.jsx("input",{type:"number",value:l.age,onChange:s=>{g(t=>({...t,age:s.target.value})),m(null)},placeholder:"Years",min:"15",max:"100"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Weight"}),e.jsxs("div",{className:"nut-input-unit",children:[e.jsx("input",{type:"number",value:l.weight,onChange:s=>{g(t=>({...t,weight:s.target.value})),m(null)},placeholder:l.weightUnit,min:"30",max:"300"}),e.jsxs("div",{className:"nut-unit-toggle",children:[e.jsx("button",{className:l.weightUnit==="kg"?"active":"",onClick:()=>{g(s=>({...s,weightUnit:"kg"})),m(null)},children:"kg"}),e.jsx("button",{className:l.weightUnit==="lbs"?"active":"",onClick:()=>{g(s=>({...s,weightUnit:"lbs"})),m(null)},children:"lbs"})]})]})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Height"}),e.jsxs("div",{className:"nut-input-unit",children:[l.heightUnit==="cm"?e.jsx("input",{type:"number",value:l.height,onChange:s=>{g(t=>({...t,height:s.target.value})),m(null)},placeholder:"cm",min:"100",max:"250"}):e.jsxs("div",{className:"nut-height-imperial",children:[e.jsx("input",{type:"number",value:l.heightFeet,onChange:s=>{g(t=>({...t,heightFeet:s.target.value})),m(null)},placeholder:"ft",min:"4",max:"7"}),e.jsx("input",{type:"number",value:l.heightInches,onChange:s=>{g(t=>({...t,heightInches:s.target.value})),m(null)},placeholder:"in",min:"0",max:"11"})]}),e.jsxs("div",{className:"nut-unit-toggle",children:[e.jsx("button",{className:l.heightUnit==="cm"?"active":"",onClick:()=>{g(s=>({...s,heightUnit:"cm"})),m(null)},children:"cm"}),e.jsx("button",{className:l.heightUnit==="ft"?"active":"",onClick:()=>{g(s=>({...s,heightUnit:"ft"})),m(null)},children:"ft/in"})]})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Daily Activity (outside of training)"}),e.jsxs("select",{value:l.dailyActivity,onChange:s=>{g(t=>({...t,dailyActivity:s.target.value})),m(null)},children:[e.jsx("option",{value:"sedentary",children:"Sedentary — desk job, under 5k steps"}),e.jsx("option",{value:"light",children:"Lightly Active — office + walking, 5-8k steps"}),e.jsx("option",{value:"moderate",children:"Moderately Active — on feet often, 8-12k steps"}),e.jsx("option",{value:"active",children:"Very Active — physical job, 12k+ steps"})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Training Sessions per Week"}),e.jsxs("select",{value:l.trainingFrequency,onChange:s=>{g(t=>({...t,trainingFrequency:s.target.value})),m(null)},children:[e.jsx("option",{value:"low",children:"1-2 sessions"}),e.jsx("option",{value:"moderate",children:"3-4 sessions"}),e.jsx("option",{value:"high",children:"5-6 sessions"}),e.jsx("option",{value:"daily",children:"7+ sessions"})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Fitness Goal"}),e.jsxs("div",{className:"nut-goal-options",children:[e.jsxs("button",{className:l.goal==="lose"?"active":"",onClick:()=>{g(s=>({...s,goal:"lose"})),m(null)},children:[e.jsx("span",{className:"nut-goal-icon",children:"-"}),e.jsx("span",{children:"Lose Weight"})]}),e.jsxs("button",{className:l.goal==="maintain"?"active":"",onClick:()=>{g(s=>({...s,goal:"maintain"})),m(null)},children:[e.jsx("span",{className:"nut-goal-icon",children:"="}),e.jsx("span",{children:"Maintain"})]}),e.jsxs("button",{className:l.goal==="build"?"active":"",onClick:()=>{g(s=>({...s,goal:"build"})),m(null)},children:[e.jsx("span",{className:"nut-goal-icon",children:"+"}),e.jsx("span",{children:"Build Muscle"})]})]})]}),l.goal==="lose"&&e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Deficit Level"}),e.jsxs("div",{className:"nut-deficit-options",children:[e.jsxs("button",{className:l.deficitLevel==="light"?"active":"",onClick:()=>{g(s=>({...s,deficitLevel:"light"})),m(null)},children:[e.jsx("strong",{children:"Mild"}),e.jsx("span",{children:"15% below TDEE"})]}),e.jsxs("button",{className:l.deficitLevel==="moderate"?"active":"",onClick:()=>{g(s=>({...s,deficitLevel:"moderate"})),m(null)},children:[e.jsx("strong",{children:"Moderate"}),e.jsx("span",{children:"20% below TDEE"})]}),e.jsxs("button",{className:l.deficitLevel==="harsh"?"active":"",onClick:()=>{g(s=>({...s,deficitLevel:"harsh"})),m(null)},children:[e.jsx("strong",{children:"Aggressive"}),e.jsx("span",{children:"25% below TDEE"})]})]})]}),e.jsx("button",{className:"nut-calc-btn",onClick:ns,disabled:!is(),children:"Calculate Macros"})]}),p&&e.jsxs("div",{className:"nut-calc-results",children:[e.jsx("h3",{children:"Your Daily Targets"}),e.jsxs("div",{className:"nut-calc-rings",children:[$("Protein","Protein",p.protein,p.protein,"ring-protein"),$("Carbs","Carbs",p.carbs,p.carbs,"ring-carbs"),$("Fats","Fats",p.fats,p.fats,"ring-fats"),$("Calories","Calories",p.calories,p.calories,"ring-cals")]}),e.jsxs("div",{className:"nut-calc-info",children:[e.jsxs("div",{className:"nut-calc-info-row",children:[e.jsx("span",{children:"BMR (body at rest)"}),e.jsxs("span",{children:[p.bmr," cal"]})]}),e.jsxs("div",{className:"nut-calc-info-row",children:[e.jsx("span",{children:"+ Daily activity (NEAT)"}),e.jsxs("span",{children:[p.neat," cal"]})]}),e.jsxs("div",{className:"nut-calc-info-row",children:[e.jsx("span",{children:"+ Training sessions"}),e.jsxs("span",{children:["+",p.exerciseAdd," cal"]})]}),e.jsxs("div",{className:"nut-calc-info-row",style:{fontWeight:600},children:[e.jsx("span",{children:"TDEE (total burn)"}),e.jsxs("span",{children:[p.tdee," cal"]})]})]}),e.jsx("button",{className:"nut-save-targets-btn",onClick:rs,children:"Set as My Daily Targets"})]})]}),O&&e.jsx("div",{className:`toast-notification ${O.type}`,children:O.message})]});const js=s=>{const t=new Date(s+"T12:00:00"),a=t.getDay(),n=new Date(t);n.setDate(t.getDate()-(a+6)%7);const o=[];for(let c=0;c<7;c++){const i=new Date(n);i.setDate(n.getDate()+c),o.push(i.toISOString().split("T")[0])}return o},vs=["M","T","W","T","F","S","S"],re=(s,t="search")=>{Ze(s),t==="scan"?(T("scan"),_(null)):t==="manual"?(T("manual"),A({name:"",protein:"",carbs:"",fats:"",calories:"",serving:""})):t==="favourites"?T("favourites"):(T("search"),xe([]),Ee(""))},He=js(M),ie=new Date(M+"T12:00:00"),bs=`${qe[ie.getMonth()]} ${ie.getFullYear()}`;return e.jsxs("div",{className:"nut-page","data-theme":V?"dark":"light","data-accent":he,children:[e.jsxs("div",{className:"nut-dark-zone",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>H("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:()=>{Y("setup"),m(null)},"aria-label":"Recalculate macros",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}),e.jsx("button",{onClick:Le,"aria-label":"Toggle theme",children:V?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})]})]})}),e.jsxs("div",{className:"nut-dark-content",children:[e.jsxs("div",{className:"nut-week-strip",children:[e.jsxs("div",{className:"nut-week-header",children:[e.jsx("button",{className:"nut-week-arrow",onClick:()=>{const s=new Date(M+"T12:00:00");s.setDate(s.getDate()-7);const t=s.toISOString().split("T")[0];Z(t)},"aria-label":"Previous week",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("button",{className:"nut-week-month-label",onClick:()=>{Te(!De),ge({year:ie.getFullYear(),month:ie.getMonth()})},children:bs}),e.jsx("button",{className:"nut-week-arrow",onClick:()=>{const s=new Date(M+"T12:00:00");s.setDate(s.getDate()+7);const t=s.toISOString().split("T")[0];t<=B()&&Z(t)},"aria-label":"Next week",disabled:He[6]>=B(),children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),e.jsx("div",{className:"nut-week-days",children:He.map((s,t)=>{const a=new Date(s+"T12:00:00").getDate(),n=s===M,o=s>B(),c=s===B();return e.jsxs("button",{className:`nut-week-day${n?" selected":""}${c?" today":""}${o?" future":""}`,disabled:o,onClick:()=>Z(s),children:[e.jsx("span",{className:"nut-week-day-letter",children:vs[t]}),e.jsx("span",{className:"nut-week-day-num",children:a})]},s)})})]}),De&&e.jsxs("div",{className:"nut-calendar nut-calendar-dark",children:[e.jsxs("div",{className:"nut-cal-header",children:[e.jsx("button",{onClick:()=>ge(s=>{let t=s.month-1,a=s.year;return t<0&&(t=11,a--),{year:a,month:t}}),children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsxs("span",{children:[qe[F.month]," ",F.year]}),e.jsx("button",{onClick:()=>ge(s=>{let t=s.month+1,a=s.year;return t>11&&(t=0,a++),{year:a,month:t}}),disabled:F.year===new Date().getFullYear()&&F.month>=new Date().getMonth(),children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),e.jsx("div",{className:"nut-cal-days-header",children:as.map(s=>e.jsx("span",{children:s},s))}),e.jsxs("div",{className:"nut-cal-grid",children:[[...Array(ts(F.year,F.month))].map((s,t)=>e.jsx("span",{},`e${t}`)),[...Array(ss(F.year,F.month))].map((s,t)=>{const a=t+1,n=`${F.year}-${String(F.month+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,o=n>B(),c=n===M,i=n===B();return e.jsx("button",{className:`nut-cal-day${c?" selected":""}${i?" today":""}${o?" future":""}`,disabled:o,onClick:()=>{Z(n),Te(!1)},children:a},a)})]})]}),e.jsxs("div",{className:"nut-rings-row",children:[$("Protein","Protein",ee.protein,k.protein,"ring-protein"),$("Carbs","Carbs",ee.carbs,k.carbs,"ring-carbs"),$("Fats","Fats",ee.fats,k.fats,"ring-fats"),$("Calories","kCal",ee.calories,k.calories,"ring-cals")]})]})]}),e.jsx("div",{className:"nut-light-zone",children:e.jsxs("div",{className:"nut-light-content",children:[ae&&e.jsxs("button",{className:"nut-water-quick",onClick:()=>me(!0),children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",width:"18",height:"18",children:e.jsx("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"})}),e.jsxs("span",{className:"nut-water-quick-count",children:[j.water," / ",k?.waterGoal||8]}),e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",width:"14",height:"14",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})]}),e.jsx("div",{className:"nut-log-section",children:e.jsx("div",{className:"nut-meals-list",children:Cs.map(s=>{const t=j.entries.filter(n=>(n.meal||"snacks")===s.key),a=t.reduce((n,o)=>({protein:n.protein+(o.protein||0),carbs:n.carbs+(o.carbs||0),fats:n.fats+(o.fats||0),calories:n.calories+(o.calories||0)}),{protein:0,carbs:0,fats:0,calories:0});return e.jsxs("div",{className:"nut-meal-card",children:[e.jsxs("div",{className:"nut-meal-card-header",children:[e.jsx("span",{className:`nut-meal-card-icon nut-meal-icon-${s.key}`,children:Ms[s.key]}),e.jsx("span",{className:"nut-meal-card-title",children:s.label}),t.length>0&&e.jsxs("span",{className:"nut-meal-card-cal",children:[a.calories," cal"]}),ae&&e.jsxs("div",{className:"nut-add-wrapper",children:[e.jsx("button",{className:"nut-meal-add-btn",onClick:()=>I(Ae===s.key?null:s.key),"aria-label":`Add to ${s.label}`,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),Ae===s.key&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nut-add-picker-backdrop",onClick:()=>I(null)}),e.jsxs("div",{className:"nut-add-picker",children:[e.jsxs("button",{onClick:()=>{I(null),re(s.key,"scan")},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),e.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),e.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),e.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),e.jsx("span",{children:"Scan"})]}),e.jsxs("button",{onClick:()=>{I(null),re(s.key,"search")},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("span",{children:"Search"})]}),e.jsxs("button",{onClick:()=>{I(null),re(s.key,"manual")},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),e.jsx("span",{children:"Manual"})]}),e.jsxs("button",{onClick:()=>{I(null),re(s.key,"favourites")},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),e.jsx("span",{children:"Favs"})]})]})]})]})]}),t.length>0&&e.jsxs("div",{className:"nut-meal-bars",children:[e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-p",children:"P"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-protein",style:{width:`${Math.min(100,k.protein>0?a.protein/k.protein*100:0)}%`}})}),e.jsxs("span",{className:"nut-meal-bar-val",children:[a.protein,"g"]})]}),e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-c",children:"C"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-carbs",style:{width:`${Math.min(100,k.carbs>0?a.carbs/k.carbs*100:0)}%`}})}),e.jsxs("span",{className:"nut-meal-bar-val",children:[a.carbs,"g"]})]}),e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-f",children:"F"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-fats",style:{width:`${Math.min(100,k.fats>0?a.fats/k.fats*100:0)}%`}})}),e.jsxs("span",{className:"nut-meal-bar-val",children:[a.fats,"g"]})]}),e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-cal",children:"K"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-cals",style:{width:`${Math.min(100,k.calories>0?a.calories/k.calories*100:0)}%`}})}),e.jsx("span",{className:"nut-meal-bar-val",children:a.calories})]})]}),t.length>0&&e.jsx("div",{className:"nut-log-list",children:t.map(n=>e.jsxs("div",{className:"nut-log-item",children:[e.jsxs("div",{className:"nut-log-item-info",children:[e.jsx("span",{className:"nut-log-item-name",children:n.name}),n.serving&&e.jsx("span",{className:"nut-log-item-serving",children:n.serving})]}),e.jsxs("div",{className:"nut-log-item-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[n.protein,"p"]}),e.jsxs("span",{className:"nut-macro-c",children:[n.carbs,"c"]}),e.jsxs("span",{className:"nut-macro-f",children:[n.fats,"f"]}),e.jsx("span",{className:"nut-macro-cal",children:n.calories})]}),ae&&e.jsx("button",{className:"nut-log-delete",onClick:()=>ls(n.id),"aria-label":"Remove",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},n.id))}),t.length===0&&e.jsx("div",{className:"nut-meal-empty",children:e.jsx("p",{children:ae?"Tap + to add food":"No entries"})})]},s.key)})})})]})}),Je&&e.jsx("div",{className:"nut-modal-overlay",onClick:()=>me(!1),children:e.jsxs("div",{className:"nut-water-popup",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"nut-water-popup-header",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",width:"20",height:"20",style:{color:"#2196f3"},children:e.jsx("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"})}),e.jsx("span",{children:"Water Intake"}),e.jsx("button",{className:"nut-modal-close",onClick:()=>me(!1),children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"nut-water-popup-body",children:[e.jsx("div",{className:"nut-water-glasses",children:[...Array(k?.waterGoal||8)].map((s,t)=>e.jsx("div",{className:`nut-water-glass ${t<j.water?"filled":""}`,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:t<j.water?"currentColor":"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"})})},t))}),e.jsxs("div",{className:"nut-water-popup-count",children:[j.water," / ",k?.waterGoal||8," glasses"]}),e.jsxs("div",{className:"nut-water-btns",children:[e.jsx("button",{onClick:ps,disabled:j.water<=0,children:"-"}),e.jsx("button",{onClick:gs,children:"+"})]})]})]})}),C&&e.jsx("div",{className:"nut-modal-overlay",onClick:()=>{fe(),se(null),T(null),_(null)},children:e.jsxs("div",{className:"nut-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"nut-modal-header",children:[e.jsx("h3",{children:C==="scan"?"Scan Barcode":C==="search"?"Search Food":C==="favourites"?"Favourites":"Manual Entry"}),e.jsx("button",{className:"nut-modal-close",onClick:()=>{fe(),se(null),T(null),_(null)},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),C==="scan"&&!r&&e.jsxs("div",{className:"nut-scan-area",children:[e.jsxs("div",{className:"nut-scanner-wrapper",children:[e.jsx("div",{id:"barcode-reader",className:"nut-scanner-view"}),pe&&!P&&e.jsx("div",{className:"nut-scan-line"}),P&&e.jsxs("div",{className:"nut-scan-detected-overlay",children:[e.jsx("svg",{className:"nut-scan-detected-tick",viewBox:"0 0 24 24",fill:"none",stroke:"#4caf50",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),e.jsx("p",{className:"nut-scan-detected-label",children:"Barcode found!"}),e.jsx("p",{className:"nut-scan-detected-code",children:P})]})]}),!pe&&e.jsxs("button",{className:"nut-scan-start-btn",onClick:cs,children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),e.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),e.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),e.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),"Open Camera"]}),pe&&!P&&e.jsx("p",{className:"nut-scan-hint",children:"Align barcode within the frame"}),e.jsx("div",{className:"nut-barcode-divider",children:e.jsx("span",{children:"or enter barcode manually"})}),e.jsxs("div",{className:"nut-barcode-manual",children:[e.jsx("input",{type:"text",inputMode:"numeric",value:q,onChange:s=>$e(s.target.value),onKeyDown:s=>s.key==="Enter"&&q.trim()&&Ne(q.trim()),placeholder:"Enter barcode number"}),e.jsx("button",{onClick:()=>q.trim()&&Ne(q.trim()),disabled:!q.trim()||We,children:We?"...":"Look Up"})]})]}),C==="scan"&&r&&(()=>{const s=r.servingUnit||"g",t=r.portion,a=N==="portion"&&t?h*t.weight:parseFloat(D)||0,n=a/100,o=s==="ml"?[100,200,250,500]:[50,100,150,200],c=N==="portion"&&t?`${h} ${t.label}${h!==1?"s":""} (${Math.round(a)}${s})`:`${Math.round(a)}${s}`;return e.jsxs("div",{className:"nut-product-result",children:[r.image&&e.jsx("img",{src:r.image,alt:"",className:"nut-product-img"}),e.jsxs("div",{className:"nut-product-name-row",children:[e.jsx("h4",{children:r.name}),e.jsx("button",{className:`nut-fav-star confirm${R(r.name)?" active":""}`,onClick:()=>ne({name:r.name,protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories,serving:r.servingSize,per100g:{protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories},servingUnit:r.servingUnit||"g",portion:r.portion||null}),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"22",height:"22",fill:R(r.name)?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})})]}),r.brand&&e.jsx("p",{className:"nut-product-brand",children:r.brand}),e.jsxs("p",{className:"nut-product-per",children:["Per 100",s,":"]}),e.jsxs("div",{className:"nut-product-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[r.protein,"g P"]}),e.jsxs("span",{className:"nut-macro-c",children:[r.carbs,"g C"]}),e.jsxs("span",{className:"nut-macro-f",children:[r.fats,"g F"]}),e.jsxs("span",{className:"nut-macro-cal",children:[r.calories," cal"]})]}),t&&e.jsxs("div",{className:"nut-mode-toggle",children:[e.jsx("button",{className:N==="portion"?"active":"",onClick:()=>{y("portion"),h<1&&b(1)},children:"Portions"}),e.jsxs("button",{className:N==="weight"?"active":"",onClick:()=>{y("weight"),v(String(Math.round(a)||100))},children:["Custom (",s,")"]})]}),N==="portion"&&t?e.jsxs("div",{className:"nut-portion-stepper",children:[e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(Math.max(1,h-1)),children:"-"}),e.jsxs("div",{className:"nut-stepper-display",children:[e.jsx("span",{className:"nut-stepper-count",children:h}),e.jsxs("span",{className:"nut-stepper-label",children:[t.label,h!==1?"s":""]}),e.jsxs("span",{className:"nut-stepper-weight",children:[Math.round(a),s]})]}),e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(h+1),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"nut-serving-adjust",children:[e.jsxs("label",{children:["Serving (",s,")"]}),e.jsx("input",{type:"number",inputMode:"numeric",value:D,onChange:i=>v(i.target.value),onFocus:i=>i.target.select(),min:"0"})]}),e.jsx("div",{className:"nut-quick-amounts",children:o.map(i=>e.jsxs("button",{className:`nut-quick-btn${D===String(i)?" active":""}`,onClick:()=>v(String(i)),children:[i,s]},i))})]}),e.jsx("div",{className:"nut-product-total",children:e.jsxs("span",{children:["Total: ",Math.round(r.protein*n),"p / ",Math.round(r.carbs*n),"c / ",Math.round(r.fats*n),"f / ",Math.round(r.calories*n)," cal"]})}),e.jsxs("div",{className:"nut-product-actions",children:[e.jsx("button",{className:"nut-btn-secondary",onClick:()=>{_(null),T("scan")},children:"Scan Again"}),e.jsx("button",{className:"nut-btn-primary",onClick:()=>J({name:r.name,protein:Math.round(r.protein*n),carbs:Math.round(r.carbs*n),fats:Math.round(r.fats*n),calories:Math.round(r.calories*n),serving:c}),children:"Add"})]})]})})(),C==="search"&&!r&&e.jsxs("div",{className:"nut-search-area",children:[e.jsxs("div",{className:"nut-search-bar",children:[e.jsx("input",{type:"text",ref:Ie,value:U,onChange:s=>Ee(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(clearTimeout(K.current),we())},onFocus:()=>setTimeout(()=>Ie.current?.scrollIntoView({behavior:"smooth",block:"center"}),350),placeholder:"Search food or product...",autoFocus:!0}),e.jsx("button",{onClick:we,disabled:je,children:je?"...":"Search"})]}),e.jsxs("div",{className:"nut-search-results",children:[Pe.map((s,t)=>e.jsxs("button",{className:"nut-search-item",onClick:()=>{_(s),s.portion?(b(1),v(String(s.portion.weight)),y("portion")):(b(0),v(String(s.servingValue||100)),y("weight"))},children:[s.image&&e.jsx("img",{src:s.image,alt:"",loading:"lazy"}),e.jsxs("div",{className:"nut-search-item-info",children:[e.jsx("span",{className:"nut-search-item-name",children:s.name}),s.brand&&e.jsx("span",{className:"nut-search-item-brand",children:s.brand}),e.jsxs("span",{className:"nut-search-item-macros",children:[s.calories," cal · ",s.protein,"p · ",s.carbs,"c · ",s.fats,"f per 100",s.servingUnit||"g"]})]})]},t)),Pe.length===0&&U&&!je&&e.jsx("p",{className:"nut-search-empty",children:"No results found. Try a different search or use manual entry."})]})]}),C==="search"&&r&&(()=>{const s=r.servingUnit||"g",t=r.portion,a=N==="portion"&&t?h*t.weight:parseFloat(D)||0,n=a/100,o=s==="ml"?[100,200,250,500]:[50,100,150,200],c=N==="portion"&&t?`${h} ${t.label}${h!==1?"s":""} (${Math.round(a)}${s})`:`${Math.round(a)}${s}`;return e.jsxs("div",{className:"nut-product-result",children:[r.image&&e.jsx("img",{src:r.image,alt:"",className:"nut-product-img"}),e.jsxs("div",{className:"nut-product-name-row",children:[e.jsx("h4",{children:r.name}),e.jsx("button",{className:`nut-fav-star confirm${R(r.name)?" active":""}`,onClick:()=>ne({name:r.name,protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories,serving:r.servingSize,per100g:{protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories},servingUnit:r.servingUnit||"g",portion:r.portion||null}),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"22",height:"22",fill:R(r.name)?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})})]}),r.brand&&e.jsx("p",{className:"nut-product-brand",children:r.brand}),e.jsxs("p",{className:"nut-product-per",children:["Per 100",s,":"]}),e.jsxs("div",{className:"nut-product-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[r.protein,"g P"]}),e.jsxs("span",{className:"nut-macro-c",children:[r.carbs,"g C"]}),e.jsxs("span",{className:"nut-macro-f",children:[r.fats,"g F"]}),e.jsxs("span",{className:"nut-macro-cal",children:[r.calories," cal"]})]}),t&&e.jsxs("div",{className:"nut-mode-toggle",children:[e.jsx("button",{className:N==="portion"?"active":"",onClick:()=>{y("portion"),h<1&&b(1)},children:"Portions"}),e.jsxs("button",{className:N==="weight"?"active":"",onClick:()=>{y("weight"),v(String(Math.round(a)||100))},children:["Custom (",s,")"]})]}),N==="portion"&&t?e.jsxs("div",{className:"nut-portion-stepper",children:[e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(Math.max(1,h-1)),children:"-"}),e.jsxs("div",{className:"nut-stepper-display",children:[e.jsx("span",{className:"nut-stepper-count",children:h}),e.jsxs("span",{className:"nut-stepper-label",children:[t.label,h!==1?"s":""]}),e.jsxs("span",{className:"nut-stepper-weight",children:[Math.round(a),s]})]}),e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(h+1),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"nut-serving-adjust",children:[e.jsxs("label",{children:["Serving (",s,")"]}),e.jsx("input",{type:"number",inputMode:"numeric",value:D,onChange:i=>v(i.target.value),onFocus:i=>i.target.select(),min:"0"})]}),e.jsx("div",{className:"nut-quick-amounts",children:o.map(i=>e.jsxs("button",{className:`nut-quick-btn${D===String(i)?" active":""}`,onClick:()=>v(String(i)),children:[i,s]},i))})]}),e.jsx("div",{className:"nut-product-total",children:e.jsxs("span",{children:["Total: ",Math.round(r.protein*n),"p / ",Math.round(r.carbs*n),"c / ",Math.round(r.fats*n),"f / ",Math.round(r.calories*n)," cal"]})}),e.jsxs("div",{className:"nut-product-actions",children:[e.jsx("button",{className:"nut-btn-secondary",onClick:()=>_(null),children:"Back to Search"}),e.jsx("button",{className:"nut-btn-primary",onClick:()=>J({name:r.name,protein:Math.round(r.protein*n),carbs:Math.round(r.carbs*n),fats:Math.round(r.fats*n),calories:Math.round(r.calories*n),serving:c}),children:"Add"})]})]})})(),C==="manual"&&e.jsxs("div",{className:"nut-manual-form",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Food Name"}),e.jsx("input",{type:"text",value:w.name,onChange:s=>A(t=>({...t,name:s.target.value})),placeholder:"e.g. Chicken Breast",autoFocus:!0})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Serving Size (optional)"}),e.jsx("input",{type:"text",value:w.serving,onChange:s=>A(t=>({...t,serving:s.target.value})),placeholder:"e.g. 150g, 1 cup"})]}),e.jsxs("div",{className:"nut-manual-macros",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Protein (g)"}),e.jsx("input",{type:"number",value:w.protein,onChange:s=>A(t=>({...t,protein:s.target.value})),min:"0"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Carbs (g)"}),e.jsx("input",{type:"number",value:w.carbs,onChange:s=>A(t=>({...t,carbs:s.target.value})),min:"0"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Fats (g)"}),e.jsx("input",{type:"number",value:w.fats,onChange:s=>A(t=>({...t,fats:s.target.value})),min:"0"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Calories"}),e.jsx("input",{type:"number",value:w.calories,onChange:s=>A(t=>({...t,calories:s.target.value})),min:"0"})]})]}),e.jsx("button",{className:"nut-btn-primary",disabled:!w.name.trim(),onClick:()=>J({name:w.name,protein:parseFloat(w.protein)||0,carbs:parseFloat(w.carbs)||0,fats:parseFloat(w.fats)||0,calories:parseFloat(w.calories)||0,serving:w.serving||""}),children:"Add Food"})]}),C==="favourites"&&!r&&(()=>{const s=be(),t=a=>{if(a.per100g){const n=a.per100g;_({name:a.name,brand:"",image:null,servingSize:a.serving||"100g",servingValue:100,servingUnit:a.servingUnit||"g",portion:a.portion||null,protein:n.protein,carbs:n.carbs,fats:n.fats,calories:n.calories,per100g:!0}),a.portion?(b(1),v(String(a.portion.weight)),y("portion")):(b(0),v("100"),y("weight"))}else J({name:a.name,protein:a.protein,carbs:a.carbs,fats:a.fats,calories:a.calories,serving:a.serving||""})};return e.jsx("div",{className:"nut-recent-area",children:s.length===0?e.jsx("p",{className:"nut-search-empty",children:"No favourites yet. Tap the star on any food to save it here."}):e.jsx("div",{className:"nut-recent-list",children:s.map((a,n)=>e.jsxs("div",{className:"nut-recent-item-row",children:[e.jsx("button",{className:"nut-fav-star active",onClick:o=>{o.stopPropagation(),ne(a)},children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),e.jsxs("button",{className:"nut-recent-item",onClick:()=>t(a),children:[e.jsxs("div",{className:"nut-recent-item-info",children:[e.jsx("span",{className:"nut-recent-item-name",children:a.name}),e.jsx("span",{className:"nut-recent-item-serving",children:a.serving||""})]}),e.jsxs("span",{className:"nut-recent-item-macros",children:[a.calories," cal"]})]})]},n))})})})(),C==="favourites"&&r&&(()=>{const s=r.servingUnit||"g",t=r.portion,a=N==="portion"&&t?h*t.weight:parseFloat(D)||0,n=a/100,o=s==="ml"?[100,200,250,500]:[50,100,150,200],c=N==="portion"&&t?`${h} ${t.label}${h!==1?"s":""} (${Math.round(a)}${s})`:`${Math.round(a)}${s}`;return e.jsxs("div",{className:"nut-product-result",children:[e.jsxs("div",{className:"nut-product-name-row",children:[e.jsx("h4",{children:r.name}),e.jsx("button",{className:`nut-fav-star confirm${R(r.name)?" active":""}`,onClick:()=>ne({name:r.name,protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories,serving:r.servingSize,per100g:{protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories},servingUnit:r.servingUnit||"g",portion:r.portion||null}),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"22",height:"22",fill:R(r.name)?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})})]}),e.jsxs("p",{className:"nut-product-per",children:["Per 100",s,":"]}),e.jsxs("div",{className:"nut-product-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[r.protein,"g P"]}),e.jsxs("span",{className:"nut-macro-c",children:[r.carbs,"g C"]}),e.jsxs("span",{className:"nut-macro-f",children:[r.fats,"g F"]}),e.jsxs("span",{className:"nut-macro-cal",children:[r.calories," cal"]})]}),t&&e.jsxs("div",{className:"nut-mode-toggle",children:[e.jsx("button",{className:N==="portion"?"active":"",onClick:()=>{y("portion"),h<1&&b(1)},children:"Portions"}),e.jsxs("button",{className:N==="weight"?"active":"",onClick:()=>{y("weight"),v(String(Math.round(a)||100))},children:["Custom (",s,")"]})]}),N==="portion"&&t?e.jsxs("div",{className:"nut-portion-stepper",children:[e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(Math.max(1,h-1)),children:"-"}),e.jsxs("div",{className:"nut-stepper-display",children:[e.jsx("span",{className:"nut-stepper-count",children:h}),e.jsxs("span",{className:"nut-stepper-label",children:[t.label,h!==1?"s":""]}),e.jsxs("span",{className:"nut-stepper-weight",children:[Math.round(a),s]})]}),e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(h+1),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"nut-serving-adjust",children:[e.jsxs("label",{children:["Serving (",s,")"]}),e.jsx("input",{type:"number",inputMode:"numeric",value:D,onChange:i=>v(i.target.value),onFocus:i=>i.target.select(),min:"0"})]}),e.jsx("div",{className:"nut-quick-amounts",children:o.map(i=>e.jsxs("button",{className:`nut-quick-btn${D===String(i)?" active":""}`,onClick:()=>v(String(i)),children:[i,s]},i))})]}),e.jsx("div",{className:"nut-product-total",children:e.jsxs("span",{children:["Total: ",Math.round(r.protein*n),"p / ",Math.round(r.carbs*n),"c / ",Math.round(r.fats*n),"f / ",Math.round(r.calories*n)," cal"]})}),e.jsxs("div",{className:"nut-product-actions",children:[e.jsx("button",{className:"nut-btn-secondary",onClick:()=>_(null),children:"Back to Favourites"}),e.jsx("button",{className:"nut-btn-primary",onClick:()=>J({name:r.name,protein:Math.round(r.protein*n),carbs:Math.round(r.carbs*n),fats:Math.round(r.fats*n),calories:Math.round(r.calories*n),serving:c}),children:"Add"})]})]})})()]})}),e.jsx(ys,{active:"nutrition"}),O&&e.jsx("div",{className:`toast-notification ${O.type}`,children:O.message})]})}export{Ds as default};
