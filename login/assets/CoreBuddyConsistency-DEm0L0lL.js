import{k as ae,l as ce,m as ne,r,j as e,c as oe,d as H,q as ie,w as le,g as re,n as de,e as he}from"./index-B7pQgPf9.js";import{C as me}from"./CoreBuddyNav-HTaMOPjh.js";const p=60,k=[{key:"trained",label:"Trained",icon:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2.71 7 4.14 8.43 7.71 4.86 16.29 13.43 12.71 17 14.14 18.43 15.57 17 17 18.43 14.14 21.29l1.43 1.43 1.43-1.43 1.43 1.43 2.14-2.14 1.43 1.43L22 20.57z"},{key:"protein",label:"Hit Protein",icon:"M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"},{key:"steps",label:"10k Steps",icon:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7"},{key:"sleep",label:"8hrs Sleep",icon:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"},{key:"water",label:"2L Water",icon:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"}];function be(i){const h=new Date(i),d=h.getDay(),b=d===0?-6:1-d;return h.setDate(h.getDate()+b),h.setHours(0,0,0,0),h}function w(i){return i.toISOString().split("T")[0]}function ue(i){return Array.from({length:7},(h,d)=>{const b=new Date(i);return b.setDate(i.getDate()+d),b})}function pe(){const{currentUser:i,isClient:h,clientData:d,loading:b}=ae(),{isDark:C,toggleTheme:O,accent:P}=ce(),j=ne(),[D,T]=r.useState({}),[R,F]=r.useState(!0),[$,S]=r.useState(!1),[V,q]=r.useState(0),[y,L]=r.useState(null),[U,B]=r.useState(null),[J,f]=r.useState(!1),W=r.useRef([]),A=r.useRef([]),G=r.useCallback((t,s="info")=>{L({message:t,type:s}),setTimeout(()=>L(null),3e3)},[]),v=new Date,u=w(v),Q=be(v),X=ue(Q),Y=["M","T","W","T","F","S","S"];r.useEffect(()=>{!b&&(!i||!h)&&j("/")},[i,h,b,j]),r.useEffect(()=>{if(!i||!d)return;(async()=>{try{const s=oe(H,"habitLogs"),a=ie(s,le("clientId","==",d.id)),c=await re(a),n={};c.docs.forEach(l=>{const x=l.data();n[x.date]={...x,_id:l.id}}),T(n);let m=0;const o=new Date(v);for(;;){const l=w(o),x=n[l];if(x)if(Object.values(x.habits||{}).filter(Boolean).length>=3)m++,o.setDate(o.getDate()-1);else break;else if(l===u)o.setDate(o.getDate()-1);else break}q(m)}catch(s){console.error("Error loading habit logs:",s)}finally{F(!1)}})()},[i,d]);const g=D[u]||{habits:{}},Z=async t=>{if(!i||$)return;const s=g.habits?.[t]||!1;s||(W.current=[...Array(10)].map((a,c)=>{const n=c/10*2*Math.PI,m=18+Math.random()*20;return{tx:Math.cos(n)*m,ty:Math.sin(n)*m,size:3+Math.random()*4,duration:.4+Math.random()*.3}}),B(t),setTimeout(()=>B(null),700)),S(!0);try{const a=g.habits||{},c={...a,[t]:!a[t]},n=g._id||`${d.id}_${u}`;await de(he(H,"habitLogs",n),{clientId:d.id,date:u,habits:c}),T(o=>({...o,[u]:{clientId:d.id,date:u,habits:c,_id:n}})),Object.values(c).filter(Boolean).length===k.length&&!s&&(A.current=[...Array(50)].map((o,l)=>({x:5+Math.random()*90,delay:Math.random()*.6,color:["#4caf50","#ff9800","#2196f3","#e91e63","#ffeb3b","#9c27b0"][l%6],drift:(Math.random()-.5)*120,spin:Math.random()*720-360,duration:1.5+Math.random()*1.5,width:4+Math.random()*8,height:4+Math.random()*10})),setTimeout(()=>{f(!0),setTimeout(()=>f(!1),3500)},500))}catch(a){console.error("Error saving habit:",a),G("Failed to save. Try again.","error")}finally{S(!1)}},N=X.map(t=>{const s=w(t),a=D[s],c=a?Object.values(a.habits||{}).filter(Boolean).length:0;return{date:t,dateStr:s,completed:c,total:k.length}}),_=N.reduce((t,s)=>t+s.completed,0),M=N.reduce((t,s)=>t+s.total,0),z=M>0?Math.round(_/M*100):0,K=Object.values(g.habits||{}).filter(Boolean).length,I=Math.round(K/k.length*100),ee=Math.round(I/100*p);return e.jsxs("div",{className:"cbc-page","data-theme":C?"dark":"light","data-accent":P,children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>j("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:O,"aria-label":"Toggle theme",children:C?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),b||R?e.jsx("div",{className:"cbc-loading-inline",children:e.jsx("div",{className:"cbc-loading-spinner"})}):e.jsxs("main",{className:"cbc-main",children:[e.jsxs("div",{className:"cbc-ring-section",children:[e.jsxs("div",{className:"cbc-progress-ring",children:[e.jsx("svg",{viewBox:"0 0 200 200",children:[...Array(p)].map((t,s)=>{const a=(s*6-90)*(Math.PI/180),c=100+78*Math.cos(a),n=100+78*Math.sin(a),m=100+94*Math.cos(a),o=100+94*Math.sin(a);return e.jsx("line",{x1:c,y1:n,x2:m,y2:o,className:s<ee?"cbc-tick-filled":"cbc-tick-empty",strokeWidth:s%5===0?"3":"2",style:{transitionDelay:`${s*20}ms`}},s)})}),e.jsxs("div",{className:"cbc-ring-center",children:[e.jsxs("span",{className:"cbc-ring-pct",children:[I,"%"]}),e.jsx("span",{className:"cbc-ring-label",children:"today"})]})]}),e.jsxs("div",{className:"cbc-streak",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"var(--color-primary)",strokeWidth:"2",children:e.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),e.jsx("span",{className:"cbc-streak-count",children:V}),e.jsx("span",{className:"cbc-streak-label",children:"day streak"})]})]}),e.jsxs("div",{className:"cbc-section",children:[e.jsx("h2",{className:"cbc-section-title",children:"Today's Habits"}),e.jsx("div",{className:"cbc-habits",children:k.map(t=>{const s=g.habits?.[t.key]||!1,a=U===t.key;return e.jsxs("button",{className:`cbc-habit-btn cbc-habit-${t.key} ${s?"cbc-habit-done":""} ${a?"cbc-habit-just-checked":""}`,onClick:()=>Z(t.key),disabled:$,children:[e.jsx("div",{className:"cbc-habit-check",children:s?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12",className:`cbc-check-path ${a?"cbc-check-animate":""}`})}):e.jsx("div",{className:"cbc-habit-circle"})}),a&&e.jsx("div",{className:"cbc-particles",children:W.current.map((c,n)=>e.jsx("span",{className:"cbc-particle",style:{"--tx":`${c.tx}px`,"--ty":`${c.ty}px`,"--size":`${c.size}px`,animationDuration:`${c.duration}s`}},n))}),e.jsx("div",{className:`cbc-habit-icon cbc-icon-${t.key}`,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:t.icon})})}),e.jsx("span",{className:"cbc-habit-label",children:t.label})]},t.key)})})]}),e.jsxs("div",{className:"cbc-section",children:[e.jsx("h2",{className:"cbc-section-title",children:"This Week"}),e.jsx("div",{className:"cbc-week-grid",children:N.map((t,s)=>{const a=t.dateStr===u,c=t.total>0?t.completed/t.total:0,n=Math.round(c*p);return e.jsxs("div",{className:`cbc-day-ring ${a?"cbc-day-today":""} ${t.completed>0?"cbc-day-active":""}`,children:[e.jsx("svg",{viewBox:"0 0 100 100",children:[...Array(p)].map((m,o)=>{const l=(o*6-90)*(Math.PI/180),x=50+38*Math.cos(l),E=50+38*Math.sin(l),te=50+46*Math.cos(l),se=50+46*Math.sin(l);return e.jsx("line",{x1:x,y1:E,x2:te,y2:se,className:o<n?"cbc-day-tick-filled":"cbc-day-tick-empty",strokeWidth:o%5===0?"3":"2"},o)})}),e.jsx("span",{className:"cbc-day-label",children:Y[s]}),e.jsxs("span",{className:"cbc-day-count",children:[t.completed,"/",t.total]})]},s)})}),e.jsxs("div",{className:"cbc-week-summary",children:[e.jsx("div",{className:"cbc-week-summary-bar",children:e.jsx("div",{className:"cbc-week-summary-fill",style:{width:`${z}%`}})}),e.jsxs("span",{className:"cbc-week-summary-text",children:[_," / ",M," habits this week (",z,"%)"]})]})]})]}),e.jsx(me,{active:"home"}),J&&e.jsxs("div",{className:"cbc-celebration",onClick:()=>f(!1),children:[e.jsx("div",{className:"cbc-confetti-container",children:A.current.map((t,s)=>e.jsx("span",{className:"cbc-confetti-piece",style:{"--x":`${t.x}%`,"--delay":`${t.delay}s`,"--color":t.color,"--drift":`${t.drift}px`,"--spin":`${t.spin}deg`,"--duration":`${t.duration}s`,width:`${t.width}px`,height:`${t.height}px`}},s))}),e.jsxs("div",{className:"cbc-celebration-card",children:[e.jsxs("svg",{className:"cbc-celebration-icon",viewBox:"0 0 24 24",fill:"none",stroke:"var(--color-primary)",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),e.jsx("h2",{className:"cbc-celebration-title",children:"Crushed it!"}),e.jsx("p",{className:"cbc-celebration-sub",children:"All habits complete today"})]})]}),y&&e.jsx("div",{className:`toast-notification ${y.type}`,children:y.message})]})}export{pe as default};
