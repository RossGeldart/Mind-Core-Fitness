import{r as l,l as C,n as N,j as e,f as B,s as k,h as S,T as j,a as A,c as I,d as P}from"./index-5Z88Ic_v.js";const T=[{value:"block",label:"Block (1-2-1)"},{value:"circuit_vip",label:"Circuit VIP"},{value:"circuit_dropin",label:"Circuit Drop-in"},{value:"core_buddy",label:"Core Buddy"}];function E(){const[s,d]=l.useState({name:"",email:"",password:"",clientType:"block",circuitAccess:!1,coreBuddyAccess:!1,coreBuddyPlan:"free",weeksInBlock:"",numberOfSessions:"",sessionDuration:"45",startDate:"",endDate:""}),[g,f]=l.useState(!1),[y,c]=l.useState(""),{currentUser:u,isAdmin:m,loading:h}=C(),o=N();l.useEffect(()=>{!h&&(!u||!m)&&o("/")},[u,m,h,o]),l.useEffect(()=>{if(s.startDate&&s.weeksInBlock){const r=new Date(s.startDate),t=parseInt(s.weeksInBlock);if(!isNaN(t)&&t>0){const i=new Date(r);i.setDate(i.getDate()+t*7);const a=i.getFullYear(),x=(i.getMonth()+1).toString().padStart(2,"0"),b=i.getDate().toString().padStart(2,"0");d(w=>({...w,endDate:`${a}-${x}-${b}`}))}}},[s.startDate,s.weeksInBlock]);const n=r=>{const{name:t,value:i,type:a,checked:x}=r.target;d(b=>({...b,[t]:a==="checkbox"?x:i}))},D=async r=>{r.preventDefault(),c(""),f(!0);try{const t=await B(k,s.email.trim().toLowerCase(),s.password);await S(k);const i=s.clientType==="block",a={uid:t.user.uid,name:s.name.trim(),email:s.email.trim().toLowerCase(),clientType:s.clientType,status:"active",tier:"premium",subscriptionStatus:"active",signupSource:"admin",createdAt:j.now()};i?(a.circuitAccess=s.circuitAccess,a.coreBuddyAccess=s.coreBuddyAccess,a.weeksInBlock=parseInt(s.weeksInBlock),a.totalSessions=parseInt(s.numberOfSessions),a.sessionsRemaining=parseInt(s.numberOfSessions),a.sessionDuration=parseInt(s.sessionDuration),a.startDate=j.fromDate(new Date(s.startDate)),a.endDate=j.fromDate(new Date(s.endDate))):s.clientType==="core_buddy"?(a.coreBuddyAccess=!0,a.coreBuddyPlan=s.coreBuddyPlan||"free"):(a.circuitStrikes=0,a.circuitBanUntil=null),await A(I(P,"clients"),a),o("/dashboard")}catch(t){console.error("Error adding client:",t),t.code==="auth/email-already-in-use"?c("This email is already registered."):t.code==="auth/weak-password"?c("Password should be at least 6 characters."):c("Failed to add client. Please try again."),f(!1)}},v=()=>{o("/dashboard")};if(h)return e.jsx("div",{className:"loading",children:"Loading..."});if(!u||!m)return null;const p=s.clientType==="block";return e.jsxs("div",{className:"add-client-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("button",{className:"back-btn",onClick:v,"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("h1",{children:"Add New Client"})]}),e.jsxs("main",{className:"page-content",children:[y&&e.jsx("div",{className:"form-error",children:y}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Type"}),e.jsx("div",{className:"client-type-toggle",children:T.map(r=>e.jsx("button",{type:"button",className:`type-btn ${s.clientType===r.value?"active":""}`,onClick:()=>d(t=>({...t,clientType:r.value})),children:r.label},r.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Client Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:n,placeholder:"John Smith",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Client Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:n,placeholder:"john@example.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Client Portal Password"}),e.jsx("input",{type:"text",id:"password",name:"password",value:s.password,onChange:n,placeholder:"Set a password for client login",minLength:"6",required:!0}),e.jsx("span",{className:"helper-text",children:"Minimum 6 characters. Share this with your client."})]}),p&&e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"circuit-toggle-label",children:[e.jsx("input",{type:"checkbox",name:"circuitAccess",checked:s.circuitAccess,onChange:n}),e.jsx("span",{children:"Also allow Circuit Class access"})]})}),p&&e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"circuit-toggle-label",children:[e.jsx("input",{type:"checkbox",name:"coreBuddyAccess",checked:s.coreBuddyAccess,onChange:n}),e.jsx("span",{children:"Enable Core Buddy access"})]})}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weeksInBlock",children:"Weeks in Block"}),e.jsx("input",{type:"number",id:"weeksInBlock",name:"weeksInBlock",value:s.weeksInBlock,onChange:n,placeholder:"8",min:"1",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"numberOfSessions",children:"Number of Sessions"}),e.jsx("input",{type:"number",id:"numberOfSessions",name:"numberOfSessions",value:s.numberOfSessions,onChange:n,placeholder:"16",min:"1",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"sessionDuration",children:"Session Duration"}),e.jsxs("select",{id:"sessionDuration",name:"sessionDuration",value:s.sessionDuration,onChange:n,required:!0,children:[e.jsx("option",{value:"30",children:"30 minutes"}),e.jsx("option",{value:"45",children:"45 minutes"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"startDate",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",value:s.startDate,onChange:n,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"endDate",children:"End Date (auto-calculated)"}),e.jsx("input",{type:"date",id:"endDate",name:"endDate",value:s.endDate,onChange:n,required:!0}),e.jsx("span",{className:"helper-text",children:"Calculated from start date + weeks"})]})]}),s.clientType==="core_buddy"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"coreBuddyPlan",children:"Core Buddy Plan"}),e.jsxs("select",{id:"coreBuddyPlan",name:"coreBuddyPlan",value:s.coreBuddyPlan,onChange:n,children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:g,children:g?"Saving...":"Save Client"})]})]})]})]})}export{E as default};
