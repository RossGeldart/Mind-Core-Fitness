import{l as be,m as pe,n as ge,t as xe,r as n,j as e,i as fe,e as Q,d as X,E as je,u as ye}from"./index-3hPUaRZF.js";import{S as ve}from"./stripe-Da7IPrZW.js";const Ne="/login/assets/cb-select-workout-COYuKWbZ.PNG",we="/login/assets/cb-generated-workout-v7-zgJOE.PNG",ke="/login/assets/cb-workout-video-BHn037Uo.PNG",Se="/login/assets/cb-nutrition-J0Cwpy3Y.PNG",Ce="/login/assets/cb-habits-C_VulXmx.PNG",ze="/login/assets/cb-dashboard-BcTBO787.PNG",z=[{title:"Build Your Workout",desc:"Choose your equipment, time, focus area and difficulty â€” then let Core Buddy generate a workout tailored to you.",image:Ne},{title:"Your Workout, Ready to Go",desc:"Your personalised workout is generated instantly. Not feeling it? Hit reshuffle for a new one, or save it for later.",image:we},{title:"Follow Along with Video",desc:"Every exercise comes with a video demo so you can nail your form. Track sets, reps and weights as you go.",image:ke},{title:"Track Your Nutrition",desc:"Log meals with our barcode scanner, save favourites for quick logging, and use copy day to repeat a good day of eating.",image:Se},{title:"Build Better Habits",desc:"Set daily habits and track your streaks. Small wins every day add up to big results.",image:Ce},{title:"Your Profile & Community",desc:"Track your stats, climb the leaderboards, and connect with your Core Buddies â€” all from your profile dashboard.",image:ze}],D=["Has your doctor ever said that you have a heart condition and that you should only do physical activity recommended by a doctor?","Do you feel pain in your chest when you do physical activity?","In the past month, have you had chest pain when you were not doing physical activity?","Do you lose your balance because of dizziness or do you ever lose consciousness?","Do you have a bone or joint problem (e.g. back, knee, or hip) that could be made worse by a change in your physical activity?","Is your doctor currently prescribing drugs (e.g. water pills) for your blood pressure or heart condition?","Do you know of any other reason why you should not do physical activity?"],Ee=["Lose weight","Build muscle","Improve fitness","Get stronger","Tone up","Sport performance","Stress relief","Stay active"],Pe=[{key:"beginner",label:"Beginner",desc:"New to exercise or returning after a long break"},{key:"intermediate",label:"Intermediate",desc:"Training regularly for 6+ months"},{key:"advanced",label:"Advanced",desc:"Training consistently for 2+ years"}],Z=6;function Me(){const{currentUser:c,clientData:o,updateClientData:K,resolveClient:ee,loading:l}=be(),{isDark:v,toggleTheme:R}=pe(),d=ge(),[se]=xe();n.useEffect(()=>{!l&&c&&!c.emailVerified&&o?.signupSource==="self_signup"&&d("/signup",{replace:!0})},[l,c,o,d]);const ae=o?.tier==="premium"||!!o?.stripeSubscriptionId,F=se.get("checkout")==="success",[b,N]=n.useState(ae||F?2:0),[E,te]=n.useState(0),p=n.useRef(null),[g,x]=n.useState(null),[W,f]=n.useState(null);n.useEffect(()=>{const s=a=>{a.persisted&&x(null)};return window.addEventListener("pageshow",s),()=>window.removeEventListener("pageshow",s)},[]);const[j,ne]=n.useState(""),[G,oe]=n.useState(""),[w,ie]=n.useState(""),[k,re]=n.useState(""),[P,ce]=n.useState(""),[h,H]=n.useState(D.map(()=>null)),[S,le]=n.useState(!1),[T,L]=n.useState(!1),u=n.useRef(null),q=n.useRef(!1),[M,_]=n.useState(!1),[r,C]=n.useState(0),y=n.useRef(null);n.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]),n.useEffect(()=>{const s=u.current;if(!s)return;const a=()=>{const t=s.getBoundingClientRect();(s.width!==t.width||s.height!==t.height)&&(s.width=t.width,s.height=t.height)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[b,r]);const O=s=>{const t=u.current.getBoundingClientRect(),i=s.touches?s.touches[0]:s;return{x:i.clientX-t.left,y:i.clientY-t.top}},Y=s=>{s.preventDefault();const t=u.current.getContext("2d"),i=O(s);t.beginPath(),t.moveTo(i.x,i.y),q.current=!0},U=s=>{if(!q.current)return;s.preventDefault();const a=u.current.getContext("2d"),t=O(s);a.lineTo(t.x,t.y),a.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim()||"#fff",a.lineWidth=2,a.lineCap="round",a.stroke(),_(!0)},A=()=>{q.current=!1},de=()=>{const s=u.current;s.getContext("2d").clearRect(0,0,s.width,s.height),_(!1)};if(n.useEffect(()=>{!l&&o?.onboardingComplete&&d("/client/core-buddy")},[l,o,d]),n.useEffect(()=>{(o?.tier==="premium"||o?.stripeSubscriptionId)&&b<2&&N(2)},[o?.tier,o?.stripeSubscriptionId,b]),n.useEffect(()=>{!l&&!c&&d("/")},[l,c,d]),l)return e.jsx("div",{className:"ob-page",children:e.jsx("div",{className:"ob-content",style:{justifyContent:"center",minHeight:"60dvh"},children:e.jsx("div",{className:"ob-loading-spinner"})})});const ue=()=>{if(!p.current)return;const s=p.current,a=s.firstChild?.offsetWidth||1,t=Math.round(s.scrollLeft/a);te(Math.min(t,z.length-1))},$=s=>{if(!p.current)return;const a=p.current,t=a.firstChild?.offsetWidth||1;a.scrollTo({left:t*s,behavior:"smooth"})},V=e.jsx("button",{className:"ob-theme-toggle",onClick:R,"aria-label":v?"Switch to light mode":"Switch to dark mode",children:v?e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"})}):e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"})})});if(b===0){const s=E===z.length-1;return e.jsx("div",{className:"ob-page ob-page--showcase",children:e.jsxs("div",{className:"ob-content ob-content--showcase",children:[e.jsxs("div",{className:"ob-showcase-header",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"ob-logo",width:"48",height:"48"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h1",{className:"ob-title",style:{textAlign:"left",marginBottom:2},children:"Core Buddy"}),e.jsx("p",{className:"ob-subtitle",style:{textAlign:"left",margin:0},children:"Here's what you can do"})]}),e.jsx("button",{className:"ob-theme-toggle",onClick:R,"aria-label":v?"Switch to light mode":"Switch to dark mode",children:v?e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"})}):e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"})})})]}),e.jsx("div",{className:"ob-showcase-carousel",ref:p,onScroll:ue,children:z.map((a,t)=>e.jsxs("div",{className:"ob-showcase-slide",children:[e.jsx("div",{className:"ob-showcase-img-wrap",children:e.jsx("img",{src:a.image,alt:a.title,className:"ob-showcase-img"})}),e.jsxs("div",{className:"ob-showcase-text",children:[e.jsx("h3",{className:"ob-showcase-title",children:a.title}),e.jsx("p",{className:"ob-showcase-desc",children:a.desc})]})]},t))}),e.jsx("div",{className:"ob-dots",children:z.map((a,t)=>e.jsx("span",{className:`ob-dot${E===t?" active":""}`,onClick:()=>$(t)},t))}),e.jsx("div",{className:"ob-showcase-actions",children:s?e.jsx("button",{className:"ob-primary-btn",onClick:()=>N(1),children:"Get Started"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"ob-primary-btn",onClick:()=>$(E+1),children:"Next"}),e.jsx("button",{className:"ob-skip-btn",onClick:()=>N(1),children:"Skip"})]})})]})})}if(b===1){const s=async a=>{if(typeof window.fbq=="function"&&(a==="free"?fbq("track","Lead",{content_name:"Core Buddy Free",content_category:"Fitness App"}):fbq("track","InitiateCheckout",{content_name:`Core Buddy ${a.charAt(0).toUpperCase()+a.slice(1)}`,content_category:"Fitness App",value:a==="annual"?99.99:9.99,currency:"GBP"})),a==="free"){N(2);return}if(!o?.id||!c?.uid||!c?.email){f("Account is still loading â€” please wait a moment and try again.");return}x(a),f(null);try{const t=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:ve[a],clientId:o.id,uid:c.uid,email:c.email})});if(!t.ok){const m=await t.text();let I;try{I=JSON.parse(m).error}catch{I=m}f(I||`Server error (${t.status})`),x(null);return}const i=await t.json();if(i.url){try{localStorage.setItem("mcf_clientId",o.id)}catch{}window.location.href=i.url}else f("No checkout URL returned â€” please try again"),x(null)}catch(t){console.error("Checkout error:",t),f("Unable to reach checkout â€” check your connection"),x(null)}};return e.jsxs("div",{className:"ob-page",children:[V,e.jsxs("div",{className:"ob-content",children:[e.jsx("div",{className:"ob-step-indicator",children:e.jsx("span",{className:"ob-step-num",children:"1 of 3"})}),e.jsx("h1",{className:"ob-title",children:"Choose Your Plan"}),e.jsx("p",{className:"ob-subtitle",children:"Start free or unlock everything with Premium"}),e.jsxs("div",{className:"ob-plans",children:[e.jsxs("button",{className:"ob-plan-card ob-plan-free",onClick:()=>s("free"),disabled:!!g,children:[e.jsx("div",{className:"ob-plan-name",children:"Free"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"0"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ‹"})," 2 workouts per week"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âš¡"})," Limited time selection (5 & 10 min)"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ“Š"})," Basic dashboard"]})]}),e.jsx("div",{className:"ob-plan-cta-outline",children:"Continue Free"})]}),e.jsxs("button",{className:"ob-plan-card",onClick:()=>s("monthly"),disabled:!!g,children:[e.jsx("div",{className:"ob-plan-badge",children:"Most Popular"}),e.jsx("div",{className:"ob-plan-name",children:"Monthly"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"9.99"}),e.jsx("span",{className:"ob-plan-period",children:"/month"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âœ¨"})," 7-day free trial"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ”“"})," All features unlocked"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âŒ"})," Cancel anytime"]})]}),e.jsx("div",{className:"ob-plan-cta",children:g==="monthly"?"Loading...":"Start Free Trial"})]}),e.jsxs("button",{className:"ob-plan-card ob-plan-featured",onClick:()=>s("annual"),disabled:!!g,children:[e.jsx("div",{className:"ob-plan-badge",children:"Best Value â€” Save 17%"}),e.jsx("div",{className:"ob-plan-name",children:"Annual"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"99.99"}),e.jsx("span",{className:"ob-plan-period",children:"/year"})]}),e.jsx("div",{className:"ob-plan-price-sub",children:"Just Â£8.33/month"}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âœ¨"})," 7-day free trial"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ”“"})," All features unlocked"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"â­"})," Best value"]})]}),e.jsx("div",{className:"ob-plan-cta ob-plan-cta-featured",children:g==="annual"?"Loading...":"Start Free Trial"})]})]}),W&&e.jsx("p",{className:"ob-error",children:W})]})]})}const he=(r+1)/Z*100,B=(s,a)=>{s(a),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{C(t=>Math.min(t+1,Z-1))},500)},J=h.every(s=>s!==null)&&S&&M,me=async()=>{if(!(!J||T)){L(!0);try{const s=await ee();if(!s){alert("Could not find your account. Please try logging out and back in."),L(!1);return}const a=u.current.toDataURL("image/png");await fe(Q(X,"onboardingSubmissions",s.id),{clientId:s.id,clientName:s.name,email:s.email,selectedPlan:s.tier||"free",welcome:{dob:j,gender:G||null,goal:w,experience:k,injuries:P.trim()||null},parq:{questions:D,answers:h,hasYes:h.includes(!0),declaration:!0,signature:a},submittedAt:je()}),await ye(Q(X,"clients",s.id),{onboardingComplete:!0,fitnessGoal:w,experienceLevel:k,dob:j||null});const t={onboardingComplete:!0,fitnessGoal:w,experienceLevel:k,dob:j};F&&(t.tier="premium",t.subscriptionStatus="trialing"),K(t),d("/client/core-buddy")}catch(s){console.error("Onboarding submit error:",s),alert(`Failed to save â€” please try again.
`+(s.code||s.message||""))}finally{L(!1)}}};return e.jsxs("div",{className:"ob-page ob-page--wizard",children:[V,e.jsxs("div",{className:"ob-content ob-content--wizard",children:[e.jsx("div",{className:"ob-wizard-progress",children:e.jsx("div",{className:"ob-wizard-progress-bar",style:{width:`${he}%`}})}),e.jsx("div",{className:"ob-wizard-orb",children:e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",width:"72",height:"72"})}),e.jsxs("div",{className:"ob-wizard-body",children:[r===0&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"ob-wizard-question",children:"When were you born?"}),e.jsx("p",{className:"ob-wizard-hint",children:"This helps us tailor your experience"}),e.jsx("input",{type:"date",className:"ob-input",value:j,onChange:s=>ne(s.target.value),max:new Date().toISOString().split("T")[0]}),e.jsx("button",{className:"ob-primary-btn",disabled:!j,onClick:()=>C(1),style:{marginTop:24},children:"Continue"})]}),r===1&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"ob-wizard-question",children:"How do you identify?"}),e.jsx("p",{className:"ob-wizard-hint",children:"Used for personalised recommendations"}),e.jsx("div",{className:"ob-chip-group ob-chip-group--centered",children:["Male","Female","Other","Prefer not to say"].map(s=>e.jsx("button",{className:`ob-chip${G===s?" active":""}`,onClick:()=>B(oe,s),children:s},s))})]}),r===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"ob-wizard-question",children:"What's your main goal?"}),e.jsx("p",{className:"ob-wizard-hint",children:"We'll focus your workouts around this"}),e.jsx("div",{className:"ob-chip-group ob-chip-group--centered",children:Ee.map(s=>e.jsx("button",{className:`ob-chip${w===s?" active":""}`,onClick:()=>B(ie,s),children:s},s))})]}),r===3&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"ob-wizard-question",children:"Where are you at?"}),e.jsx("p",{className:"ob-wizard-hint",children:"No judgement â€” just helps us set the right level"}),e.jsx("div",{className:"ob-level-group",children:Pe.map(s=>e.jsxs("button",{className:`ob-level-card${k===s.key?" active":""}`,onClick:()=>B(re,s.key),children:[e.jsx("strong",{children:s.label}),e.jsx("span",{children:s.desc})]},s.key))})]}),r===4&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"ob-wizard-question",children:"Anything we should know?"}),e.jsx("p",{className:"ob-wizard-hint",children:"Injuries, conditions, limitations â€” totally optional"}),e.jsx("textarea",{className:"ob-textarea",placeholder:"E.g. bad knee, lower back pain, asthma...",value:P,onChange:s=>ce(s.target.value),rows:3,maxLength:500}),e.jsx("button",{className:"ob-primary-btn",onClick:()=>C(5),style:{marginTop:24},children:P.trim()?"Continue":"Skip"})]}),r===5&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"ob-wizard-question",children:"Health Questionnaire"}),e.jsx("p",{className:"ob-wizard-hint",children:"PAR-Q â€” please answer honestly for your safety"}),e.jsx("div",{className:"ob-parq",children:D.map((s,a)=>e.jsxs("div",{className:"ob-parq-item",children:[e.jsx("p",{className:"ob-parq-question",children:s}),e.jsxs("div",{className:"ob-parq-btns",children:[e.jsx("button",{className:`ob-parq-btn${h[a]===!0?" yes":""}`,onClick:()=>H(t=>t.map((i,m)=>m===a?!0:i)),children:"Yes"}),e.jsx("button",{className:`ob-parq-btn${h[a]===!1?" no":""}`,onClick:()=>H(t=>t.map((i,m)=>m===a?!1:i)),children:"No"})]})]},a))}),h.includes(!0)&&e.jsx("div",{className:"ob-parq-warning",children:"You answered YES to one or more questions. We recommend consulting your doctor before starting an exercise programme."}),e.jsxs("label",{className:"ob-declare-label",onClick:()=>le(!S),children:[e.jsx("span",{className:`ob-declare-box${S?" checked":""}`,children:S&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})})}),e.jsx("span",{className:"ob-declare-text",children:"I confirm that I have read and answered each question honestly. I understand that if my health changes I should inform my trainer. I take full responsibility for my participation in physical activity."})]}),e.jsxs("div",{className:"ob-sig-section",children:[e.jsxs("div",{className:"ob-sig-header",children:[e.jsx("label",{className:"ob-label",style:{margin:0},children:"Signature"}),M&&e.jsx("button",{type:"button",className:"ob-sig-clear",onClick:de,children:"Clear"})]}),e.jsx("canvas",{ref:u,className:"ob-sig-canvas",onMouseDown:Y,onMouseMove:U,onMouseUp:A,onMouseLeave:A,onTouchStart:Y,onTouchMove:U,onTouchEnd:A}),!M&&e.jsx("p",{className:"ob-sig-hint",children:"Draw your signature above"})]}),e.jsx("button",{className:"ob-primary-btn",disabled:!J||T,onClick:me,children:T?"Saving...":"Complete Setup"})]})]},r),r>0&&e.jsxs("button",{className:"ob-wizard-back",onClick:()=>C(s=>s-1),children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back"]})]})]})}export{Me as default};
