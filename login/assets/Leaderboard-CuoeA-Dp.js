import{r as i,k as xe,l as be,m as je,g as F,q as I,c as O,d as C,w as B,T as K,j as e,C as X,u as ee,e as se}from"./index-Crq4khzG.js";function te(){const t=new Date,r=t.getDay(),l=r===0?-6:1-r,h=new Date(t);h.setDate(t.getDate()+l),h.setHours(0,0,0,0);const c=new Date(h);return c.setDate(h.getDate()+6),c.setHours(23,59,59,999),{start:h,end:c}}function ke(){const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1);r.setHours(0,0,0,0);const l=new Date(t.getFullYear(),t.getMonth()+1,0);return l.setHours(23,59,59,999),{start:r,end:l}}function ve(t){return t.toISOString().split("T")[0]}function A(t){if(!t)return"?";const r=t.trim().split(/\s+/);return r.length===1?r[0][0].toUpperCase():(r[0][0]+r[r.length-1][0]).toUpperCase()}function ge(t){if(t<60)return`${t}m`;const r=Math.floor(t/60),l=t%60;return l>0?`${r}h ${l}m`:`${r}h`}function fe(t){const r=new Date(t),l=r.getDay(),h=l===0?-6:1-l;return r.setDate(r.getDate()+h),r.setHours(0,0,0,0),r}function we(t){if(t.size===0)return 0;const l=fe(new Date);let h=0,c=new Date(l);const b=new Date(c);b.setDate(b.getDate()+6);let f=!1;t.forEach(m=>{const p=new Date(m);p>=c&&p<=b&&(f=!0)}),f||c.setDate(c.getDate()-7);for(let m=0;m<52;m++){const p=new Date(c),j=new Date(c);j.setDate(j.getDate()+6);let k=!1;if(t.forEach(w=>{const T=new Date(w);T>=p&&T<=j&&(k=!0)}),k)h++,c.setDate(c.getDate()-7);else break}return h}function ye(t){return t>=1e6?`${(t/1e6).toFixed(1)}M kg`:t>=1e3?`${(t/1e3).toFixed(1)}T`:`${t} kg`}const ae=[{key:"workouts",label:"Workouts",icon:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2.71 7 4.14 8.43 7.71 4.86 16.29 13.43 12.71 17 14.14 18.43 15.57 17 17 18.43 14.14 21.29l1.43 1.43 1.43-1.43 1.43 1.43 2.14-2.14 1.43 1.43L22 20.57z"},{key:"minutes",label:"Minutes",icon:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"},{key:"volume",label:"Volume",icon:"M6.5 2H4v20h2.5M17.5 2H20v20h-2.5M4 12h16M7 7h10M7 17h10"},{key:"streak",label:"Streak",icon:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"}],J=["#FFD700","#A8B4C0","#CD7F32"];function Ce(){const[t,r]=i.useState("workouts"),[l,h]=i.useState("week"),[c,b]=i.useState(!0),[f,m]=i.useState([]),[p,j]=i.useState(null),[k,w]=i.useState(!1),[T,$]=i.useState(!1),[M,_]=i.useState(null),[R,oe]=i.useState(!1),[q,ne]=i.useState(new Set),{currentUser:U,isClient:V,clientData:d,updateClientData:Q,loading:z}=xe(),{isDark:Y,toggleTheme:re}=be(),x=je(),D=i.useCallback((s,u="info")=>{_({message:s,type:u}),setTimeout(()=>_(null),4e3)},[]);i.useEffect(()=>{!z&&(!U||!V)&&x("/")},[U,V,z,x]),i.useEffect(()=>{d&&j(d.leaderboardOptIn===!0)},[d]),i.useEffect(()=>{d&&(async()=>{try{const s=d.id,u=await F(I(O(C,"buddies"),B("user1","==",s))),v=await F(I(O(C,"buddies"),B("user2","==",s))),g=new Set;[...u.docs,...v.docs].forEach(P=>{const S=P.data();g.add(S.user1===s?S.user2:S.user1)}),ne(g)}catch(s){console.error("Error fetching buddies:",s)}})()},[d]),i.useEffect(()=>{!d||!p||ce()},[d,p,t,l]);const le=async()=>{w(!0);try{await ee(se(C,"clients",d.id),{leaderboardOptIn:!0}),Q({leaderboardOptIn:!0}),j(!0),D("You're on the leaderboard!","success")}catch(s){console.error("Error opting in:",s),D("Failed to join. Try again.","error")}finally{w(!1)}},ie=async()=>{w(!0),$(!1);try{await ee(se(C,"clients",d.id),{leaderboardOptIn:!1}),Q({leaderboardOptIn:!1}),j(!1),m([]),D("You've left the leaderboard","info")}catch(s){console.error("Error opting out:",s),D("Failed to leave. Try again.","error")}finally{w(!1)}},ce=async()=>{b(!0);try{const s=I(O(C,"clients"),B("leaderboardOptIn","==",!0)),v=(await F(s)).docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.clientType==="core_buddy"||a.coreBuddyAccess===!0);if(v.length===0){m([]),b(!1);return}let g;if(t==="streak"){const a=new Date,n=new Date(a);n.setDate(n.getDate()-365),n.setHours(0,0,0,0),g={start:n,end:a}}else g=l==="week"?te():ke();const P=K.fromDate(g.start),S=K.fromDate(g.end),he=I(O(C,"workoutLogs"),B("completedAt",">=",P),B("completedAt","<=",S)),ue=await F(he),me=new Set(v.map(a=>a.id)),H={};v.forEach(a=>{H[a.id]={id:a.id,name:a.name,photoURL:a.photoURL||null,workouts:0,minutes:0,volume:0,workoutDates:new Set}}),ue.docs.forEach(a=>{const n=a.data();if(!me.has(n.clientId))return;const W=H[n.clientId];if(W.workouts++,n.type||(W.minutes+=n.duration||0),(n.type==="programme"||n.type==="muscle_group")&&(W.volume+=n.volume||0),n.completedAt){const pe=n.completedAt.toDate();W.workoutDates.add(ve(pe))}}),t==="streak"&&Object.values(H).forEach(a=>{a.streak=we(a.workoutDates)});let N=Object.values(H);t==="workouts"?N.sort((a,n)=>n.workouts-a.workouts||a.name.localeCompare(n.name)):t==="minutes"?N.sort((a,n)=>n.minutes-a.minutes||a.name.localeCompare(n.name)):t==="volume"?N.sort((a,n)=>n.volume-a.volume||a.name.localeCompare(n.name)):N.sort((a,n)=>n.streak-a.streak||a.name.localeCompare(n.name)),N.forEach((a,n)=>{a.rank=n+1}),m(N)}catch(s){console.error("Error fetching leaderboard:",s),D("Failed to load leaderboard","error")}finally{b(!1)}},L=s=>t==="workouts"?s.workouts:t==="minutes"?ge(s.minutes):t==="volume"?ye(s.volume):s.streak,de=()=>{if(t==="streak")return"All Time";if(l==="week"){const{start:u,end:v}=te();return`${u.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${v.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return new Date().toLocaleDateString("en-GB",{month:"long",year:"numeric"})},G=R?f.filter(s=>q.has(s.id)||s.id===d?.id).map((s,u)=>({...s,rank:u+1})):f,o=G.slice(0,3),Z=G.slice(3),y=s=>s.id===d?.id,E=G.find(s=>s.id===d?.id);return z?e.jsx("div",{className:"lb-loading",children:e.jsx("div",{className:"lb-loading-spinner"})}):!U||!V||!d?null:p===!1?e.jsxs("div",{className:"lb-page","data-theme":Y?"dark":"light",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>x("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:re,"aria-label":"Toggle theme",children:Y?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),e.jsx("main",{className:"lb-optin-main",children:e.jsxs("div",{className:"lb-optin-card",children:[e.jsx("div",{className:"lb-optin-trophy",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]})}),e.jsx("h2",{className:"lb-optin-title",children:"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-desc",children:"Compete with other Mind Core Fitness members"}),e.jsx("div",{className:"lb-optin-categories",children:ae.map(s=>e.jsxs("div",{className:"lb-optin-category",children:[e.jsx("div",{className:"lb-optin-category-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})})}),e.jsxs("div",{className:"lb-optin-category-text",children:[e.jsx("span",{className:"lb-optin-category-name",children:s.label}),e.jsxs("span",{className:"lb-optin-category-desc",children:[s.key==="workouts"&&"Randomiser, muscle group & programme workouts",s.key==="minutes"&&"Total minutes from randomiser workouts",s.key==="volume"&&"Total weight lifted in programmes & muscle groups",s.key==="streak"&&"Consecutive weeks with at least one workout"]})]})]},s.key))}),e.jsx("button",{className:"lb-optin-btn",onClick:le,disabled:k,children:k?"Joining...":"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-note",children:"Your full name will be visible to other members"})]})}),e.jsx(X,{})]}):e.jsxs("div",{className:"lb-page","data-theme":Y?"dark":"light",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>x("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:()=>$(!0),"aria-label":"Settings",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]})}),e.jsxs("main",{className:"lb-main",children:[e.jsx("div",{className:"lb-tabs",children:ae.map(s=>e.jsxs("button",{className:`lb-tab ${t===s.key?"lb-tab-active":""}`,onClick:()=>r(s.key),children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})}),e.jsx("span",{children:s.label})]},s.key))}),t!=="streak"&&e.jsx("div",{className:"lb-period-row",children:e.jsxs("div",{className:"lb-period-toggle",children:[e.jsx("button",{className:`lb-period-btn ${l==="week"?"lb-period-active":""}`,onClick:()=>h("week"),children:"This Week"}),e.jsx("button",{className:`lb-period-btn ${l==="month"?"lb-period-active":""}`,onClick:()=>h("month"),children:"This Month"})]})}),q.size>0&&e.jsx("div",{className:"lb-buddy-filter-row",children:e.jsxs("button",{className:`lb-buddy-filter${R?" active":""}`,onClick:()=>oe(!R),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Buddies Only"})]})}),e.jsx("div",{className:"lb-period-label",children:de()}),c?e.jsx("div",{className:"lb-content-loading",children:e.jsx("div",{className:"lb-loading-spinner"})}):f.length===0?e.jsxs("div",{className:"lb-empty",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"lb-empty-icon",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]}),e.jsx("h3",{children:"No one here yet"}),e.jsx("p",{children:"Be the first to get a workout in!"})]}):e.jsxs(e.Fragment,{children:[o.length>0&&e.jsxs("div",{className:"lb-podium",children:[e.jsx("div",{className:"lb-podium-place lb-podium-2nd",onClick:()=>o[1]&&x(`/client/core-buddy/profile/${o[1].id}`),role:o[1]?"button":void 0,children:o[1]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${y(o[1])?"lb-avatar-you":""}`,style:{borderColor:J[1]},children:o[1].photoURL?e.jsx("img",{src:o[1].photoURL,alt:"",className:"lb-avatar-img"}):A(o[1].name)}),e.jsx("div",{className:"lb-podium-name",children:o[1].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:L(o[1])}),e.jsx("div",{className:"lb-podium-bar lb-bar-2nd",children:e.jsx("span",{className:"lb-podium-rank",children:"2"})})]}):e.jsx("div",{className:"lb-podium-spacer"})}),e.jsxs("div",{className:"lb-podium-place lb-podium-1st",onClick:()=>x(`/client/core-buddy/profile/${o[0].id}`),role:"button",children:[e.jsx("div",{className:"lb-podium-crown",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"#FFD700",stroke:"none",children:[e.jsx("path",{d:"M2.5 18.5l3-7 4 4 3-9 3 9 4-4 3 7z"}),e.jsx("rect",{x:"3",y:"18",width:"18",height:"2",rx:"1"})]})}),e.jsx("div",{className:`lb-podium-avatar lb-avatar-1st ${y(o[0])?"lb-avatar-you":""}`,style:{borderColor:J[0]},children:o[0].photoURL?e.jsx("img",{src:o[0].photoURL,alt:"",className:"lb-avatar-img"}):A(o[0].name)}),e.jsx("div",{className:"lb-podium-name",children:o[0].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:L(o[0])}),e.jsx("div",{className:"lb-podium-bar lb-bar-1st",children:e.jsx("span",{className:"lb-podium-rank",children:"1"})})]}),e.jsx("div",{className:"lb-podium-place lb-podium-3rd",onClick:()=>o[2]&&x(`/client/core-buddy/profile/${o[2].id}`),role:o[2]?"button":void 0,children:o[2]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${y(o[2])?"lb-avatar-you":""}`,style:{borderColor:J[2]},children:o[2].photoURL?e.jsx("img",{src:o[2].photoURL,alt:"",className:"lb-avatar-img"}):A(o[2].name)}),e.jsx("div",{className:"lb-podium-name",children:o[2].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:L(o[2])}),e.jsx("div",{className:"lb-podium-bar lb-bar-3rd",children:e.jsx("span",{className:"lb-podium-rank",children:"3"})})]}):e.jsx("div",{className:"lb-podium-spacer"})})]}),Z.length>0&&e.jsx("div",{className:"lb-rankings",children:Z.map((s,u)=>e.jsxs("div",{className:`lb-rank-item ${y(s)?"lb-rank-you":""}`,style:{animationDelay:`${u*.04}s`},onClick:()=>x(`/client/core-buddy/profile/${s.id}`),role:"button",children:[e.jsx("span",{className:"lb-rank-number",children:s.rank}),e.jsx("div",{className:`lb-rank-avatar ${y(s)?"lb-avatar-you":""}`,children:s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"lb-avatar-img"}):A(s.name)}),e.jsx("div",{className:"lb-rank-info",children:e.jsxs("span",{className:"lb-rank-name",children:[s.name,y(s)&&e.jsx("span",{className:"lb-you-badge",children:"You"})]})}),e.jsx("span",{className:"lb-rank-stat",children:L(s)})]},s.id))}),E&&E.rank>5&&e.jsxs("div",{className:"lb-your-position",children:[e.jsxs("span",{className:"lb-your-rank",children:["#",E.rank]}),e.jsx("span",{className:"lb-your-label",children:"Your Position"}),e.jsx("span",{className:"lb-your-stat",children:L(E)})]})]})]}),T&&e.jsx("div",{className:"lb-modal-overlay",onClick:()=>$(!1),children:e.jsxs("div",{className:"lb-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"Leave the Leaderboard?"}),e.jsx("p",{children:"Your name will no longer appear to other members. You can rejoin anytime."}),e.jsxs("div",{className:"lb-modal-actions",children:[e.jsx("button",{className:"lb-modal-cancel",onClick:()=>$(!1),children:"Stay"}),e.jsx("button",{className:"lb-modal-confirm",onClick:ie,disabled:k,children:k?"Leaving...":"Leave"})]})]})}),e.jsx(X,{}),M&&e.jsxs("div",{className:`toast-notification ${M.type}`,children:[e.jsx("span",{className:"toast-icon",children:M.type==="success"?e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 13 L9 17 L19 7"})}):M.type==="error"?e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",children:[e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"}),e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"})]}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("circle",{cx:"12",cy:"16",r:"1",fill:"currentColor"})]})}),e.jsx("span",{className:"toast-message",children:M.message})]})]})}export{Ce as default};
