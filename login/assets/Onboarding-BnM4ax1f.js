import{l as ae,n as te,z as oe,r as o,j as e,i as ne,e as y,d as N,A as re,u as v,v as D}from"./index-L-UbmML7.js";import{S as ie}from"./stripe-7qEIN5w7.js";const le="/login/assets/feature_profile-CWe2aGgl.PNG",ce="/login/assets/feature_profile_tabs-CsR8qCH6.PNG",de="/login/assets/feature_pickaprogramme-BBJ_uVci.PNG",ue="/login/assets/feature_musclegroup-lOMvZzZD.PNG",he="/login/assets/feature_randomise_selection-BtpDvCw2.PNG",me="/login/assets/feature_randomise_generated_workout-DhG7zINk.PNG",be="/login/assets/feature_workout_view-DvsqOXHP.PNG",pe="/login/assets/feature_nutritionview-MoiMoFj1.PNG",fe="/login/assets/feature_journey_posts-Bw-ms_P0.PNG",u=[{title:"Your Profile",desc:"Set up your personal profile to track your fitness journey, view your stats, and showcase your progress.",image:le},{title:"Profile Tabs",desc:"Explore your achievements, personal bests, and activity history â€” all organised in one place.",image:ce},{title:"Pick a Programme",desc:"Choose from structured 4, 8, or 12-week programmes designed by professionals to match your goals.",image:de},{title:"Target Muscle Groups",desc:"Select specific muscle groups to focus on and get workouts tailored to exactly what you want to train.",image:ue},{title:"Randomise Your Workout",desc:"Pick your preferences â€” focus area, difficulty, and duration â€” and let Core Buddy generate a workout for you.",image:he},{title:"Generated Workout",desc:"Your personalised workout is ready to go. Follow along with exercises, sets, and reps all laid out for you.",image:me},{title:"Workout View",desc:"Track your progress in real time as you work through each exercise with a clear, easy-to-follow layout.",image:be},{title:"Nutrition Tracking",desc:"Log meals, scan barcodes, and track your macros and water intake to stay on top of your daily targets.",image:pe},{title:"Journey Posts",desc:"Share updates, celebrate wins, and connect with your Core Buddies through the community feed.",image:fe}],ge=3;function ye(){const{currentUser:l,clientData:n,updateClientData:h,resolveClient:G,loading:c}=ae(),i=te(),[O]=oe(),M=O.get("checkout")==="success",[m,V]=o.useState(0),[J,K]=o.useState("right"),[w,_]=o.useState(!1),[r,Y]=o.useState(0),f=o.useRef(null),[g,E]=o.useState(null),[A,b]=o.useState(null),[x,I]=o.useState([]),[k,R]=o.useState(""),[d,W]=o.useState(!1),[H,C]=o.useState(null),[z,U]=o.useState(!1),S=o.useRef(null),P=o.useRef(null),p=o.useCallback(s=>{w||(K(s>m?"right":"left"),_(!0),setTimeout(()=>{V(s),_(!1),window.scrollTo(0,0)},250))},[m,w]);if(o.useEffect(()=>{S.current&&S.current.scrollIntoView({behavior:"smooth"})},[x,d]),o.useEffect(()=>{m===1&&x.length===0&&!d&&L([])},[m]),o.useEffect(()=>{!c&&n?.onboardingComplete&&i("/client/core-buddy")},[c,n,i]),o.useEffect(()=>{if(!M||!n?.id||n?.onboardingComplete)return;(async()=>{try{await v(y(N,"clients",n.id),{onboardingComplete:!0}),h({onboardingComplete:!0,tier:"premium",subscriptionStatus:"trialing"}),i("/client/core-buddy")}catch(a){console.error("Post-checkout finalise error:",a)}})()},[M,n?.id,n?.onboardingComplete,h,i]),o.useEffect(()=>{c||!n?.id||n.onboardingComplete||(n.tier==="premium"||n.stripeSubscriptionId)&&(async()=>{try{await v(y(N,"clients",n.id),{onboardingComplete:!0}),h({onboardingComplete:!0}),i("/client/core-buddy")}catch(a){console.error("Auto-complete onboarding error:",a)}})()},[c,n?.id,n?.tier,n?.stripeSubscriptionId,n?.onboardingComplete,h,i]),o.useEffect(()=>{!c&&!l&&i("/")},[c,l,i]),c)return e.jsx("div",{className:"ob-page",children:e.jsx("div",{className:"ob-content",style:{justifyContent:"center",minHeight:"60dvh"},children:e.jsx("div",{className:"ob-loading-spinner"})})});const L=async s=>{W(!0),C(null);try{const t=await(await fetch("/api/buddy-onboarding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:s,clientName:n?.name||l?.displayName||"there"})})).json();if(t.error){C(t.error);return}const ee={role:"assistant",content:t.reply};I(se=>[...se,ee]),t.profileData&&(await Z(t.profileData),U(!0))}catch(a){console.error("Buddy chat error:",a),C("Something went wrong â€” try sending again.")}finally{W(!1)}},F=()=>{const s=k.trim();if(!s||d)return;const a={role:"user",content:s},t=[...x,a];I(t),R(""),P.current&&P.current.focus(),L(t)},q=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),F())},Z=async s=>{try{const a=await G();if(!a)return;await ne(y(N,"onboardingSubmissions",a.id),{clientId:a.id,clientName:a.name,email:a.email,source:"buddy_chat",welcome:{dob:s.dob||null,gender:s.gender||null,goals:s.goals||[],experience:s.experience||null,injuries:s.injuries||null,activityLevel:s.activityLevel||null,exerciseHistory:s.exerciseHistory||null,sleepHours:s.sleepHours||null,stressLevel:s.stressLevel||null,dietaryInfo:s.dietaryInfo||null,availability:s.availability||null,additionalInfo:s.additionalInfo||null},submittedAt:re()});const t=s.goals||[];await v(y(N,"clients",a.id),{fitnessGoal:t[0]||null,fitnessGoals:t,experienceLevel:s.experience||null,dob:s.dob||null,injuries:s.injuries||null}),h({fitnessGoal:t[0]||null,fitnessGoals:t,experienceLevel:s.experience,dob:s.dob})}catch(a){console.error("Save profile error:",a)}},X=s=>{s.key==="ArrowRight"||s.key==="ArrowDown"?(s.preventDefault(),r<u.length-1&&j(r+1)):s.key==="ArrowLeft"||s.key==="ArrowUp"?(s.preventDefault(),r>0&&j(r-1)):(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),r===u.length-1?p(1):j(r+1))},Q=()=>{if(!f.current)return;const s=f.current,a=s.firstChild?.offsetWidth||1,t=Math.round(s.scrollLeft/a);Y(Math.min(t,u.length-1))},j=s=>{if(!f.current)return;const a=f.current,t=a.firstChild?.offsetWidth||1;a.scrollTo({left:t*s,behavior:"smooth"})},T=w?`ob-step-anim ob-step-exit-${J}`:"ob-step-anim ob-step-enter",$=({current:s})=>{if(s===0)return null;const a=ge-1,t=s/a*100;return e.jsxs("div",{className:"ob-progress",children:[e.jsx("div",{className:"ob-progress-bar",children:e.jsx("div",{className:"ob-progress-fill",style:{width:`${t}%`}})}),e.jsxs("span",{className:"ob-progress-label",children:["Step ",s," of ",a]})]})};if(m===0){const s=r===u.length-1;return e.jsx("div",{className:"ob-page ob-page--showcase",children:e.jsxs("div",{className:`ob-content ob-content--showcase ${T}`,children:[e.jsxs("div",{className:"ob-showcase-header",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"ob-logo",width:"48",height:"48"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h1",{className:"ob-title",style:{textAlign:"left",marginBottom:2},children:"Core Buddy"}),e.jsx("p",{className:"ob-subtitle",style:{textAlign:"left",margin:0},children:"Here's what you can do"})]}),e.jsx(D,{className:"ob-theme-toggle"})]}),e.jsx("div",{className:"ob-showcase-carousel",ref:f,onScroll:Q,onKeyDown:X,tabIndex:0,role:"region","aria-label":"Feature showcase","aria-roledescription":"carousel",children:u.map((a,t)=>e.jsxs("div",{className:"ob-showcase-slide",role:"group","aria-roledescription":"slide","aria-label":`${t+1} of ${u.length}: ${a.title}`,children:[e.jsx("div",{className:"ob-showcase-img-wrap",children:e.jsx("img",{src:a.image,alt:a.title,className:"ob-showcase-img"})}),e.jsxs("div",{className:"ob-showcase-text",children:[e.jsx("h3",{className:"ob-showcase-title",children:a.title}),e.jsx("p",{className:"ob-showcase-desc",children:a.desc})]})]},t))}),e.jsx("div",{className:"ob-dots",role:"tablist","aria-label":"Slide indicators",children:u.map((a,t)=>e.jsx("span",{className:`ob-dot${r===t?" active":""}`,onClick:()=>j(t),role:"tab","aria-selected":r===t,"aria-label":`Go to slide ${t+1}`},t))}),e.jsx("div",{className:"ob-showcase-actions",children:s?e.jsx("button",{className:"ob-primary-btn",onClick:()=>p(1),children:"Get Started"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"ob-primary-btn",onClick:()=>j(r+1),children:"Next"}),e.jsx("button",{className:"ob-skip-btn",onClick:()=>p(1),children:"Skip"})]})})]})})}if(m===1)return e.jsxs("div",{className:"ob-page ob-page--chat",children:[e.jsx(D,{className:"ob-theme-toggle"}),e.jsxs("div",{className:`ob-chat-container ${T}`,children:[e.jsx($,{current:1}),e.jsxs("div",{className:"ob-chat-header",children:[e.jsx("div",{className:"ob-chat-avatar",children:e.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 2a4 4 0 0 1 4 4v2a4 4 0 0 1-8 0V6a4 4 0 0 1 4-4z"}),e.jsx("path",{d:"M18 14c2 1 3 3 3 5v2H3v-2c0-2 1-4 3-5"}),e.jsx("circle",{cx:"9",cy:"7",r:"0.5",fill:"currentColor"}),e.jsx("circle",{cx:"15",cy:"7",r:"0.5",fill:"currentColor"}),e.jsx("path",{d:"M9.5 10a2.5 2.5 0 0 0 5 0"})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"ob-chat-name",children:"Buddy"}),e.jsx("span",{className:"ob-chat-status",children:d?"typing...":"Your AI Coach"})]})]}),e.jsxs("div",{className:"ob-chat-messages",children:[x.map((s,a)=>e.jsxs("div",{className:`ob-chat-bubble ob-chat-${s.role}`,children:[s.role==="assistant"&&e.jsx("div",{className:"ob-chat-bubble-avatar",children:"B"}),e.jsx("div",{className:"ob-chat-bubble-content",children:s.content})]},a)),d&&e.jsxs("div",{className:"ob-chat-bubble ob-chat-assistant",children:[e.jsx("div",{className:"ob-chat-bubble-avatar",children:"B"}),e.jsxs("div",{className:"ob-chat-bubble-content ob-chat-typing",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]}),H&&e.jsxs("div",{className:"ob-chat-error",children:[H,e.jsx("button",{onClick:()=>L(x),children:"Retry"})]}),e.jsx("div",{ref:S})]}),z?e.jsx("div",{className:"ob-chat-done",children:e.jsx("button",{className:"ob-primary-btn",onClick:()=>p(2),children:"Continue"})}):e.jsxs("div",{className:"ob-chat-input-wrap",children:[e.jsx("textarea",{ref:P,className:"ob-chat-input",placeholder:"Type your message...",value:k,onChange:s=>R(s.target.value),onKeyDown:q,rows:1,disabled:d}),e.jsx("button",{className:"ob-chat-send",onClick:F,disabled:!k.trim()||d,"aria-label":"Send message",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})})]}),e.jsxs("button",{className:"ob-back-btn",onClick:()=>p(0),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]}),"Back"]})]})]});const B=async s=>{if(s==="free"){try{const a=await G();a&&await v(y(N,"clients",a.id),{onboardingComplete:!0}),h({onboardingComplete:!0}),i("/client/core-buddy")}catch(a){console.error("Free plan finalise error:",a),b("Something went wrong â€” please try again.")}return}if(!n?.id||!l?.uid||!l?.email){b("Account is still loading â€” please wait a moment and try again.");return}if(!l.emailVerified){b("Please verify your email before subscribing. Check your inbox for a verification link.");return}E(s),b(null);try{const t=await(await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:ie[s],clientId:n?.id,uid:l?.uid,email:l?.email})})).json();if(t.url){try{localStorage.setItem("mcf_clientId",n.id)}catch{}window.location.href=t.url}else b(t.error||"Something went wrong")}catch(a){console.error("Checkout error:",a),b("Unable to start checkout")}finally{E(null)}};return e.jsxs("div",{className:"ob-page",children:[e.jsx(D,{className:"ob-theme-toggle"}),e.jsxs("div",{className:`ob-content ${T}`,children:[e.jsx($,{current:2}),e.jsx("h1",{className:"ob-title",children:"Choose Your Plan"}),e.jsx("p",{className:"ob-subtitle",children:"Start free or unlock everything with Premium"}),e.jsxs("div",{className:"ob-plans",children:[e.jsxs("button",{className:"ob-plan-card ob-plan-free",onClick:()=>B("free"),disabled:!!g,children:[e.jsx("div",{className:"ob-plan-name",children:"Free"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"0"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âš¡"})," Randomiser workouts (5 & 10 min)"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ‹"})," 1 workout per week"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ“Š"})," Basic dashboard"]})]}),e.jsx("div",{className:"ob-plan-cta-free",children:"Get Started Free"})]}),e.jsxs("button",{className:"ob-plan-card",onClick:()=>B("monthly"),disabled:!!g,children:[e.jsx("div",{className:"ob-plan-badge",children:"Most Popular"}),e.jsx("div",{className:"ob-plan-name",children:"Monthly"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"19.99"}),e.jsx("span",{className:"ob-plan-period",children:"/month"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âœ¨"})," 7-day free trial"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ”“"})," All features unlocked"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âŒ"})," Cancel anytime"]})]}),e.jsx("div",{className:"ob-plan-cta",children:g==="monthly"?"Loading...":"Start Free Trial"})]}),e.jsxs("button",{className:"ob-plan-card ob-plan-featured",onClick:()=>B("annual"),disabled:!!g,children:[e.jsx("div",{className:"ob-plan-badge",children:"Best Value â€” Save 17%"}),e.jsx("div",{className:"ob-plan-name",children:"Annual"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"199.99"}),e.jsx("span",{className:"ob-plan-period",children:"/year"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âœ¨"})," 7-day free trial"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ”“"})," All features unlocked"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"â­"})," Best value"]})]}),e.jsx("div",{className:"ob-plan-cta ob-plan-cta-featured",children:g==="annual"?"Loading...":"Start Free Trial"})]})]}),A&&e.jsx("p",{className:"ob-error",children:A}),e.jsxs("button",{className:"ob-back-btn",onClick:()=>p(1),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]}),"Back"]})]})]})}export{ye as default};
