const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/stripe-DjYhJFjB.js","assets/index-DamGvgSc.js","assets/index-oTF6_sTt.css"])))=>i.map(i=>d[i]);
import{u as Ne,a as ve,x as we,r as o,s as oe,d as S,b as C,y as ne,j as e,l as T,g as ke,c as Se,_ as Ce}from"./index-DamGvgSc.js";import{S as Pe}from"./stripe-DjYhJFjB.js";const De="/login/assets/feature_profile-CWe2aGgl.PNG",Ee="/login/assets/feature_profile_tabs-CsR8qCH6.PNG",Te="/login/assets/feature_pickaprogramme-BBJ_uVci.PNG",Ae="/login/assets/feature_musclegroup-lOMvZzZD.PNG",Le="/login/assets/feature_randomise_selection-BtpDvCw2.PNG",_e="/login/assets/feature_randomise_generated_workout-DhG7zINk.PNG",Ge="/login/assets/feature_workout_view-DvsqOXHP.PNG",Ie="/login/assets/feature_nutritionview-MoiMoFj1.PNG",Me="/login/assets/feature_journey_posts-Bw-ms_P0.PNG",p=[{title:"Your Profile",desc:"Set up your personal profile to track your fitness journey, view your stats, and showcase your progress.",image:De},{title:"Profile Tabs",desc:"Explore your achievements, personal bests, and activity history â€” all organised in one place.",image:Ee},{title:"Pick a Programme",desc:"Choose from structured 4, 8, or 12-week programmes designed by professionals to match your goals.",image:Te},{title:"Target Muscle Groups",desc:"Select specific muscle groups to focus on and get workouts tailored to exactly what you want to train.",image:Ae},{title:"Randomise Your Workout",desc:"Pick your preferences â€” focus area, difficulty, and duration â€” and let Core Buddy generate a workout for you.",image:Le},{title:"Generated Workout",desc:"Your personalised workout is ready to go. Follow along with exercises, sets, and reps all laid out for you.",image:_e},{title:"Workout View",desc:"Track your progress in real time as you work through each exercise with a clear, easy-to-follow layout.",image:Ge},{title:"Nutrition Tracking",desc:"Log meals, scan barcodes, and track your macros and water intake to stay on top of your daily targets.",image:Ie},{title:"Journey Posts",desc:"Share updates, celebrate wins, and connect with your Core Buddies through the community feed.",image:Me}],$=["Has your doctor ever said that you have a heart condition and that you should only do physical activity recommended by a doctor?","Do you feel pain in your chest when you do physical activity?","In the past month, have you had chest pain when you were not doing physical activity?","Do you lose your balance because of dizziness or do you ever lose consciousness?","Do you have a bone or joint problem (e.g. back, knee, or hip) that could be made worse by a change in your physical activity?","Is your doctor currently prescribing drugs (e.g. water pills) for your blood pressure or heart condition?","Do you know of any other reason why you should not do physical activity?"],Re=["Lose weight","Build muscle","Improve fitness","Get stronger","Tone up","Sport performance","Stress relief","Stay active"],A=3,qe=[{key:"beginner",label:"Beginner",desc:"New to exercise or returning after a long break"},{key:"intermediate",label:"Intermediate",desc:"Training regularly for 6+ months"},{key:"advanced",label:"Advanced",desc:"Training consistently for 2+ years"}],Be=4;function Oe(){const{currentUser:u,clientData:n,updateClientData:re,resolveClient:ie,loading:f}=Ne(),x=ve(),[le]=we(),ce=n?.tier==="premium"||!!n?.stripeSubscriptionId,F=le.get("checkout")==="success",[c,O]=o.useState(ce||F?2:0),[de,ue]=o.useState("right"),[L,Y]=o.useState(!1),[l,he]=o.useState(0),j=o.useRef(null),[y,H]=o.useState(null),[V,N]=o.useState(null),[h,U]=o.useState(""),[v,z]=o.useState(""),[i,J]=o.useState([]),[m,K]=o.useState(""),[P,Q]=o.useState(""),[g,X]=o.useState($.map(()=>null)),[D,me]=o.useState(!1),[_,G]=o.useState(!1),[Z,I]=o.useState(null),b=o.useRef(null),M=o.useRef(!1),[R,q]=o.useState(!1),d=o.useCallback(s=>{L||(ue(s>c?"right":"left"),Y(!0),setTimeout(()=>{O(s),Y(!1)},250))},[c,L]);o.useEffect(()=>{if(!n?.id)return;(async()=>{try{const t=await ke(S(C,"onboardingDrafts",n.id));if(t.exists()){const a=t.data();a.dob&&U(a.dob),a.gender&&z(a.gender),a.goals?.length&&J(a.goals),a.experience&&K(a.experience),a.injuries&&Q(a.injuries)}}catch{}})()},[n?.id]);const be=o.useCallback(async()=>{if(n?.id)try{await oe(S(C,"onboardingDrafts",n.id),{dob:h,gender:v,goals:i,experience:m,injuries:P.trim(),updatedAt:ne()},{merge:!0})}catch{}},[n?.id,h,v,i,m,P]);o.useEffect(()=>{const s=b.current;if(!s)return;const t=()=>{const a=s.getBoundingClientRect();(s.width!==a.width||s.height!==a.height)&&(s.width=a.width,s.height=a.height,q(!1))};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[c]);const ee=s=>{const a=b.current.getBoundingClientRect(),r=s.touches?s.touches[0]:s;return{x:r.clientX-a.left,y:r.clientY-a.top}},se=s=>{s.preventDefault();const a=b.current.getContext("2d"),r=ee(s);a.beginPath(),a.moveTo(r.x,r.y),M.current=!0},ae=s=>{if(!M.current)return;s.preventDefault();const t=b.current.getContext("2d"),a=ee(s);t.lineTo(a.x,a.y),t.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim()||"#fff",t.lineWidth=2,t.lineCap="round",t.stroke(),q(!0)},B=()=>{M.current=!1},pe=()=>{const s=b.current;s.getContext("2d").clearRect(0,0,s.width,s.height),q(!1)};if(o.useEffect(()=>{!f&&n?.onboardingComplete&&x("/client/core-buddy")},[f,n,x]),o.useEffect(()=>{(n?.tier==="premium"||n?.stripeSubscriptionId)&&c<2&&O(2)},[n?.tier,n?.stripeSubscriptionId,c]),o.useEffect(()=>{!f&&!u&&x("/")},[f,u,x]),f)return e.jsx("div",{className:"ob-page",children:e.jsx("div",{className:"ob-content",style:{justifyContent:"center",minHeight:"60dvh"},children:e.jsx("div",{className:"ob-loading-spinner"})})});const ge=s=>{s.key==="ArrowRight"||s.key==="ArrowDown"?(s.preventDefault(),l<p.length-1&&w(l+1)):s.key==="ArrowLeft"||s.key==="ArrowUp"?(s.preventDefault(),l>0&&w(l-1)):(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),l===p.length-1?d(1):w(l+1))},fe=()=>{if(!j.current)return;const s=j.current,t=s.firstChild?.offsetWidth||1,a=Math.round(s.scrollLeft/t);he(Math.min(a,p.length-1))},w=s=>{if(!j.current)return;const t=j.current,a=t.firstChild?.offsetWidth||1;t.scrollTo({left:a*s,behavior:"smooth"})},xe=s=>{J(t=>t.includes(s)?t.filter(a=>a!==s):t.length>=A?t:[...t,s])},E=L?`ob-step-anim ob-step-exit-${de}`:"ob-step-anim ob-step-enter",W=({current:s})=>{if(s===0)return null;const t=Be-1,a=s/t*100;return e.jsxs("div",{className:"ob-progress",children:[e.jsx("div",{className:"ob-progress-bar",children:e.jsx("div",{className:"ob-progress-fill",style:{width:`${a}%`}})}),e.jsxs("span",{className:"ob-progress-label",children:["Step ",s," of ",t]})]})};if(c===0){const s=l===p.length-1;return e.jsx("div",{className:"ob-page ob-page--showcase",children:e.jsxs("div",{className:`ob-content ob-content--showcase ${E}`,children:[e.jsxs("div",{className:"ob-showcase-header",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"ob-logo",width:"48",height:"48"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h1",{className:"ob-title",style:{textAlign:"left",marginBottom:2},children:"Core Buddy"}),e.jsx("p",{className:"ob-subtitle",style:{textAlign:"left",margin:0},children:"Here's what you can do"})]}),e.jsx(T,{className:"ob-theme-toggle"})]}),e.jsx("div",{className:"ob-showcase-carousel",ref:j,onScroll:fe,onKeyDown:ge,tabIndex:0,role:"region","aria-label":"Feature showcase","aria-roledescription":"carousel",children:p.map((t,a)=>e.jsxs("div",{className:"ob-showcase-slide",role:"group","aria-roledescription":"slide","aria-label":`${a+1} of ${p.length}: ${t.title}`,children:[e.jsx("div",{className:"ob-showcase-img-wrap",children:e.jsx("img",{src:t.image,alt:t.title,className:"ob-showcase-img"})}),e.jsxs("div",{className:"ob-showcase-text",children:[e.jsx("h3",{className:"ob-showcase-title",children:t.title}),e.jsx("p",{className:"ob-showcase-desc",children:t.desc})]})]},a))}),e.jsx("div",{className:"ob-dots",role:"tablist","aria-label":"Slide indicators",children:p.map((t,a)=>e.jsx("span",{className:`ob-dot${l===a?" active":""}`,onClick:()=>w(a),role:"tab","aria-selected":l===a,"aria-label":`Go to slide ${a+1}`},a))}),e.jsx("div",{className:"ob-showcase-actions",children:s?e.jsx("button",{className:"ob-primary-btn",onClick:()=>d(1),children:"Get Started"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"ob-primary-btn",onClick:()=>w(l+1),children:"Next"}),e.jsx("button",{className:"ob-skip-btn",onClick:()=>d(1),children:"Skip"})]})})]})})}if(c===1){const s=async t=>{if(t==="free"){d(2);return}if(!n?.id||!u?.uid||!u?.email){N("Account is still loading â€” please wait a moment and try again.");return}if(!u.emailVerified){N("Please verify your email before subscribing. Check your inbox for a verification link.");return}H(t),N(null);try{const r=await(await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:Pe[t],clientId:n?.id,uid:u?.uid,email:u?.email})})).json();if(r.url){try{localStorage.setItem("mcf_clientId",n.id)}catch{}window.location.href=r.url}else N(r.error||"Something went wrong")}catch(a){console.error("Checkout error:",a),N("Unable to start checkout")}finally{H(null)}};return e.jsxs("div",{className:"ob-page",children:[e.jsx(T,{className:"ob-theme-toggle"}),e.jsxs("div",{className:`ob-content ${E}`,children:[e.jsx(W,{current:1}),e.jsx("h1",{className:"ob-title",children:"Choose Your Plan"}),e.jsx("p",{className:"ob-subtitle",children:"Start free or unlock everything with Premium"}),e.jsxs("div",{className:"ob-plans",children:[e.jsxs("button",{className:"ob-plan-card ob-plan-free",onClick:()=>s("free"),disabled:!!y,children:[e.jsx("div",{className:"ob-plan-name",children:"Free"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"0"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âš¡"})," Randomiser workouts (5 & 10 min)"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ‹"})," 1 workout per week"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ“Š"})," Basic dashboard"]})]}),e.jsx("div",{className:"ob-plan-cta-free",children:"Get Started Free"})]}),e.jsxs("button",{className:"ob-plan-card",onClick:()=>s("monthly"),disabled:!!y,children:[e.jsx("div",{className:"ob-plan-badge",children:"Most Popular"}),e.jsx("div",{className:"ob-plan-name",children:"Monthly"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"19.99"}),e.jsx("span",{className:"ob-plan-period",children:"/month"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âœ¨"})," 7-day free trial"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ”“"})," All features unlocked"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âŒ"})," Cancel anytime"]})]}),e.jsx("div",{className:"ob-plan-cta",children:y==="monthly"?"Loading...":"Start Free Trial"})]}),e.jsxs("button",{className:"ob-plan-card ob-plan-featured",onClick:()=>s("annual"),disabled:!!y,children:[e.jsx("div",{className:"ob-plan-badge",children:"Best Value â€” Save 17%"}),e.jsx("div",{className:"ob-plan-name",children:"Annual"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-currency",children:"Â£"}),e.jsx("span",{className:"ob-plan-amount",children:"199.99"}),e.jsx("span",{className:"ob-plan-period",children:"/year"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"âœ¨"})," 7-day free trial"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"ðŸ”“"})," All features unlocked"]}),e.jsxs("li",{children:[e.jsx("span",{className:"ob-plan-feat-icon",children:"â­"})," Best value"]})]}),e.jsx("div",{className:"ob-plan-cta ob-plan-cta-featured",children:y==="annual"?"Loading...":"Start Free Trial"})]})]}),V&&e.jsx("p",{className:"ob-error",children:V}),e.jsxs("button",{className:"ob-back-btn",onClick:()=>d(0),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]}),"Back"]})]})]})}if(c===2){const s=h&&v&&i.length>0&&m,t=()=>{be(),d(3)};return e.jsxs("div",{className:"ob-page",children:[e.jsx(T,{className:"ob-theme-toggle"}),e.jsxs("div",{className:`ob-content ${E}`,children:[e.jsx(W,{current:2}),e.jsx("h1",{className:"ob-title",children:"Let's Get To Know You"}),e.jsx("p",{className:"ob-subtitle",children:"Tell us a bit about yourself and where you're at with your fitness â€” we're in this together"}),e.jsxs("div",{className:"ob-form",children:[e.jsx("label",{className:"ob-label",children:"Date of Birth"}),e.jsx("input",{type:"date",className:"ob-input",value:h,onChange:a=>U(a.target.value),max:new Date().toISOString().split("T")[0]}),e.jsx("label",{className:"ob-label",children:"Sex"}),e.jsx("div",{className:"ob-chip-group",children:["Male","Female","Other","Prefer not to say"].map(a=>e.jsx("button",{className:`ob-chip${v===a?" active":""}`,onClick:()=>z(a),children:a},a))}),e.jsxs("label",{className:"ob-label",children:["What Are Your Fitness Goals? ",e.jsxs("span",{className:"ob-optional",children:["(pick up to ",A,")"]})]}),e.jsx("div",{className:"ob-chip-group",children:Re.map(a=>e.jsx("button",{className:`ob-chip${i.includes(a)?" active":""}${!i.includes(a)&&i.length>=A?" disabled":""}`,onClick:()=>xe(a),disabled:!i.includes(a)&&i.length>=A,children:a},a))}),e.jsx("label",{className:"ob-label",children:"Where Are You At Right Now?"}),e.jsx("div",{className:"ob-level-group",children:qe.map(a=>e.jsxs("button",{className:`ob-level-card${m===a.key?" active":""}`,onClick:()=>K(a.key),children:[e.jsx("strong",{children:a.label}),e.jsx("span",{children:a.desc})]},a.key))}),e.jsxs("label",{className:"ob-label",children:["Any Injuries or Conditions We Should Know About? ",e.jsx("span",{className:"ob-optional",children:"(optional)"})]}),e.jsx("textarea",{className:"ob-textarea",placeholder:"E.g. bad knee, lower back pain, asthma...",value:P,onChange:a=>Q(a.target.value),rows:3,maxLength:500})]}),e.jsx("button",{className:"ob-primary-btn",disabled:!s,onClick:t,children:"Continue"}),e.jsxs("button",{className:"ob-back-btn",onClick:()=>d(1),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]}),"Back"]})]})]})}const te=g.every(s=>s!==null)&&D&&R,je=async()=>{if(!(!te||_)){G(!0),I(null);try{const s=await ie();if(!s){I("Could not find your account. Please try logging out and back in."),G(!1);return}const t=b.current.toDataURL("image/png");await oe(S(C,"onboardingSubmissions",s.id),{clientId:s.id,clientName:s.name,email:s.email,selectedPlan:s.tier||"free",welcome:{dob:h,gender:v||null,goals:i,experience:m,injuries:P.trim()||null},parq:{questions:$,answers:g,hasYes:g.includes(!0),declaration:!0,signature:t},submittedAt:ne()}),await Se(S(C,"clients",s.id),{onboardingComplete:!0,fitnessGoal:i[0],fitnessGoals:i,experienceLevel:m,dob:h||null});try{const{deleteDoc:r}=await Ce(async()=>{const{deleteDoc:k}=await import("./stripe-DjYhJFjB.js").then(ye=>ye.i);return{deleteDoc:k}},__vite__mapDeps([0,1,2]));await r(S(C,"onboardingDrafts",s.id))}catch{}const a={onboardingComplete:!0,fitnessGoal:i[0],fitnessGoals:i,experienceLevel:m,dob:h};F&&(a.tier="premium",a.subscriptionStatus="trialing"),re(a),x("/client/core-buddy")}catch(s){console.error("Onboarding submit error:",s),I("Failed to save â€” please try again."+(s.code?` (${s.code})`:""))}finally{G(!1)}}};return e.jsxs("div",{className:"ob-page",children:[e.jsx(T,{className:"ob-theme-toggle"}),e.jsxs("div",{className:`ob-content ${E}`,children:[e.jsx(W,{current:3}),e.jsx("h1",{className:"ob-title",children:"Health Questionnaire"}),e.jsx("p",{className:"ob-subtitle",children:"PAR-Q â€” please answer honestly for your safety"}),e.jsx("div",{className:"ob-parq",children:$.map((s,t)=>e.jsxs("div",{className:"ob-parq-item",children:[e.jsx("p",{className:"ob-parq-question",children:s}),e.jsxs("div",{className:"ob-parq-btns",children:[e.jsx("button",{className:`ob-parq-btn${g[t]===!0?" yes":""}`,onClick:()=>X(a=>a.map((r,k)=>k===t?!0:r)),children:"Yes"}),e.jsx("button",{className:`ob-parq-btn${g[t]===!1?" no":""}`,onClick:()=>X(a=>a.map((r,k)=>k===t?!1:r)),children:"No"})]})]},t))}),g.includes(!0)&&e.jsx("div",{className:"ob-parq-warning",children:"You answered YES to one or more questions. We recommend consulting your doctor before starting an exercise programme."}),e.jsxs("label",{className:"ob-declare-label",onClick:()=>me(!D),children:[e.jsx("span",{className:`ob-declare-box${D?" checked":""}`,children:D&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})})}),e.jsx("span",{className:"ob-declare-text",children:"I confirm that I have read and answered each question honestly. I understand that if my health changes I should inform my trainer. I take full responsibility for my participation in physical activity."})]}),e.jsxs("div",{className:"ob-sig-section",children:[e.jsxs("div",{className:"ob-sig-header",children:[e.jsx("label",{className:"ob-label",style:{margin:0},children:"Signature"}),R&&e.jsx("button",{type:"button",className:"ob-sig-clear",onClick:pe,children:"Clear"})]}),e.jsx("canvas",{ref:b,className:"ob-sig-canvas",onMouseDown:se,onMouseMove:ae,onMouseUp:B,onMouseLeave:B,onTouchStart:se,onTouchMove:ae,onTouchEnd:B}),!R&&e.jsx("p",{className:"ob-sig-hint",children:"Draw your signature above"})]}),Z&&e.jsx("p",{className:"ob-error",children:Z}),e.jsx("button",{className:"ob-primary-btn",disabled:!te||_,onClick:je,children:_?"Saving...":"Complete Setup"}),e.jsxs("button",{className:"ob-back-btn",onClick:()=>d(2),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]}),"Back"]})]})]})}export{Oe as default};
