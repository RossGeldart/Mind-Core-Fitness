import{r as i,k as we,l as Ne,m as ye,g as S,q as I,c as B,d as v,w as b,T as ee,j as e,C as se,u as te,e as ae}from"./index-BCPRZzeW.js";function ne(){const t=new Date,r=t.getDay(),l=r===0?-6:1-r,h=new Date(t);h.setDate(t.getDate()+l),h.setHours(0,0,0,0);const c=new Date(h);return c.setDate(h.getDate()+6),c.setHours(23,59,59,999),{start:h,end:c}}function Ce(){const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1);r.setHours(0,0,0,0);const l=new Date(t.getFullYear(),t.getMonth()+1,0);return l.setHours(23,59,59,999),{start:r,end:l}}function U(t){return t.toISOString().split("T")[0]}function R(t){if(!t)return"?";const r=t.trim().split(/\s+/);return r.length===1?r[0][0].toUpperCase():(r[0][0]+r[r.length-1][0]).toUpperCase()}function De(t){if(t<60)return`${t}m`;const r=Math.floor(t/60),l=t%60;return l>0?`${r}h ${l}m`:`${r}h`}function Me(t){const r=new Date(t),l=r.getDay(),h=l===0?-6:1-l;return r.setDate(r.getDate()+h),r.setHours(0,0,0,0),r}function Le(t){if(t.size===0)return 0;const l=Me(new Date);let h=0,c=new Date(l);const f=new Date(c);f.setDate(f.getDate()+6);let C=!1;t.forEach(x=>{const j=new Date(x);j>=c&&j<=f&&(C=!0)}),C||c.setDate(c.getDate()-7);for(let x=0;x<52;x++){const j=new Date(c),w=new Date(c);w.setDate(w.getDate()+6);let N=!1;if(t.forEach(D=>{const H=new Date(D);H>=j&&H<=w&&(N=!0)}),N)h++,c.setDate(c.getDate()-7);else break}return h}const oe=[{key:"workouts",label:"Workouts",icon:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2.71 7 4.14 8.43 7.71 4.86 16.29 13.43 12.71 17 14.14 18.43 15.57 17 17 18.43 14.14 21.29l1.43 1.43 1.43-1.43 1.43 1.43 2.14-2.14 1.43 1.43L22 20.57z"},{key:"minutes",label:"Minutes",icon:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"},{key:"streak",label:"Streak",icon:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"}],q=["#FFD700","#A8B4C0","#CD7F32"];function Ie(){const[t,r]=i.useState("workouts"),[l,h]=i.useState("week"),[c,f]=i.useState(!0),[C,x]=i.useState([]),[j,w]=i.useState(null),[N,D]=i.useState(!1),[H,O]=i.useState(!1),[E,Z]=i.useState(null),[z,re]=i.useState(!1),[K,le]=i.useState(new Set),{currentUser:V,isClient:Y,clientData:d,updateClientData:_,loading:G}=we(),{isDark:P,toggleTheme:ie}=Ne(),k=ye(),T=i.useCallback((s,m="info")=>{Z({message:s,type:m}),setTimeout(()=>Z(null),4e3)},[]);i.useEffect(()=>{!G&&(!V||!Y)&&k("/")},[V,Y,G,k]),i.useEffect(()=>{d&&w(d.leaderboardOptIn===!0)},[d]),i.useEffect(()=>{d&&(async()=>{try{const s=d.id,m=await S(I(B(v,"buddies"),b("user1","==",s))),y=await S(I(B(v,"buddies"),b("user2","==",s))),p=new Set;[...m.docs,...y.docs].forEach(A=>{const L=A.data();p.add(L.user1===s?L.user2:L.user1)}),le(p)}catch(s){console.error("Error fetching buddies:",s)}})()},[d]),i.useEffect(()=>{!d||!j||he()},[d,j,t,l]);const ce=async()=>{D(!0);try{await te(ae(v,"clients",d.id),{leaderboardOptIn:!0}),_({leaderboardOptIn:!0}),w(!0),T("You're on the leaderboard!","success")}catch(s){console.error("Error opting in:",s),T("Failed to join. Try again.","error")}finally{D(!1)}},de=async()=>{D(!0),O(!1);try{await te(ae(v,"clients",d.id),{leaderboardOptIn:!1}),_({leaderboardOptIn:!1}),w(!1),x([]),T("You've left the leaderboard","info")}catch(s){console.error("Error opting out:",s),T("Failed to leave. Try again.","error")}finally{D(!1)}},he=async()=>{f(!0);try{const s=I(B(v,"clients"),b("leaderboardOptIn","==",!0)),y=(await S(s)).docs.map(n=>({id:n.id,...n.data()}));if(y.length===0){x([]),f(!1);return}let p;if(t==="streak"){const n=new Date,a=new Date(n);a.setDate(a.getDate()-365),a.setHours(0,0,0,0),p={start:a,end:n}}else p=l==="week"?ne():Ce();const A=U(p.start),L=U(p.end),me=ee.fromDate(p.start),pe=ee.fromDate(p.end),be=I(B(v,"workoutLogs"),b("completedAt",">=",me),b("completedAt","<=",pe)),xe=await S(be),je=I(B(v,"circuitSessions"),b("date",">=",A),b("date","<=",L)),ke=await S(je),ge=I(B(v,"sessions"),b("date",">=",A),b("date","<=",L)),ve=await S(ge),J=new Set(y.map(n=>n.id)),u={};y.forEach(n=>{u[n.id]={id:n.id,name:n.name,photoURL:n.photoURL||null,workouts:0,minutes:0,workoutDates:new Set}}),xe.docs.forEach(n=>{const a=n.data();if(J.has(a.clientId)&&(u[a.clientId].workouts++,u[a.clientId].minutes+=a.duration||0,a.completedAt)){const g=a.completedAt.toDate();u[a.clientId].workoutDates.add(U(g))}}),ke.docs.forEach(n=>{const a=n.data();(a.slots||[]).forEach(g=>{g.attended&&g.memberId&&J.has(g.memberId)&&(u[g.memberId].workouts++,u[g.memberId].minutes+=45,u[g.memberId].workoutDates.add(a.date))})});const fe=U(new Date);ve.docs.forEach(n=>{const a=n.data();J.has(a.clientId)&&a.date<=fe&&(u[a.clientId].workouts++,u[a.clientId].minutes+=a.duration||45,u[a.clientId].workoutDates.add(a.date))}),t==="streak"&&Object.values(u).forEach(n=>{n.streak=Le(n.workoutDates)});let $=Object.values(u);t==="workouts"?$.sort((n,a)=>a.workouts-n.workouts||n.name.localeCompare(a.name)):t==="minutes"?$.sort((n,a)=>a.minutes-n.minutes||n.name.localeCompare(a.name)):$.sort((n,a)=>a.streak-n.streak||n.name.localeCompare(a.name)),$.forEach((n,a)=>{n.rank=a+1}),x($)}catch(s){console.error("Error fetching leaderboard:",s),T("Failed to load leaderboard","error")}finally{f(!1)}},W=s=>t==="workouts"?s.workouts:t==="minutes"?De(s.minutes):s.streak,ue=()=>{if(t==="streak")return"All Time";if(l==="week"){const{start:m,end:y}=ne();return`${m.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${y.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return new Date().toLocaleDateString("en-GB",{month:"long",year:"numeric"})},Q=z?C.filter(s=>K.has(s.id)||s.id===d?.id).map((s,m)=>({...s,rank:m+1})):C,o=Q.slice(0,3),X=Q.slice(3),M=s=>s.id===d?.id,F=Q.find(s=>s.id===d?.id);return G?e.jsx("div",{className:"lb-loading",children:e.jsx("div",{className:"lb-loading-spinner"})}):!V||!Y||!d?null:j===!1?e.jsxs("div",{className:"lb-page","data-theme":P?"dark":"light",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>k("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:ie,"aria-label":"Toggle theme",children:P?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),e.jsx("main",{className:"lb-optin-main",children:e.jsxs("div",{className:"lb-optin-card",children:[e.jsx("div",{className:"lb-optin-trophy",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]})}),e.jsx("h2",{className:"lb-optin-title",children:"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-desc",children:"Compete with other Mind Core Fitness members"}),e.jsx("div",{className:"lb-optin-categories",children:oe.map(s=>e.jsxs("div",{className:"lb-optin-category",children:[e.jsx("div",{className:"lb-optin-category-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})})}),e.jsxs("div",{className:"lb-optin-category-text",children:[e.jsx("span",{className:"lb-optin-category-name",children:s.label}),e.jsxs("span",{className:"lb-optin-category-desc",children:[s.key==="workouts"&&"Total workouts from all training types",s.key==="minutes"&&"Total active minutes across all sessions",s.key==="streak"&&"Consecutive weeks with at least one workout"]})]})]},s.key))}),e.jsx("button",{className:"lb-optin-btn",onClick:ce,disabled:N,children:N?"Joining...":"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-note",children:"Your full name will be visible to other members"})]})}),e.jsx(se,{})]}):e.jsxs("div",{className:"lb-page","data-theme":P?"dark":"light",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>k("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:()=>O(!0),"aria-label":"Settings",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]})}),e.jsxs("main",{className:"lb-main",children:[e.jsx("div",{className:"lb-tabs",children:oe.map(s=>e.jsxs("button",{className:`lb-tab ${t===s.key?"lb-tab-active":""}`,onClick:()=>r(s.key),children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})}),e.jsx("span",{children:s.label})]},s.key))}),t!=="streak"&&e.jsx("div",{className:"lb-period-row",children:e.jsxs("div",{className:"lb-period-toggle",children:[e.jsx("button",{className:`lb-period-btn ${l==="week"?"lb-period-active":""}`,onClick:()=>h("week"),children:"This Week"}),e.jsx("button",{className:`lb-period-btn ${l==="month"?"lb-period-active":""}`,onClick:()=>h("month"),children:"This Month"})]})}),K.size>0&&e.jsx("div",{className:"lb-buddy-filter-row",children:e.jsxs("button",{className:`lb-buddy-filter${z?" active":""}`,onClick:()=>re(!z),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Buddies Only"})]})}),e.jsx("div",{className:"lb-period-label",children:ue()}),c?e.jsx("div",{className:"lb-content-loading",children:e.jsx("div",{className:"lb-loading-spinner"})}):C.length===0?e.jsxs("div",{className:"lb-empty",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"lb-empty-icon",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]}),e.jsx("h3",{children:"No one here yet"}),e.jsx("p",{children:"Be the first to get a workout in!"})]}):e.jsxs(e.Fragment,{children:[o.length>0&&e.jsxs("div",{className:"lb-podium",children:[e.jsx("div",{className:"lb-podium-place lb-podium-2nd",onClick:()=>o[1]&&k(`/client/core-buddy/profile/${o[1].id}`),role:o[1]?"button":void 0,children:o[1]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${M(o[1])?"lb-avatar-you":""}`,style:{borderColor:q[1]},children:o[1].photoURL?e.jsx("img",{src:o[1].photoURL,alt:"",className:"lb-avatar-img"}):R(o[1].name)}),e.jsx("div",{className:"lb-podium-name",children:o[1].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:W(o[1])}),e.jsx("div",{className:"lb-podium-bar lb-bar-2nd",children:e.jsx("span",{className:"lb-podium-rank",children:"2"})})]}):e.jsx("div",{className:"lb-podium-spacer"})}),e.jsxs("div",{className:"lb-podium-place lb-podium-1st",onClick:()=>k(`/client/core-buddy/profile/${o[0].id}`),role:"button",children:[e.jsx("div",{className:"lb-podium-crown",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"#FFD700",stroke:"none",children:[e.jsx("path",{d:"M2.5 18.5l3-7 4 4 3-9 3 9 4-4 3 7z"}),e.jsx("rect",{x:"3",y:"18",width:"18",height:"2",rx:"1"})]})}),e.jsx("div",{className:`lb-podium-avatar lb-avatar-1st ${M(o[0])?"lb-avatar-you":""}`,style:{borderColor:q[0]},children:o[0].photoURL?e.jsx("img",{src:o[0].photoURL,alt:"",className:"lb-avatar-img"}):R(o[0].name)}),e.jsx("div",{className:"lb-podium-name",children:o[0].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:W(o[0])}),e.jsx("div",{className:"lb-podium-bar lb-bar-1st",children:e.jsx("span",{className:"lb-podium-rank",children:"1"})})]}),e.jsx("div",{className:"lb-podium-place lb-podium-3rd",onClick:()=>o[2]&&k(`/client/core-buddy/profile/${o[2].id}`),role:o[2]?"button":void 0,children:o[2]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${M(o[2])?"lb-avatar-you":""}`,style:{borderColor:q[2]},children:o[2].photoURL?e.jsx("img",{src:o[2].photoURL,alt:"",className:"lb-avatar-img"}):R(o[2].name)}),e.jsx("div",{className:"lb-podium-name",children:o[2].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:W(o[2])}),e.jsx("div",{className:"lb-podium-bar lb-bar-3rd",children:e.jsx("span",{className:"lb-podium-rank",children:"3"})})]}):e.jsx("div",{className:"lb-podium-spacer"})})]}),X.length>0&&e.jsx("div",{className:"lb-rankings",children:X.map((s,m)=>e.jsxs("div",{className:`lb-rank-item ${M(s)?"lb-rank-you":""}`,style:{animationDelay:`${m*.04}s`},onClick:()=>k(`/client/core-buddy/profile/${s.id}`),role:"button",children:[e.jsx("span",{className:"lb-rank-number",children:s.rank}),e.jsx("div",{className:`lb-rank-avatar ${M(s)?"lb-avatar-you":""}`,children:s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"lb-avatar-img"}):R(s.name)}),e.jsx("div",{className:"lb-rank-info",children:e.jsxs("span",{className:"lb-rank-name",children:[s.name,M(s)&&e.jsx("span",{className:"lb-you-badge",children:"You"})]})}),e.jsx("span",{className:"lb-rank-stat",children:W(s)})]},s.id))}),F&&F.rank>5&&e.jsxs("div",{className:"lb-your-position",children:[e.jsxs("span",{className:"lb-your-rank",children:["#",F.rank]}),e.jsx("span",{className:"lb-your-label",children:"Your Position"}),e.jsx("span",{className:"lb-your-stat",children:W(F)})]})]})]}),H&&e.jsx("div",{className:"lb-modal-overlay",onClick:()=>O(!1),children:e.jsxs("div",{className:"lb-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"Leave the Leaderboard?"}),e.jsx("p",{children:"Your name will no longer appear to other members. You can rejoin anytime."}),e.jsxs("div",{className:"lb-modal-actions",children:[e.jsx("button",{className:"lb-modal-cancel",onClick:()=>O(!1),children:"Stay"}),e.jsx("button",{className:"lb-modal-confirm",onClick:de,disabled:N,children:N?"Leaving...":"Leave"})]})]})}),e.jsx(se,{}),E&&e.jsxs("div",{className:`toast-notification ${E.type}`,children:[e.jsx("span",{className:"toast-icon",children:E.type==="success"?e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 13 L9 17 L19 7"})}):E.type==="error"?e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",children:[e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"}),e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"})]}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("circle",{cx:"12",cy:"16",r:"1",fill:"currentColor"})]})}),e.jsx("span",{className:"toast-message",children:E.message})]})]})}export{Ie as default};
