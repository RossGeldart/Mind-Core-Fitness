import{l as oe,n as re,v as ie,r as n,j as e,k as le,e as I,d as y,q as ce,c as de,w as ue,g as he,i as me,x as pe,u as be}from"./index-YQse9f5_.js";import{S as xe}from"./stripe-7qEIN5w7.js";const L=[{title:"Randomiser Workouts",desc:"Quick, effective workouts generated for you. Choose your focus, level, and time — we handle the rest.",icon:"M1 9h2v6H1V9zm3-2h2v10H4V7zm3 4h10v2H7v-2zm10-4h2v10h-2V7zm3 2h2v6h-2V9z",color:"#FF6B35"},{title:"Nutrition Tracking",desc:"Track macros, scan barcodes, log meals and water intake to hit your daily targets.",icon:"M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z",color:"#14b8a6",stroke:!0},{title:"Structured Programmes",desc:"Follow 4, 8, or 12-week programmes designed by professionals. Full body, core, upper, and lower splits.",icon:"M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2",color:"#8B5CF6",stroke:!0},{title:"Buddies & Social",desc:"Connect with other members, share your journey, like and comment on posts.",icon:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75",color:"#38B6FF",stroke:!0},{title:"Achievements & PBs",desc:"Track personal bests, earn badges, and celebrate every milestone on your fitness journey.",icon:"M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z",color:"#eab308",stroke:!0},{title:"Leaderboard",desc:"Compete with your Core Buddies. Opt in, climb the ranks, and stay motivated together.",icon:"M8 21v-4M16 21v-2M12 21V11M3 7l9-4 9 4M4 10v6l8 4 8-4v-6",color:"#e74c3c",stroke:!0}],q=["Has your doctor ever said that you have a heart condition and that you should only do physical activity recommended by a doctor?","Do you feel pain in your chest when you do physical activity?","In the past month, have you had chest pain when you were not doing physical activity?","Do you lose your balance because of dizziness or do you ever lose consciousness?","Do you have a bone or joint problem (e.g. back, knee, or hip) that could be made worse by a change in your physical activity?","Is your doctor currently prescribing drugs (e.g. water pills) for your blood pressure or heart condition?","Do you know of any other reason why you should not do physical activity?"],ge=["Lose weight","Build muscle","Improve fitness","Get stronger","Stay active","Sport performance"],ve=[{key:"beginner",label:"Beginner",desc:"New to exercise or returning after a long break"},{key:"intermediate",label:"Intermediate",desc:"Training regularly for 6+ months"},{key:"advanced",label:"Advanced",desc:"Training consistently for 2+ years"}];function Ne(){const{currentUser:l,clientData:r,updateClientData:N,loading:h}=oe(),m=re(),[W]=ie(),Y=r?.tier==="premium"||!!r?.stripeSubscriptionId,D=W.get("checkout")==="success",[d,v]=n.useState(Y||D?2:0),[U,_]=n.useState(0),k=n.useRef(null),[$,Q]=n.useState(null),[p,T]=n.useState(null),[R,j]=n.useState(null),[b,X]=n.useState(""),[A,J]=n.useState(""),[x,K]=n.useState(""),[g,Z]=n.useState(""),[F,ee]=n.useState(""),[u,B]=n.useState(q.map(()=>null)),[f,se]=n.useState(!1),[S,w]=n.useState(!1),c=n.useRef(null),C=n.useRef(!1),[E,z]=n.useState(!1);n.useEffect(()=>{const s=c.current;if(!s)return;const a=()=>{const t=s.getBoundingClientRect();(s.width!==t.width||s.height!==t.height)&&(s.width=t.width,s.height=t.height)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[d]);const H=s=>{const t=c.current.getBoundingClientRect(),o=s.touches?s.touches[0]:s;return{x:o.clientX-t.left,y:o.clientY-t.top}},V=s=>{s.preventDefault();const t=c.current.getContext("2d"),o=H(s);t.beginPath(),t.moveTo(o.x,o.y),C.current=!0},G=s=>{if(!C.current)return;s.preventDefault();const a=c.current.getContext("2d"),t=H(s);a.lineTo(t.x,t.y),a.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim()||"#fff",a.lineWidth=2,a.lineCap="round",a.stroke(),z(!0)},M=()=>{C.current=!1},ae=()=>{const s=c.current;s.getContext("2d").clearRect(0,0,s.width,s.height),z(!1)};if(n.useEffect(()=>{!h&&r?.onboardingComplete&&m("/client/core-buddy")},[h,r,m]),n.useEffect(()=>{(r?.tier==="premium"||r?.stripeSubscriptionId)&&d<2&&v(2)},[r?.tier,r?.stripeSubscriptionId,d]),n.useEffect(()=>{!h&&!l&&m("/")},[h,l,m]),h)return e.jsx("div",{className:"ob-page",children:e.jsx("div",{className:"ob-content",style:{justifyContent:"center",minHeight:"60dvh"},children:e.jsx("div",{className:"ob-loading-spinner"})})});const te=()=>{if(!k.current)return;const s=k.current,a=s.firstChild?.offsetWidth||1,o=Math.round(s.scrollLeft/(a+12));_(Math.min(o,L.length-1))};if(d===0)return e.jsx("div",{className:"ob-page",children:e.jsxs("div",{className:"ob-content",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"ob-logo",width:"60",height:"60"}),e.jsx("h1",{className:"ob-title",children:"Welcome to Core Buddy"}),e.jsx("p",{className:"ob-subtitle",children:"Your all-in-one fitness companion"}),e.jsxs("div",{className:"ob-carousel-wrap",children:[e.jsx("div",{className:"ob-carousel",ref:k,onScroll:te,children:L.map((s,a)=>e.jsxs("div",{className:"ob-feature-card",style:{"--accent":s.color},children:[e.jsx("div",{className:"ob-feature-icon",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:s.stroke?"none":"currentColor",stroke:s.stroke?"currentColor":"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:s.icon})})}),e.jsx("h3",{children:s.title}),e.jsx("p",{children:s.desc})]},a))}),e.jsx("div",{className:"ob-dots",children:L.map((s,a)=>e.jsx("span",{className:`ob-dot${U===a?" active":""}`},a))})]}),e.jsx("button",{className:"ob-primary-btn",onClick:()=>v(1),children:"Get Started"})]})});if(d===1){const s=async a=>{if(a==="free"){Q("free"),v(2);return}if(!r?.id||!l?.uid||!l?.email){j("Account is still loading — please wait a moment and try again.");return}T(a),j(null);try{const o=await(await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:xe[a],clientId:r?.id,uid:l?.uid,email:l?.email})})).json();if(o.url){try{localStorage.setItem("mcf_clientId",r.id)}catch{}window.location.href=o.url}else j(o.error||"Something went wrong")}catch(t){console.error("Checkout error:",t),j("Unable to start checkout")}finally{T(null)}};return e.jsx("div",{className:"ob-page",children:e.jsxs("div",{className:"ob-content",children:[e.jsx("div",{className:"ob-step-indicator",children:e.jsx("span",{className:"ob-step-num",children:"1 of 3"})}),e.jsx("h1",{className:"ob-title",children:"Choose Your Plan"}),e.jsx("p",{className:"ob-subtitle",children:"Start free or unlock everything with Premium"}),e.jsxs("div",{className:"ob-plans",children:[e.jsxs("button",{className:"ob-plan-card",onClick:()=>s("free"),disabled:!!p,children:[e.jsx("div",{className:"ob-plan-name",children:"Free"}),e.jsx("div",{className:"ob-plan-price",children:e.jsx("span",{className:"ob-plan-amount",children:"£0"})}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsx("li",{children:"Randomiser workouts (5 & 10 min)"}),e.jsx("li",{children:"1 workout per week"}),e.jsx("li",{children:"Basic dashboard"})]}),e.jsx("div",{className:"ob-plan-cta-outline",children:"Continue Free"})]}),e.jsxs("button",{className:"ob-plan-card",onClick:()=>s("monthly"),disabled:!!p,children:[e.jsx("div",{className:"ob-plan-name",children:"Monthly"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-amount",children:"£19.99"}),e.jsx("span",{className:"ob-plan-period",children:"/month"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsx("li",{children:"7-day free trial"}),e.jsx("li",{children:"All features unlocked"}),e.jsx("li",{children:"Cancel anytime"})]}),e.jsx("div",{className:"ob-plan-cta",children:p==="monthly"?"Loading...":"Start Free Trial"})]}),e.jsxs("button",{className:"ob-plan-card ob-plan-featured",onClick:()=>s("annual"),disabled:!!p,children:[e.jsx("div",{className:"ob-plan-save",children:"Save 17%"}),e.jsx("div",{className:"ob-plan-name",children:"Annual"}),e.jsxs("div",{className:"ob-plan-price",children:[e.jsx("span",{className:"ob-plan-amount",children:"£199.99"}),e.jsx("span",{className:"ob-plan-period",children:"/year"})]}),e.jsxs("ul",{className:"ob-plan-features",children:[e.jsx("li",{children:"7-day free trial"}),e.jsx("li",{children:"All features unlocked"}),e.jsx("li",{children:"Best value"})]}),e.jsx("div",{className:"ob-plan-cta ob-plan-cta-featured",children:p==="annual"?"Loading...":"Start Free Trial"})]})]}),R&&e.jsx("p",{className:"ob-error",children:R})]})})}if(d===2){const s=b&&x&&g;return e.jsx("div",{className:"ob-page",children:e.jsxs("div",{className:"ob-content",children:[e.jsx("div",{className:"ob-step-indicator",children:e.jsx("span",{className:"ob-step-num",children:"2 of 3"})}),e.jsx("h1",{className:"ob-title",children:"About You"}),e.jsx("p",{className:"ob-subtitle",children:"Help us personalise your experience"}),e.jsxs("div",{className:"ob-form",children:[e.jsx("label",{className:"ob-label",children:"Date of Birth"}),e.jsx("input",{type:"date",className:"ob-input",value:b,onChange:a=>X(a.target.value),max:new Date().toISOString().split("T")[0]}),e.jsxs("label",{className:"ob-label",children:["Gender ",e.jsx("span",{className:"ob-optional",children:"(optional)"})]}),e.jsx("div",{className:"ob-chip-group",children:["Male","Female","Other","Prefer not to say"].map(a=>e.jsx("button",{className:`ob-chip${A===a?" active":""}`,onClick:()=>J(a),children:a},a))}),e.jsx("label",{className:"ob-label",children:"Primary Fitness Goal"}),e.jsx("div",{className:"ob-chip-group",children:ge.map(a=>e.jsx("button",{className:`ob-chip${x===a?" active":""}`,onClick:()=>K(a),children:a},a))}),e.jsx("label",{className:"ob-label",children:"Experience Level"}),e.jsx("div",{className:"ob-level-group",children:ve.map(a=>e.jsxs("button",{className:`ob-level-card${g===a.key?" active":""}`,onClick:()=>Z(a.key),children:[e.jsx("strong",{children:a.label}),e.jsx("span",{children:a.desc})]},a.key))}),e.jsxs("label",{className:"ob-label",children:["Injuries or Conditions ",e.jsx("span",{className:"ob-optional",children:"(optional)"})]}),e.jsx("textarea",{className:"ob-textarea",placeholder:"E.g. bad knee, lower back pain, asthma...",value:F,onChange:a=>ee(a.target.value),rows:3,maxLength:500})]}),e.jsx("button",{className:"ob-primary-btn",disabled:!s,onClick:()=>v(3),children:"Continue"})]})})}const O=u.every(s=>s!==null)&&f&&E,ne=async()=>{if(!(!O||S)){w(!0);try{let s=r;if(!s){const o=localStorage.getItem("mcf_clientId");if(o)try{const i=await le(I(y,"clients",o));i.exists()&&(s={id:i.id,...i.data()},N(s))}catch(i){console.error("Direct client read failed:",i)}if(!s&&l){const i=ce(de(y,"clients"),ue("uid","==",l.uid)),P=await he(i);P.empty||(s={id:P.docs[0].id,...P.docs[0].data()},N(s))}if(!s){alert("Could not find your account. Please try logging out and back in."),w(!1);return}}const a=c.current.toDataURL("image/png");await me(I(y,"onboardingSubmissions",s.id),{clientId:s.id,clientName:s.name,email:s.email,selectedPlan:$||"free",welcome:{dob:b,gender:A||null,goal:x,experience:g,injuries:F.trim()||null},parq:{questions:q,answers:u,hasYes:u.includes(!0),declaration:!0,signature:a},submittedAt:pe()}),await be(I(y,"clients",s.id),{onboardingComplete:!0,fitnessGoal:x,experienceLevel:g,dob:b||null});const t={onboardingComplete:!0,fitnessGoal:x,experienceLevel:g,dob:b};D&&(t.tier="premium",t.subscriptionStatus="trialing"),N(t),m("/client/core-buddy")}catch(s){console.error("Onboarding submit error:",s),alert(`Failed to save — please try again.
`+(s.code||s.message||""))}finally{w(!1)}}};return e.jsx("div",{className:"ob-page",children:e.jsxs("div",{className:"ob-content",children:[e.jsx("div",{className:"ob-step-indicator",children:e.jsx("span",{className:"ob-step-num",children:"3 of 3"})}),e.jsx("h1",{className:"ob-title",children:"Health Questionnaire"}),e.jsx("p",{className:"ob-subtitle",children:"PAR-Q — please answer honestly for your safety"}),e.jsx("div",{className:"ob-parq",children:q.map((s,a)=>e.jsxs("div",{className:"ob-parq-item",children:[e.jsx("p",{className:"ob-parq-question",children:s}),e.jsxs("div",{className:"ob-parq-btns",children:[e.jsx("button",{className:`ob-parq-btn${u[a]===!0?" yes":""}`,onClick:()=>B(t=>t.map((o,i)=>i===a?!0:o)),children:"Yes"}),e.jsx("button",{className:`ob-parq-btn${u[a]===!1?" no":""}`,onClick:()=>B(t=>t.map((o,i)=>i===a?!1:o)),children:"No"})]})]},a))}),u.includes(!0)&&e.jsx("div",{className:"ob-parq-warning",children:"You answered YES to one or more questions. We recommend consulting your doctor before starting an exercise programme."}),e.jsxs("label",{className:"ob-declare-label",onClick:()=>se(!f),children:[e.jsx("span",{className:`ob-declare-box${f?" checked":""}`,children:f&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})})}),e.jsx("span",{className:"ob-declare-text",children:"I confirm that I have read and answered each question honestly. I understand that if my health changes I should inform my trainer. I take full responsibility for my participation in physical activity."})]}),e.jsxs("div",{className:"ob-sig-section",children:[e.jsxs("div",{className:"ob-sig-header",children:[e.jsx("label",{className:"ob-label",style:{margin:0},children:"Signature"}),E&&e.jsx("button",{type:"button",className:"ob-sig-clear",onClick:ae,children:"Clear"})]}),e.jsx("canvas",{ref:c,className:"ob-sig-canvas",onMouseDown:V,onMouseMove:G,onMouseUp:M,onMouseLeave:M,onTouchStart:V,onTouchMove:G,onTouchEnd:M}),!E&&e.jsx("p",{className:"ob-sig-hint",children:"Draw your signature above"})]}),e.jsx("button",{className:"ob-primary-btn",disabled:!O||S,onClick:ne,children:S?"Saving...":"Complete Setup"})]})})}export{Ne as default};
