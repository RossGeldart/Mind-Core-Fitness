import{r as c,l as we,m as Ne,n as ye,x as se,g as F,q as H,c as O,d as y,w as B,T as te,j as e,C as ae,P as Ce,B as De,u as ne,e as oe}from"./index-BezfUDBE.js";function re(){const t=new Date,o=t.getDay(),r=o===0?-6:1-o,d=new Date(t);d.setDate(t.getDate()+r),d.setHours(0,0,0,0);const h=new Date(d);return h.setDate(d.getDate()+6),h.setHours(23,59,59,999),{start:d,end:h}}function Me(){const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),1);o.setHours(0,0,0,0);const r=new Date(t.getFullYear(),t.getMonth()+1,0);return r.setHours(23,59,59,999),{start:o,end:r}}function Le(){const t=new Date,o=new Date(t.getFullYear(),0,1);o.setHours(0,0,0,0);const r=new Date(t.getFullYear(),11,31);return r.setHours(23,59,59,999),{start:o,end:r}}function Se(t){return t.toISOString().split("T")[0]}function R(t){if(!t)return"?";const o=t.trim().split(/\s+/);return o.length===1?o[0][0].toUpperCase():(o[0][0]+o[o.length-1][0]).toUpperCase()}function Be(t){if(t<60)return`${t}m`;const o=Math.floor(t/60),r=t%60;return r>0?`${o}h ${r}m`:`${o}h`}function Te(t){const o=new Date(t),r=o.getDay(),d=r===0?-6:1-r;return o.setDate(o.getDate()+d),o.setHours(0,0,0,0),o}function Ee(t){if(t.size===0)return 0;const r=Te(new Date);let d=0,h=new Date(r);const x=new Date(h);x.setDate(x.getDate()+6);let v=!1;t.forEach(m=>{const p=new Date(m);p>=h&&p<=x&&(v=!0)}),v||h.setDate(h.getDate()-7);for(let m=0;m<52;m++){const p=new Date(h),j=new Date(h);j.setDate(j.getDate()+6);let k=!1;if(t.forEach(w=>{const T=new Date(w);T>=p&&T<=j&&(k=!0)}),k)d++,h.setDate(h.getDate()-7);else break}return d}const le=[{key:"workouts",label:"Workouts",icon:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2.71 7 4.14 8.43 7.71 4.86 16.29 13.43 12.71 17 14.14 18.43 15.57 17 17 18.43 14.14 21.29l1.43 1.43 1.43-1.43 1.43 1.43 2.14-2.14 1.43 1.43L22 20.57z"},{key:"minutes",label:"Minutes",icon:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"},{key:"streak",label:"Streak",icon:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"}],q=["#FFD700","#A8B4C0","#CD7F32"],$e={workouts:"Total completed workouts across randomiser, muscle group and programme sessions",minutes:"Active minutes from randomiser workouts only",streak:"Consecutive weeks with at least one workout completed (Monâ€“Sun)"};function Ie(){const[t,o]=c.useState("workouts"),[r,d]=c.useState("week"),[h,x]=c.useState(!0),[v,m]=c.useState([]),[p,j]=c.useState(null),[k,w]=c.useState(!1),[T,E]=c.useState(!1),[C,Q]=c.useState(null),[U,ie]=c.useState(!1),[Z,ce]=c.useState(new Set),[$,K]=c.useState(!1),{currentUser:Y,isClient:V,clientData:i,updateClientData:X,loading:z}=we(),{isDark:de,toggleTheme:he}=Ne(),b=ye(),D=c.useCallback((s,u="info")=>{Q({message:s,type:u}),setTimeout(()=>Q(null),4e3)},[]);c.useEffect(()=>{!z&&(!Y||!V)&&b("/")},[Y,V,z,b]);const[ue,P]=c.useState(null);c.useEffect(()=>{i&&(j(i.leaderboardOptIn===!0),i.leaderboardOptIn===!0&&se("leaderboard_join",i).then(s=>{s&&P(s)}))},[i]),c.useEffect(()=>{i&&(async()=>{try{const s=i.id,u=await F(H(O(y,"buddies"),B("user1","==",s))),g=await F(H(O(y,"buddies"),B("user2","==",s))),f=new Set;[...u.docs,...g.docs].forEach(_=>{const L=_.data();f.add(L.user1===s?L.user2:L.user1)}),ce(f)}catch(s){console.error("Error fetching buddies:",s)}})()},[i]),c.useEffect(()=>{!i||!p||(K(!1),be())},[i,p,t,r]);const me=async()=>{w(!0);try{await ne(oe(y,"clients",i.id),{leaderboardOptIn:!0}),X({leaderboardOptIn:!0}),j(!0),D("You're on the leaderboard!","success");const s=await se("leaderboard_join",i);s&&P(s)}catch(s){console.error("Error opting in:",s),D("Failed to join. Try again.","error")}finally{w(!1)}},pe=async()=>{w(!0),E(!1);try{await ne(oe(y,"clients",i.id),{leaderboardOptIn:!1}),X({leaderboardOptIn:!1}),j(!1),m([]),D("You've left the leaderboard","info")}catch(s){console.error("Error opting out:",s),D("Failed to leave. Try again.","error")}finally{w(!1)}},be=async()=>{x(!0);try{const s=H(O(y,"clients"),B("leaderboardOptIn","==",!0)),g=(await F(s)).docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.clientType==="core_buddy"||a.coreBuddyAccess===!0);if(g.length===0){m([]),x(!1);return}let f;if(t==="streak"){const a=new Date,l=new Date(a);l.setDate(l.getDate()-365),l.setHours(0,0,0,0),f={start:l,end:a}}else f=r==="week"?re():r==="month"?Me():Le();const _=te.fromDate(f.start),L=te.fromDate(f.end),ke=H(O(y,"workoutLogs"),B("completedAt",">=",_),B("completedAt","<=",L)),ge=await F(ke),fe=new Set(g.map(a=>a.id)),W={};g.forEach(a=>{W[a.id]={id:a.id,name:a.name,photoURL:a.photoURL||null,workouts:0,minutes:0,workoutDates:new Set}}),ge.docs.forEach(a=>{const l=a.data();if(!fe.has(l.clientId))return;const J=W[l.clientId];if(J.workouts++,l.type||(J.minutes+=l.duration||0),l.completedAt){const ve=l.completedAt.toDate();J.workoutDates.add(Se(ve))}}),t==="streak"&&Object.values(W).forEach(a=>{a.streak=Ee(a.workoutDates)});let S=Object.values(W);t==="workouts"?S.sort((a,l)=>l.workouts-a.workouts||a.name.localeCompare(l.name)):t==="minutes"?S.sort((a,l)=>l.minutes-a.minutes||a.name.localeCompare(l.name)):S.sort((a,l)=>l.streak-a.streak||a.name.localeCompare(l.name)),S.forEach((a,l)=>{a.rank=l+1}),m(S)}catch(s){console.error("Error fetching leaderboard:",s),D("Failed to load leaderboard","error")}finally{x(!1)}},M=s=>t==="workouts"?s.workouts:t==="minutes"?Be(s.minutes):s.streak,xe=()=>{if(t==="streak")return"All Time";if(r==="week"){const{start:u,end:g}=re();return`${u.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${g.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return r==="year"?new Date().getFullYear().toString():new Date().toLocaleDateString("en-GB",{month:"long",year:"numeric"})},A=U?v.filter(s=>Z.has(s.id)||s.id===i?.id).map((s,u)=>({...s,rank:u+1})):v,n=A.slice(0,3),G=A.slice(3),ee=$?G:G.slice(0,7),je=G.length>7,N=s=>s.id===i?.id,I=A.find(s=>s.id===i?.id);return z?e.jsx("div",{className:"lb-loading",children:e.jsx("div",{className:"lb-loading-spinner"})}):!Y||!V||!i?null:p===!1?e.jsxs("div",{className:"lb-page",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>b("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:he,"aria-label":"Toggle theme",children:de?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),e.jsx("main",{className:"lb-optin-main",children:e.jsxs("div",{className:"lb-optin-card",children:[e.jsx("div",{className:"lb-optin-trophy",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]})}),e.jsx("h2",{className:"lb-optin-title",children:"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-desc",children:"Compete with other Mind Core Fitness members"}),e.jsx("div",{className:"lb-optin-categories",children:le.map(s=>e.jsxs("div",{className:"lb-optin-category",children:[e.jsx("div",{className:"lb-optin-category-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})})}),e.jsxs("div",{className:"lb-optin-category-text",children:[e.jsx("span",{className:"lb-optin-category-name",children:s.label}),e.jsxs("span",{className:"lb-optin-category-desc",children:[s.key==="workouts"&&"Randomiser, muscle group & programme workouts",s.key==="minutes"&&"Total minutes from randomiser workouts",s.key==="streak"&&"Consecutive weeks with at least one workout"]})]})]},s.key))}),e.jsx("button",{className:"lb-optin-btn",onClick:me,disabled:k,children:k?"Joining...":"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-note",children:"Your full name will be visible to other members"})]})}),e.jsx(ae,{})]}):e.jsx(Ce,{children:e.jsxs("div",{className:"lb-page",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>b("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:()=>E(!0),"aria-label":"Settings",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]})}),e.jsxs("main",{className:"lb-main",children:[e.jsx("div",{className:"lb-tabs",children:le.map(s=>e.jsxs("button",{className:`lb-tab ${t===s.key?"lb-tab-active":""}`,onClick:()=>o(s.key),children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})}),e.jsx("span",{children:s.label})]},s.key))}),e.jsx("div",{className:"lb-tab-desc",children:$e[t]}),t!=="streak"&&e.jsx("div",{className:"lb-period-row",children:e.jsxs("div",{className:"lb-period-toggle",children:[e.jsx("button",{className:`lb-period-btn ${r==="week"?"lb-period-active":""}`,onClick:()=>d("week"),children:"This Week"}),e.jsx("button",{className:`lb-period-btn ${r==="month"?"lb-period-active":""}`,onClick:()=>d("month"),children:"This Month"}),e.jsx("button",{className:`lb-period-btn ${r==="year"?"lb-period-active":""}`,onClick:()=>d("year"),children:"This Year"})]})}),Z.size>0&&e.jsx("div",{className:"lb-buddy-filter-row",children:e.jsxs("button",{className:`lb-buddy-filter${U?" active":""}`,onClick:()=>ie(!U),children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Buddies Only"})]})}),e.jsx("div",{className:"lb-period-label",children:xe()}),h?e.jsx("div",{className:"lb-content-loading",children:e.jsx("div",{className:"lb-loading-spinner"})}):v.length===0?e.jsxs("div",{className:"lb-empty",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"lb-empty-icon",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]}),e.jsx("h3",{children:"No one here yet"}),e.jsx("p",{children:"Be the first to get a workout in!"})]}):e.jsxs(e.Fragment,{children:[n.length>0&&e.jsxs("div",{className:"lb-podium",children:[e.jsx("div",{className:"lb-podium-place lb-podium-2nd",onClick:()=>n[1]&&b(`/client/core-buddy/profile/${n[1].id}`),role:n[1]?"button":void 0,children:n[1]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${N(n[1])?"lb-avatar-you":""}`,style:{borderColor:q[1]},children:n[1].photoURL?e.jsx("img",{src:n[1].photoURL,alt:"",className:"lb-avatar-img"}):R(n[1].name)}),e.jsx("div",{className:"lb-podium-name",children:n[1].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:M(n[1])}),e.jsx("div",{className:"lb-podium-bar lb-bar-2nd",children:e.jsx("span",{className:"lb-podium-rank",children:"2"})})]}):e.jsx("div",{className:"lb-podium-spacer"})}),e.jsxs("div",{className:"lb-podium-place lb-podium-1st",onClick:()=>b(`/client/core-buddy/profile/${n[0].id}`),role:"button",children:[e.jsx("div",{className:"lb-podium-crown",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"#FFD700",stroke:"none",children:[e.jsx("path",{d:"M2.5 18.5l3-7 4 4 3-9 3 9 4-4 3 7z"}),e.jsx("rect",{x:"3",y:"18",width:"18",height:"2",rx:"1"})]})}),e.jsx("div",{className:`lb-podium-avatar lb-avatar-1st ${N(n[0])?"lb-avatar-you":""}`,style:{borderColor:q[0]},children:n[0].photoURL?e.jsx("img",{src:n[0].photoURL,alt:"",className:"lb-avatar-img"}):R(n[0].name)}),e.jsx("div",{className:"lb-podium-name",children:n[0].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:M(n[0])}),e.jsx("div",{className:"lb-podium-bar lb-bar-1st",children:e.jsx("span",{className:"lb-podium-rank",children:"1"})})]}),e.jsx("div",{className:"lb-podium-place lb-podium-3rd",onClick:()=>n[2]&&b(`/client/core-buddy/profile/${n[2].id}`),role:n[2]?"button":void 0,children:n[2]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${N(n[2])?"lb-avatar-you":""}`,style:{borderColor:q[2]},children:n[2].photoURL?e.jsx("img",{src:n[2].photoURL,alt:"",className:"lb-avatar-img"}):R(n[2].name)}),e.jsx("div",{className:"lb-podium-name",children:n[2].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:M(n[2])}),e.jsx("div",{className:"lb-podium-bar lb-bar-3rd",children:e.jsx("span",{className:"lb-podium-rank",children:"3"})})]}):e.jsx("div",{className:"lb-podium-spacer"})})]}),ee.length>0&&e.jsxs("div",{className:"lb-rankings",children:[ee.map((s,u)=>e.jsxs("div",{className:`lb-rank-item ${N(s)?"lb-rank-you":""}`,style:{animationDelay:`${u*.04}s`},onClick:()=>b(`/client/core-buddy/profile/${s.id}`),role:"button",children:[e.jsx("span",{className:"lb-rank-number",children:s.rank}),e.jsx("div",{className:`lb-rank-avatar ${N(s)?"lb-avatar-you":""}`,children:s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"lb-avatar-img"}):R(s.name)}),e.jsx("div",{className:"lb-rank-info",children:e.jsxs("span",{className:"lb-rank-name",children:[s.name,N(s)&&e.jsx("span",{className:"lb-you-badge",children:"You"})]})}),e.jsx("span",{className:"lb-rank-stat",children:M(s)})]},s.id)),je&&e.jsxs("button",{className:"lb-view-all-btn",onClick:()=>K(!$),children:[e.jsx("span",{children:$?"Show Less":`View All (${A.length})`}),e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:$?"rotate(180deg)":"none",transition:"transform 0.2s"},children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]})]}),I&&I.rank>5&&e.jsxs("div",{className:"lb-your-position",children:[e.jsxs("span",{className:"lb-your-rank",children:["#",I.rank]}),e.jsx("span",{className:"lb-your-label",children:"Your Position"}),e.jsx("span",{className:"lb-your-stat",children:M(I)})]})]})]}),T&&e.jsx("div",{className:"lb-modal-overlay",onClick:()=>E(!1),children:e.jsxs("div",{className:"lb-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"Leave the Leaderboard?"}),e.jsx("p",{children:"Your name will no longer appear to other members. You can rejoin anytime."}),e.jsxs("div",{className:"lb-modal-actions",children:[e.jsx("button",{className:"lb-modal-cancel",onClick:()=>E(!1),children:"Stay"}),e.jsx("button",{className:"lb-modal-confirm",onClick:pe,disabled:k,children:k?"Leaving...":"Leave"})]})]})}),e.jsx(ae,{}),C&&e.jsxs("div",{className:`toast-notification ${C.type}`,children:[e.jsx("span",{className:"toast-icon",children:C.type==="success"?e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 13 L9 17 L19 7"})}):C.type==="error"?e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",children:[e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"}),e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"})]}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("circle",{cx:"12",cy:"16",r:"1",fill:"currentColor"})]})}),e.jsx("span",{className:"toast-message",children:C.message})]}),e.jsx(De,{badge:ue,onDismiss:()=>P(null)})]})})}export{Ie as default};
