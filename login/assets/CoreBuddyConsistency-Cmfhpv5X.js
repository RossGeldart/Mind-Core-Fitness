import{k as ee,l as se,m as te,r as o,j as e,c as ae,d as A,q as ce,w as ne,g as ie,n as le,e as oe}from"./index-BVJUG_mo.js";import{C as re}from"./CoreBuddyNav-CiRthjQn.js";import{c as de,b as he}from"./ringTicks-_1Alaa2O.js";const E=60,p=[{key:"trained",label:"Trained",icon:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2.71 7 4.14 8.43 7.71 4.86 16.29 13.43 12.71 17 14.14 18.43 15.57 17 17 18.43 14.14 21.29l1.43 1.43 1.43-1.43 1.43 1.43 2.14-2.14 1.43 1.43L22 20.57z"},{key:"protein",label:"Hit Protein",icon:"M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"},{key:"steps",label:"10k Steps",icon:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7"},{key:"sleep",label:"8hrs Sleep",icon:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"},{key:"water",label:"2L Water",icon:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"}];function me(i){const h=new Date(i),r=h.getDay(),m=r===0?-6:1-r;return h.setDate(h.getDate()+m),h.setHours(0,0,0,0),h}function w(i){return i.toISOString().split("T")[0]}function be(i){return Array.from({length:7},(h,r)=>{const m=new Date(i);return m.setDate(i.getDate()+r),m})}function ke(){const{currentUser:i,isClient:h,clientData:r,loading:m}=ee(),{isDark:M,toggleTheme:H,accent:O}=se(),k=te(),[C,T]=o.useState({}),[R,F]=o.useState(!0),[D,S]=o.useState(!1),[P,V]=o.useState(0),[j,$]=o.useState(null),[q,L]=o.useState(null),[U,y]=o.useState(!1),B=o.useRef([]),W=o.useRef([]),J=o.useCallback((s,t="info")=>{$({message:s,type:t}),setTimeout(()=>$(null),3e3)},[]),f=new Date,b=w(f),G=me(f),K=be(G),Q=["M","T","W","T","F","S","S"];o.useEffect(()=>{!m&&(!i||!h)&&k("/")},[i,h,m,k]),o.useEffect(()=>{if(!i||!r)return;(async()=>{try{const t=ae(A,"habitLogs"),a=ce(t,ne("clientId","==",r.id)),c=await ie(a),n={};c.docs.forEach(x=>{const g=x.data();n[g.date]={...g,_id:x.id}}),T(n);let l=0;const d=new Date(f);for(;;){const x=w(d),g=n[x];if(g)if(Object.values(g.habits||{}).filter(Boolean).length>=3)l++,d.setDate(d.getDate()-1);else break;else if(x===b)d.setDate(d.getDate()-1);else break}V(l)}catch(t){console.error("Error loading habit logs:",t)}finally{F(!1)}})()},[i,r]);const u=C[b]||{habits:{}},X=async s=>{if(!i||D)return;const t=u.habits?.[s]||!1;t||(B.current=[...Array(10)].map((a,c)=>{const n=c/10*2*Math.PI,l=18+Math.random()*20;return{tx:Math.cos(n)*l,ty:Math.sin(n)*l,size:3+Math.random()*4,duration:.4+Math.random()*.3}}),L(s),setTimeout(()=>L(null),700)),S(!0);try{const a=u.habits||{},c={...a,[s]:!a[s]},n=u._id||`${r.id}_${b}`;await le(oe(A,"habitLogs",n),{clientId:r.id,date:b,habits:c}),T(d=>({...d,[b]:{clientId:r.id,date:b,habits:c,_id:n}})),Object.values(c).filter(Boolean).length===p.length&&!t&&(W.current=[...Array(50)].map((d,x)=>({x:5+Math.random()*90,delay:Math.random()*.6,color:["#4caf50","#ff9800","#2196f3","#e91e63","#ffeb3b","#9c27b0"][x%6],drift:(Math.random()-.5)*120,spin:Math.random()*720-360,duration:1.5+Math.random()*1.5,width:4+Math.random()*8,height:4+Math.random()*10})),setTimeout(()=>{y(!0),setTimeout(()=>y(!1),3500)},500))}catch(a){console.error("Error saving habit:",a),J("Failed to save. Try again.","error")}finally{S(!1)}},v=K.map(s=>{const t=w(s),a=C[t],c=a?Object.values(a.habits||{}).filter(Boolean).length:0;return{date:s,dateStr:t,completed:c,total:p.length}}),I=v.reduce((s,t)=>s+t.completed,0),N=v.reduce((s,t)=>s+t.total,0),_=N>0?Math.round(I/N*100):0,Y=Object.values(u.habits||{}).filter(Boolean).length,z=Math.round(Y/p.length*100),Z=Math.round(z/100*E);return e.jsxs("div",{className:"cbc-page","data-theme":M?"dark":"light","data-accent":O,children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>k("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:H,"aria-label":"Toggle theme",children:M?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),m||R?e.jsx("div",{className:"cbc-loading-inline",children:e.jsx("div",{className:"cbc-loading-spinner"})}):e.jsxs("main",{className:"cbc-main",children:[e.jsxs("div",{className:"cbc-ring-section",children:[e.jsxs("div",{className:"cbc-progress-ring",children:[e.jsx("svg",{viewBox:"0 0 200 200",children:de.map((s,t)=>e.jsx("line",{x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,className:t<Z?"cbc-tick-filled":"cbc-tick-empty",strokeWidth:s.thick?"3":"2",style:{transitionDelay:`${t*20}ms`}},t))}),e.jsxs("div",{className:"cbc-ring-center",children:[e.jsxs("span",{className:"cbc-ring-pct",children:[z,"%"]}),e.jsx("span",{className:"cbc-ring-label",children:"today"})]})]}),e.jsxs("div",{className:"cbc-streak",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"var(--color-primary)",strokeWidth:"2",children:e.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),e.jsx("span",{className:"cbc-streak-count",children:P}),e.jsx("span",{className:"cbc-streak-label",children:"day streak"})]})]}),e.jsxs("div",{className:"cbc-section",children:[e.jsx("h2",{className:"cbc-section-title",children:"Today's Habits"}),e.jsx("div",{className:"cbc-habits",children:p.map(s=>{const t=u.habits?.[s.key]||!1,a=q===s.key;return e.jsxs("button",{className:`cbc-habit-btn cbc-habit-${s.key} ${t?"cbc-habit-done":""} ${a?"cbc-habit-just-checked":""}`,onClick:()=>X(s.key),disabled:D,children:[e.jsx("div",{className:"cbc-habit-check",children:t?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12",className:`cbc-check-path ${a?"cbc-check-animate":""}`})}):e.jsx("div",{className:"cbc-habit-circle"})}),a&&e.jsx("div",{className:"cbc-particles",children:B.current.map((c,n)=>e.jsx("span",{className:"cbc-particle",style:{"--tx":`${c.tx}px`,"--ty":`${c.ty}px`,"--size":`${c.size}px`,animationDuration:`${c.duration}s`}},n))}),e.jsx("div",{className:`cbc-habit-icon cbc-icon-${s.key}`,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})})}),e.jsx("span",{className:"cbc-habit-label",children:s.label})]},s.key)})})]}),e.jsxs("div",{className:"cbc-section",children:[e.jsx("h2",{className:"cbc-section-title",children:"This Week"}),e.jsx("div",{className:"cbc-week-grid",children:v.map((s,t)=>{const a=s.dateStr===b,c=s.total>0?s.completed/s.total:0,n=Math.round(c*E);return e.jsxs("div",{className:`cbc-day-ring ${a?"cbc-day-today":""} ${s.completed>0?"cbc-day-active":""}`,children:[e.jsx("svg",{viewBox:"0 0 100 100",children:he.map((l,d)=>e.jsx("line",{x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,className:d<n?"cbc-day-tick-filled":"cbc-day-tick-empty",strokeWidth:l.thick?"3":"2"},d))}),e.jsx("span",{className:"cbc-day-label",children:Q[t]}),e.jsxs("span",{className:"cbc-day-count",children:[s.completed,"/",s.total]})]},t)})}),e.jsxs("div",{className:"cbc-week-summary",children:[e.jsx("div",{className:"cbc-week-summary-bar",children:e.jsx("div",{className:"cbc-week-summary-fill",style:{width:`${_}%`}})}),e.jsxs("span",{className:"cbc-week-summary-text",children:[I," / ",N," habits this week (",_,"%)"]})]})]})]}),e.jsx(re,{active:"home"}),U&&e.jsxs("div",{className:"cbc-celebration",onClick:()=>y(!1),children:[e.jsx("div",{className:"cbc-confetti-container",children:W.current.map((s,t)=>e.jsx("span",{className:"cbc-confetti-piece",style:{"--x":`${s.x}%`,"--delay":`${s.delay}s`,"--color":s.color,"--drift":`${s.drift}px`,"--spin":`${s.spin}deg`,"--duration":`${s.duration}s`,width:`${s.width}px`,height:`${s.height}px`}},t))}),e.jsxs("div",{className:"cbc-celebration-card",children:[e.jsxs("svg",{className:"cbc-celebration-icon",viewBox:"0 0 24 24",fill:"none",stroke:"var(--color-primary)",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),e.jsx("h2",{className:"cbc-celebration-title",children:"Crushed it!"}),e.jsx("p",{className:"cbc-celebration-sub",children:"All habits complete today"})]})]}),j&&e.jsx("div",{className:`toast-notification ${j.type}`,children:j.message})]})}export{ke as default};
