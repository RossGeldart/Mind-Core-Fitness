import{r as l,k as C,m as N,j as e,f as S,s as D,h as B,T as b,a as I,c as A,d as T}from"./index-WqFBW1A4.js";const F=[{value:"block",label:"Block (1-2-1)"},{value:"circuit_vip",label:"Circuit VIP"},{value:"circuit_dropin",label:"Circuit Drop-in"},{value:"core_buddy",label:"Core Buddy"}];function L(){const[s,d]=l.useState({name:"",email:"",password:"",clientType:"block",circuitAccess:!1,weeksInBlock:"",numberOfSessions:"",sessionDuration:"45",startDate:"",endDate:""}),[j,g]=l.useState(!1),[f,o]=l.useState(""),{currentUser:u,isAdmin:m,loading:h}=C(),c=N();l.useEffect(()=>{!h&&(!u||!m)&&c("/")},[u,m,h,c]),l.useEffect(()=>{if(s.startDate&&s.weeksInBlock){const n=new Date(s.startDate),t=parseInt(s.weeksInBlock);if(!isNaN(t)&&t>0){const r=new Date(n);r.setDate(r.getDate()+t*7);const a=r.getFullYear(),p=(r.getMonth()+1).toString().padStart(2,"0"),x=r.getDate().toString().padStart(2,"0");d(y=>({...y,endDate:`${a}-${p}-${x}`}))}}},[s.startDate,s.weeksInBlock]);const i=n=>{const{name:t,value:r,type:a,checked:p}=n.target;d(x=>({...x,[t]:a==="checkbox"?p:r}))},w=async n=>{n.preventDefault(),o(""),g(!0);try{const t=await S(D,s.email.trim().toLowerCase(),s.password);await B(D);const r=s.clientType==="block",a={uid:t.user.uid,name:s.name.trim(),email:s.email.trim().toLowerCase(),clientType:s.clientType,status:"active",createdAt:b.now()};r?(a.circuitAccess=s.circuitAccess,a.weeksInBlock=parseInt(s.weeksInBlock),a.totalSessions=parseInt(s.numberOfSessions),a.sessionsRemaining=parseInt(s.numberOfSessions),a.sessionDuration=parseInt(s.sessionDuration),a.startDate=b.fromDate(new Date(s.startDate)),a.endDate=b.fromDate(new Date(s.endDate))):(a.circuitStrikes=0,a.circuitBanUntil=null),await I(A(T,"clients"),a),c("/dashboard")}catch(t){console.error("Error adding client:",t),t.code==="auth/email-already-in-use"?o("This email is already registered."):t.code==="auth/weak-password"?o("Password should be at least 6 characters."):o("Failed to add client. Please try again."),g(!1)}},k=()=>{c("/dashboard")};if(h)return e.jsx("div",{className:"loading",children:"Loading..."});if(!u||!m)return null;const v=s.clientType==="block";return e.jsxs("div",{className:"add-client-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("button",{className:"back-btn",onClick:k,"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("h1",{children:"Add New Client"})]}),e.jsxs("main",{className:"page-content",children:[f&&e.jsx("div",{className:"form-error",children:f}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Type"}),e.jsx("div",{className:"client-type-toggle",children:F.map(n=>e.jsx("button",{type:"button",className:`type-btn ${s.clientType===n.value?"active":""}`,onClick:()=>d(t=>({...t,clientType:n.value})),children:n.label},n.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Client Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:i,placeholder:"John Smith",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Client Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:i,placeholder:"john@example.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Client Portal Password"}),e.jsx("input",{type:"text",id:"password",name:"password",value:s.password,onChange:i,placeholder:"Set a password for client login",minLength:"6",required:!0}),e.jsx("span",{className:"helper-text",children:"Minimum 6 characters. Share this with your client."})]}),v&&e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"circuit-toggle-label",children:[e.jsx("input",{type:"checkbox",name:"circuitAccess",checked:s.circuitAccess,onChange:i}),e.jsx("span",{children:"Also allow Circuit Class access"})]})}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weeksInBlock",children:"Weeks in Block"}),e.jsx("input",{type:"number",id:"weeksInBlock",name:"weeksInBlock",value:s.weeksInBlock,onChange:i,placeholder:"8",min:"1",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"numberOfSessions",children:"Number of Sessions"}),e.jsx("input",{type:"number",id:"numberOfSessions",name:"numberOfSessions",value:s.numberOfSessions,onChange:i,placeholder:"16",min:"1",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"sessionDuration",children:"Session Duration"}),e.jsxs("select",{id:"sessionDuration",name:"sessionDuration",value:s.sessionDuration,onChange:i,required:!0,children:[e.jsx("option",{value:"30",children:"30 minutes"}),e.jsx("option",{value:"45",children:"45 minutes"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"startDate",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",value:s.startDate,onChange:i,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"endDate",children:"End Date (auto-calculated)"}),e.jsx("input",{type:"date",id:"endDate",name:"endDate",value:s.endDate,onChange:i,required:!0}),e.jsx("span",{className:"helper-text",children:"Calculated from start date + weeks"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:k,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:j,children:j?"Saving...":"Save Client"})]})]})]})]})}export{L as default};
