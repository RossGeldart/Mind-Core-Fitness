import{r as h,k as Lt,l as Rt,m as At,q as Ue,c as qe,d as W,w as Xe,g as Je,j as e,n as he,e as H,T as _,b as Wt,p as Ot,i as Tt}from"./index-B7pQgPf9.js";/* empty css                        */import{C as zt}from"./CoreBuddyNav-HTaMOPjh.js";const le=[{key:"pressUps",name:"Press-Ups",category:"Upper Body",unit:"reps"},{key:"squats",name:"Squats",category:"Lower Body",unit:"reps"},{key:"longJump",name:"Standing Long Jump",category:"Power",unit:"distance"},{key:"deadHang",name:"Dead Hang",category:"Upper Body",unit:"time"},{key:"plank",name:"Plank",category:"Core",unit:"time"},{key:"wallSit",name:"Wall Sit",category:"Lower Body",unit:"time"},{key:"chestPress",name:"Chest Press",category:"Upper Body",unit:"weight"}],Pe=[{key:"weight",name:"Weight",suffix:"kg"},{key:"chest",name:"Chest",suffix:"cm"},{key:"waist",name:"Waist",suffix:"cm"},{key:"hips",name:"Hips",suffix:"cm"},{key:"leftArm",name:"Left Arm",suffix:"cm"},{key:"rightArm",name:"Right Arm",suffix:"cm"},{key:"leftThigh",name:"Left Thigh",suffix:"cm"},{key:"rightThigh",name:"Right Thigh",suffix:"cm"}];function Ht(){const p=new Date;return`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`}function oe(p){const[m,g]=p.split("-");return new Date(parseInt(m),parseInt(g)-1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}function _t(p){if(!p&&p!==0)return"-";const m=Math.floor(p/60),g=(p%60).toFixed(2);return m>0?`${m}m ${parseFloat(g).toFixed(0)}s`:`${parseFloat(g).toFixed(2)}s`}function Yt(p,m){return!p&&p!==0?"-":!m&&m!==0?`${p}kg`:`${p}kg x ${m}`}function xt(p,m){if(!m)return"-";switch(p.unit){case"weight":return Yt(m.weight,m.reps);case"time":return _t(m.time);case"reps":return m.reps?`${m.reps} reps`:"-";case"distance":return m.distance?`${m.distance} cm`:"-";default:return"-"}}function Ye(p,m){if(!m)return 0;switch(p.unit){case"weight":return(m.weight||0)*(m.reps||0);case"time":return m.time||0;case"reps":return m.reps||0;case"distance":return m.distance||0;default:return 0}}function $t(p,m){return!m||m===0?null:(p-m)/m*100}function Gt({data:p,exerciseKey:m,unit:g}){if(!p||p.length<2)return e.jsx("div",{className:"pb-trend-empty",children:e.jsx("p",{children:"Not enough data for trend line yet"})});const Y=p.map(k=>{const x=k.benchmarks?.[m];if(!x)return 0;switch(g){case"weight":return(x.weight||0)*(x.reps||0);case"time":return x.time||0;case"reps":return x.reps||0;case"distance":return x.distance||0;default:return 0}}),$e=Math.max(...Y),pe=Math.min(...Y),M=$e-pe||1,C=300,V=100,D=20,ae=C-D*2,P=V-D*2,I=Y.map((k,x)=>{const U=D+x/(Y.length-1)*ae,Q=D+P-(k-pe)/M*P;return{x:U,y:Q,value:k}}),G=I.map((k,x)=>`${x===0?"M":"L"} ${k.x} ${k.y}`).join(" "),be=G+` L ${I[I.length-1].x} ${D+P} L ${I[0].x} ${D+P} Z`;return e.jsxs("div",{className:"pb-trend-chart",children:[e.jsxs("svg",{viewBox:`0 0 ${C} ${V}`,preserveAspectRatio:"xMidYMid meet",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trendGradientJr",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--color-primary)",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"var(--color-primary)",stopOpacity:"0.02"})]})}),e.jsx("path",{d:be,fill:"url(#trendGradientJr)"}),e.jsx("path",{d:G,fill:"none",stroke:"var(--color-primary)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}),I.map((k,x)=>e.jsx("circle",{cx:k.x,cy:k.y,r:"4",fill:"var(--bg-card)",stroke:"var(--color-primary)",strokeWidth:"2"},x))]}),e.jsx("div",{className:"pb-trend-labels",children:p.map((k,x)=>e.jsxs("span",{className:"pb-trend-label",children:[k.month.split("-")[1],"/",k.month.split("-")[0].slice(2)]},x))})]})}function Ut(){const[p,m]=h.useState("bests"),[g,Y]=h.useState([]),[$e,pe]=h.useState(!0),[M,C]=h.useState(!1),[V,D]=h.useState(0),[ae,P]=h.useState(!1),[I,G]=h.useState(!1),[be,k]=h.useState(!1),[x,U]=h.useState({}),[Q,re]=h.useState({}),[F,Be]=h.useState({}),[E,Ve]=h.useState({}),[S,Z]=h.useState({}),[Qe,xe]=h.useState(!1),[Se,K]=h.useState({}),[R,Ze]=h.useState([]),[je,Le]=h.useState(null),[ve,Re]=h.useState(null),[ne,vt]=h.useState(!1),[ye,Ke]=h.useState(""),[ke,et]=h.useState(""),fe=h.useRef(null),pt=h.useRef(0),me=h.useRef(0),tt=h.useRef("right"),Te=h.useCallback(t=>{D(i=>{const c=Math.max(0,Math.min(le.length-1,t));return c===i?i:(tt.current=c>i?"right":"left",c)})},[]),{currentUser:st,isClient:ie,clientData:L,loading:Ae}=Lt(),{isDark:at}=Rt(),Ne=At(),ee=h.useCallback((t,i="info")=>{Re({message:t,type:i}),setTimeout(()=>Re(null),4e3)},[]);h.useEffect(()=>{!Ae&&(!st||!ie)&&Ne("/")},[st,ie,Ae,Ne]),h.useEffect(()=>{L&&we()},[L]);const we=async()=>{try{const t=Ue(qe(W,"juniorPBs"),Xe("clientId","==",L.id)),c=(await Je(t)).docs.map(u=>({id:u.id,...u.data()}));c.sort((u,y)=>u.month.localeCompare(y.month)),Y(c);const o=Ue(qe(W,"juniorPBTargets"),Xe("clientId","==",L.id)),r=await Je(o);if(!r.empty){const u=r.docs[0].data();Be(u.targets||{}),Ve(u.metricTargets||{}),Z(u.targets||{}),K(u.metricTargets||{})}const j=Ue(qe(W,"juniorAchievements"),Xe("clientId","==",L.id)),B=await Je(j);B.empty||Ze(B.docs[0].data().badges||[])}catch(t){console.error("Error fetching junior personal bests:",t)}pe(!1)},X=Ht(),$=g.find(t=>t.month===X),We=g.filter(t=>t.month<X),Ie=We.length>0?We[We.length-1]:null;h.useEffect(()=>{$?(U($.benchmarks||{}),re($.bodyMetrics||{})):(U({}),re({}))},[$?.id]);const w=async(t,i)=>{const c=[];if(t==="strength"?le.forEach(o=>{const r=F[o.key];if(!r)return;const j=i[o.key];if(!j)return;let B;if(r.targetType==="time"){if(!r.targetValue)return;const u=r.startValue||0,y=j.time||0,b=r.targetValue-u;B=b===0?y>=r.targetValue?1:0:Math.max(0,(y-u)/b)}else if(r.targetType==="reps"){if(!r.targetReps)return;const u=r.startReps||0,y=j.reps||0,b=r.targetReps-u;B=b===0?y>=r.targetReps?1:0:Math.max(0,(y-u)/b)}else if(r.targetType==="distance"){if(!r.targetDistance)return;const u=r.startDistance||0,y=j.distance||0,b=r.targetDistance-u;B=b===0?y>=r.targetDistance?1:0:Math.max(0,(y-u)/b)}else{if(!r.targetWeight&&!r.targetReps)return;const u=(r.startWeight||0)*(r.startReps||0),y=(r.targetWeight||0)*(r.targetReps||0),b=(j.weight||0)*(j.reps||0),O=y-u;B=O===0?b>=y?1:0:Math.max(0,(b-u)/O)}if(B>=1){let u,y;r.targetType==="time"?(u=R.some(b=>b.type==="strength"&&b.key===o.key&&b.targetValue===r.targetValue),y=`${o.name} ${r.targetValue}s`):r.targetType==="reps"?(u=R.some(b=>b.type==="strength"&&b.key===o.key&&b.targetReps===r.targetReps),y=`${o.name} ${r.targetReps} reps`):r.targetType==="distance"?(u=R.some(b=>b.type==="strength"&&b.key===o.key&&b.targetDistance===r.targetDistance),y=`${o.name} ${r.targetDistance}cm`):(u=R.some(b=>b.type==="strength"&&b.key===o.key&&b.targetWeight===r.targetWeight&&b.targetReps===r.targetReps),y=`${o.name} ${r.targetWeight}kg × ${r.targetReps}`),u||c.push({type:"strength",key:o.key,...r.targetType==="time"?{targetType:"time",targetValue:r.targetValue}:r.targetType==="reps"?{targetType:"reps",targetReps:r.targetReps}:r.targetType==="distance"?{targetType:"distance",targetDistance:r.targetDistance}:{targetWeight:r.targetWeight,targetReps:r.targetReps},achievedMonth:X,label:y})}}):Pe.forEach(o=>{const r=E[o.key];if(!r||!r.targetValue)return;const j=i[o.key];if(j==null)return;const B=r.startValue||0,u=r.targetValue,y=u-B;(y===0?j===u?1:0:Math.max(0,(j-B)/y))>=1&&(R.some(dt=>dt.type==="metric"&&dt.key===o.key&&dt.targetValue===u)||c.push({type:"metric",key:o.key,targetValue:u,achievedMonth:X,label:`${o.name} ${u}${o.suffix}`}))}),c.length>0){const o=[...R,...c];await he(H(W,"juniorAchievements",L.id),{clientId:L.id,badges:o,updatedAt:_.now()}),Ze(o),Le(c),setTimeout(()=>Le(null),5e3)}},Oe=(t,i)=>{if(t==="strength"){const c=F[i];if(!c)return!1;switch(le.find(r=>r.key===i)?.unit){case"time":return R.some(r=>r.type==="strength"&&r.key===i&&r.targetValue===c.targetValue);case"reps":return R.some(r=>r.type==="strength"&&r.key===i&&r.targetReps===c.targetReps);case"distance":return R.some(r=>r.type==="strength"&&r.key===i&&r.targetDistance===c.targetDistance);default:return!c.targetWeight&&!c.targetReps?!1:R.some(r=>r.type==="strength"&&r.key===i&&r.targetWeight===c.targetWeight&&r.targetReps===c.targetReps)}}else{const c=E[i];return!c||!c.targetValue?!1:R.some(o=>o.type==="metric"&&o.key===i&&o.targetValue===c.targetValue)}},Vt=async()=>{C(!0);try{const t=`${L.id}_${X}`,i=$||{};await he(H(W,"juniorPBs",t),{clientId:L.id,month:X,benchmarks:x,bodyMetrics:i.bodyMetrics||Q||{},createdAt:i.createdAt||_.now(),updatedAt:_.now()}),await w("strength",x),ee("Benchmarks saved!","success"),P(!1),await we()}catch(t){console.error("Error saving benchmarks:",t),ee("Failed to save. Please try again.","error")}C(!1)},ue=async()=>{C(!0);try{const t=`${L.id}_${X}`,i=$||{};await he(H(W,"juniorPBs",t),{clientId:L.id,month:X,benchmarks:i.benchmarks||x||{},bodyMetrics:Q,createdAt:i.createdAt||_.now(),updatedAt:_.now()}),await w("metric",Q),ee("Body metrics saved!","success"),G(!1),await we()}catch(t){console.error("Error saving metrics:",t),ee("Failed to save. Please try again.","error")}C(!1)},Fe=(t,i,c)=>{U(o=>({...o,[t]:{...o[t],[i]:c===""?"":parseFloat(c)}}))},rt=(t,i)=>{re(c=>({...c,[t]:i===""?"":parseFloat(i)}))},se=(t,i,c)=>{Z(o=>({...o,[t]:{...o[t],[i]:c===""?"":parseFloat(c)}}))},q=async()=>{C(!0);try{const t=`targets_${L.id}`,i=$?.benchmarks||{},c={};le.forEach(o=>{const r=i[o.key];switch(o.unit){case"time":S[o.key]?.targetValue&&(c[o.key]={targetType:"time",targetValue:S[o.key].targetValue,startValue:r?.time||0});break;case"reps":S[o.key]?.targetReps&&(c[o.key]={targetType:"reps",targetReps:S[o.key].targetReps,startReps:r?.reps||0});break;case"distance":S[o.key]?.targetDistance&&(c[o.key]={targetType:"distance",targetDistance:S[o.key].targetDistance,startDistance:r?.distance||0});break;default:(S[o.key]?.targetWeight||S[o.key]?.targetReps)&&(c[o.key]={targetWeight:S[o.key].targetWeight||0,targetReps:S[o.key].targetReps||0,startWeight:r?.weight||0,startReps:r?.reps||0})}}),await he(H(W,"juniorPBTargets",t),{clientId:L.id,targets:c,metricTargets:E,updatedAt:_.now()}),Be(c),Z(c),ee("Targets saved!","success"),k(!1)}catch(t){console.error("Error saving targets:",t),ee("Failed to save targets.","error")}C(!1)},nt=(t,i)=>{K(c=>({...c,[t]:{...c[t],targetValue:i===""?"":parseFloat(i)}}))},yt=async()=>{C(!0);try{const t=`targets_${L.id}`,i={};Pe.forEach(c=>{if(Se[c.key]?.targetValue){const o=$?.bodyMetrics?.[c.key]||0;i[c.key]={targetValue:Se[c.key].targetValue,startValue:o}}}),await he(H(W,"juniorPBTargets",t),{clientId:L.id,targets:F,metricTargets:i,updatedAt:_.now()}),Ve(i),K(i),ee("Metric targets saved!","success"),xe(!1)}catch(t){console.error("Error saving metric targets:",t),ee("Failed to save targets.","error")}C(!1)},mt=async()=>{if(window.confirm("Reset all goals? This will clear all strength and body metric targets. Your recorded benchmarks and measurements will NOT be affected.")){C(!0);try{const t=H(W,"juniorPBTargets",`targets_${L.id}`);await Wt(t),Be({}),Ve({}),Z({}),K({}),ee("All goals have been reset","success")}catch(t){console.error("Error resetting targets:",t),ee("Failed to reset goals","error")}C(!1)}},kt=(t,i)=>{const c=F[t];if(!c||!i)return null;if(c.targetType==="time"){if(!c.targetValue)return null;const u=c.startValue||0,y=c.targetValue,b=i.time||0,O=y-u;return O<=0?b>=y?1:0:Math.max(0,Math.min((b-u)/O,1))}if(c.targetType==="reps"){if(!c.targetReps)return null;const u=c.startReps||0,y=c.targetReps,b=i.reps||0,O=y-u;return O<=0?b>=y?1:0:Math.max(0,Math.min((b-u)/O,1))}if(c.targetType==="distance"){if(!c.targetDistance)return null;const u=c.startDistance||0,y=c.targetDistance,b=i.distance||0,O=y-u;return O<=0?b>=y?1:0:Math.max(0,Math.min((b-u)/O,1))}if(!c.targetWeight&&!c.targetReps)return null;const o=(c.startWeight||0)*(c.startReps||0),r=(c.targetWeight||0)*(c.targetReps||0),j=(i.weight||0)*(i.reps||0),B=r-o;return B<=0?j>=r?1:0:Math.max(0,Math.min((j-o)/B,1))},te=t=>{const i=E[t];if(!i||!i.targetValue)return null;const c=$?.bodyMetrics?.[t];if(c==null)return null;const o=i.startValue||0,r=i.targetValue,j=r-o;return j===0?c===r?1:0:Math.max(0,Math.min((c-o)/j,1))},A=t=>{pt.current=t.touches[0].clientX,me.current=0},it=t=>{me.current=t.touches[0].clientX-pt.current},ut=()=>{me.current<-50?Te(V+1):me.current>50&&Te(V-1),me.current=0},gt=t=>{const i=$?.bodyMetrics?.[t],c=Ie?.bodyMetrics?.[t];return i==null||c==null?null:parseFloat((i-c).toFixed(2))},ze=g.find(t=>t.month===ye),ct=g.find(t=>t.month===ke);if(Ae||$e)return e.jsxs("div",{className:"pb-page",children:[e.jsx("header",{className:"client-header",children:e.jsx("div",{className:"header-content",children:e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"})})}),e.jsxs("main",{className:"pb-main",children:[e.jsx("div",{className:"skeleton skeleton-title",style:{width:180,height:28,marginBottom:20}}),e.jsx("div",{className:"skeleton skeleton-card-large",style:{height:320,borderRadius:16}})]})]});if(!st||!ie||!L)return null;const J=le[V],Ce=$?.benchmarks?.[J.key],ft=Ie?.benchmarks?.[J.key],He=Ye(J,Ce),Nt=Ye(J,ft),Ee=$t(He,Nt),_e=kt(J.key,Ce),bt=_e!==null,lt=_e!==null&&_e>=1,wt=bt?Math.round(_e*60):He>0?15:0,ot=F[J.key],Ct=t=>t?t.targetType==="time"?`${t.startValue||0}s → ${t.targetValue}s`:t.targetType==="reps"?`${t.startReps||0} → ${t.targetReps} reps`:t.targetType==="distance"?`${t.startDistance||0} → ${t.targetDistance}cm`:`${t.startWeight||0}kg×${t.startReps||0} → ${t.targetWeight}kg×${t.targetReps}`:null;return e.jsxs("div",{className:"pb-page",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>Ne("/client"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"})]})}),e.jsxs("main",{className:"pb-main page-transition-enter",children:[e.jsxs("div",{className:"pb-intro",children:[e.jsx("h2",{children:"Junior Strength Tests"}),e.jsx("p",{children:"Track your strength test results and body measurements each month."})]}),e.jsxs("div",{className:"pb-tabs",children:[e.jsx("button",{className:`pb-tab ${p==="bests"?"active":""}`,onClick:()=>m("bests"),children:"Strength"}),e.jsx("button",{className:`pb-tab ${p==="metrics"?"active":""}`,onClick:()=>m("metrics"),children:"Body Metrics"}),e.jsx("button",{className:`pb-tab ${p==="history"?"active":""}`,onClick:()=>m("history"),children:"History"})]}),p==="bests"&&e.jsxs("div",{className:"pb-strength-section",children:[!ae&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-carousel",ref:fe,onTouchStart:A,onTouchMove:it,onTouchEnd:ut,children:[e.jsx("div",{className:`pb-ring-container slide-from-${tt.current}`,children:e.jsxs("div",{className:"pb-ring",children:[e.jsx("svg",{className:"pb-ring-svg",viewBox:"0 0 200 200",children:[...Array(60)].map((t,i)=>{const c=(i*6-90)*(Math.PI/180),o=85,r=96,j=100+o*Math.cos(c),B=100+o*Math.sin(c),u=100+r*Math.cos(c),y=100+r*Math.sin(c),b=i<Math.round(wt);return e.jsx("line",{x1:j,y1:B,x2:u,y2:y,className:`pb-ring-tick ${b?lt?"hit":"filled":"empty"}`,strokeWidth:i%5===0?"3":"2"},i)})}),e.jsxs("div",{className:"pb-ring-center",children:[e.jsx("div",{className:"pb-ring-category",children:J.category}),e.jsxs("div",{className:"pb-ring-exercise",children:[J.name,Oe("strength",J.key)&&e.jsx("svg",{className:"pb-badge-icon",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})]}),e.jsx("div",{className:"pb-ring-value",children:Ce?xt(J,Ce):"-"}),Ee!==null&&e.jsxs("div",{className:`pb-ring-change ${Ee>=0?"positive":"negative"}`,children:[Ee>=0?"+":"",Ee.toFixed(1),"%"]}),Ee===null&&Ce&&e.jsx("div",{className:"pb-ring-change neutral",children:"New entry"}),ot&&e.jsx("div",{className:`pb-ring-target ${lt?"hit":""}`,children:lt?"Target hit!":Ct(ot)}),!ot&&e.jsx("div",{className:"pb-ring-target none",children:"No target set"})]})]})},V),e.jsx("div",{className:"pb-carousel-dots",children:le.map((t,i)=>e.jsx("button",{className:`pb-dot ${i===V?"active":""}`,onClick:()=>Te(i)},i))}),e.jsx("button",{className:"pb-carousel-arrow left",onClick:()=>Te(V-1),disabled:V===0,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("button",{className:"pb-carousel-arrow right",onClick:()=>Te(V+1),disabled:V===le.length-1,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})})})]}),e.jsxs("div",{className:"pb-trend-section",children:[e.jsx("h4",{children:"Trend"}),e.jsx(Gt,{data:g,exerciseKey:J.key,unit:J.unit})]})]}),!ae&&!be&&e.jsxs("div",{className:"pb-action-buttons",children:[e.jsx("button",{className:"pb-edit-btn",onClick:()=>P(!0),children:$?.benchmarks?"Edit This Month's Benchmarks":"Add This Month's Benchmarks"}),e.jsx("button",{className:"pb-edit-btn pb-target-btn",onClick:()=>k(!0),children:Object.keys(F).length>0?"Edit Targets":"Set Targets"}),(Object.keys(F).length>0||Object.keys(E).length>0)&&e.jsx("button",{className:"pb-edit-btn pb-reset-btn",onClick:mt,disabled:M,children:"Reset All Goals"})]}),ae&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsxs("h3",{children:["Benchmarks - ",oe(X)]}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{P(!1),U($?.benchmarks||{})},children:"×"})]}),e.jsx("div",{className:"pb-edit-body",children:le.map(t=>e.jsxs("div",{className:"pb-edit-exercise",children:[e.jsx("div",{className:"pb-edit-exercise-name",children:t.name}),t.unit==="weight"?e.jsxs("div",{className:"pb-edit-row",children:[e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Weight (kg)"}),e.jsx("input",{type:"number",step:"0.5",value:x[t.key]?.weight??"",onChange:i=>Fe(t.key,"weight",i.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Reps"}),e.jsx("input",{type:"number",value:x[t.key]?.reps??"",onChange:i=>Fe(t.key,"reps",i.target.value),placeholder:"0"})]})]}):t.unit==="reps"?e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Reps (max in 1 min)"}),e.jsx("input",{type:"number",value:x[t.key]?.reps??"",onChange:i=>Fe(t.key,"reps",i.target.value),placeholder:"0"})]})}):t.unit==="distance"?e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Distance (cm)"}),e.jsx("input",{type:"number",step:"0.5",value:x[t.key]?.distance??"",onChange:i=>Fe(t.key,"distance",i.target.value),placeholder:"0"})]})}):e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Time (seconds)"}),e.jsx("input",{type:"number",step:"0.01",value:x[t.key]?.time??"",onChange:i=>Fe(t.key,"time",i.target.value),placeholder:"0"})]})})]},t.key))}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{P(!1),U($?.benchmarks||{})},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:Vt,disabled:M,children:M?"Saving...":"Save"})]})]}),be&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsx("h3",{children:"Set Your Targets"}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{k(!1),Z(F)},children:"×"})]}),e.jsxs("div",{className:"pb-edit-body",children:[e.jsx("p",{className:"pb-target-hint",children:"Set a target for each exercise. Your current best is captured automatically from your latest benchmarks."}),le.map(t=>{const i=$?.benchmarks?.[t.key];let c="-";if(i)switch(t.unit){case"weight":(i.weight||i.reps)&&(c=`${i.weight||0}kg × ${i.reps||0}`);break;case"time":i.time&&(c=`${i.time}s`);break;case"reps":i.reps&&(c=`${i.reps} reps`);break;case"distance":i.distance&&(c=`${i.distance} cm`);break}return e.jsxs("div",{className:"pb-edit-exercise",children:[e.jsxs("div",{className:"pb-edit-exercise-header",children:[e.jsx("div",{className:"pb-edit-exercise-name",children:t.name}),e.jsxs("div",{className:"pb-edit-current-best",children:["Current: ",c]})]}),t.unit==="weight"?e.jsxs("div",{className:"pb-edit-row",children:[e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Target Weight (kg)"}),e.jsx("input",{type:"number",step:"0.5",value:S[t.key]?.targetWeight??"",onChange:o=>se(t.key,"targetWeight",o.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Target Reps"}),e.jsx("input",{type:"number",value:S[t.key]?.targetReps??"",onChange:o=>se(t.key,"targetReps",o.target.value),placeholder:"0"})]})]}):t.unit==="reps"?e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Target Reps (in 1 min)"}),e.jsx("input",{type:"number",value:S[t.key]?.targetReps??"",onChange:o=>se(t.key,"targetReps",o.target.value),placeholder:"0"})]})}):t.unit==="distance"?e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Target Distance (cm)"}),e.jsx("input",{type:"number",step:"0.5",value:S[t.key]?.targetDistance??"",onChange:o=>se(t.key,"targetDistance",o.target.value),placeholder:"0"})]})}):e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Target (seconds)"}),e.jsx("input",{type:"number",step:"1",value:S[t.key]?.targetValue??"",onChange:o=>se(t.key,"targetValue",o.target.value),placeholder:"0"})]})})]},t.key)})]}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{k(!1),Z(F)},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:q,disabled:M,children:M?"Saving...":"Save Targets"})]})]})]}),p==="metrics"&&e.jsxs("div",{className:"pb-metrics-section",children:[!I&&!Qe&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-metrics-card",children:[e.jsx("h3",{children:"Body Measurements"}),e.jsx("p",{className:"pb-metrics-month",children:oe(X)}),e.jsx("div",{className:"pb-metrics-list",children:Pe.map(t=>{const i=$?.bodyMetrics?.[t.key],c=gt(t.key),o=E[t.key],r=te(t.key),j=r!==null&&r>=1;return e.jsxs("div",{className:"pb-metric-row",children:[e.jsxs("div",{className:"pb-metric-top",children:[e.jsxs("div",{className:"pb-metric-left",children:[e.jsxs("span",{className:"pb-metric-name",children:[t.name,Oe("metric",t.key)&&e.jsx("svg",{className:"pb-badge-icon-sm",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})]}),o&&e.jsxs("span",{className:"pb-metric-target-label",children:["Target: ",o.targetValue," ",t.suffix]})]}),e.jsxs("div",{className:"pb-metric-values",children:[e.jsx("span",{className:"pb-metric-current",children:i!=null?`${i} ${t.suffix}`:"-"}),c!==null&&e.jsxs("span",{className:`pb-metric-change ${c>0?"up":c<0?"down":"same"}`,children:[c>0?"+":"",c," ",t.suffix]})]})]}),r!==null&&e.jsxs("div",{className:"pb-metric-progress",children:[e.jsx("div",{className:"pb-metric-bar",children:e.jsx("div",{className:`pb-metric-bar-fill ${j?"hit":""}`,style:{width:`${Math.round(r*100)}%`}})}),e.jsx("span",{className:`pb-metric-percent ${j?"hit":""}`,children:j?"Hit!":`${Math.round(r*100)}%`})]})]},t.key)})})]}),e.jsxs("div",{className:"pb-action-buttons",children:[e.jsx("button",{className:"pb-edit-btn",onClick:()=>G(!0),children:$?.bodyMetrics?"Edit This Month's Measurements":"Add This Month's Measurements"}),e.jsx("button",{className:"pb-edit-btn pb-target-btn",onClick:()=>xe(!0),children:Object.keys(E).length>0?"Edit Targets":"Set Targets"}),(Object.keys(F).length>0||Object.keys(E).length>0)&&e.jsx("button",{className:"pb-edit-btn pb-reset-btn",onClick:mt,disabled:M,children:"Reset All Goals"})]})]}),I&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsxs("h3",{children:["Measurements - ",oe(X)]}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{G(!1),re($?.bodyMetrics||{})},children:"×"})]}),e.jsx("div",{className:"pb-edit-body",children:Pe.map(t=>e.jsx("div",{className:"pb-edit-metric",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsxs("label",{children:[t.name," (",t.suffix,")"]}),e.jsx("input",{type:"number",step:"0.1",value:Q[t.key]??"",onChange:i=>rt(t.key,i.target.value),placeholder:"0"})]})},t.key))}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{G(!1),re($?.bodyMetrics||{})},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:ue,disabled:M,children:M?"Saving...":"Save"})]})]}),Qe&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsx("h3",{children:"Body Metric Targets"}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{xe(!1),K(E)},children:"×"})]}),e.jsxs("div",{className:"pb-edit-body",children:[e.jsx("p",{className:"pb-target-hint",children:"Set targets for your body measurements. Your current measurement is captured automatically."}),Pe.map(t=>{const i=$?.bodyMetrics?.[t.key];return e.jsxs("div",{className:"pb-edit-exercise",children:[e.jsxs("div",{className:"pb-edit-exercise-header",children:[e.jsx("div",{className:"pb-edit-exercise-name",children:t.name}),e.jsxs("div",{className:"pb-edit-current-best",children:["Current: ",i!=null?`${i} ${t.suffix}`:"-"]})]}),e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsxs("label",{children:["Target (",t.suffix,")"]}),e.jsx("input",{type:"number",step:"0.1",value:Se[t.key]?.targetValue??"",onChange:c=>nt(t.key,c.target.value),placeholder:"0"})]})})]},t.key)})]}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{xe(!1),K(E)},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:yt,disabled:M,children:M?"Saving...":"Save Targets"})]})]})]}),p==="history"&&e.jsx("div",{className:"pb-history-section",children:g.length===0?e.jsxs("div",{className:"pb-empty",children:[e.jsx("h4",{children:"No records yet"}),e.jsx("p",{children:"Start adding your monthly benchmarks and measurements to track your progress over time."})]}):e.jsxs(e.Fragment,{children:[R.length>0&&e.jsxs("div",{className:"pb-achievements-wall",children:[e.jsxs("h4",{className:"pb-achievements-wall-title",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"Targets Achieved"]}),e.jsx("div",{className:"pb-achievements-list",children:[...R].reverse().map((t,i)=>e.jsxs("div",{className:"pb-achievement-item",style:{animationDelay:`${i*.05}s`},children:[e.jsx("div",{className:"pb-achievement-star",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),e.jsxs("div",{className:"pb-achievement-info",children:[e.jsx("span",{className:"pb-achievement-label",children:t.label}),e.jsx("span",{className:"pb-achievement-date",children:oe(t.achievedMonth)})]})]},i))})]}),e.jsx("div",{className:"pb-history-controls",children:e.jsx("button",{className:`pb-compare-toggle ${ne?"active":""}`,onClick:()=>{vt(!ne),!ne&&g.length>=2&&(Ke(g[0].month),et(g[g.length-1].month))},children:ne?"Back to Timeline":"Compare Months"})}),ne?e.jsxs("div",{className:"pb-compare",children:[e.jsxs("div",{className:"pb-compare-selectors",children:[e.jsxs("div",{className:"pb-compare-select",children:[e.jsx("label",{children:"From"}),e.jsx("select",{value:ye,onChange:t=>Ke(t.target.value),children:g.map(t=>e.jsx("option",{value:t.month,children:oe(t.month)},t.month))})]}),e.jsx("div",{className:"pb-compare-vs",children:"vs"}),e.jsxs("div",{className:"pb-compare-select",children:[e.jsx("label",{children:"To"}),e.jsx("select",{value:ke,onChange:t=>et(t.target.value),children:g.map(t=>e.jsx("option",{value:t.month,children:oe(t.month)},t.month))})]})]}),ze&&ct&&e.jsxs("div",{className:"pb-compare-results",children:[e.jsxs("div",{className:"pb-compare-group",children:[e.jsx("h4",{children:"Strength Tests"}),e.jsxs("div",{className:"pb-compare-table",children:[e.jsxs("div",{className:"pb-compare-header-row",children:[e.jsx("span",{children:"Exercise"}),e.jsx("span",{children:oe(ye).split(" ")[0]}),e.jsx("span",{children:oe(ke).split(" ")[0]}),e.jsx("span",{children:"Change"})]}),le.map(t=>{const i=ze.benchmarks?.[t.key],c=ct.benchmarks?.[t.key],o=Ye(t,i),r=Ye(t,c),j=$t(r,o);return e.jsxs("div",{className:"pb-compare-row",children:[e.jsx("span",{className:"pb-compare-name",children:t.name}),e.jsx("span",{className:"pb-compare-val",children:i?xt(t,i):"-"}),e.jsx("span",{className:"pb-compare-val",children:c?xt(t,c):"-"}),e.jsx("span",{className:`pb-compare-change ${j!==null?j>=0?"positive":"negative":""}`,children:j!==null?`${j>=0?"+":""}${j.toFixed(1)}%`:"-"})]},t.key)})]})]}),e.jsxs("div",{className:"pb-compare-group",children:[e.jsx("h4",{children:"Body Measurements"}),e.jsxs("div",{className:"pb-compare-table",children:[e.jsxs("div",{className:"pb-compare-header-row",children:[e.jsx("span",{children:"Measurement"}),e.jsx("span",{children:oe(ye).split(" ")[0]}),e.jsx("span",{children:oe(ke).split(" ")[0]}),e.jsx("span",{children:"Change"})]}),Pe.map(t=>{const i=ze.bodyMetrics?.[t.key],c=ct.bodyMetrics?.[t.key],o=i!=null&&c!=null?parseFloat((c-i).toFixed(2)):null;return e.jsxs("div",{className:"pb-compare-row",children:[e.jsx("span",{className:"pb-compare-name",children:t.name}),e.jsx("span",{className:"pb-compare-val",children:i!=null?`${i}`:"-"}),e.jsx("span",{className:"pb-compare-val",children:c!=null?`${c}`:"-"}),e.jsx("span",{className:`pb-compare-change ${o!==null?o>0?"positive":o<0?"negative":"neutral":""}`,children:o!==null?`${o>0?"+":""}${o} ${t.suffix}`:"-"})]},t.key)})]})]})]})]}):e.jsx("div",{className:"pb-timeline",children:[...g].reverse().map((t,i)=>{const c=g.filter(o=>o.month<t.month).pop();return e.jsxs("div",{className:"pb-timeline-item",style:{animationDelay:`${i*.05}s`},children:[e.jsx("div",{className:"pb-timeline-dot"}),e.jsxs("div",{className:"pb-timeline-card",children:[e.jsx("h4",{children:oe(t.month)}),t.benchmarks&&Object.keys(t.benchmarks).length>0&&e.jsxs("div",{className:"pb-timeline-group",children:[e.jsx("h5",{children:"Strength Tests"}),le.map(o=>{const r=t.benchmarks[o.key];if(!r)return null;const j=c?.benchmarks?.[o.key],B=Ye(o,r),u=Ye(o,j),y=$t(B,u);return e.jsxs("div",{className:"pb-timeline-row",children:[e.jsx("span",{className:"pb-timeline-label",children:o.name}),e.jsxs("div",{className:"pb-timeline-values",children:[e.jsx("span",{className:"pb-timeline-value",children:xt(o,r)}),y!==null&&e.jsxs("span",{className:`pb-timeline-change ${y>=0?"positive":"negative"}`,children:[y>=0?"+":"",y.toFixed(1),"%"]})]})]},o.key)})]}),t.bodyMetrics&&Object.keys(t.bodyMetrics).length>0&&e.jsxs("div",{className:"pb-timeline-group",children:[e.jsx("h5",{children:"Body Measurements"}),Pe.map(o=>{const r=t.bodyMetrics[o.key];if(r==null)return null;const j=c?.bodyMetrics?.[o.key],B=j!=null?parseFloat((r-j).toFixed(2)):null;return e.jsxs("div",{className:"pb-timeline-row",children:[e.jsx("span",{className:"pb-timeline-label",children:o.name}),e.jsxs("div",{className:"pb-timeline-values",children:[e.jsxs("span",{className:"pb-timeline-value",children:[r," ",o.suffix]}),B!==null&&e.jsxs("span",{className:`pb-timeline-change ${B>0?"positive":B<0?"negative":"neutral"}`,children:[B>0?"+":"",B," ",o.suffix]})]})]},o.key)})]})]})]},t.id)})})]})})]}),je&&e.jsx("div",{className:"pb-celebration-overlay",onClick:()=>Le(null),children:e.jsxs("div",{className:"pb-celebration-card",children:[e.jsx("div",{className:"pb-celebration-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),e.jsx("h3",{className:"pb-celebration-title",children:je.length===1?"Target Achieved!":`${je.length} Targets Achieved!`}),e.jsx("div",{className:"pb-celebration-badges",children:je.map((t,i)=>e.jsx("div",{className:"pb-celebration-badge",children:t.label},i))}),e.jsx("p",{className:"pb-celebration-sub",children:"Tap to dismiss"})]})}),ve&&e.jsxs("div",{className:`toast-notification ${ve.type}`,children:[e.jsx("span",{className:"toast-icon",children:ve.type==="success"?e.jsx("svg",{className:"success-check-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{className:"check-path",d:"M5 13 L9 17 L19 7"})}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",children:[e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"}),e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"})]})}),e.jsx("span",{className:"toast-message",children:ve.message}),e.jsx("button",{className:"toast-close",onClick:()=>Re(null),children:"×"})]}),e.jsxs("nav",{className:"block-bottom-nav",children:[e.jsxs("button",{className:"block-nav-tab",onClick:()=>Ne("/client"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),e.jsx("span",{children:"Home"})]}),e.jsxs("button",{className:"block-nav-tab",onClick:()=>Ne("/client/forms"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),e.jsx("span",{children:"Forms"})]}),e.jsxs("button",{className:"block-nav-tab",onClick:()=>Ne("/client/tools"),children:[e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),e.jsx("span",{children:"Tools"})]}),e.jsxs("button",{className:"block-nav-tab active",children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 20V10"}),e.jsx("path",{d:"M18 20V4"}),e.jsx("path",{d:"M6 20v-4"})]}),e.jsx("span",{children:"PBs"})]}),L?.circuitAccess&&e.jsxs("button",{className:"block-nav-tab",onClick:()=>Ne("/client/circuit"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),e.jsx("span",{children:"Circuit"})]})]})]})}const ge=[{key:"chestPress",name:"Chest Press",category:"Upper Body - Push",unit:"weight"},{key:"shoulderPress",name:"Shoulder Press",category:"Upper Body - Push",unit:"weight"},{key:"seatedRow",name:"Seated Row",category:"Upper Body - Pull",unit:"weight"},{key:"latPulldown",name:"Lat Pulldown",category:"Upper Body - Pull",unit:"weight"},{key:"squat",name:"Squat",category:"Lower Body",unit:"weight"},{key:"deadlift",name:"Deadlift",category:"Lower Body",unit:"weight"},{key:"plank",name:"Plank",category:"Core",unit:"time"}],De=[{key:"weight",name:"Weight",suffix:"kg"},{key:"chest",name:"Chest",suffix:"cm"},{key:"waist",name:"Waist",suffix:"cm"},{key:"hips",name:"Hips",suffix:"cm"},{key:"leftArm",name:"Left Arm",suffix:"cm"},{key:"rightArm",name:"Right Arm",suffix:"cm"},{key:"leftThigh",name:"Left Thigh",suffix:"cm"},{key:"rightThigh",name:"Right Thigh",suffix:"cm"}];function qt(){const p=new Date;return`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`}function de(p){const[m,g]=p.split("-");return new Date(parseInt(m),parseInt(g)-1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}function jt(p){if(!p&&p!==0)return"-";const m=Math.floor(p/60),g=(p%60).toFixed(2);return m>0?`${m}m ${parseFloat(g).toFixed(0)}s`:`${parseFloat(g).toFixed(2)}s`}function St(p,m){return!p&&p!==0?"-":!m&&m!==0?`${p}kg`:`${p}kg x ${m}`}function Ge(p,m){return m?p.unit==="time"?m.time||0:(m.weight||0)*(m.reps||0):0}function Bt(p,m){return!m||m===0?null:(p-m)/m*100}function Xt({data:p,exerciseKey:m,unit:g}){if(!p||p.length<2)return e.jsx("div",{className:"pb-trend-empty",children:e.jsx("p",{children:"Not enough data for trend line yet"})});const Y=p.map(k=>{const x=k.benchmarks?.[m];return x?g==="time"?x.time||0:(x.weight||0)*(x.reps||0):0}),$e=Math.max(...Y),pe=Math.min(...Y),M=$e-pe||1,C=300,V=100,D=20,ae=C-D*2,P=V-D*2,I=Y.map((k,x)=>{const U=D+x/(Y.length-1)*ae,Q=D+P-(k-pe)/M*P;return{x:U,y:Q,value:k}}),G=I.map((k,x)=>`${x===0?"M":"L"} ${k.x} ${k.y}`).join(" "),be=G+` L ${I[I.length-1].x} ${D+P} L ${I[0].x} ${D+P} Z`;return e.jsxs("div",{className:"pb-trend-chart",children:[e.jsxs("svg",{viewBox:`0 0 ${C} ${V}`,preserveAspectRatio:"xMidYMid meet",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trendGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--color-primary)",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"var(--color-primary)",stopOpacity:"0.02"})]})}),e.jsx("path",{d:be,fill:"url(#trendGradient)"}),e.jsx("path",{d:G,fill:"none",stroke:"var(--color-primary)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}),I.map((k,x)=>e.jsx("circle",{cx:k.x,cy:k.y,r:"4",fill:"var(--bg-card)",stroke:"var(--color-primary)",strokeWidth:"2"},x))]}),e.jsx("div",{className:"pb-trend-labels",children:p.map((k,x)=>e.jsxs("span",{className:"pb-trend-label",children:[k.month.split("-")[1],"/",k.month.split("-")[0].slice(2)]},x))})]})}function Kt(){const[p,m]=h.useState("bests"),[g,Y]=h.useState([]),[$e,pe]=h.useState(!0),[M,C]=h.useState(!1),[V,D]=h.useState(0),[ae,P]=h.useState(!1),[I,G]=h.useState(!1),[be,k]=h.useState(!1),[x,U]=h.useState({}),[Q,re]=h.useState({}),[F,Be]=h.useState({}),[E,Ve]=h.useState({}),[S,Z]=h.useState({}),[Qe,xe]=h.useState(!1),[Se,K]=h.useState({}),[R,Ze]=h.useState([]),[je,Le]=h.useState(null),[ve,Re]=h.useState(null),[ne,vt]=h.useState(!1),[ye,Ke]=h.useState(""),[ke,et]=h.useState(""),[fe,pt]=h.useState({}),[me,tt]=h.useState({}),[Te,st]=h.useState(null),[ie,L]=h.useState(null),[Ae,at]=h.useState(""),Ne=h.useRef(null),ee=h.useRef(0),we=h.useRef(0),X=h.useRef("right"),$=h.useCallback(s=>{D(a=>{const n=Math.max(0,Math.min(ge.length-1,s));return n===a?a:(X.current=n>a?"right":"left",n)})},[]),{currentUser:We,isClient:Ie,clientData:w,loading:Oe}=Lt(),{isDark:Vt}=Rt(),ue=At(),[Fe]=Ot(),rt=Fe.get("mode")==="corebuddy",se=!rt&&(!w?.clientType||w.clientType==="block"),q=h.useCallback((s,a="info")=>{Re({message:s,type:a}),setTimeout(()=>Re(null),4e3)},[]);h.useEffect(()=>{!Oe&&(!We||!Ie)&&ue("/")},[We,Ie,Oe,ue]),h.useEffect(()=>{w&&(se?nt():(async()=>{try{const[a,n,l]=await Promise.all([Tt(H(W,"coreBuddyPBs",w.id)),Tt(H(W,"coreBuddyTargets",w.id)),Tt(H(W,"coreBuddyAchievements",w.id))]);a.exists()&&pt(a.data().exercises||{}),n.exists()&&tt(n.data().targets||{}),l.exists()&&st(l.data())}catch(a){console.error("Error loading Core Buddy PBs:",a)}pe(!1)})())},[w]);const nt=async()=>{try{const s=Ue(qe(W,"personalBests"),Xe("clientId","==",w.id)),n=(await Je(s)).docs.map(N=>({id:N.id,...N.data()}));n.sort((N,f)=>N.month.localeCompare(f.month)),Y(n);const l=Ue(qe(W,"personalBestTargets"),Xe("clientId","==",w.id)),d=await Je(l);if(!d.empty){const N=d.docs[0].data();Be(N.targets||{}),Ve(N.metricTargets||{}),Z(N.targets||{}),K(N.metricTargets||{})}const v=Ue(qe(W,"achievements"),Xe("clientId","==",w.id)),T=await Je(v);T.empty||Ze(T.docs[0].data().badges||[])}catch(s){console.error("Error fetching personal bests:",s)}pe(!1)},yt=async()=>{if(!ie||!Ae||!w)return;const s=parseFloat(Ae),a=fe[ie];if(!a||s<=a.weight){q("Target must be higher than current PB","error");return}C(!0);try{const n={...me,[ie]:{targetWeight:s,setAt:_.now(),currentPBWhenSet:a.weight}};await he(H(W,"coreBuddyTargets",w.id),{clientId:w.id,targets:n,updatedAt:_.now()}),tt(n),L(null),at(""),q("Target set!","success")}catch(n){console.error("Error saving target:",n),q("Failed to save target","error")}C(!1)},mt=s=>{if(!Te?.badges)return!1;const a=me[s];return a?Te.badges.some(n=>n.type==="pb_target"&&n.exercise===s&&n.targetWeight===a.targetWeight):!1},kt=s=>{const a=me[s];if(!a)return null;const n=fe[s];if(!n)return 0;const l=a.currentPBWhenSet||0,d=a.targetWeight,v=d-l;return v<=0?n.weight>=d?1:0:Math.max(0,Math.min((n.weight-l)/v,1))},te=qt(),A=g.find(s=>s.month===te),it=g.filter(s=>s.month<te),ut=it.length>0?it[it.length-1]:null;h.useEffect(()=>{A?(U(A.benchmarks||{}),re(A.bodyMetrics||{})):(U({}),re({}))},[A?.id]);const gt=async(s,a)=>{const n=[];if(s==="strength"?ge.forEach(l=>{const d=F[l.key];if(!d)return;const v=a[l.key];if(!v)return;let T;if(d.targetType==="time"){if(!d.targetValue)return;const N=d.startValue||0,f=v.time||0,z=d.targetValue-N;T=z===0?f>=d.targetValue?1:0:Math.max(0,(f-N)/z)}else{if(!d.targetWeight&&!d.targetReps)return;const N=(d.startWeight||0)*(d.startReps||0),f=(d.targetWeight||0)*(d.targetReps||0),z=(v.weight||0)*(v.reps||0),ce=f-N;T=ce===0?z>=f?1:0:Math.max(0,(z-N)/ce)}if(T>=1&&!(d.targetType==="time"?R.some(f=>f.type==="strength"&&f.key===l.key&&f.targetValue===d.targetValue):R.some(f=>f.type==="strength"&&f.key===l.key&&f.targetWeight===d.targetWeight&&f.targetReps===d.targetReps))){const f=d.targetType==="time"?`${l.name} ${d.targetValue}s`:`${l.name} ${d.targetWeight}kg × ${d.targetReps}`;n.push({type:"strength",key:l.key,...d.targetType==="time"?{targetType:"time",targetValue:d.targetValue}:{targetWeight:d.targetWeight,targetReps:d.targetReps},achievedMonth:te,label:f})}}):De.forEach(l=>{const d=E[l.key];if(!d||!d.targetValue)return;const v=a[l.key];if(v==null)return;const T=d.startValue||0,N=d.targetValue,f=N-T;(f===0?v===N?1:0:Math.max(0,(v-T)/f))>=1&&(R.some(ht=>ht.type==="metric"&&ht.key===l.key&&ht.targetValue===N)||n.push({type:"metric",key:l.key,targetValue:N,achievedMonth:te,label:`${l.name} ${N}${l.suffix}`}))}),n.length>0){const l=[...R,...n];await he(H(W,"achievements",w.id),{clientId:w.id,badges:l,updatedAt:_.now()}),Ze(l),Le(n),setTimeout(()=>Le(null),5e3)}},ze=(s,a)=>{if(s==="strength"){const n=F[a];return n?n.targetType==="time"?R.some(l=>l.type==="strength"&&l.key===a&&l.targetValue===n.targetValue):!n.targetWeight&&!n.targetReps?!1:R.some(l=>l.type==="strength"&&l.key===a&&l.targetWeight===n.targetWeight&&l.targetReps===n.targetReps):!1}else{const n=E[a];return!n||!n.targetValue?!1:R.some(l=>l.type==="metric"&&l.key===a&&l.targetValue===n.targetValue)}},ct=async()=>{C(!0);try{const s=`${w.id}_${te}`,a=A||{};await he(H(W,"personalBests",s),{clientId:w.id,month:te,benchmarks:x,bodyMetrics:a.bodyMetrics||Q||{},createdAt:a.createdAt||_.now(),updatedAt:_.now()}),await gt("strength",x),q("Benchmarks saved!","success"),P(!1),await nt()}catch(s){console.error("Error saving benchmarks:",s),q("Failed to save. Please try again.","error")}C(!1)},J=async()=>{C(!0);try{const s=`${w.id}_${te}`,a=A||{};await he(H(W,"personalBests",s),{clientId:w.id,month:te,benchmarks:a.benchmarks||x||{},bodyMetrics:Q,createdAt:a.createdAt||_.now(),updatedAt:_.now()}),await gt("metric",Q),q("Body metrics saved!","success"),G(!1),await nt()}catch(s){console.error("Error saving metrics:",s),q("Failed to save. Please try again.","error")}C(!1)},Ce=(s,a,n)=>{U(l=>({...l,[s]:{...l[s],[a]:n===""?"":parseFloat(n)}}))},ft=(s,a)=>{re(n=>({...n,[s]:a===""?"":parseFloat(a)}))},He=(s,a,n)=>{Z(l=>({...l,[s]:{...l[s],[a]:n===""?"":parseFloat(n)}}))},Nt=async()=>{C(!0);try{const s=`targets_${w.id}`,a=A?.benchmarks||{},n={};ge.forEach(l=>{const d=a[l.key];l.unit==="time"?S[l.key]?.targetValue&&(n[l.key]={targetType:"time",targetValue:S[l.key].targetValue,startValue:d?.time||0}):(S[l.key]?.targetWeight||S[l.key]?.targetReps)&&(n[l.key]={targetWeight:S[l.key].targetWeight||0,targetReps:S[l.key].targetReps||0,startWeight:d?.weight||0,startReps:d?.reps||0})}),await he(H(W,"personalBestTargets",s),{clientId:w.id,targets:n,metricTargets:E,updatedAt:_.now()}),Be(n),Z(n),q("Targets saved!","success"),k(!1)}catch(s){console.error("Error saving targets:",s),q("Failed to save targets.","error")}C(!1)},Ee=(s,a)=>{K(n=>({...n,[s]:{...n[s],targetValue:a===""?"":parseFloat(a)}}))},_e=async()=>{C(!0);try{const s=`targets_${w.id}`,a={};De.forEach(n=>{if(Se[n.key]?.targetValue){const l=A?.bodyMetrics?.[n.key]||0;a[n.key]={targetValue:Se[n.key].targetValue,startValue:l}}}),await he(H(W,"personalBestTargets",s),{clientId:w.id,targets:F,metricTargets:a,updatedAt:_.now()}),Ve(a),K(a),q("Metric targets saved!","success"),xe(!1)}catch(s){console.error("Error saving metric targets:",s),q("Failed to save targets.","error")}C(!1)},bt=async()=>{if(window.confirm("Reset all goals? This will clear all strength and body metric targets. Your recorded benchmarks and measurements will NOT be affected.")){C(!0);try{const s=H(W,"personalBestTargets",`targets_${w.id}`);await Wt(s),Be({}),Ve({}),Z({}),K({}),q("All goals have been reset","success")}catch(s){console.error("Error resetting targets:",s),q("Failed to reset goals","error")}C(!1)}},lt=(s,a)=>{const n=F[s];if(!n||!a)return null;if(n.targetType==="time"){if(!n.targetValue)return null;const N=n.startValue||0,f=n.targetValue,z=a.time||0,ce=f-N;return ce<=0?z>=f?1:0:Math.max(0,Math.min((z-N)/ce,1))}if(!n.targetWeight&&!n.targetReps)return null;const l=(n.startWeight||0)*(n.startReps||0),d=(n.targetWeight||0)*(n.targetReps||0),v=(a.weight||0)*(a.reps||0),T=d-l;return T<=0?v>=d?1:0:Math.max(0,Math.min((v-l)/T,1))},wt=s=>{const a=E[s];if(!a||!a.targetValue)return null;const n=A?.bodyMetrics?.[s];if(n==null)return null;const l=a.startValue||0,d=a.targetValue,v=d-l;return v===0?n===d?1:0:Math.max(0,Math.min((n-l)/v,1))},ot=s=>{ee.current=s.touches[0].clientX,we.current=0},Ct=s=>{we.current=s.touches[0].clientX-ee.current},t=()=>{we.current<-50?$(V+1):we.current>50&&$(V-1),we.current=0},i=s=>{const a=A?.bodyMetrics?.[s],n=ut?.bodyMetrics?.[s];return a==null||n==null?null:parseFloat((a-n).toFixed(2))},c=g.find(s=>s.month===ye),o=g.find(s=>s.month===ke);if(Oe||$e)return e.jsxs("div",{className:"pb-page",children:[e.jsx("header",{className:"client-header",children:e.jsx("div",{className:"header-content",children:e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"})})}),e.jsxs("main",{className:"pb-main",children:[e.jsx("div",{className:"skeleton skeleton-title",style:{width:180,height:28,marginBottom:20}}),e.jsx("div",{className:"skeleton skeleton-card-large",style:{height:320,borderRadius:16}})]})]});if(!We||!Ie||!w)return null;if(se&&w?.isJunior)return e.jsx(Ut,{});const r=ge[V],j=A?.benchmarks?.[r.key],B=ut?.benchmarks?.[r.key],u=Ge(r,j),y=Ge(r,B),b=Bt(u,y),O=lt(r.key,j),dt=O!==null,Mt=O!==null&&O>=1,Ft=dt?Math.round(O*60):u>0?15:0,Me=F[r.key];return e.jsxs("div",{className:"pb-page",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>ue(rt?"/client/core-buddy":"/client"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"})]})}),e.jsxs("main",{className:"pb-main page-transition-enter",children:[e.jsxs("div",{className:"pb-intro",children:[e.jsx("h2",{children:"Personal Bests"}),e.jsx("p",{children:se?"Track your strength benchmarks and body measurements each month.":"Your all-time best lifts from programme workouts."})]}),!se&&e.jsxs("div",{className:"pb-cb-section",children:[Object.keys(fe).length===0?e.jsxs("div",{className:"pb-empty",children:[e.jsx("div",{className:"pb-cb-empty-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"})})}),e.jsx("h4",{children:"No personal bests yet"}),e.jsx("p",{children:"Complete weight-based workouts to start tracking your personal bests."})]}):e.jsx("div",{className:"pb-cb-grid",children:Object.entries(fe).sort(([s],[a])=>s.localeCompare(a)).map(([s,a],n)=>{const l=me[s],d=kt(s),v=d!==null&&d>=1,T=mt(s),N=d!==null?Math.round(d*60):60;return e.jsxs("div",{className:"pb-cb-card",style:{animationDelay:`${n*.05}s`},children:[e.jsxs("div",{className:"pb-cb-card-ring",children:[e.jsx("svg",{className:"pb-cb-ring-svg",viewBox:"0 0 80 80",children:[...Array(60)].map((f,z)=>{const ce=(z*6-90)*(Math.PI/180),ht=40+30*Math.cos(ce),Et=40+30*Math.sin(ce),Pt=40+37*Math.cos(ce),Dt=40+37*Math.sin(ce),It=z<N;return e.jsx("line",{x1:ht,y1:Et,x2:Pt,y2:Dt,className:`pb-ring-tick ${It?v?"hit":"filled":"empty"}`,strokeWidth:z%5===0?"2":"1.5"},z)})}),e.jsx("div",{className:"pb-cb-ring-icon",children:T?e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"pb-cb-badge-earned",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}):e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"})})})]}),e.jsxs("div",{className:"pb-cb-card-info",children:[e.jsx("h4",{className:"pb-cb-card-name",children:s}),e.jsxs("div",{className:"pb-cb-card-value",children:[a.weight,"kg × ",a.reps]}),a.achievedAt&&e.jsx("div",{className:"pb-cb-card-date",children:(a.achievedAt.toDate?a.achievedAt.toDate():new Date(a.achievedAt)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),l&&!v&&e.jsxs("div",{className:"pb-cb-target-info",children:["Target: ",l.targetWeight,"kg (",Math.round((d||0)*100),"%)"]}),l&&v&&!T&&e.jsx("div",{className:"pb-cb-target-info hit",children:"Target hit!"}),T&&e.jsx("div",{className:"pb-cb-target-info earned",children:"Badge earned!"})]}),e.jsx("div",{className:"pb-cb-card-action",children:l?v&&T?e.jsx("button",{className:"pb-cb-target-btn",onClick:()=>{L(s),at("")},children:e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})})}):null:e.jsx("button",{className:"pb-cb-target-btn",onClick:()=>{L(s),at("")},children:e.jsxs("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]})})})]},s)})}),Object.keys(fe).length>0&&e.jsxs("button",{className:"pb-cb-achievements-link",onClick:()=>ue("/client/core-buddy/achievements"),children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"View Achievements",e.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})]}),ie&&e.jsx("div",{className:"pb-cb-target-modal-overlay",onClick:()=>L(null),children:e.jsxs("div",{className:"pb-cb-target-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"Set Target"}),e.jsx("p",{className:"pb-cb-target-exercise-name",children:ie}),e.jsxs("div",{className:"pb-cb-target-current",children:["Current PB: ",e.jsxs("strong",{children:[fe[ie]?.weight,"kg"]})]}),e.jsxs("div",{className:"pb-cb-target-input-wrap",children:[e.jsx("label",{children:"Your target (kg)"}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.5",value:Ae,onChange:s=>at(s.target.value),placeholder:String((fe[ie]?.weight||0)+5),className:"pb-cb-target-input",autoFocus:!0})]}),e.jsxs("div",{className:"pb-cb-target-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>L(null),children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:yt,disabled:M,children:M?"Saving...":"Set Target"})]})]})})]}),se&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-tabs",children:[e.jsx("button",{className:`pb-tab ${p==="bests"?"active":""}`,onClick:()=>m("bests"),children:"Strength"}),e.jsx("button",{className:`pb-tab ${p==="metrics"?"active":""}`,onClick:()=>m("metrics"),children:"Body Metrics"}),e.jsx("button",{className:`pb-tab ${p==="history"?"active":""}`,onClick:()=>m("history"),children:"History"})]}),p==="bests"&&e.jsxs("div",{className:"pb-strength-section",children:[!ae&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-carousel",ref:Ne,onTouchStart:ot,onTouchMove:Ct,onTouchEnd:t,children:[e.jsx("div",{className:`pb-ring-container slide-from-${X.current}`,children:e.jsxs("div",{className:"pb-ring",children:[e.jsx("svg",{className:"pb-ring-svg",viewBox:"0 0 200 200",children:[...Array(60)].map((s,a)=>{const n=(a*6-90)*(Math.PI/180),l=85,d=96,v=100+l*Math.cos(n),T=100+l*Math.sin(n),N=100+d*Math.cos(n),f=100+d*Math.sin(n),z=a<Math.round(Ft);return e.jsx("line",{x1:v,y1:T,x2:N,y2:f,className:`pb-ring-tick ${z?Mt?"hit":"filled":"empty"}`,strokeWidth:a%5===0?"3":"2"},a)})}),e.jsxs("div",{className:"pb-ring-center",children:[e.jsx("div",{className:"pb-ring-category",children:r.category}),e.jsxs("div",{className:"pb-ring-exercise",children:[r.name,ze("strength",r.key)&&e.jsx("svg",{className:"pb-badge-icon",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})]}),e.jsx("div",{className:"pb-ring-value",children:j?r.unit==="time"?jt(j.time):St(j.weight,j.reps):"-"}),b!==null&&e.jsxs("div",{className:`pb-ring-change ${b>=0?"positive":"negative"}`,children:[b>=0?"+":"",b.toFixed(1),"%"]}),b===null&&j&&e.jsx("div",{className:"pb-ring-change neutral",children:"New entry"}),Me&&e.jsx("div",{className:`pb-ring-target ${Mt?"hit":""}`,children:Mt?"Target hit!":Me.targetType==="time"?`${Me.startValue||0}s → ${Me.targetValue}s`:`${Me.startWeight||0}kg×${Me.startReps||0} → ${Me.targetWeight}kg×${Me.targetReps}`}),!Me&&e.jsx("div",{className:"pb-ring-target none",children:"No target set"})]})]})},V),e.jsx("div",{className:"pb-carousel-dots",children:ge.map((s,a)=>e.jsx("button",{className:`pb-dot ${a===V?"active":""}`,onClick:()=>$(a)},a))}),e.jsx("button",{className:"pb-carousel-arrow left",onClick:()=>$(V-1),disabled:V===0,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("button",{className:"pb-carousel-arrow right",onClick:()=>$(V+1),disabled:V===ge.length-1,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})})})]}),e.jsxs("div",{className:"pb-trend-section",children:[e.jsx("h4",{children:"Trend"}),e.jsx(Xt,{data:g,exerciseKey:r.key,unit:r.unit})]})]}),!ae&&!be&&e.jsxs("div",{className:"pb-action-buttons",children:[e.jsx("button",{className:"pb-edit-btn",onClick:()=>P(!0),children:A?.benchmarks?"Edit This Month's Benchmarks":"Add This Month's Benchmarks"}),e.jsx("button",{className:"pb-edit-btn pb-target-btn",onClick:()=>k(!0),children:Object.keys(F).length>0?"Edit Targets":"Set Targets"}),(Object.keys(F).length>0||Object.keys(E).length>0)&&e.jsx("button",{className:"pb-edit-btn pb-reset-btn",onClick:bt,disabled:M,children:"Reset All Goals"})]}),ae&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsxs("h3",{children:["Benchmarks - ",de(te)]}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{P(!1),U(A?.benchmarks||{})},children:"×"})]}),e.jsx("div",{className:"pb-edit-body",children:ge.map(s=>e.jsxs("div",{className:"pb-edit-exercise",children:[e.jsx("div",{className:"pb-edit-exercise-name",children:s.name}),s.unit==="weight"?e.jsxs("div",{className:"pb-edit-row",children:[e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Weight (kg)"}),e.jsx("input",{type:"number",step:"0.5",value:x[s.key]?.weight??"",onChange:a=>Ce(s.key,"weight",a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Reps"}),e.jsx("input",{type:"number",value:x[s.key]?.reps??"",onChange:a=>Ce(s.key,"reps",a.target.value),placeholder:"0"})]})]}):e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Time (seconds)"}),e.jsx("input",{type:"number",step:"0.01",value:x[s.key]?.time??"",onChange:a=>Ce(s.key,"time",a.target.value),placeholder:"0"})]})})]},s.key))}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{P(!1),U(A?.benchmarks||{})},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:ct,disabled:M,children:M?"Saving...":"Save"})]})]}),be&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsx("h3",{children:"Set Your Targets"}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{k(!1),Z(F)},children:"×"})]}),e.jsxs("div",{className:"pb-edit-body",children:[e.jsx("p",{className:"pb-target-hint",children:"Set a target for each exercise. Your current best is captured automatically from your latest benchmarks."}),ge.map(s=>{const a=A?.benchmarks?.[s.key];let n="-";return a&&(s.unit==="time"&&a.time?n=`${a.time}s`:(a.weight||a.reps)&&(n=`${a.weight||0}kg × ${a.reps||0}`)),e.jsxs("div",{className:"pb-edit-exercise",children:[e.jsxs("div",{className:"pb-edit-exercise-header",children:[e.jsx("div",{className:"pb-edit-exercise-name",children:s.name}),e.jsxs("div",{className:"pb-edit-current-best",children:["Current: ",n]})]}),s.unit==="weight"?e.jsxs("div",{className:"pb-edit-row",children:[e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Target Weight (kg)"}),e.jsx("input",{type:"number",step:"0.5",value:S[s.key]?.targetWeight??"",onChange:l=>He(s.key,"targetWeight",l.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"pb-edit-field",children:[e.jsx("label",{children:"Target Reps"}),e.jsx("input",{type:"number",value:S[s.key]?.targetReps??"",onChange:l=>He(s.key,"targetReps",l.target.value),placeholder:"0"})]})]}):e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsx("label",{children:"Target (seconds)"}),e.jsx("input",{type:"number",step:"1",value:S[s.key]?.targetValue??"",onChange:l=>He(s.key,"targetValue",l.target.value),placeholder:"0"})]})})]},s.key)})]}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{k(!1),Z(F)},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:Nt,disabled:M,children:M?"Saving...":"Save Targets"})]})]})]}),p==="metrics"&&e.jsxs("div",{className:"pb-metrics-section",children:[!I&&!Qe&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-metrics-card",children:[e.jsx("h3",{children:"Body Measurements"}),e.jsx("p",{className:"pb-metrics-month",children:de(te)}),e.jsx("div",{className:"pb-metrics-list",children:De.map(s=>{const a=A?.bodyMetrics?.[s.key],n=i(s.key),l=E[s.key],d=wt(s.key),v=d!==null&&d>=1;return e.jsxs("div",{className:"pb-metric-row",children:[e.jsxs("div",{className:"pb-metric-top",children:[e.jsxs("div",{className:"pb-metric-left",children:[e.jsxs("span",{className:"pb-metric-name",children:[s.name,ze("metric",s.key)&&e.jsx("svg",{className:"pb-badge-icon-sm",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})]}),l&&e.jsxs("span",{className:"pb-metric-target-label",children:["Target: ",l.targetValue," ",s.suffix]})]}),e.jsxs("div",{className:"pb-metric-values",children:[e.jsx("span",{className:"pb-metric-current",children:a!=null?`${a} ${s.suffix}`:"-"}),n!==null&&e.jsxs("span",{className:`pb-metric-change ${n>0?"up":n<0?"down":"same"}`,children:[n>0?"+":"",n," ",s.suffix]})]})]}),d!==null&&e.jsxs("div",{className:"pb-metric-progress",children:[e.jsx("div",{className:"pb-metric-bar",children:e.jsx("div",{className:`pb-metric-bar-fill ${v?"hit":""}`,style:{width:`${Math.round(d*100)}%`}})}),e.jsx("span",{className:`pb-metric-percent ${v?"hit":""}`,children:v?"Hit!":`${Math.round(d*100)}%`})]})]},s.key)})})]}),e.jsxs("div",{className:"pb-action-buttons",children:[e.jsx("button",{className:"pb-edit-btn",onClick:()=>G(!0),children:A?.bodyMetrics?"Edit This Month's Measurements":"Add This Month's Measurements"}),e.jsx("button",{className:"pb-edit-btn pb-target-btn",onClick:()=>xe(!0),children:Object.keys(E).length>0?"Edit Targets":"Set Targets"}),(Object.keys(F).length>0||Object.keys(E).length>0)&&e.jsx("button",{className:"pb-edit-btn pb-reset-btn",onClick:bt,disabled:M,children:"Reset All Goals"})]})]}),I&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsxs("h3",{children:["Measurements - ",de(te)]}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{G(!1),re(A?.bodyMetrics||{})},children:"×"})]}),e.jsx("div",{className:"pb-edit-body",children:De.map(s=>e.jsx("div",{className:"pb-edit-metric",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsxs("label",{children:[s.name," (",s.suffix,")"]}),e.jsx("input",{type:"number",step:"0.1",value:Q[s.key]??"",onChange:a=>ft(s.key,a.target.value),placeholder:"0"})]})},s.key))}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{G(!1),re(A?.bodyMetrics||{})},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:J,disabled:M,children:M?"Saving...":"Save"})]})]}),Qe&&e.jsxs("div",{className:"pb-edit-card",children:[e.jsxs("div",{className:"pb-edit-header",children:[e.jsx("h3",{children:"Body Metric Targets"}),e.jsx("button",{className:"pb-edit-close",onClick:()=>{xe(!1),K(E)},children:"×"})]}),e.jsxs("div",{className:"pb-edit-body",children:[e.jsx("p",{className:"pb-target-hint",children:"Set targets for your body measurements. Your current measurement is captured automatically."}),De.map(s=>{const a=A?.bodyMetrics?.[s.key];return e.jsxs("div",{className:"pb-edit-exercise",children:[e.jsxs("div",{className:"pb-edit-exercise-header",children:[e.jsx("div",{className:"pb-edit-exercise-name",children:s.name}),e.jsxs("div",{className:"pb-edit-current-best",children:["Current: ",a!=null?`${a} ${s.suffix}`:"-"]})]}),e.jsx("div",{className:"pb-edit-row",children:e.jsxs("div",{className:"pb-edit-field full",children:[e.jsxs("label",{children:["Target (",s.suffix,")"]}),e.jsx("input",{type:"number",step:"0.1",value:Se[s.key]?.targetValue??"",onChange:n=>Ee(s.key,n.target.value),placeholder:"0"})]})})]},s.key)})]}),e.jsxs("div",{className:"pb-edit-actions",children:[e.jsx("button",{className:"pb-cancel-btn",onClick:()=>{xe(!1),K(E)},children:"Cancel"}),e.jsx("button",{className:"pb-save-btn",onClick:_e,disabled:M,children:M?"Saving...":"Save Targets"})]})]})]}),p==="history"&&e.jsx("div",{className:"pb-history-section",children:g.length===0?e.jsxs("div",{className:"pb-empty",children:[e.jsx("h4",{children:"No records yet"}),e.jsx("p",{children:"Start adding your monthly benchmarks and measurements to track your progress over time."})]}):e.jsxs(e.Fragment,{children:[R.length>0&&e.jsxs("div",{className:"pb-achievements-wall",children:[e.jsxs("h4",{className:"pb-achievements-wall-title",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"Targets Achieved"]}),e.jsx("div",{className:"pb-achievements-list",children:[...R].reverse().map((s,a)=>e.jsxs("div",{className:"pb-achievement-item",style:{animationDelay:`${a*.05}s`},children:[e.jsx("div",{className:"pb-achievement-star",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),e.jsxs("div",{className:"pb-achievement-info",children:[e.jsx("span",{className:"pb-achievement-label",children:s.label}),e.jsx("span",{className:"pb-achievement-date",children:de(s.achievedMonth)})]})]},a))})]}),e.jsx("div",{className:"pb-history-controls",children:e.jsx("button",{className:`pb-compare-toggle ${ne?"active":""}`,onClick:()=>{vt(!ne),!ne&&g.length>=2&&(Ke(g[0].month),et(g[g.length-1].month))},children:ne?"Back to Timeline":"Compare Months"})}),ne?e.jsxs("div",{className:"pb-compare",children:[e.jsxs("div",{className:"pb-compare-selectors",children:[e.jsxs("div",{className:"pb-compare-select",children:[e.jsx("label",{children:"From"}),e.jsx("select",{value:ye,onChange:s=>Ke(s.target.value),children:g.map(s=>e.jsx("option",{value:s.month,children:de(s.month)},s.month))})]}),e.jsx("div",{className:"pb-compare-vs",children:"vs"}),e.jsxs("div",{className:"pb-compare-select",children:[e.jsx("label",{children:"To"}),e.jsx("select",{value:ke,onChange:s=>et(s.target.value),children:g.map(s=>e.jsx("option",{value:s.month,children:de(s.month)},s.month))})]})]}),c&&o&&e.jsxs("div",{className:"pb-compare-results",children:[e.jsxs("div",{className:"pb-compare-group",children:[e.jsx("h4",{children:"Strength Benchmarks"}),e.jsxs("div",{className:"pb-compare-table",children:[e.jsxs("div",{className:"pb-compare-header-row",children:[e.jsx("span",{children:"Exercise"}),e.jsx("span",{children:de(ye).split(" ")[0]}),e.jsx("span",{children:de(ke).split(" ")[0]}),e.jsx("span",{children:"Change"})]}),ge.map(s=>{const a=c.benchmarks?.[s.key],n=o.benchmarks?.[s.key],l=Ge(s,a),d=Ge(s,n),v=Bt(d,l);return e.jsxs("div",{className:"pb-compare-row",children:[e.jsx("span",{className:"pb-compare-name",children:s.name}),e.jsx("span",{className:"pb-compare-val",children:a?s.unit==="time"?jt(a.time):`${a.weight}x${a.reps}`:"-"}),e.jsx("span",{className:"pb-compare-val",children:n?s.unit==="time"?jt(n.time):`${n.weight}x${n.reps}`:"-"}),e.jsx("span",{className:`pb-compare-change ${v!==null?v>=0?"positive":"negative":""}`,children:v!==null?`${v>=0?"+":""}${v.toFixed(1)}%`:"-"})]},s.key)})]})]}),e.jsxs("div",{className:"pb-compare-group",children:[e.jsx("h4",{children:"Body Measurements"}),e.jsxs("div",{className:"pb-compare-table",children:[e.jsxs("div",{className:"pb-compare-header-row",children:[e.jsx("span",{children:"Measurement"}),e.jsx("span",{children:de(ye).split(" ")[0]}),e.jsx("span",{children:de(ke).split(" ")[0]}),e.jsx("span",{children:"Change"})]}),De.map(s=>{const a=c.bodyMetrics?.[s.key],n=o.bodyMetrics?.[s.key],l=a!=null&&n!=null?parseFloat((n-a).toFixed(2)):null;return e.jsxs("div",{className:"pb-compare-row",children:[e.jsx("span",{className:"pb-compare-name",children:s.name}),e.jsx("span",{className:"pb-compare-val",children:a!=null?`${a}`:"-"}),e.jsx("span",{className:"pb-compare-val",children:n!=null?`${n}`:"-"}),e.jsx("span",{className:`pb-compare-change ${l!==null?l>0?"positive":l<0?"negative":"neutral":""}`,children:l!==null?`${l>0?"+":""}${l} ${s.suffix}`:"-"})]},s.key)})]})]})]})]}):e.jsx("div",{className:"pb-timeline",children:[...g].reverse().map((s,a)=>{const n=g.find(l=>l.month<s.month&&g.indexOf(l)===g.indexOf(s)-1)||g.filter(l=>l.month<s.month).pop();return e.jsxs("div",{className:"pb-timeline-item",style:{animationDelay:`${a*.05}s`},children:[e.jsx("div",{className:"pb-timeline-dot"}),e.jsxs("div",{className:"pb-timeline-card",children:[e.jsx("h4",{children:de(s.month)}),s.benchmarks&&Object.keys(s.benchmarks).length>0&&e.jsxs("div",{className:"pb-timeline-group",children:[e.jsx("h5",{children:"Strength Benchmarks"}),ge.map(l=>{const d=s.benchmarks[l.key];if(!d)return null;const v=n?.benchmarks?.[l.key],T=Ge(l,d),N=Ge(l,v),f=Bt(T,N);return e.jsxs("div",{className:"pb-timeline-row",children:[e.jsx("span",{className:"pb-timeline-label",children:l.name}),e.jsxs("div",{className:"pb-timeline-values",children:[e.jsx("span",{className:"pb-timeline-value",children:l.unit==="time"?jt(d.time):St(d.weight,d.reps)}),f!==null&&e.jsxs("span",{className:`pb-timeline-change ${f>=0?"positive":"negative"}`,children:[f>=0?"+":"",f.toFixed(1),"%"]})]})]},l.key)})]}),s.bodyMetrics&&Object.keys(s.bodyMetrics).length>0&&e.jsxs("div",{className:"pb-timeline-group",children:[e.jsx("h5",{children:"Body Measurements"}),De.map(l=>{const d=s.bodyMetrics[l.key];if(d==null)return null;const v=n?.bodyMetrics?.[l.key],T=v!=null?parseFloat((d-v).toFixed(2)):null;return e.jsxs("div",{className:"pb-timeline-row",children:[e.jsx("span",{className:"pb-timeline-label",children:l.name}),e.jsxs("div",{className:"pb-timeline-values",children:[e.jsxs("span",{className:"pb-timeline-value",children:[d," ",l.suffix]}),T!==null&&e.jsxs("span",{className:`pb-timeline-change ${T>0?"positive":T<0?"negative":"neutral"}`,children:[T>0?"+":"",T," ",l.suffix]})]})]},l.key)})]})]})]},s.id)})})]})})]})]}),je&&e.jsx("div",{className:"pb-celebration-overlay",onClick:()=>Le(null),children:e.jsxs("div",{className:"pb-celebration-card",children:[e.jsx("div",{className:"pb-celebration-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),e.jsx("h3",{className:"pb-celebration-title",children:je.length===1?"Target Achieved!":`${je.length} Targets Achieved!`}),e.jsx("div",{className:"pb-celebration-badges",children:je.map((s,a)=>e.jsx("div",{className:"pb-celebration-badge",children:s.label},a))}),e.jsx("p",{className:"pb-celebration-sub",children:"Tap to dismiss"})]})}),ve&&e.jsxs("div",{className:`toast-notification ${ve.type}`,children:[e.jsx("span",{className:"toast-icon",children:ve.type==="success"?e.jsx("svg",{className:"success-check-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{className:"check-path",d:"M5 13 L9 17 L19 7"})}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",children:[e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"}),e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"})]})}),e.jsx("span",{className:"toast-message",children:ve.message}),e.jsx("button",{className:"toast-close",onClick:()=>Re(null),children:"×"})]}),se&&e.jsxs("nav",{className:"block-bottom-nav",children:[e.jsxs("button",{className:"block-nav-tab",onClick:()=>ue("/client"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),e.jsx("span",{children:"Home"})]}),e.jsxs("button",{className:"block-nav-tab",onClick:()=>ue("/client/forms"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),e.jsx("span",{children:"Forms"})]}),e.jsxs("button",{className:"block-nav-tab",onClick:()=>ue("/client/tools"),children:[e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),e.jsx("span",{children:"Tools"})]}),e.jsxs("button",{className:"block-nav-tab active",children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 20V10"}),e.jsx("path",{d:"M18 20V4"}),e.jsx("path",{d:"M6 20v-4"})]}),e.jsx("span",{children:"PBs"})]}),w?.circuitAccess&&e.jsxs("button",{className:"block-nav-tab",onClick:()=>ue("/client/circuit"),children:[e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),e.jsx("span",{children:"Circuit"})]})]}),rt&&e.jsx(zt,{active:"progress"})]})}export{Kt as default};
