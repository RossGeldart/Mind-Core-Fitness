import{r as h,k as be,l as je,m as ke,q as W,c as H,d as D,w as v,g as O,T as K,j as e,u as _,e as X}from"./index-xmWl_PCp.js";import{C as ge}from"./CoreBuddyNav-CJ5WHbgj.js";function ee(){const a=new Date,r=a.getDay(),l=r===0?-6:1-r,c=new Date(a);c.setDate(a.getDate()+l),c.setHours(0,0,0,0);const i=new Date(c);return i.setDate(c.getDate()+6),i.setHours(23,59,59,999),{start:c,end:i}}function ve(){const a=new Date,r=new Date(a.getFullYear(),a.getMonth(),1);r.setHours(0,0,0,0);const l=new Date(a.getFullYear(),a.getMonth()+1,0);return l.setHours(23,59,59,999),{start:r,end:l}}function A(a){return a.toISOString().split("T")[0]}function F(a){if(!a)return"?";const r=a.trim().split(/\s+/);return r.length===1?r[0][0].toUpperCase():(r[0][0]+r[r.length-1][0]).toUpperCase()}function fe(a){if(a<60)return`${a}m`;const r=Math.floor(a/60),l=a%60;return l>0?`${r}h ${l}m`:`${r}h`}function we(a){const r=new Date(a),l=r.getDay(),c=l===0?-6:1-l;return r.setDate(r.getDate()+c),r.setHours(0,0,0,0),r}function Ne(a){if(a.size===0)return 0;const l=we(new Date);let c=0,i=new Date(l);const b=new Date(i);b.setDate(b.getDate()+6);let j=!1;a.forEach(u=>{const p=new Date(u);p>=i&&p<=b&&(j=!0)}),j||i.setDate(i.getDate()-7);for(let u=0;u<52;u++){const p=new Date(i),k=new Date(i);k.setDate(k.getDate()+6);let g=!1;if(a.forEach(f=>{const E=new Date(f);E>=p&&E<=k&&(g=!0)}),g)c++,i.setDate(i.getDate()-7);else break}return c}const se=[{key:"workouts",label:"Workouts",icon:"M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2.71 7 4.14 8.43 7.71 4.86 16.29 13.43 12.71 17 14.14 18.43 15.57 17 17 18.43 14.14 21.29l1.43 1.43 1.43-1.43 1.43 1.43 2.14-2.14 1.43 1.43L22 20.57z"},{key:"minutes",label:"Minutes",icon:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"},{key:"streak",label:"Streak",icon:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"}],P=["#FFD700","#A8B4C0","#CD7F32"];function Ce(){const[a,r]=h.useState("workouts"),[l,c]=h.useState("week"),[i,b]=h.useState(!0),[j,u]=h.useState([]),[p,k]=h.useState(null),[g,f]=h.useState(!1),[E,T]=h.useState(!1),[C,Q]=h.useState(null),{currentUser:$,isClient:V,clientData:m,updateClientData:J,loading:z}=be(),{isDark:Y,toggleTheme:ae}=je(),U=ke(),M=h.useCallback((s,N="info")=>{Q({message:s,type:N}),setTimeout(()=>Q(null),4e3)},[]);h.useEffect(()=>{!z&&(!$||!V)&&U("/")},[$,V,z,U]),h.useEffect(()=>{m&&k(m.leaderboardOptIn===!0)},[m]),h.useEffect(()=>{!m||!p||re()},[m,p,a,l]);const te=async()=>{f(!0);try{await _(X(D,"clients",m.id),{leaderboardOptIn:!0}),J({leaderboardOptIn:!0}),k(!0),M("You're on the leaderboard!","success")}catch(s){console.error("Error opting in:",s),M("Failed to join. Try again.","error")}finally{f(!1)}},ne=async()=>{f(!0),T(!1);try{await _(X(D,"clients",m.id),{leaderboardOptIn:!1}),J({leaderboardOptIn:!1}),k(!1),u([]),M("You've left the leaderboard","info")}catch(s){console.error("Error opting out:",s),M("Failed to leave. Try again.","error")}finally{f(!1)}},re=async()=>{b(!0);try{const s=W(H(D,"clients"),v("leaderboardOptIn","==",!0)),S=(await O(s)).docs.map(n=>({id:n.id,...n.data()}));if(S.length===0){u([]),b(!1);return}let y;if(a==="streak"){const n=new Date,t=new Date(n);t.setDate(t.getDate()-365),t.setHours(0,0,0,0),y={start:t,end:n}}else y=l==="week"?ee():ve();const q=A(y.start),Z=A(y.end),oe=K.fromDate(y.start),ie=K.fromDate(y.end),ce=W(H(D,"workoutLogs"),v("completedAt",">=",oe),v("completedAt","<=",ie)),de=await O(ce),he=W(H(D,"circuitSessions"),v("date",">=",q),v("date","<=",Z)),me=await O(he),ue=W(H(D,"sessions"),v("date",">=",q),v("date","<=",Z)),pe=await O(ue),G=new Set(S.map(n=>n.id)),d={};S.forEach(n=>{d[n.id]={id:n.id,name:n.name,workouts:0,minutes:0,workoutDates:new Set}}),de.docs.forEach(n=>{const t=n.data();if(G.has(t.clientId)&&(d[t.clientId].workouts++,d[t.clientId].minutes+=t.duration||0,t.completedAt)){const x=t.completedAt.toDate();d[t.clientId].workoutDates.add(A(x))}}),me.docs.forEach(n=>{const t=n.data();(t.slots||[]).forEach(x=>{x.attended&&x.memberId&&G.has(x.memberId)&&(d[x.memberId].workouts++,d[x.memberId].minutes+=45,d[x.memberId].workoutDates.add(t.date))})});const xe=A(new Date);pe.docs.forEach(n=>{const t=n.data();G.has(t.clientId)&&t.date<=xe&&(d[t.clientId].workouts++,d[t.clientId].minutes+=t.duration||45,d[t.clientId].workoutDates.add(t.date))}),a==="streak"&&Object.values(d).forEach(n=>{n.streak=Ne(n.workoutDates)});let I=Object.values(d);a==="workouts"?I.sort((n,t)=>t.workouts-n.workouts||n.name.localeCompare(t.name)):a==="minutes"?I.sort((n,t)=>t.minutes-n.minutes||n.name.localeCompare(t.name)):I.sort((n,t)=>t.streak-n.streak||n.name.localeCompare(t.name)),I.forEach((n,t)=>{n.rank=t+1}),u(I)}catch(s){console.error("Error fetching leaderboard:",s),M("Failed to load leaderboard","error")}finally{b(!1)}},L=s=>a==="workouts"?s.workouts:a==="minutes"?fe(s.minutes):s.streak,le=()=>{if(a==="streak")return"All Time";if(l==="week"){const{start:N,end:S}=ee();return`${N.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${S.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return new Date().toLocaleDateString("en-GB",{month:"long",year:"numeric"})},w=s=>s.id===m?.id,B=j.find(s=>s.id===m?.id);if(z)return e.jsx("div",{className:"lb-loading",children:e.jsx("div",{className:"lb-loading-spinner"})});if(!$||!V||!m)return null;if(p===!1)return e.jsxs("div",{className:"lb-page","data-theme":Y?"dark":"light",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:ae,"aria-label":"Toggle theme",children:Y?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),e.jsx("main",{className:"lb-optin-main",children:e.jsxs("div",{className:"lb-optin-card",children:[e.jsx("div",{className:"lb-optin-trophy",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]})}),e.jsx("h2",{className:"lb-optin-title",children:"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-desc",children:"Compete with other Mind Core Fitness members"}),e.jsx("div",{className:"lb-optin-categories",children:se.map(s=>e.jsxs("div",{className:"lb-optin-category",children:[e.jsx("div",{className:"lb-optin-category-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})})}),e.jsxs("div",{className:"lb-optin-category-text",children:[e.jsx("span",{className:"lb-optin-category-name",children:s.label}),e.jsxs("span",{className:"lb-optin-category-desc",children:[s.key==="workouts"&&"Total workouts from all training types",s.key==="minutes"&&"Total active minutes across all sessions",s.key==="streak"&&"Consecutive weeks with at least one workout"]})]})]},s.key))}),e.jsx("button",{className:"lb-optin-btn",onClick:te,disabled:g,children:g?"Joining...":"Join the Leaderboard"}),e.jsx("p",{className:"lb-optin-note",children:"Your full name will be visible to other members"})]})})]});const o=j.slice(0,3),R=j.slice(3);return e.jsxs("div",{className:"lb-page","data-theme":Y?"dark":"light",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>U("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:()=>T(!0),"aria-label":"Settings",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})})]})}),e.jsxs("main",{className:"lb-main",children:[e.jsx("div",{className:"lb-tabs",children:se.map(s=>e.jsxs("button",{className:`lb-tab ${a===s.key?"lb-tab-active":""}`,onClick:()=>r(s.key),children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:s.icon})}),e.jsx("span",{children:s.label})]},s.key))}),a!=="streak"&&e.jsx("div",{className:"lb-period-row",children:e.jsxs("div",{className:"lb-period-toggle",children:[e.jsx("button",{className:`lb-period-btn ${l==="week"?"lb-period-active":""}`,onClick:()=>c("week"),children:"This Week"}),e.jsx("button",{className:`lb-period-btn ${l==="month"?"lb-period-active":""}`,onClick:()=>c("month"),children:"This Month"})]})}),e.jsx("div",{className:"lb-period-label",children:le()}),i?e.jsx("div",{className:"lb-content-loading",children:e.jsx("div",{className:"lb-loading-spinner"})}):j.length===0?e.jsxs("div",{className:"lb-empty",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"lb-empty-icon",children:[e.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),e.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),e.jsx("path",{d:"M4 22h16"}),e.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),e.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),e.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]}),e.jsx("h3",{children:"No one here yet"}),e.jsx("p",{children:"Be the first to get a workout in!"})]}):e.jsxs(e.Fragment,{children:[o.length>0&&e.jsxs("div",{className:"lb-podium",children:[e.jsx("div",{className:"lb-podium-place lb-podium-2nd",children:o[1]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${w(o[1])?"lb-avatar-you":""}`,style:{borderColor:P[1]},children:F(o[1].name)}),e.jsx("div",{className:"lb-podium-name",children:o[1].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:L(o[1])}),e.jsx("div",{className:"lb-podium-bar lb-bar-2nd",children:e.jsx("span",{className:"lb-podium-rank",children:"2"})})]}):e.jsx("div",{className:"lb-podium-spacer"})}),e.jsxs("div",{className:"lb-podium-place lb-podium-1st",children:[e.jsx("div",{className:"lb-podium-crown",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"#FFD700",stroke:"none",children:[e.jsx("path",{d:"M2.5 18.5l3-7 4 4 3-9 3 9 4-4 3 7z"}),e.jsx("rect",{x:"3",y:"18",width:"18",height:"2",rx:"1"})]})}),e.jsx("div",{className:`lb-podium-avatar lb-avatar-1st ${w(o[0])?"lb-avatar-you":""}`,style:{borderColor:P[0]},children:F(o[0].name)}),e.jsx("div",{className:"lb-podium-name",children:o[0].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:L(o[0])}),e.jsx("div",{className:"lb-podium-bar lb-bar-1st",children:e.jsx("span",{className:"lb-podium-rank",children:"1"})})]}),e.jsx("div",{className:"lb-podium-place lb-podium-3rd",children:o[2]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`lb-podium-avatar ${w(o[2])?"lb-avatar-you":""}`,style:{borderColor:P[2]},children:F(o[2].name)}),e.jsx("div",{className:"lb-podium-name",children:o[2].name.split(" ")[0]}),e.jsx("div",{className:"lb-podium-stat",children:L(o[2])}),e.jsx("div",{className:"lb-podium-bar lb-bar-3rd",children:e.jsx("span",{className:"lb-podium-rank",children:"3"})})]}):e.jsx("div",{className:"lb-podium-spacer"})})]}),R.length>0&&e.jsx("div",{className:"lb-rankings",children:R.map((s,N)=>e.jsxs("div",{className:`lb-rank-item ${w(s)?"lb-rank-you":""}`,style:{animationDelay:`${N*.04}s`},children:[e.jsx("span",{className:"lb-rank-number",children:s.rank}),e.jsx("div",{className:`lb-rank-avatar ${w(s)?"lb-avatar-you":""}`,children:F(s.name)}),e.jsx("div",{className:"lb-rank-info",children:e.jsxs("span",{className:"lb-rank-name",children:[s.name,w(s)&&e.jsx("span",{className:"lb-you-badge",children:"You"})]})}),e.jsx("span",{className:"lb-rank-stat",children:L(s)})]},s.id))}),B&&B.rank>5&&e.jsxs("div",{className:"lb-your-position",children:[e.jsxs("span",{className:"lb-your-rank",children:["#",B.rank]}),e.jsx("span",{className:"lb-your-label",children:"Your Position"}),e.jsx("span",{className:"lb-your-stat",children:L(B)})]})]})]}),E&&e.jsx("div",{className:"lb-modal-overlay",onClick:()=>T(!1),children:e.jsxs("div",{className:"lb-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{children:"Leave the Leaderboard?"}),e.jsx("p",{children:"Your name will no longer appear to other members. You can rejoin anytime."}),e.jsxs("div",{className:"lb-modal-actions",children:[e.jsx("button",{className:"lb-modal-cancel",onClick:()=>T(!1),children:"Stay"}),e.jsx("button",{className:"lb-modal-confirm",onClick:ne,disabled:g,children:g?"Leaving...":"Leave"})]})]})}),e.jsx(ge,{}),C&&e.jsxs("div",{className:`toast-notification ${C.type}`,children:[e.jsx("span",{className:"toast-icon",children:C.type==="success"?e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 13 L9 17 L19 7"})}):C.type==="error"?e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",children:[e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"}),e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"})]}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("circle",{cx:"12",cy:"16",r:"1",fill:"currentColor"})]})}),e.jsx("span",{className:"toast-message",children:C.message})]})]})}export{Ce as default};
