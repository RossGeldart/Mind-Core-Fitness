import{l as f,y as N,n as v,r as h,j as e,z as j}from"./index-0_nfK038.js";import{S as w}from"./stripe-Da7IPrZW.js";function S(){const{currentUser:i,clientData:t}=f(),{isPremium:x,subscriptionStatus:g}=N(),p=v(),[l,s]=h.useState(null),[c,r]=h.useState(null);h.useEffect(()=>{const a=n=>{n.persisted&&s(null)};return window.addEventListener("pageshow",a),()=>window.removeEventListener("pageshow",a)},[]);async function k(){if(t?.stripeCustomerId){s("manage"),r(null);try{const a={"Content-Type":"application/json"};if(i){const d=await i.getIdToken();a.Authorization=`Bearer ${d}`}const o=await(await fetch("/api/create-portal-session",{method:"POST",headers:a,body:JSON.stringify({stripeCustomerId:t.stripeCustomerId,clientId:t.id})})).json();o.url?window.location.href=o.url:r(o.error||"Something went wrong")}catch(a){console.error("Portal error:",a),r("Unable to open subscription portal")}finally{s(null)}}}async function m(a){if(s(a),r(null),!i?.uid||!i?.email||!t?.id){r("Please sign in again and retry"),s(null);return}try{typeof fbq=="function"&&fbq("track","InitiateCheckout",{content_name:"Core Buddy "+(a==="annual"?"Annual":"Monthly"),content_category:"Fitness App",value:a==="annual"?99.99:9.99,currency:"GBP"});const n=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:w[a],clientId:t.id,uid:i.uid,email:i.email})});if(!n.ok){const d=await n.text();let u;try{u=JSON.parse(d).error}catch{u=d}r(u||`Server error (${n.status})`),s(null);return}const o=await n.json();o.url?window.location.href=o.url:(r("No checkout URL returned — please try again"),s(null))}catch(n){console.error("Checkout error:",n),r("Unable to reach checkout — check your connection"),s(null)}}return x?e.jsxs("div",{className:"upgrade-page",children:[e.jsx(j,{className:"upgrade-theme-toggle"}),e.jsxs("button",{className:"upgrade-back-btn",onClick:()=>p(-1),children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]}),"Back"]}),e.jsxs("div",{className:"upgrade-header",children:[e.jsx("div",{className:"upgrade-icon upgrade-icon-active",children:e.jsx("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z"})})}),e.jsx("h1",{children:"You're on Premium!"}),e.jsxs("p",{className:"upgrade-status",children:["Status: ",e.jsx("strong",{children:g||"active"})]})]}),t?.stripeCustomerId&&e.jsx("button",{className:"upgrade-manage-btn",onClick:k,disabled:l==="manage",children:l==="manage"?"Opening...":"Manage Subscription"}),c&&e.jsx("p",{className:"upgrade-error",children:c})]}):e.jsxs("div",{className:"upgrade-page",children:[e.jsx(j,{className:"upgrade-theme-toggle"}),e.jsxs("button",{className:"upgrade-back-btn",onClick:()=>p(-1),children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]}),"Back"]}),e.jsxs("div",{className:"upgrade-header",children:[e.jsx("div",{className:"upgrade-icon",children:e.jsx("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z"})})}),e.jsx("h1",{children:"Upgrade to Premium"}),e.jsx("p",{children:"Unlock all Core Buddy features with a 7-day free trial"})]}),e.jsxs("div",{className:"upgrade-plans",children:[e.jsxs("div",{className:"plan-card",children:[e.jsx("div",{className:"plan-name",children:"Monthly"}),e.jsxs("div",{className:"plan-price",children:[e.jsx("span",{className:"plan-amount",children:"£9.99"}),e.jsx("span",{className:"plan-period",children:"/month"})]}),e.jsxs("ul",{className:"plan-features",children:[e.jsx("li",{children:"7-day free trial"}),e.jsx("li",{children:"Unlimited workout durations"}),e.jsx("li",{children:"Unlimited weekly workouts"}),e.jsx("li",{children:"Save & replay workouts"}),e.jsx("li",{children:"Nutrition tracking"}),e.jsx("li",{children:"Buddies & social"}),e.jsx("li",{children:"Cancel anytime"})]}),e.jsx("button",{className:"plan-cta",onClick:()=>m("monthly"),disabled:!!l,children:l==="monthly"?"Loading...":"Start Free Trial"})]}),e.jsxs("div",{className:"plan-card plan-card-featured",children:[e.jsx("div",{className:"plan-badge-save",children:"Best Value — Save 17%"}),e.jsx("div",{className:"plan-name",children:"Annual"}),e.jsxs("div",{className:"plan-price",children:[e.jsx("span",{className:"plan-amount",children:"£99.99"}),e.jsx("span",{className:"plan-period",children:"/year"})]}),e.jsx("div",{className:"plan-price-sub",children:"That's just £8.33/month"}),e.jsxs("ul",{className:"plan-features",children:[e.jsx("li",{children:"7-day free trial"}),e.jsx("li",{children:"Unlimited workout durations"}),e.jsx("li",{children:"Unlimited weekly workouts"}),e.jsx("li",{children:"Save & replay workouts"}),e.jsx("li",{children:"Nutrition tracking"}),e.jsx("li",{children:"Buddies & social"}),e.jsx("li",{children:"Best value"})]}),e.jsx("button",{className:"plan-cta plan-cta-featured",onClick:()=>m("annual"),disabled:!!l,children:l==="annual"?"Loading...":"Start Free Trial"})]})]}),c&&e.jsx("p",{className:"upgrade-error",children:c})]})}export{S as default};
