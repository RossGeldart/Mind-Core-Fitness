import{k as ce,l as re,m as ne,r as o,j as e,i as oe,e as ie,d as M,c as L,q as D,w as C,g as $}from"./index-B7pQgPf9.js";import{C as le}from"./CoreBuddyNav-HTaMOPjh.js";const de="/login/assets/workouts-DXJtvJtv.jpg",g=60,S=[10,25,50,100,200,500,1e3],he=5;function me(h){return h.toISOString().split("T")[0]}function ue(h){let j=0;for(const d of S){if(h<d)return{prev:j,next:d};j=d}return{prev:S[S.length-1],next:h+100}}const be={fullbody_4wk:{duration:4,daysPerWeek:3},fullbody_8wk:{duration:8,daysPerWeek:3},fullbody_12wk:{duration:12,daysPerWeek:3},core_4wk:{duration:4,daysPerWeek:3},core_8wk:{duration:8,daysPerWeek:3},core_12wk:{duration:12,daysPerWeek:3},upper_4wk:{duration:4,daysPerWeek:3},lower_4wk:{duration:4,daysPerWeek:3}};function je(){const{currentUser:h,isClient:j,clientData:d,logout:R,loading:k}=ce(),{isDark:T,toggleTheme:O}=re(),m=ne(),[v,A]=o.useState({hours:0,minutes:0,seconds:0}),[H,q]=o.useState(0),[W,U]=o.useState(0),[xe,F]=o.useState(""),[f,z]=o.useState(0),[P,J]=o.useState(0),[K,X]=o.useState(!1),[x,B]=o.useState(null);o.useCallback((s,c="info")=>{B({message:s,type:c}),setTimeout(()=>B(null),4e3)},[]),o.useEffect(()=>{!k&&!h&&m("/")},[k,h,m]),o.useEffect(()=>{const s=()=>{const t=new Date,a=new Date(t);a.setHours(23,59,59,999);const r=a-t,i=Math.floor(r/(1e3*60*60)),l=Math.floor(r%(1e3*60*60)/(1e3*60)),n=Math.floor(r%(1e3*60)/1e3);A({hours:i,minutes:l,seconds:n}),q(60-n)};s();const c=setInterval(s,1e3);return()=>clearInterval(c)},[]),o.useEffect(()=>{if(!h||!d)return;(async()=>{try{const c=await oe(ie(M,"clientProgrammes",d.id));if(c.exists()){const u=c.data(),N=be[u.templateId];if(N){const se=Object.keys(u.completedSessions||{}).length,I=N.duration*N.daysPerWeek;U(I>0?Math.round(se/I*100):0);const te=u.templateId.replace(/_/g," ").replace(/\b\w/g,ae=>ae.toUpperCase());F(te)}}const t=L(M,"workoutLogs"),a=D(t,C("clientId","==",d.id)),i=(await $(a)).docs.filter(u=>u.data().type!=="programme").length;z(i);const l=me(new Date),n=L(M,"habitLogs"),y=D(n,C("clientId","==",d.id),C("date","==",l)),p=await $(y);let E=0;if(!p.empty){const u=p.docs[0].data().habits||{};E=Object.values(u).filter(Boolean).length}J(Math.round(E/he*100))}catch(c){console.error("Error loading dashboard stats:",c)}finally{X(!0)}})()},[h,d]);const b=s=>{const c=s.currentTarget,t=c.querySelector(".ripple");t&&t.remove();const a=c.getBoundingClientRect(),r=Math.max(a.width,a.height),i=s.clientX-a.left-r/2,l=s.clientY-a.top-r/2,n=document.createElement("span");n.className="ripple",n.style.cssText=`width:${r}px;height:${r}px;left:${i}px;top:${l}px;`,c.appendChild(n),setTimeout(()=>n.remove(),600)},Y=d?.name?.split(" ")[0]||"there",V=Math.round(W/100*g),{prev:w,next:_}=ue(f),G=_>w?Math.round((f-w)/(_-w)*100):100,Q=Math.round(G/100*g),Z=Math.round(P/100*g),ee=[{label:"Programme",value:`${W}%`,ticks:V,cls:"cb-stat-programme"},{label:"Workouts",value:`${f}`,ticks:Q,cls:"cb-stat-workouts"},{label:"Habits Today",value:`${P}%`,ticks:Z,cls:"cb-stat-habits"}];return e.jsxs("div",{className:"cb-dashboard","data-theme":T?"dark":"light",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:O,"aria-label":"Toggle theme",children:T?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})}),e.jsx("button",{onClick:R,"aria-label":"Log out",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})]})]})}),k?e.jsx("div",{className:"cb-loading-inline",children:e.jsx("div",{className:"cb-loading-spinner"})}):e.jsxs("main",{className:"cb-main",children:[e.jsx("div",{className:"cb-greeting",children:e.jsxs("h2",{children:["Hey ",Y]})}),e.jsxs("div",{className:"cb-ring-container",children:[e.jsxs("div",{className:"cb-ring",children:[e.jsx("svg",{className:"cb-ring-svg",viewBox:"0 0 200 200",children:[...Array(60)].map((s,c)=>{const t=(c*6-90)*(Math.PI/180),a=85,r=96,i=100+a*Math.cos(t),l=100+a*Math.sin(t),n=100+r*Math.cos(t),y=100+r*Math.sin(t),p=c<H;return e.jsx("line",{x1:i,y1:l,x2:n,y2:y,className:`ring-tick ${p?"elapsed":"remaining"}`,strokeWidth:c%5===0?"3":"2"},c)})}),e.jsxs("div",{className:"cb-ring-center",children:[e.jsx("div",{className:"cb-ring-logo",children:e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness"})}),e.jsxs("div",{className:"cb-ring-countdown",children:[e.jsx("span",{className:"cb-timer-digit",children:String(v.hours).padStart(2,"0")}),e.jsx("span",{className:"cb-timer-colon",children:":"}),e.jsx("span",{className:"cb-timer-digit",children:String(v.minutes).padStart(2,"0")}),e.jsx("span",{className:"cb-timer-colon",children:":"}),e.jsx("span",{className:"cb-timer-digit cb-timer-seconds",children:String(v.seconds).padStart(2,"0")})]}),e.jsx("div",{className:"cb-ring-label",children:"remaining today"})]})]}),e.jsxs("p",{className:"cb-ring-tagline",children:["You have 24 hours a day... ",e.jsx("strong",{children:"make it count"})," with Core Buddy"]})]}),e.jsx("div",{className:"cb-stats-row",children:ee.map(s=>e.jsxs("div",{className:"cb-stat-item",children:[e.jsxs("div",{className:`cb-stat-ring ${s.cls}`,children:[e.jsx("svg",{viewBox:"0 0 100 100",children:[...Array(g)].map((c,t)=>{const a=(t*6-90)*(Math.PI/180),r=50+38*Math.cos(a),i=50+38*Math.sin(a),l=50+46*Math.cos(a),n=50+46*Math.sin(a);return e.jsx("line",{x1:r,y1:i,x2:l,y2:n,className:t<s.ticks?"cb-stat-filled":"cb-stat-empty",strokeWidth:t%5===0?"3":"2"},t)})}),e.jsx("span",{className:"cb-stat-value",children:K?s.value:"â€“"})]}),e.jsx("span",{className:"cb-stat-label",children:s.label})]},s.cls))}),e.jsxs("div",{className:"cb-features",children:[e.jsxs("button",{className:"cb-feature-card cb-card-nutrition cb-card-has-preview ripple-btn",onClick:s=>{b(s),m("/client/core-buddy/nutrition")},children:[e.jsxs("div",{className:"cb-card-top-row",children:[e.jsx("div",{className:"cb-card-content",children:e.jsx("h3",{children:"Today's Nutrition"})}),e.jsx("svg",{className:"cb-card-arrow",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})]}),e.jsx("div",{className:"cb-card-preview-row",children:e.jsx("div",{className:"cb-mini-rings",children:[{cls:"cb-ring-protein",label:"P",filled:15},{cls:"cb-ring-carbs",label:"C",filled:28},{cls:"cb-ring-fats",label:"F",filled:38},{cls:"cb-ring-cals",label:"Cal",filled:22}].map(s=>e.jsxs("div",{className:`cb-mini-ring ${s.cls}`,children:[e.jsx("svg",{viewBox:"0 0 100 100",children:[...Array(60)].map((c,t)=>{const a=(t*6-90)*(Math.PI/180),r=50+38*Math.cos(a),i=50+38*Math.sin(a),l=50+46*Math.cos(a),n=50+46*Math.sin(a);return e.jsx("line",{x1:r,y1:i,x2:l,y2:n,className:t<s.filled?"cb-tick-filled":"cb-tick-empty",strokeWidth:t%5===0?"3":"2"},t)})}),e.jsx("span",{children:s.label})]},s.cls))})}),e.jsx("p",{className:"cb-card-desc",children:"Track macros, scan barcodes, log water"})]}),e.jsx("button",{className:"cb-feature-card cb-card-workouts cb-card-thumbnail ripple-btn",onClick:s=>{b(s),m("/client/core-buddy/workouts")},children:e.jsx("img",{src:de,alt:"Workouts",className:"cb-card-thumb-img"})}),e.jsxs("button",{className:"cb-feature-card cb-card-consistency ripple-btn",onClick:s=>{b(s),m("/client/core-buddy/consistency")},children:[e.jsxs("div",{className:"cb-card-content",children:[e.jsx("h3",{children:"Daily Habits"}),e.jsx("p",{children:"Check off your daily habits and build streaks"})]}),e.jsx("svg",{className:"cb-card-arrow",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})]}),e.jsxs("button",{className:"cb-feature-card cb-card-progress ripple-btn",onClick:s=>{b(s),m("/client/personal-bests?mode=corebuddy")},children:[e.jsxs("div",{className:"cb-card-content",children:[e.jsx("h3",{children:"My Progress"}),e.jsx("p",{children:"Track personal bests and body metrics"})]}),e.jsx("svg",{className:"cb-card-arrow",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})]}),e.jsxs("button",{className:"cb-feature-card cb-card-leaderboard ripple-btn",onClick:s=>{b(s),m("/client/leaderboard")},children:[e.jsxs("div",{className:"cb-card-content",children:[e.jsx("h3",{children:"Leaderboard"}),e.jsx("p",{children:"Compete with your Core Buddies"})]}),e.jsx("svg",{className:"cb-card-arrow",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})]})]})]}),e.jsx(le,{active:"home"}),x&&e.jsxs("div",{className:`toast-notification ${x.type}`,children:[x.type==="info"&&e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),x.message]})]})}export{je as default};
