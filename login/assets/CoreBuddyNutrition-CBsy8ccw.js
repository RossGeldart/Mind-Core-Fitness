import{k as fs,l as ks,m as Ns,r as d,j as e,i as Ve,e as le,d as ce,T as He,n as Ye,_ as ws}from"./index-xmWl_PCp.js";import{C as ys}from"./CoreBuddyNav-CJ5WHbgj.js";import{c as Cs}from"./ringTicks-_1Alaa2O.js";const Ge=60,Ne=new Map;function W(){return new Date().toISOString().split("T")[0]}const Ms=[{key:"breakfast",label:"Breakfast"},{key:"lunch",label:"Lunch"},{key:"dinner",label:"Dinner"},{key:"snacks",label:"Snacks"}],Ss={breakfast:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8h1a4 4 0 0 1 0 8h-1"}),e.jsx("path",{d:"M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"}),e.jsx("line",{x1:"6",y1:"1",x2:"6",y2:"4"}),e.jsx("line",{x1:"10",y1:"1",x2:"10",y2:"4"}),e.jsx("line",{x1:"14",y1:"1",x2:"14",y2:"4"})]}),lunch:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}),dinner:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),snacks:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})};function Ls(){const z=new Date().getHours();return z<11?"breakfast":z<14?"lunch":z<17?"snacks":"dinner"}function $s(){const{currentUser:z,isClient:we,clientData:L,loading:oe}=fs(),{isDark:V,toggleTheme:ye,accent:de}=ks(),H=Ns(),[Ce,Y]=d.useState("loading"),[f,Me]=d.useState(null),[l,p]=d.useState({gender:"male",age:"",weight:"",weightUnit:"kg",height:"",heightUnit:"cm",heightFeet:"",heightInches:"",dailyActivity:"sedentary",trainingFrequency:"moderate",goal:"maintain",deficitLevel:"moderate"}),[x,g]=d.useState(null),[C,Z]=d.useState(W()),[j,B]=d.useState({entries:[],water:0}),[ee,Ke]=d.useState({protein:0,carbs:0,fats:0,calories:0}),[Se,Le]=d.useState(!1),[Qe,ue]=d.useState(!1),[F,he]=d.useState(()=>{const s=new Date;return{year:s.getFullYear(),month:s.getMonth()}}),[Je,Xe]=d.useState(Ls),[Fe,U]=d.useState(null),[y,D]=d.useState(null),[me,G]=d.useState(!1),[E,se]=d.useState(null),[I,_e]=d.useState(""),[Te,De]=d.useState(!1),[P,$e]=d.useState(""),[Ae,ge]=d.useState([]),[pe,We]=d.useState(!1),[N,$]=d.useState({name:"",protein:"",carbs:"",fats:"",calories:"",serving:""}),[r,_]=d.useState(null),[T,v]=d.useState("100"),[h,b]=d.useState(0),[k,w]=d.useState("weight"),[Fs,Ze]=d.useState(0),[q,Be]=d.useState(null);d.useRef(null);const K=d.useRef(!1),xe=d.useRef(null),Q=d.useRef(null),Ee=d.useRef(null),M=d.useCallback((s,t="info")=>{Be({message:s,type:t}),setTimeout(()=>Be(null),3e3)},[]);d.useEffect(()=>{!oe&&(!z||!we)&&H("/")},[z,we,oe,H]),d.useEffect(()=>{if(!L?.id)return;(async()=>{try{const t=await Ve(le(ce,"nutritionTargets",L.id));t.exists()?(Me(t.data()),Y("dashboard")):Y("setup")}catch(t){console.error("Error loading nutrition data:",t),Y("setup")}})()},[L?.id]),d.useEffect(()=>{if(!L?.id)return;(async()=>{try{const t=await Ve(le(ce,"nutritionLogs",`${L.id}_${C}`));if(t.exists()){const a=t.data();B({entries:a.entries||[],water:a.water||0})}else B({entries:[],water:0})}catch(t){console.error("Error loading log:",t),B({entries:[],water:0})}})()},[L?.id,C]),d.useEffect(()=>{const s=j.entries.reduce((t,a)=>({protein:t.protein+(a.protein||0),carbs:t.carbs+(a.carbs||0),fats:t.fats+(a.fats||0),calories:t.calories+(a.calories||0)}),{protein:0,carbs:0,fats:0,calories:0});Ke(s)},[j.entries]);const te=async s=>{try{await Ye(le(ce,"nutritionLogs",`${L.id}_${C}`),{clientId:L.id,date:C,entries:s.entries,water:s.water,updatedAt:He.now()})}catch(t){console.error("Error saving nutrition log:",t)}},ae=C===W(),es=(s,t)=>new Date(s,t+1,0).getDate(),ss=(s,t)=>new Date(s,t,1).getDay(),Pe=["January","February","March","April","May","June","July","August","September","October","November","December"],ts=["Su","Mo","Tu","We","Th","Fr","Sa"],as=()=>{let s=parseFloat(l.weight);l.weightUnit==="lbs"&&(s*=.453592);let t;l.heightUnit==="cm"?t=parseFloat(l.height):t=(parseFloat(l.heightFeet)||0)*30.48+(parseFloat(l.heightInches)||0)*2.54;const a=parseInt(l.age);let n=l.gender==="male"?10*s+6.25*t-5*a+5:10*s+6.25*t-5*a-161;const c=n*{sedentary:1.2,light:1.3,moderate:1.4,active:1.5}[l.dailyActivity],i={low:100,moderate:200,high:300,daily:400},m=Math.round(c+i[l.trainingFrequency]);let u=m,S,R;switch(l.goal){case"lose":u=m*(1-{light:.15,moderate:.2,harsh:.25}[l.deficitLevel]),S=2.2,R=.3;break;case"build":u=m*1.1,S=2,R=.22;break;default:S=1.8,R=.25}u=Math.max(u,l.gender==="male"?1400:1100);const Oe=Math.round(s*S),Re=Math.round(u*R/9),bs=Math.max(0,Math.round((u-Oe*4-Re*9)/4));g({calories:Math.round(u),protein:Oe,carbs:bs,fats:Re,bmr:Math.round(n),neat:Math.round(c),exerciseAdd:i[l.trainingFrequency],tdee:Math.round(m)})},ns=async()=>{if(x)try{const s={clientId:L.id,calories:x.calories,protein:x.protein,carbs:x.carbs,fats:x.fats,waterGoal:8,goal:l.goal,updatedAt:He.now()};await Ye(le(ce,"nutritionTargets",L.id),s),Me(s),Y("dashboard"),M("Macro targets saved!","success")}catch(s){console.error("Error saving targets:",s),M("Failed to save targets. Please try again.","error")}},rs=()=>{const s=l.weight&&parseFloat(l.weight)>0,t=l.age&&parseInt(l.age)>0,a=l.heightUnit==="cm"?l.height&&parseFloat(l.height)>0:l.heightFeet&&parseFloat(l.heightFeet)>0||l.heightInches&&parseFloat(l.heightInches)>0;return s&&t&&a},ze="nut_favourite_foods",je=()=>{try{return JSON.parse(localStorage.getItem(ze)||"[]")}catch{return[]}},O=s=>je().some(t=>t.name.toLowerCase()===(s||"").toLowerCase()),ne=s=>{const t=je(),a=t.findIndex(n=>n.name.toLowerCase()===s.name.toLowerCase());a>=0?t.splice(a,1):t.unshift({name:s.name,protein:s.protein,carbs:s.carbs,fats:s.fats,calories:s.calories,serving:s.serving,per100g:s.per100g||null,servingUnit:s.servingUnit||"g",portion:s.portion||null}),localStorage.setItem(ze,JSON.stringify(t)),Ze(n=>n+1)},J=s=>{const t=[...j.entries,{...s,meal:Je,id:Date.now(),addedAt:new Date().toISOString()}],a={...j,entries:t};B(a),te(a),D(null),_(null),v("100"),b(0),w("weight"),$({name:"",protein:"",carbs:"",fats:"",calories:"",serving:""}),M("Food added!","success")},is=s=>{const t=j.entries.filter(n=>n.id!==s),a={...j,entries:t};B(a),te(a)},X=d.useRef(null),ls=async()=>{G(!0);const s=document.querySelector("#barcode-reader");if(!s){G(!1),M("Scanner container not found.","error");return}if(!X.current)try{const a=await ws(()=>import("./quagga.min-BbicSfvA.js").then(n=>n.q),[]);X.current=a.default}catch(a){console.error("Failed to load barcode scanner:",a),G(!1),M("Could not load scanner.","error");return}const t=X.current;t.init({inputStream:{type:"LiveStream",target:s,constraints:{facingMode:"environment",width:{min:640,ideal:1280,max:1920},height:{min:480,ideal:720,max:1080}}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:navigator.hardwareConcurrency||2,decoder:{readers:["ean_reader","ean_8_reader","upc_reader","upc_e_reader","code_128_reader","code_39_reader"]},locate:!0},a=>{if(a){console.error("Quagga init error:",a),G(!1),M("Could not access camera. Check permissions.","error");return}t.start(),K.current=!0}),t.onDetected(a=>{const n=a.codeResult.decodedCodes?.filter(c=>c.error!==void 0)?.map(c=>c.error)||[];if((n.length>0?n.reduce((c,i)=>c+i,0)/n.length:1)<.15){const c=a.codeResult.code;t.offDetected(),se(c)}})},ve=()=>{const s=X.current;K.current&&s&&(s.stop(),s.offDetected(),K.current=!1),G(!1)},cs=/\b(milk|semi.skimmed|skimmed|whole milk|oat milk|almond milk|soy milk|juice|smoothie|water|squash|cordial|cola|pepsi|fanta|lemonade|soda|beer|wine|cider|lager|spirit|whisky|vodka|rum|gin|brandy|cream|yoghurt drink|milkshake|coffee|tea|broth|stock|soup|sauce|ketchup|vinegar|oil|syrup|honey|custard|coconut water|kombucha|energy drink|protein shake)\b/i,be=s=>/ml|cl|\dl(?!b)|litre|liter|fl\s?oz/i.test((s||"").replace(/\s/g,"")),os=s=>{if(!s)return{value:100,unit:"g"};const t=s.toLowerCase().replace(/\s/g,""),a=t.match(/([\d.]+)/),n=a?parseFloat(a[1]):100;return be(s)?/cl/.test(t)?{value:n*10,unit:"ml"}:/(?:^|\d)l(?!i)/.test(t)&&!/ml/.test(t)?{value:n*1e3,unit:"ml"}:{value:n,unit:"ml"}:{value:n,unit:"g"}},ds=s=>{if(be(s.serving_size)||be(s.quantity))return"ml";const t=s.product_name||s.product_name_en||"";return cs.test(t)?"ml":"g"},us=[{pattern:/\b(toast|bread|loaf|brioche|bagel|pitta|wrap|tortilla|crumpet|muffin|waffle|pancake)\b/i,label:"slice",weight:36},{pattern:/\begg\b/i,label:"egg",weight:60},{pattern:/\b(biscuit|cookie|digestive|hobnob|rich tea|oreo)\b/i,label:"biscuit",weight:13},{pattern:/\b(sausage|banger)\b/i,label:"sausage",weight:57},{pattern:/\b(rasher|bacon)\b/i,label:"rasher",weight:25},{pattern:/\b(rice cake)\b/i,label:"cake",weight:9},{pattern:/\b(cracker|ryvita)\b/i,label:"cracker",weight:10}],hs=(s,t)=>{const a=s||"",n=a.match(/\((\d+\.?\d*)\s*g\)/i),o=a.match(/(?:^|per\s+)(\d*\s*[a-z][a-z\s]*?)(?:\s*\(|\s*-\s*|\s*$)/i);if(n&&o){const m=parseFloat(n[1]);let u=o[1].replace(/^\d+\s*/,"").trim();if(u&&m>0)return{label:u,weight:m}}const c=a.match(/(\d+\.?\d*)\s*g\s*[\/=]\s*(\d*\s*[a-z][a-z\s]*)/i);if(c){const m=parseFloat(c[1]);let u=c[2].replace(/^\d+\s*/,"").trim();if(u&&m>0)return{label:u,weight:m}}const i=t||"";for(const{pattern:m,label:u,weight:S}of us)if(m.test(i))return{label:u,weight:S};return null},Ue=s=>{const t=s.nutriments||{},a=ds(s),n=os(s.serving_size),o=a==="ml"?n.unit==="ml"?n.value:100:n.value,c=s.product_name||s.product_name_en||"Unknown Product",i=hs(s.serving_size,c);return{name:c,brand:s.brands||"",image:s.image_small_url||s.image_url||null,servingSize:s.serving_size||"100g",servingValue:o,servingUnit:a,portion:i,protein:Math.round(t.proteins_100g||t.proteins||0),carbs:Math.round(t.carbohydrates_100g||t.carbohydrates||0),fats:Math.round(t.fat_100g||t.fat||0),calories:Math.round(t["energy-kcal_100g"]||t["energy-kcal"]||(t.energy_100g?t.energy_100g/4.184:0)),per100g:!0}},fe=async s=>{De(!0);try{const t=`https://world.openfoodfacts.org/api/v2/product/${s}?fields=product_name,product_name_en,brands,image_small_url,image_url,serving_size,quantity,nutriments`,a=await fetch(t);if(!a.ok)throw new Error(`HTTP ${a.status}`);const n=await a.json();if(n.status==="success"||n.status===1||n.product){const o=Ue(n.product);o.calories===0&&o.protein===0&&o.carbs===0?M("Product found but no nutrition data available.","error"):(_(o),o.portion?(b(1),v(String(o.portion.weight)),w("portion")):(b(0),v(String(o.servingValue||100)),w("weight")),_e(""))}else M("Product not found. Try search or manual entry.","error")}catch(t){console.error("Barcode lookup error:",t),M("Failed to look up product. Check your connection.","error")}De(!1)},Ie=(s,t,a)=>{const n=s.toLowerCase().trim(),o=t.toLowerCase().trim(),c=a.toLowerCase().trim();let i=0;return(n===c||n===c+"s"||n+"s"===c)&&(i+=100),(n.endsWith(" "+c)||n.endsWith(" "+c+"s"))&&(i+=40),(n.startsWith(c+" ")||n.startsWith(c+"s "))&&(i+=15),c.split(/\s+/).some(u=>o===u||o.startsWith(u))&&(i+=30),i+=Math.max(0,30-n.length),i},ke=async()=>{if(!P.trim())return;xe.current&&xe.current.abort();const s=new AbortController;xe.current=s;const t=P.trim().toLowerCase(),a=t.split(/\s+/).filter(Boolean);if(Ne.has(t)){ge(Ne.get(t));return}We(!0);try{const o=`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${encodeURIComponent(P.trim())}&search_simple=1&action=process&json=1&page_size=10&lc=en&sort_by=unique_scans_n&fields=product_name,product_name_en,brands,image_small_url,image_url,serving_size,quantity,nutriments`,c=await fetch(o,{signal:s.signal});if(!c.ok)throw new Error(`HTTP ${c.status}`);const m=((await c.json()).products||[]).map(u=>Ue(u)).filter(u=>u.name!=="Unknown Product"&&(u.calories>0||u.protein>0)).filter(u=>{const S=(u.name+" "+u.brand).toLowerCase();return a.every(R=>S.includes(R))}).sort((u,S)=>Ie(S.name,S.brand,t)-Ie(u.name,u.brand,t)).slice(0,10);Ne.set(t,m),ge(m),m.length===0&&M("No results found. Try a different search.","info")}catch(n){if(n.name==="AbortError")return;console.error("Search error:",n),M("Search failed. Check your connection.","error")}We(!1)};d.useEffect(()=>{if(Q.current&&clearTimeout(Q.current),!(!P.trim()||y!=="search"||r))return Q.current=setTimeout(()=>{ke()},700),()=>clearTimeout(Q.current)},[P]);const ms=()=>{const s={...j,water:j.water+1};B(s),te(s)},gs=()=>{if(j.water<=0)return;const s={...j,water:j.water-1};B(s),te(s)},ps=(s,t)=>!t||t<=0?0:Math.min(Ge,Math.round(s/t*Ge)),A=(s,t,a,n,o)=>{const c=ps(a,n),i=n>0?Math.min(100,Math.round(a/n*100)):0;return e.jsxs("div",{className:`nut-ring-wrap ${o}`,children:[e.jsx("svg",{className:"nut-ring-svg",viewBox:"0 0 200 200",children:Cs.map((m,u)=>e.jsx("line",{x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,className:u<c?"nut-tick-filled":"nut-tick-empty",strokeWidth:m.thick?"4.5":"3",strokeLinecap:"round",style:u<c?{animationDelay:`${u*50}ms`}:void 0},u))}),e.jsxs("div",{className:"nut-ring-center",children:[e.jsx("span",{className:"nut-ring-value",children:Math.round(a)}),e.jsxs("span",{className:"nut-ring-target",children:["/ ",n,s==="Calories"?"":"g"]}),e.jsx("span",{className:"nut-ring-label",children:t})]}),e.jsxs("span",{className:"nut-ring-pct",children:[i,"%"]})]})};if(d.useEffect(()=>{if(!E)return;const s=setTimeout(()=>{const t=E;ve(),se(null),fe(t)},1500);return()=>clearTimeout(s)},[E]),d.useEffect(()=>()=>{const s=X.current;if(K.current&&s){try{s.stop(),s.offDetected()}catch{}K.current=!1}},[]),oe||Ce==="loading")return e.jsxs("div",{className:"nut-page","data-theme":V?"dark":"light","data-accent":de,children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>H("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"})]})}),e.jsx("div",{className:"nut-loading-inline",children:e.jsx("div",{className:"cb-loading-spinner"})})]});if(Ce==="setup")return e.jsxs("div",{className:"nut-page","data-theme":V?"dark":"light","data-accent":de,children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>H("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsx("div",{className:"header-actions",children:e.jsx("button",{onClick:ye,"aria-label":"Toggle theme",children:V?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})})]})}),e.jsxs("main",{className:"nut-main",children:[e.jsxs("div",{className:"nut-setup-intro",children:[e.jsx("h2",{children:"Set Your Daily Targets"}),e.jsx("p",{children:"Calculate your personalised macros based on your body and goals."})]}),e.jsxs("div",{className:"nut-calc-form",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Gender"}),e.jsxs("div",{className:"nut-toggle-group",children:[e.jsx("button",{className:l.gender==="male"?"active":"",onClick:()=>{p(s=>({...s,gender:"male"})),g(null)},children:"Male"}),e.jsx("button",{className:l.gender==="female"?"active":"",onClick:()=>{p(s=>({...s,gender:"female"})),g(null)},children:"Female"})]})]}),e.jsxs("div",{className:"nut-form-row",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Age"}),e.jsx("input",{type:"number",value:l.age,onChange:s=>{p(t=>({...t,age:s.target.value})),g(null)},placeholder:"Years",min:"15",max:"100"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Weight"}),e.jsxs("div",{className:"nut-input-unit",children:[e.jsx("input",{type:"number",value:l.weight,onChange:s=>{p(t=>({...t,weight:s.target.value})),g(null)},placeholder:l.weightUnit,min:"30",max:"300"}),e.jsxs("div",{className:"nut-unit-toggle",children:[e.jsx("button",{className:l.weightUnit==="kg"?"active":"",onClick:()=>{p(s=>({...s,weightUnit:"kg"})),g(null)},children:"kg"}),e.jsx("button",{className:l.weightUnit==="lbs"?"active":"",onClick:()=>{p(s=>({...s,weightUnit:"lbs"})),g(null)},children:"lbs"})]})]})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Height"}),e.jsxs("div",{className:"nut-input-unit",children:[l.heightUnit==="cm"?e.jsx("input",{type:"number",value:l.height,onChange:s=>{p(t=>({...t,height:s.target.value})),g(null)},placeholder:"cm",min:"100",max:"250"}):e.jsxs("div",{className:"nut-height-imperial",children:[e.jsx("input",{type:"number",value:l.heightFeet,onChange:s=>{p(t=>({...t,heightFeet:s.target.value})),g(null)},placeholder:"ft",min:"4",max:"7"}),e.jsx("input",{type:"number",value:l.heightInches,onChange:s=>{p(t=>({...t,heightInches:s.target.value})),g(null)},placeholder:"in",min:"0",max:"11"})]}),e.jsxs("div",{className:"nut-unit-toggle",children:[e.jsx("button",{className:l.heightUnit==="cm"?"active":"",onClick:()=>{p(s=>({...s,heightUnit:"cm"})),g(null)},children:"cm"}),e.jsx("button",{className:l.heightUnit==="ft"?"active":"",onClick:()=>{p(s=>({...s,heightUnit:"ft"})),g(null)},children:"ft/in"})]})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Daily Activity (outside of training)"}),e.jsxs("select",{value:l.dailyActivity,onChange:s=>{p(t=>({...t,dailyActivity:s.target.value})),g(null)},children:[e.jsx("option",{value:"sedentary",children:"Sedentary — desk job, under 5k steps"}),e.jsx("option",{value:"light",children:"Lightly Active — office + walking, 5-8k steps"}),e.jsx("option",{value:"moderate",children:"Moderately Active — on feet often, 8-12k steps"}),e.jsx("option",{value:"active",children:"Very Active — physical job, 12k+ steps"})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Training Sessions per Week"}),e.jsxs("select",{value:l.trainingFrequency,onChange:s=>{p(t=>({...t,trainingFrequency:s.target.value})),g(null)},children:[e.jsx("option",{value:"low",children:"1-2 sessions"}),e.jsx("option",{value:"moderate",children:"3-4 sessions"}),e.jsx("option",{value:"high",children:"5-6 sessions"}),e.jsx("option",{value:"daily",children:"7+ sessions"})]})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Fitness Goal"}),e.jsxs("div",{className:"nut-goal-options",children:[e.jsxs("button",{className:l.goal==="lose"?"active":"",onClick:()=>{p(s=>({...s,goal:"lose"})),g(null)},children:[e.jsx("span",{className:"nut-goal-icon",children:"-"}),e.jsx("span",{children:"Lose Weight"})]}),e.jsxs("button",{className:l.goal==="maintain"?"active":"",onClick:()=>{p(s=>({...s,goal:"maintain"})),g(null)},children:[e.jsx("span",{className:"nut-goal-icon",children:"="}),e.jsx("span",{children:"Maintain"})]}),e.jsxs("button",{className:l.goal==="build"?"active":"",onClick:()=>{p(s=>({...s,goal:"build"})),g(null)},children:[e.jsx("span",{className:"nut-goal-icon",children:"+"}),e.jsx("span",{children:"Build Muscle"})]})]})]}),l.goal==="lose"&&e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Deficit Level"}),e.jsxs("div",{className:"nut-deficit-options",children:[e.jsxs("button",{className:l.deficitLevel==="light"?"active":"",onClick:()=>{p(s=>({...s,deficitLevel:"light"})),g(null)},children:[e.jsx("strong",{children:"Mild"}),e.jsx("span",{children:"15% below TDEE"})]}),e.jsxs("button",{className:l.deficitLevel==="moderate"?"active":"",onClick:()=>{p(s=>({...s,deficitLevel:"moderate"})),g(null)},children:[e.jsx("strong",{children:"Moderate"}),e.jsx("span",{children:"20% below TDEE"})]}),e.jsxs("button",{className:l.deficitLevel==="harsh"?"active":"",onClick:()=>{p(s=>({...s,deficitLevel:"harsh"})),g(null)},children:[e.jsx("strong",{children:"Aggressive"}),e.jsx("span",{children:"25% below TDEE"})]})]})]}),e.jsx("button",{className:"nut-calc-btn",onClick:as,disabled:!rs(),children:"Calculate Macros"})]}),x&&e.jsxs("div",{className:"nut-calc-results",children:[e.jsx("h3",{children:"Your Daily Targets"}),e.jsxs("div",{className:"nut-calc-rings",children:[A("Protein","Protein",x.protein,x.protein,"ring-protein"),A("Carbs","Carbs",x.carbs,x.carbs,"ring-carbs"),A("Fats","Fats",x.fats,x.fats,"ring-fats"),A("Calories","Calories",x.calories,x.calories,"ring-cals")]}),e.jsxs("div",{className:"nut-calc-info",children:[e.jsxs("div",{className:"nut-calc-info-row",children:[e.jsx("span",{children:"BMR (body at rest)"}),e.jsxs("span",{children:[x.bmr," cal"]})]}),e.jsxs("div",{className:"nut-calc-info-row",children:[e.jsx("span",{children:"+ Daily activity (NEAT)"}),e.jsxs("span",{children:[x.neat," cal"]})]}),e.jsxs("div",{className:"nut-calc-info-row",children:[e.jsx("span",{children:"+ Training sessions"}),e.jsxs("span",{children:["+",x.exerciseAdd," cal"]})]}),e.jsxs("div",{className:"nut-calc-info-row",style:{fontWeight:600},children:[e.jsx("span",{children:"TDEE (total burn)"}),e.jsxs("span",{children:[x.tdee," cal"]})]})]}),e.jsx("button",{className:"nut-save-targets-btn",onClick:ns,children:"Set as My Daily Targets"})]})]}),q&&e.jsx("div",{className:`toast-notification ${q.type}`,children:q.message})]});const xs=s=>{const t=new Date(s+"T12:00:00"),a=t.getDay(),n=new Date(t);n.setDate(t.getDate()-(a+6)%7);const o=[];for(let c=0;c<7;c++){const i=new Date(n);i.setDate(n.getDate()+c),o.push(i.toISOString().split("T")[0])}return o},js=["M","T","W","T","F","S","S"],re=(s,t="search")=>{Xe(s),t==="scan"?(D("scan"),_(null)):t==="manual"?(D("manual"),$({name:"",protein:"",carbs:"",fats:"",calories:"",serving:""})):t==="favourites"?D("favourites"):(D("search"),ge([]),$e(""))},qe=xs(C),ie=new Date(C+"T12:00:00"),vs=`${Pe[ie.getMonth()]} ${ie.getFullYear()}`;return e.jsxs("div",{className:"nut-page","data-theme":V?"dark":"light","data-accent":de,children:[e.jsxs("div",{className:"nut-dark-zone",children:[e.jsx("header",{className:"client-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("button",{className:"header-back-btn",onClick:()=>H("/client/core-buddy"),"aria-label":"Go back",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("img",{src:"/Logo.webp",alt:"Mind Core Fitness",className:"header-logo",width:"50",height:"50"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:()=>{Y("setup"),g(null)},"aria-label":"Recalculate macros",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}),e.jsx("button",{onClick:ye,"aria-label":"Toggle theme",children:V?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})]})]})}),e.jsxs("div",{className:"nut-dark-content",children:[e.jsxs("div",{className:"nut-week-strip",children:[e.jsxs("div",{className:"nut-week-header",children:[e.jsx("button",{className:"nut-week-arrow",onClick:()=>{const s=new Date(C+"T12:00:00");s.setDate(s.getDate()-7);const t=s.toISOString().split("T")[0];Z(t)},"aria-label":"Previous week",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("button",{className:"nut-week-month-label",onClick:()=>{Le(!Se),he({year:ie.getFullYear(),month:ie.getMonth()})},children:vs}),e.jsx("button",{className:"nut-week-arrow",onClick:()=>{const s=new Date(C+"T12:00:00");s.setDate(s.getDate()+7);const t=s.toISOString().split("T")[0];t<=W()&&Z(t)},"aria-label":"Next week",disabled:qe[6]>=W(),children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),e.jsx("div",{className:"nut-week-days",children:qe.map((s,t)=>{const a=new Date(s+"T12:00:00").getDate(),n=s===C,o=s>W(),c=s===W();return e.jsxs("button",{className:`nut-week-day${n?" selected":""}${c?" today":""}${o?" future":""}`,disabled:o,onClick:()=>Z(s),children:[e.jsx("span",{className:"nut-week-day-letter",children:js[t]}),e.jsx("span",{className:"nut-week-day-num",children:a})]},s)})})]}),Se&&e.jsxs("div",{className:"nut-calendar nut-calendar-dark",children:[e.jsxs("div",{className:"nut-cal-header",children:[e.jsx("button",{onClick:()=>he(s=>{let t=s.month-1,a=s.year;return t<0&&(t=11,a--),{year:a,month:t}}),children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsxs("span",{children:[Pe[F.month]," ",F.year]}),e.jsx("button",{onClick:()=>he(s=>{let t=s.month+1,a=s.year;return t>11&&(t=0,a++),{year:a,month:t}}),disabled:F.year===new Date().getFullYear()&&F.month>=new Date().getMonth(),children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),e.jsx("div",{className:"nut-cal-days-header",children:ts.map(s=>e.jsx("span",{children:s},s))}),e.jsxs("div",{className:"nut-cal-grid",children:[[...Array(ss(F.year,F.month))].map((s,t)=>e.jsx("span",{},`e${t}`)),[...Array(es(F.year,F.month))].map((s,t)=>{const a=t+1,n=`${F.year}-${String(F.month+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,o=n>W(),c=n===C,i=n===W();return e.jsx("button",{className:`nut-cal-day${c?" selected":""}${i?" today":""}${o?" future":""}`,disabled:o,onClick:()=>{Z(n),Le(!1)},children:a},a)})]})]}),e.jsxs("div",{className:"nut-rings-row",children:[A("Protein","Protein",ee.protein,f.protein,"ring-protein"),A("Carbs","Carbs",ee.carbs,f.carbs,"ring-carbs"),A("Fats","Fats",ee.fats,f.fats,"ring-fats"),A("Calories","kCal",ee.calories,f.calories,"ring-cals")]})]})]}),e.jsx("div",{className:"nut-light-zone",children:e.jsxs("div",{className:"nut-light-content",children:[ae&&e.jsxs("button",{className:"nut-water-quick",onClick:()=>ue(!0),children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",width:"18",height:"18",children:e.jsx("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"})}),e.jsxs("span",{className:"nut-water-quick-count",children:[j.water," / ",f?.waterGoal||8]}),e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",width:"14",height:"14",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})]}),e.jsx("div",{className:"nut-log-section",children:e.jsx("div",{className:"nut-meals-list",children:Ms.map(s=>{const t=j.entries.filter(n=>(n.meal||"snacks")===s.key),a=t.reduce((n,o)=>({protein:n.protein+(o.protein||0),carbs:n.carbs+(o.carbs||0),fats:n.fats+(o.fats||0),calories:n.calories+(o.calories||0)}),{protein:0,carbs:0,fats:0,calories:0});return e.jsxs("div",{className:"nut-meal-card",children:[e.jsxs("div",{className:"nut-meal-card-header",children:[e.jsx("span",{className:`nut-meal-card-icon nut-meal-icon-${s.key}`,children:Ss[s.key]}),e.jsx("span",{className:"nut-meal-card-title",children:s.label}),t.length>0&&e.jsxs("span",{className:"nut-meal-card-cal",children:[a.calories," cal"]}),ae&&e.jsxs("div",{className:"nut-add-wrapper",children:[e.jsx("button",{className:"nut-meal-add-btn",onClick:()=>U(Fe===s.key?null:s.key),"aria-label":`Add to ${s.label}`,children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),Fe===s.key&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nut-add-picker-backdrop",onClick:()=>U(null)}),e.jsxs("div",{className:"nut-add-picker",children:[e.jsxs("button",{onClick:()=>{U(null),re(s.key,"scan")},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),e.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),e.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),e.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),e.jsx("span",{children:"Scan"})]}),e.jsxs("button",{onClick:()=>{U(null),re(s.key,"search")},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("span",{children:"Search"})]}),e.jsxs("button",{onClick:()=>{U(null),re(s.key,"manual")},children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),e.jsx("span",{children:"Manual"})]}),e.jsxs("button",{onClick:()=>{U(null),re(s.key,"favourites")},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),e.jsx("span",{children:"Favs"})]})]})]})]})]}),t.length>0&&e.jsxs("div",{className:"nut-meal-bars",children:[e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-p",children:"P"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-protein",style:{width:`${Math.min(100,f.protein>0?a.protein/f.protein*100:0)}%`}})}),e.jsxs("span",{className:"nut-meal-bar-val",children:[a.protein,"g"]})]}),e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-c",children:"C"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-carbs",style:{width:`${Math.min(100,f.carbs>0?a.carbs/f.carbs*100:0)}%`}})}),e.jsxs("span",{className:"nut-meal-bar-val",children:[a.carbs,"g"]})]}),e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-f",children:"F"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-fats",style:{width:`${Math.min(100,f.fats>0?a.fats/f.fats*100:0)}%`}})}),e.jsxs("span",{className:"nut-meal-bar-val",children:[a.fats,"g"]})]}),e.jsxs("div",{className:"nut-meal-bar-row",children:[e.jsx("span",{className:"nut-meal-bar-label nut-macro-cal",children:"K"}),e.jsx("div",{className:"nut-meal-bar-track",children:e.jsx("div",{className:"nut-meal-bar-fill bar-cals",style:{width:`${Math.min(100,f.calories>0?a.calories/f.calories*100:0)}%`}})}),e.jsx("span",{className:"nut-meal-bar-val",children:a.calories})]})]}),t.length>0&&e.jsx("div",{className:"nut-log-list",children:t.map(n=>e.jsxs("div",{className:"nut-log-item",children:[e.jsxs("div",{className:"nut-log-item-info",children:[e.jsx("span",{className:"nut-log-item-name",children:n.name}),n.serving&&e.jsx("span",{className:"nut-log-item-serving",children:n.serving})]}),e.jsxs("div",{className:"nut-log-item-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[n.protein,"p"]}),e.jsxs("span",{className:"nut-macro-c",children:[n.carbs,"c"]}),e.jsxs("span",{className:"nut-macro-f",children:[n.fats,"f"]}),e.jsx("span",{className:"nut-macro-cal",children:n.calories})]}),ae&&e.jsx("button",{className:"nut-log-delete",onClick:()=>is(n.id),"aria-label":"Remove",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},n.id))}),t.length===0&&e.jsx("div",{className:"nut-meal-empty",children:e.jsx("p",{children:ae?"Tap + to add food":"No entries"})})]},s.key)})})})]})}),Qe&&e.jsx("div",{className:"nut-modal-overlay",onClick:()=>ue(!1),children:e.jsxs("div",{className:"nut-water-popup",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"nut-water-popup-header",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",width:"20",height:"20",style:{color:"#2196f3"},children:e.jsx("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"})}),e.jsx("span",{children:"Water Intake"}),e.jsx("button",{className:"nut-modal-close",onClick:()=>ue(!1),children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"nut-water-popup-body",children:[e.jsx("div",{className:"nut-water-glasses",children:[...Array(f?.waterGoal||8)].map((s,t)=>e.jsx("div",{className:`nut-water-glass ${t<j.water?"filled":""}`,children:e.jsx("svg",{viewBox:"0 0 24 24",fill:t<j.water?"currentColor":"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"})})},t))}),e.jsxs("div",{className:"nut-water-popup-count",children:[j.water," / ",f?.waterGoal||8," glasses"]}),e.jsxs("div",{className:"nut-water-btns",children:[e.jsx("button",{onClick:gs,disabled:j.water<=0,children:"-"}),e.jsx("button",{onClick:ms,children:"+"})]})]})]})}),y&&e.jsx("div",{className:"nut-modal-overlay",onClick:()=>{ve(),se(null),D(null),_(null)},children:e.jsxs("div",{className:"nut-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"nut-modal-header",children:[e.jsx("h3",{children:y==="scan"?"Scan Barcode":y==="search"?"Search Food":y==="favourites"?"Favourites":"Manual Entry"}),e.jsx("button",{className:"nut-modal-close",onClick:()=>{ve(),se(null),D(null),_(null)},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),y==="scan"&&!r&&e.jsxs("div",{className:"nut-scan-area",children:[e.jsxs("div",{className:"nut-scanner-wrapper",children:[e.jsx("div",{id:"barcode-reader",className:"nut-scanner-view"}),me&&!E&&e.jsx("div",{className:"nut-scan-line"}),E&&e.jsxs("div",{className:"nut-scan-detected-overlay",children:[e.jsx("svg",{className:"nut-scan-detected-tick",viewBox:"0 0 24 24",fill:"none",stroke:"#4caf50",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),e.jsx("p",{className:"nut-scan-detected-label",children:"Barcode found!"}),e.jsx("p",{className:"nut-scan-detected-code",children:E})]})]}),!me&&e.jsxs("button",{className:"nut-scan-start-btn",onClick:ls,children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),e.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),e.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),e.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),e.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),"Open Camera"]}),me&&!E&&e.jsx("p",{className:"nut-scan-hint",children:"Align barcode within the frame"}),e.jsx("div",{className:"nut-barcode-divider",children:e.jsx("span",{children:"or enter barcode manually"})}),e.jsxs("div",{className:"nut-barcode-manual",children:[e.jsx("input",{type:"text",inputMode:"numeric",value:I,onChange:s=>_e(s.target.value),onKeyDown:s=>s.key==="Enter"&&I.trim()&&fe(I.trim()),placeholder:"Enter barcode number"}),e.jsx("button",{onClick:()=>I.trim()&&fe(I.trim()),disabled:!I.trim()||Te,children:Te?"...":"Look Up"})]})]}),y==="scan"&&r&&(()=>{const s=r.servingUnit||"g",t=r.portion,a=k==="portion"&&t?h*t.weight:parseFloat(T)||0,n=a/100,o=s==="ml"?[100,200,250,500]:[50,100,150,200],c=k==="portion"&&t?`${h} ${t.label}${h!==1?"s":""} (${Math.round(a)}${s})`:`${Math.round(a)}${s}`;return e.jsxs("div",{className:"nut-product-result",children:[r.image&&e.jsx("img",{src:r.image,alt:r.name||"Product",className:"nut-product-img",loading:"lazy"}),e.jsxs("div",{className:"nut-product-name-row",children:[e.jsx("h4",{children:r.name}),e.jsx("button",{className:`nut-fav-star confirm${O(r.name)?" active":""}`,onClick:()=>ne({name:r.name,protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories,serving:r.servingSize,per100g:{protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories},servingUnit:r.servingUnit||"g",portion:r.portion||null}),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"22",height:"22",fill:O(r.name)?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})})]}),r.brand&&e.jsx("p",{className:"nut-product-brand",children:r.brand}),e.jsxs("p",{className:"nut-product-per",children:["Per 100",s,":"]}),e.jsxs("div",{className:"nut-product-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[r.protein,"g P"]}),e.jsxs("span",{className:"nut-macro-c",children:[r.carbs,"g C"]}),e.jsxs("span",{className:"nut-macro-f",children:[r.fats,"g F"]}),e.jsxs("span",{className:"nut-macro-cal",children:[r.calories," cal"]})]}),t&&e.jsxs("div",{className:"nut-mode-toggle",children:[e.jsx("button",{className:k==="portion"?"active":"",onClick:()=>{w("portion"),h<1&&b(1)},children:"Portions"}),e.jsxs("button",{className:k==="weight"?"active":"",onClick:()=>{w("weight"),v(String(Math.round(a)||100))},children:["Custom (",s,")"]})]}),k==="portion"&&t?e.jsxs("div",{className:"nut-portion-stepper",children:[e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(Math.max(1,h-1)),children:"-"}),e.jsxs("div",{className:"nut-stepper-display",children:[e.jsx("span",{className:"nut-stepper-count",children:h}),e.jsxs("span",{className:"nut-stepper-label",children:[t.label,h!==1?"s":""]}),e.jsxs("span",{className:"nut-stepper-weight",children:[Math.round(a),s]})]}),e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(h+1),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"nut-serving-adjust",children:[e.jsxs("label",{children:["Serving (",s,")"]}),e.jsx("input",{type:"number",inputMode:"numeric",value:T,onChange:i=>v(i.target.value),onFocus:i=>i.target.select(),min:"0"})]}),e.jsx("div",{className:"nut-quick-amounts",children:o.map(i=>e.jsxs("button",{className:`nut-quick-btn${T===String(i)?" active":""}`,onClick:()=>v(String(i)),children:[i,s]},i))})]}),e.jsx("div",{className:"nut-product-total",children:e.jsxs("span",{children:["Total: ",Math.round(r.protein*n),"p / ",Math.round(r.carbs*n),"c / ",Math.round(r.fats*n),"f / ",Math.round(r.calories*n)," cal"]})}),e.jsxs("div",{className:"nut-product-actions",children:[e.jsx("button",{className:"nut-btn-secondary",onClick:()=>{_(null),D("scan")},children:"Scan Again"}),e.jsx("button",{className:"nut-btn-primary",onClick:()=>J({name:r.name,protein:Math.round(r.protein*n),carbs:Math.round(r.carbs*n),fats:Math.round(r.fats*n),calories:Math.round(r.calories*n),serving:c}),children:"Add"})]})]})})(),y==="search"&&!r&&e.jsxs("div",{className:"nut-search-area",children:[e.jsxs("div",{className:"nut-search-bar",children:[e.jsx("input",{type:"text",ref:Ee,value:P,onChange:s=>$e(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(clearTimeout(Q.current),ke())},onFocus:()=>setTimeout(()=>Ee.current?.scrollIntoView({behavior:"smooth",block:"center"}),350),placeholder:"Search food or product...",autoFocus:!0}),e.jsx("button",{onClick:ke,disabled:pe,children:pe?"...":"Search"})]}),e.jsxs("div",{className:"nut-search-results",children:[Ae.map((s,t)=>e.jsxs("button",{className:"nut-search-item",onClick:()=>{_(s),s.portion?(b(1),v(String(s.portion.weight)),w("portion")):(b(0),v(String(s.servingValue||100)),w("weight"))},children:[s.image&&e.jsx("img",{src:s.image,alt:s.name||"Product",loading:"lazy"}),e.jsxs("div",{className:"nut-search-item-info",children:[e.jsx("span",{className:"nut-search-item-name",children:s.name}),s.brand&&e.jsx("span",{className:"nut-search-item-brand",children:s.brand}),e.jsxs("span",{className:"nut-search-item-macros",children:[s.calories," cal · ",s.protein,"p · ",s.carbs,"c · ",s.fats,"f per 100",s.servingUnit||"g"]})]})]},t)),Ae.length===0&&P&&!pe&&e.jsx("p",{className:"nut-search-empty",children:"No results found. Try a different search or use manual entry."})]})]}),y==="search"&&r&&(()=>{const s=r.servingUnit||"g",t=r.portion,a=k==="portion"&&t?h*t.weight:parseFloat(T)||0,n=a/100,o=s==="ml"?[100,200,250,500]:[50,100,150,200],c=k==="portion"&&t?`${h} ${t.label}${h!==1?"s":""} (${Math.round(a)}${s})`:`${Math.round(a)}${s}`;return e.jsxs("div",{className:"nut-product-result",children:[r.image&&e.jsx("img",{src:r.image,alt:r.name||"Product",className:"nut-product-img",loading:"lazy"}),e.jsxs("div",{className:"nut-product-name-row",children:[e.jsx("h4",{children:r.name}),e.jsx("button",{className:`nut-fav-star confirm${O(r.name)?" active":""}`,onClick:()=>ne({name:r.name,protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories,serving:r.servingSize,per100g:{protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories},servingUnit:r.servingUnit||"g",portion:r.portion||null}),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"22",height:"22",fill:O(r.name)?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})})]}),r.brand&&e.jsx("p",{className:"nut-product-brand",children:r.brand}),e.jsxs("p",{className:"nut-product-per",children:["Per 100",s,":"]}),e.jsxs("div",{className:"nut-product-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[r.protein,"g P"]}),e.jsxs("span",{className:"nut-macro-c",children:[r.carbs,"g C"]}),e.jsxs("span",{className:"nut-macro-f",children:[r.fats,"g F"]}),e.jsxs("span",{className:"nut-macro-cal",children:[r.calories," cal"]})]}),t&&e.jsxs("div",{className:"nut-mode-toggle",children:[e.jsx("button",{className:k==="portion"?"active":"",onClick:()=>{w("portion"),h<1&&b(1)},children:"Portions"}),e.jsxs("button",{className:k==="weight"?"active":"",onClick:()=>{w("weight"),v(String(Math.round(a)||100))},children:["Custom (",s,")"]})]}),k==="portion"&&t?e.jsxs("div",{className:"nut-portion-stepper",children:[e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(Math.max(1,h-1)),children:"-"}),e.jsxs("div",{className:"nut-stepper-display",children:[e.jsx("span",{className:"nut-stepper-count",children:h}),e.jsxs("span",{className:"nut-stepper-label",children:[t.label,h!==1?"s":""]}),e.jsxs("span",{className:"nut-stepper-weight",children:[Math.round(a),s]})]}),e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(h+1),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"nut-serving-adjust",children:[e.jsxs("label",{children:["Serving (",s,")"]}),e.jsx("input",{type:"number",inputMode:"numeric",value:T,onChange:i=>v(i.target.value),onFocus:i=>i.target.select(),min:"0"})]}),e.jsx("div",{className:"nut-quick-amounts",children:o.map(i=>e.jsxs("button",{className:`nut-quick-btn${T===String(i)?" active":""}`,onClick:()=>v(String(i)),children:[i,s]},i))})]}),e.jsx("div",{className:"nut-product-total",children:e.jsxs("span",{children:["Total: ",Math.round(r.protein*n),"p / ",Math.round(r.carbs*n),"c / ",Math.round(r.fats*n),"f / ",Math.round(r.calories*n)," cal"]})}),e.jsxs("div",{className:"nut-product-actions",children:[e.jsx("button",{className:"nut-btn-secondary",onClick:()=>_(null),children:"Back to Search"}),e.jsx("button",{className:"nut-btn-primary",onClick:()=>J({name:r.name,protein:Math.round(r.protein*n),carbs:Math.round(r.carbs*n),fats:Math.round(r.fats*n),calories:Math.round(r.calories*n),serving:c}),children:"Add"})]})]})})(),y==="manual"&&e.jsxs("div",{className:"nut-manual-form",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Food Name"}),e.jsx("input",{type:"text",value:N.name,onChange:s=>$(t=>({...t,name:s.target.value})),placeholder:"e.g. Chicken Breast",autoFocus:!0})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Serving Size (optional)"}),e.jsx("input",{type:"text",value:N.serving,onChange:s=>$(t=>({...t,serving:s.target.value})),placeholder:"e.g. 150g, 1 cup"})]}),e.jsxs("div",{className:"nut-manual-macros",children:[e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Protein (g)"}),e.jsx("input",{type:"number",value:N.protein,onChange:s=>$(t=>({...t,protein:s.target.value})),min:"0"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Carbs (g)"}),e.jsx("input",{type:"number",value:N.carbs,onChange:s=>$(t=>({...t,carbs:s.target.value})),min:"0"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Fats (g)"}),e.jsx("input",{type:"number",value:N.fats,onChange:s=>$(t=>({...t,fats:s.target.value})),min:"0"})]}),e.jsxs("div",{className:"nut-form-group",children:[e.jsx("label",{children:"Calories"}),e.jsx("input",{type:"number",value:N.calories,onChange:s=>$(t=>({...t,calories:s.target.value})),min:"0"})]})]}),e.jsx("button",{className:"nut-btn-primary",disabled:!N.name.trim(),onClick:()=>J({name:N.name,protein:parseFloat(N.protein)||0,carbs:parseFloat(N.carbs)||0,fats:parseFloat(N.fats)||0,calories:parseFloat(N.calories)||0,serving:N.serving||""}),children:"Add Food"})]}),y==="favourites"&&!r&&(()=>{const s=je(),t=a=>{if(a.per100g){const n=a.per100g;_({name:a.name,brand:"",image:null,servingSize:a.serving||"100g",servingValue:100,servingUnit:a.servingUnit||"g",portion:a.portion||null,protein:n.protein,carbs:n.carbs,fats:n.fats,calories:n.calories,per100g:!0}),a.portion?(b(1),v(String(a.portion.weight)),w("portion")):(b(0),v("100"),w("weight"))}else J({name:a.name,protein:a.protein,carbs:a.carbs,fats:a.fats,calories:a.calories,serving:a.serving||""})};return e.jsx("div",{className:"nut-recent-area",children:s.length===0?e.jsx("p",{className:"nut-search-empty",children:"No favourites yet. Tap the star on any food to save it here."}):e.jsx("div",{className:"nut-recent-list",children:s.map((a,n)=>e.jsxs("div",{className:"nut-recent-item-row",children:[e.jsx("button",{className:"nut-fav-star active",onClick:o=>{o.stopPropagation(),ne(a)},children:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),e.jsxs("button",{className:"nut-recent-item",onClick:()=>t(a),children:[e.jsxs("div",{className:"nut-recent-item-info",children:[e.jsx("span",{className:"nut-recent-item-name",children:a.name}),e.jsx("span",{className:"nut-recent-item-serving",children:a.serving||""})]}),e.jsxs("span",{className:"nut-recent-item-macros",children:[a.calories," cal"]})]})]},n))})})})(),y==="favourites"&&r&&(()=>{const s=r.servingUnit||"g",t=r.portion,a=k==="portion"&&t?h*t.weight:parseFloat(T)||0,n=a/100,o=s==="ml"?[100,200,250,500]:[50,100,150,200],c=k==="portion"&&t?`${h} ${t.label}${h!==1?"s":""} (${Math.round(a)}${s})`:`${Math.round(a)}${s}`;return e.jsxs("div",{className:"nut-product-result",children:[e.jsxs("div",{className:"nut-product-name-row",children:[e.jsx("h4",{children:r.name}),e.jsx("button",{className:`nut-fav-star confirm${O(r.name)?" active":""}`,onClick:()=>ne({name:r.name,protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories,serving:r.servingSize,per100g:{protein:r.protein,carbs:r.carbs,fats:r.fats,calories:r.calories},servingUnit:r.servingUnit||"g",portion:r.portion||null}),children:e.jsx("svg",{viewBox:"0 0 24 24",width:"22",height:"22",fill:O(r.name)?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})})]}),e.jsxs("p",{className:"nut-product-per",children:["Per 100",s,":"]}),e.jsxs("div",{className:"nut-product-macros",children:[e.jsxs("span",{className:"nut-macro-p",children:[r.protein,"g P"]}),e.jsxs("span",{className:"nut-macro-c",children:[r.carbs,"g C"]}),e.jsxs("span",{className:"nut-macro-f",children:[r.fats,"g F"]}),e.jsxs("span",{className:"nut-macro-cal",children:[r.calories," cal"]})]}),t&&e.jsxs("div",{className:"nut-mode-toggle",children:[e.jsx("button",{className:k==="portion"?"active":"",onClick:()=>{w("portion"),h<1&&b(1)},children:"Portions"}),e.jsxs("button",{className:k==="weight"?"active":"",onClick:()=>{w("weight"),v(String(Math.round(a)||100))},children:["Custom (",s,")"]})]}),k==="portion"&&t?e.jsxs("div",{className:"nut-portion-stepper",children:[e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(Math.max(1,h-1)),children:"-"}),e.jsxs("div",{className:"nut-stepper-display",children:[e.jsx("span",{className:"nut-stepper-count",children:h}),e.jsxs("span",{className:"nut-stepper-label",children:[t.label,h!==1?"s":""]}),e.jsxs("span",{className:"nut-stepper-weight",children:[Math.round(a),s]})]}),e.jsx("button",{className:"nut-stepper-btn",onClick:()=>b(h+1),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"nut-serving-adjust",children:[e.jsxs("label",{children:["Serving (",s,")"]}),e.jsx("input",{type:"number",inputMode:"numeric",value:T,onChange:i=>v(i.target.value),onFocus:i=>i.target.select(),min:"0"})]}),e.jsx("div",{className:"nut-quick-amounts",children:o.map(i=>e.jsxs("button",{className:`nut-quick-btn${T===String(i)?" active":""}`,onClick:()=>v(String(i)),children:[i,s]},i))})]}),e.jsx("div",{className:"nut-product-total",children:e.jsxs("span",{children:["Total: ",Math.round(r.protein*n),"p / ",Math.round(r.carbs*n),"c / ",Math.round(r.fats*n),"f / ",Math.round(r.calories*n)," cal"]})}),e.jsxs("div",{className:"nut-product-actions",children:[e.jsx("button",{className:"nut-btn-secondary",onClick:()=>_(null),children:"Back to Favourites"}),e.jsx("button",{className:"nut-btn-primary",onClick:()=>J({name:r.name,protein:Math.round(r.protein*n),carbs:Math.round(r.carbs*n),fats:Math.round(r.fats*n),calories:Math.round(r.calories*n),serving:c}),children:"Add"})]})]})})()]})}),e.jsx(ys,{active:"nutrition"}),q&&e.jsx("div",{className:`toast-notification ${q.type}`,children:q.message})]})}export{$s as default};
